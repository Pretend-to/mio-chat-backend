# 数据迁移指南

## 从配置文件迁移到数据库

如果你是从旧版本升级，需要将配置文件迁移到 SQLite 数据库。

### 一键迁移

```bash
# 迁移所有配置和数据
pnpm run migrate
```

### 迁移内容

这个命令会自动迁移：

- **系统配置**：server、web、onebot、debug 等配置
- **LLM 适配器配置**：所有 LLM 实例配置
- **插件配置**：包括 OneBot 插件配置
- **预设数据**：内置和自定义预设
- **模型所有者配置**：owners.yaml 中的配置

### 安全保障

- ✅ **自动备份**：迁移前会自动备份现有配置到 `backup/` 目录
- ✅ **智能检测**：不会重复迁移已存在的配置
- ✅ **详细报告**：提供成功、失败、跳过的详细统计
- ✅ **结果验证**：迁移完成后自动验证数据完整性

### 新用户

新用户无需迁移，应用启动时会自动初始化默认配置：

```bash
# 初始化默认配置（新用户）
pnpm run init-defaults
```

### 故障排除

如果迁移失败，可以：

1. 检查 `backup/` 目录中的备份文件
2. 查看迁移日志了解具体错误
3. 手动恢复备份文件
4. 重新运行迁移命令

### 迁移后

迁移完成后，原有的配置文件可以安全删除（建议保留备份）。