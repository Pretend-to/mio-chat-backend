services:
  mio-chat-backend:
    image: miofcip/miochat:latest
    container_name: mio-chat-backend
    restart: unless-stopped

    ports:
      - "${PORT:-3080}:${PORT:-3080}"

    environment:
      # 服务器配置
      - PORT=${PORT:-3080}
      - HOST=${HOST:-0.0.0.0}
      - NODE_ENV=production
      - TZ=Asia/Shanghai
      
      # 访问码配置（必须设置）
      - ADMIN_CODE=${ADMIN_CODE:-}
      - USER_CODE=${USER_CODE:-}
      
      # 可选配置
      - DEBUG=${DEBUG:-false}
      - LOG_LEVEL=${LOG_LEVEL:-info}

    # 正式版本：不挂载任何目录，使用容器内自带的文件
    # volumes: []

    # 健康检查（支持动态端口）
    healthcheck:
      test: ["CMD", "sh", "-c", "curl -f http://localhost:$${PORT:-3080}/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

    # 日志配置
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  default:
    name: mio-chat-network
