import{c as e,_ as t,R as a,F as l,T as s,I as o,a as n,C as i,s as c,f as r,b as d,d as u,r as p,u as v,E as m,e as h,g,L as f,A as y,p as b,P as w,h as _}from"./components-DoNJkV3V.js";import{a as k,R as C,u as x,q as S,H as P,_ as V,b as O}from"./vendor_editor_preview-z3gkd-VO.js";import"./vendor_emoji-C7BQ2utN.js";import{$ as T}from"./vendor_misc-BKj2OnSQ.js";import{aX as I,aY as M,c as L,a as j,e as $,t as A,n as R,b as U,w as E,j as B,v as z,f as q,F as D,d as N,o as W,g as J,s as H,i as F,k as Q,m as G,p as K,A as X,l as Y,aZ as Z,u as ee,h as te,q as ae,a3 as le,x as se,av as oe,E as ne,r as ie,B as ce,D as re}from"./vendor_vue-CSrYp3NK.js";import{E as de,m as ue,c as pe,e as ve,f as me,g as he,i as ge,j as fe,a as ye,r as be,k as we,n as _e,o as ke,q as Ce,t as xe,w as Se,x as Pe,y as Ve,z as Oe,A as Te,d as Ie,p as Me,B as Le,v as je,h as $e,C as Ae,D as Re,F as Ue,G as Ee,H as Be,I as ze,J as qe,K as De,L as Ne,s as We}from"./vendor_element_plus-CzIQaF8i.js";const Je=()=>k(()=>Promise.resolve().then(()=>bt),void 0),He=I({history:M("/"),routes:[{path:"/",name:"home",component:()=>k(()=>Promise.resolve().then(()=>xt),void 0),children:[{path:"/",name:"blank",component:Je},{path:"/contactors",name:"contactors",component:Je},{path:"/chat/:id",name:"chat_view",component:()=>k(()=>Promise.resolve().then(()=>gt),void 0)},{path:"/profile/:id",name:"profile_view",component:()=>k(()=>Promise.resolve().then(()=>Xt),void 0)}]},{path:"/auth",name:"auth",component:()=>k(()=>Promise.resolve().then(()=>ga),void 0)},{path:"/settings",name:"settings",component:()=>k(()=>Promise.resolve().then(()=>ua),void 0),redirect:"/settings",children:[{path:"",name:"settings_overview",component:()=>k(()=>Promise.resolve().then(()=>hl),void 0)},{path:"llm-adapters",name:"settings_llm_adapters",component:()=>k(()=>Promise.resolve().then(()=>Dl),void 0)},{path:"server",name:"settings_server",component:()=>k(()=>Promise.resolve().then(()=>Fl),void 0)},{path:"web",name:"settings_web",component:()=>k(()=>Promise.resolve().then(()=>Yl),void 0)},{path:"onebot",name:"settings_onebot",component:()=>k(()=>Promise.resolve().then(()=>ls),void 0)},{path:"plugins",name:"settings_plugins",component:()=>k(()=>Promise.resolve().then(()=>ko),void 0)},{path:"presets",name:"settings_presets",component:()=>k(()=>Promise.resolve().then(()=>tn),void 0)},{path:"logs",name:"settings_logs",component:()=>k(()=>Promise.resolve().then(()=>jn),void 0)}]}]});He.beforeEach(async t=>{if(!e.everLogin()&&"auth"!==t.name){de.warning("请先登录");return{name:"auth",query:"/settings"===t.path?null:{redirect:t.fullPath}}}});const Fe={id:"chat-window"},Qe={class:"upside-bar"},Ge={class:"contactor-name"},Ke={class:"delay-num"},Xe={class:"options"},Ye={key:0,class:"message-time"},Ze=["id"],et={key:0,class:"avatar"},tt=["src","alt"],at=["src","alt"],lt={key:1,class:"msg"},st={class:"wholename"},ot={key:0,class:"title"},nt={class:"name"},it=["onContextmenu"],ct={key:2,class:"reply-block"},rt={key:5},dt={key:7,class:"blank-message",style:{width:"10rem",height:"28.8px",position:"relative"}},ut={key:2,class:"system-message"},pt={class:"system-message-content"},vt={class:"system-message-button"},mt=["onClick"];const ht=t({components:{MdRenderer:C,ContextMenu:i,ForwardMsg:n,InputEditor:o,ToolCallBar:s,FileBlock:l,ReasonBlock:a},data(){let t,a,l=!1,s=!0;const o=window.location.href,n=new URL(o).searchParams;n.has("preview")&&"true"===n.get("preview")&&(l=!0),n.has("shareId")&&(t=n.get("shareId")),n.has("scroll")&&(s=n.get("scroll")||"true");const i=parseInt(this.$route.params.id);try{if(a=e.getContactor(i),!a)throw new Error("找不到联系人")}catch(c){const s=e.contactList[0].id;this.$router.push({path:`/chat/${s}`,query:{preview:l,shareId:t}}),a=e.getContactor(s)}return{scroll:s,preview:l,shareId:t,activeContactor:a,showwindow:!0,showemoji:!1,userInput:"",client:e,extraOptions:[],wraperPresets:{},selectedOption:null,currentDelay:0,toupdate:!1,seletedText:"",seletedImage:"",retryList:[],showMenu:!1,menuTop:0,menuLeft:0,validMessageIndex:-1,repliedMessageId:-1,autoScroll:!1,fullScreen:!1,chatWindowRef:null,prevScrollTop:0,showRollDown:!1,inputBarTop:0,clearMessageTip:"以上的对话记录已清除",loadingIcon:"<span id='message-loading-icon'></span>",katexPlugin:O,mioPlugins:[{plugin:x},{plugin:S},{plugin:P,options:{shape:"circle"}},{plugin:V}]}},computed:{getMenuStyle(){if(window.innerWidth<768){const e=160;return this.menuTop-e<0?{top:e+"px"}:{bottom:window.innerHeight-this.menuTop+16+"px"}}return this.menuLeft+110>window.innerWidth?{top:this.menuTop+"px",left:this.menuLeft-110+"px"}:{top:this.menuTop+"px",left:this.menuLeft+"px"}},getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},activeMessageChain(){return this.activeContactor.options.presetSettings?.opening?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain}},watch:{"$route.params.id"(t,a){const l=parseInt(t),s=e.getContactor(l);if(this.activeContactor=s,this.initContactor(this.activeContactor),this.chatWindowRef&&this.toButtom(),a){const t=parseInt(a),l=e.getContactor(t);this.disableContactor(l)}}},async mounted(){document.addEventListener("click",()=>{this.showMenu=!1,this.seletedText="",this.seletedImage=""}),this.chatWindowRef=this.$refs.chatWindow,this.chatWindowRef.addEventListener("scroll",this.scrollHandler),!this.preview&&this.scroll&&this.toButtom(),this.scroll=!0,this.initContactor(this.activeContactor),this.fullScreen=this.client.fullScreen;const t=document.querySelector(".input-bar");if(t){const e=window.innerHeight;this.inputBarTop=e-t.offsetTop}if(this.shareId){await e.loadOriginalContactors(this.shareId)?this.$router.push({path:"/chat/"+this.shareId,query:{preview:this.preview,scroll:!1}}):this.$message({message:"分享链接已失效",type:"error"})}},updated(){this.toupdate&&this.autoScroll&&0===this.retryList.length&&(this.toButtom(),this.toupdate=!1)},beforeUnmount(){this.disableContactor(this.activeContactor),this.chatWindowRef.removeEventListener("scroll",this.scrollHandler)},methods:{handleMouseUp(){const e=window.getSelection().toString();e&&(this.seletedText=e)},toButtom(e){setTimeout(()=>{(()=>{const t=this.chatWindowRef||document.getElementById("main-messages-window");t&&t.scrollTo({top:t.scrollHeight,behavior:e?"smooth":"instant"})})()},1)},cleanScreen(){this.activeContactor.messageChain=[],this.activeContactor.updateFirstMessage(),e.setLocalStorage(),this.activeContactor.emit("updateMessageSummary"),this.toupdate=!0,this.$message({message:"已清除会话记录",type:"success"})},cleanHistory(){this.activeContactor.updateFirstMessage(),this.$message({message:"上下文信息已清除，之后的请求将不再记录上文记录",type:"success"});for(let e=this.activeContactor.messageChain.length-1;e>=0;e--){const t=this.activeContactor.messageChain[e];"mio_system"===t.role&&"text"===t.content[0].type&&t.content[0].data.text===this.clearMessageTip&&this.activeContactor.messageChain.splice(e,1)}this.activeContactor.makeSystemMessage(this.clearMessageTip),e.setLocalStorage()},delSystemMessage(t){const a=this.activeContactor.messageChain[t];"text"===a.content[0].type&&a.content[0].data.text===this.clearMessageTip&&(this.activeContactor.firstMessageIndex=0),this.activeContactor.messageChain.splice(t,1),e.setLocalStorage()},isValidInput:e=>!/^[ \n]+$/.test(e),waiting(){this.$message({message:"此功能尚未开放",type:"warning"})},tolist(){this.$router.push({name:"home"})},async setModel(t){const a=t[0],l=t[2];this.activeContactor.options.provider=a,this.activeContactor.options.base.model=l,this.activeContactor.loadAvatar(),await e.setLocalStorage()},toimg(){const e=this.chatWindowRef.getBoundingClientRect();e.height=this.chatWindowRef.scrollHeight,T(this.chatWindowRef,{windowHeight:1.2*e.height,width:e.width}).then(e=>{const t=e.toDataURL("image/png"),a=document.createElement("a");a.download="chat.png",a.href=t,a.click()})},async share(){const t=await e.shareContactor(this.activeContactor.id);if(t&&t.shareUrl){const{shareUrl:e}=t,{success:a,message:l}=c(e);a?this.$message({message:l,type:"success"}):this.$message({message:l,type:"error"})}},hasOpening(){return!!this.activeContactor.options.presetSettings?.opening},getFullMessages(){return this.hasOpening()?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain},showTime(e){const t=this.getFullMessages(),a=t[e].time;if(0===e)return{show:!0,time:this.activeContactor.getShownTime(a)};return a-t[e-1].time>6e5?{show:!0,time:this.activeContactor.getShownTime(a)}:{show:!1,time:""}},separateTextAndImages(e){const t=/!\[([^\]]*)\]\((.*)\)/g;let a,l=[],s=0;for(;null!==(a=t.exec(e));){if(a.index>s){const t=e.slice(s,a.index).trim();t&&l.push({type:"text",data:{text:t}})}l.push({type:"image",data:{file:a[2]}}),s=t.lastIndex}if(s<e.length){const t=e.slice(s).trim();t&&l.push({type:"text",data:{text:t}})}return l},getChatwindowScrollheight(){var e=this.chatWindowRef.scrollTop,t=this.chatWindowRef.clientHeight,a=this.chatWindowRef.scrollHeight;return a-e/(a-t)*a},initContactor(t){t.active=!0,t.on("revMessage",e=>{this.activeContactor.messageChain.push(e),this.toupdate=!0}),t.on("delMessage",e=>{this.activeContactor.messageChain.splice(e,1),this.toupdate=!0}),t.on("updateMessage",()=>{this.$forceUpdate(),this.toupdate=!0,e.setLocalStorage()}),t.on("completeMessage",async t=>{const a=t.messageId,l=this.activeContactor.getMessageById(a);this.retryList.includes(a)&&(this.retryList=this.retryList.filter(e=>e!==a)),l.content.forEach((e,t)=>{if("text"===e.type&&"onebot"===this.activeContactor.platform){const a=this.separateTextAndImages(e.data.text);l.content.splice(t,1,...a)}}),this.toupdate=!0,this.$forceUpdate(),this.activeContactor.loadName(),e.setLocalStorage()})},disableContactor(e){e&&(e.active=!1,e.off("updateMessage"),e.off("revMessage"),e.off("delMessage"),e.off("completeMessage"))},getReplyText(e){let t="";const a=this.activeContactor.messageChain.find(t=>t.id===e||String(t.id)===String(e));return a?(a.content.forEach(e=>{"text"===e.type?t+=e.data.text:"image"===e.type&&(t+="[图片]")}),t.trim().slice(0,20)):"[消息已删除] "},imageLoaded(){this.scroll&&this.toButtom()},showMessageMenu(e,t){if("img"===e.target.tagName.toLowerCase()){const t=e.target.src;this.seletedImage=t}this.validMessageIndex="openai"===this.activeContactor.platform&&this.hasOpening()?t-1:t,e.preventDefault(),this.showMenu=!0,this.menuTop=e.clientY,this.menuLeft=e.clientX;const a=window.getSelection().toString();this.seletedText=a||""},toProfile(){this.$router.push({name:"profile_view",params:{id:this.activeContactor.id}})},scrollHandler(){const e=this.chatWindowRef.scrollTop,t=e>this.prevScrollTop,a=e<this.prevScrollTop;this.prevScrollTop=e,this.showMenu=!1,this.showemoji&&(this.showemoji=!1);const l=this.getChatwindowScrollheight();this.autoScroll=!(l>100);const s=l<=199;!t||this.autoScroll||s?(a||this.autoScroll||s)&&(this.showRollDown=!1):this.showRollDown=!0},getseletedMessage(){return this.activeContactor.messageChain[this.validMessageIndex]},handleMessageOption(t){const a=this.getseletedMessage();switch(t){case"retry":if("onebot"===this.activeContactor.platform)"user"===a.role?this.activeContactor.webSend(a):this.activeContactor.webSend({...a,role:"user"}),this.$message({message:"消息已重新发送",type:"success"});else{const e="user"===a.role?this.validMessageIndex+1:this.validMessageIndex;let t=this.activeContactor.messageChain[e];if(!t||"other"!==t.role){const a=this.activeContactor.getBaseUserContainer();a.role="other",this.activeContactor.insertMessage(a,e),t=a}if("retrying"===t.status)return void this.$message({message:"该消息正在重试中",type:"warning"});this.activeContactor.retryMessage(t.id),t.status="retrying",this.retryList.push(t.id)}this.toButtom();break;case"reply":"onebot"===this.activeContactor.platform?(this.repliedMessageId=a.id,this.$message({message:"已引用该消息",type:"success"})):this.userInput+=this.getReplyText(this.activeContactor.messageChain[this.validMessageIndex].id)+"\n\n";break;case"delete":this.activeContactor.messageChain.splice(this.validMessageIndex,1),e.setLocalStorage()}}}},[["render",function(e,t,a,l,s,o){const n=q("ContextMenu"),i=q("MdRenderer"),c=q("ForwardMsg"),r=q("FileBlock"),d=q("ReasonBlock"),u=q("ToolCallBar"),p=q("InputEditor");return W(),L("div",Fe,[j("div",Qe,[j("div",{class:"return",onClick:t[0]||(t[0]=e=>o.tolist())},t[8]||(t[8]=[j("i",{class:"iconfont icon-return"},null,-1)])),j("div",{class:"name-area",onClick:t[1]||(t[1]=(...e)=>o.toProfile&&o.toProfile(...e))},[j("div",Ge,A(s.activeContactor.name),1),j("span",{class:R("delay-status "+o.getDelayStatus)},null,2),j("span",Ke,"当前延迟: "+A(s.currentDelay)+" ms",1)]),j("ul",Xe,[j("li",{class:"share",onClick:t[2]||(t[2]=e=>o.share())},t[9]||(t[9]=[j("i",{class:"iconfont icon-share"},null,-1)]))])]),j("div",{id:"main-messages-window",ref:"chatWindow",class:R({"message-window":!0,preview:s.preview})},[s.showRollDown?(W(),L("div",{key:0,id:"roll-buttom-button",style:B({bottom:s.inputBarTop+24+"px"}),onClick:t[3]||(t[3]=e=>o.toButtom(!0))},t[10]||(t[10]=[j("i",{class:"iconfont down1"},null,-1)]),4)):U("",!0),E($(n,{type:"message",message:o.getseletedMessage(),"seleted-text":s.seletedText,"seleted-image":s.seletedImage,style:B(o.getMenuStyle),onMessageOption:o.handleMessageOption,onClose:t[4]||(t[4]=e=>s.showMenu=!1)},null,8,["message","seleted-text","seleted-image","style","onMessageOption"]),[[z,s.showMenu]]),(W(!0),L(D,null,N(o.activeMessageChain,(e,a)=>(W(),L("div",{key:`${s.activeContactor.id}-${e.id}`,ref_for:!0,ref:"message",class:"message-container"},[o.showTime(a).show?(W(),L("div",Ye,A(o.showTime(a).time),1)):U("",!0),j("div",{id:e.role,class:"message-body"},["mio_system"!==e.role?(W(),L("div",et,["other"===e.role?(W(),L("img",{key:0,src:s.activeContactor.avatar,alt:s.activeContactor.name,onClick:t[5]||(t[5]=(...e)=>o.toProfile&&o.toProfile(...e))},null,8,tt)):(W(),L("img",{key:1,src:s.client.avatar,alt:s.client.name},null,8,at))])):U("",!0),"mio_system"!==e.role?(W(),L("div",lt,[j("div",st,[("other"===e.role?s.activeContactor.title:s.client.title)?(W(),L("div",ot,A("other"===e.role?s.activeContactor.title:s.client.title),1)):U("",!0),j("div",nt,A("other"===e.role?s.activeContactor.name:s.client.name),1)]),j("div",{class:R(["content",e.status]),onMouseup:t[6]||(t[6]=(...e)=>o.handleMouseUp&&o.handleMouseUp(...e)),onContextmenu:e=>o.showMessageMenu(e,a)},[(W(!0),L(D,null,N(e.content,(a,l)=>(W(),L("div",{key:l,class:"inner-content"},["text"===a.type?(W(),J(i,{key:0,md:a.data.text,theme:"github",isStreaming:["pending","retrying"].includes(e.status)&&e.content.length-1===l,"custom-plugins":s.mioPlugins,"markdown-it-plugins":[{plugin:s.katexPlugin}],"markdown-it-options":{breaks:"onebot"===s.activeContactor.platform}},null,8,["md","isStreaming","custom-plugins","markdown-it-plugins","markdown-it-options"])):U("",!0),"image"===a.type?(W(),J(i,{md:`![image](${a.data.file})`,"custom-plugins":s.mioPlugins,theme:"github",key:a.data.file},null,8,["md","custom-plugins"])):"reply"===a.type?(W(),L("div",ct,A(o.getReplyText(a.data.id)),1)):"nodes"===a.type?(W(),J(c,{key:3,contactor:s.activeContactor,messages:a.data.messages},null,8,["contactor","messages"])):"file"===a.type?(W(),J(r,{key:4,"file-url":a.data.file},null,8,["file-url"])):"at"===a.type?(W(),L("span",rt)):"reason"===a.type?(W(),J(d,{key:6,"end-time":a.data.endTime,"start-time":a.data.startTime,content:a.data.text},null,8,["end-time","start-time","content"])):"blank"===a.type?(W(),L("div",dt,t[11]||(t[11]=[j("span",{class:"blank-loader"},null,-1)]))):"tool_call"===a.type?(W(),J(u,{key:8,"tool-call":a.data},null,8,["tool-call"])):U("",!0)]))),128))],42,it)])):(W(),L("div",ut,[j("div",pt,A(e.content[0].data.text),1),j("div",vt,[j("i",{class:"iconfont close",onClick:e=>o.delSystemMessage(a)},null,8,mt)])]))],8,Ze)]))),128))],2),$(p,{ref:"inputEditor","active-contactor":s.activeContactor,"replied-message-id":s.repliedMessageId,onStroge:t[7]||(t[7]=e=>s.client.setLocalStorage()),onSetModel:o.setModel,onCleanScreen:o.cleanScreen,onCleanHistory:o.cleanHistory,onToButtom:o.toButtom},null,8,["active-contactor","replied-message-id","onSetModel","onCleanScreen","onCleanHistory","onToButtom"])])}],["__scopeId","data-v-f6edf145"]]),gt=Object.freeze(Object.defineProperty({__proto__:null,default:ht},Symbol.toStringTag,{value:"Module"})),ft={class:"blank-view"};const yt=t({name:"BlankView",data:()=>({fullScreen:!1,client:e}),watch:{},created(){this.fullScreen=e.fullScreen},methods:{waiting(){this.$message({message:"此功能尚未开放",type:"warning"})}}},[["render",function(e,t,a,l,s,o){return W(),L("div",ft,t[0]||(t[0]=[j("div",{class:"upside-bar"},[j("div",{class:"options"})],-1)]))}],["__scopeId","data-v-29ea73df"]]),bt=Object.freeze(Object.defineProperty({__proto__:null,default:yt},Symbol.toStringTag,{value:"Module"})),wt={key:0,id:"main"},_t={key:1,id:"main-mobile"},kt={key:2,id:"main-mobile",class:"mobile-chat"};const Ct=t({components:{friendlist:r,blankView:yt},data(){return{onPhone:window.innerWidth<600,pagePath:this.$route.path,loaded:!1}},watch:{$route:function(e){this.pagePath=e.path}},mounted(){e.inited?this.loaded=!0:e.on("loaded",()=>{this.loaded=!0},!1)}},[["render",function(e,t,a,l,s,o){const n=q("friendlist"),i=q("router-view"),c=q("blankView");return s.onPhone?"/"===s.pagePath?(W(),L("div",_t,[s.loaded?(W(),J(n,{key:0})):(W(),J(c,{key:1}))])):(W(),L("div",kt,[s.loaded?(W(),J(i,{key:0})):(W(),J(c,{key:1}))])):(W(),L("div",wt,[$(n),s.loaded?(W(),J(i,{key:0})):(W(),J(c,{key:1}))]))}]]),xt=Object.freeze(Object.defineProperty({__proto__:null,default:Ct},Symbol.toStringTag,{value:"Module"})),St={class:"profile-body"},Pt={id:"profile"},Vt={class:"profile-container"},Ot={class:"base-info"},Tt={class:"base-info-avatar"},It={class:"base-info-content"},Mt={class:"name"},Lt={class:"id"},jt={class:"status"},$t={class:"info-blocks"},At={class:"settings-block"},Rt={class:"block-content"},Ut={class:"block-content-item"},Et={class:"item-content"},Bt={class:"block-content-item"},zt={class:"item-content"},qt={key:0,class:"block-content-item"},Dt={class:"item-content"},Nt={key:1,class:"block-content-item"},Wt={class:"item-content"},Jt={class:"block-content-item"},Ht={class:"item-content"},Ft={class:"info-blocks"},Qt={class:"action-bar"},Gt={class:"dialog-footer"};const Kt=t({components:{ContactorSettings:d},data(){const t=parseInt(this.$route.params.id),a=e.getContactor(t),l=u.getToolCallModes(),s=u.getLLMProviders(),o=u.getSafetySettingsParams(),n=Object.keys(o).map(e=>({value:e,label:e})),i=[];for(const e in u.llmTools){const t=u.llmTools[e],a=Object.keys(t).map(e=>({enabled:!1,...t[e]}));i.push({name:e,tools:a,collapsed:!0})}return{activeContactor:a,options:null,currentDelay:0,centerDialogVisible:!1,avatarPolicyList:[{value:0,label:"跟随模型"},{value:1,label:"自定义"}],namePolicyList:[{value:0,label:"跟随模型"},{value:1,label:"自定义"},{value:2,label:"对话摘要"}],isOnebot:"onebot"===a.platform,llmProviders:s,toolCallModes:l,safetyParams:o,safetySimpleValue:n,allLLMTools:i,basicInfo:null}},computed:{getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},getAvatarPolicyValue(){return 1===this.basicInfo.avatarPolicy?"自定义":"跟随模型"}},watch:{"$route.params.id"(t){const a=parseInt(t);this.activeContactor=e.getContactor(a),this.activeContactor&&(this.isOnebot="onebot"===this.activeContactor.platform),this.initContactor()},options:{handler(t){t&&this.activeContactor&&(this.activeContactor.options=JSON.parse(JSON.stringify(t)),e.setLocalStorage())},deep:!0},basicInfo:{handler(t){t&&this.activeContactor&&(this.activeContactor.name=t.name,this.activeContactor.avatar=t.avatar,this.activeContactor.namePolicy=t.namePolicy,this.activeContactor.avatarPolicy=t.avatarPolicy,this.activeContactor.priority=t.priority?0:1,e.setLocalStorage())},deep:!0}},created(){this.initContactor()},mounted(){this.delayInterval=setInterval(()=>{this.currentDelay=e.socket.delay},3e3)},beforeUnmount(){this.delayInterval&&clearInterval(this.delayInterval)},methods:{initContactor(){this.options=JSON.parse(JSON.stringify(this.activeContactor.options));const{name:e,avatar:t,namePolicy:a,avatarPolicy:l,priority:s}=this.activeContactor;this.basicInfo={name:e,avatar:t,namePolicy:a,avatarPolicy:l,priority:1!==s},"onebot"===this.activeContactor.platform&&this.options.toolCallSettings&&(this.options.toolCallSettings.mode="none",this.options.toolCallSettings.tools=[])},handleUpdateOpenaiPresets(e){this.options&&this.options.presetSettings&&(this.options.presetSettings.history=e,this.$message({message:"预设历史记录已更新",type:"success"}))},async delContactor(){this.centerDialogVisible=!1,await e.rmContactor(this.activeContactor.id),this.$router.push("/")},handleProviderSwitched(){this.activeContactor.loadAvatar()},updateContactorName(){0===this.basicInfo.namePolicy&&(this.basicInfo.name=this.activeContactor.options.base.model)},updateContactorAvatar(){const{avatarPolicy:e}=this.basicInfo;this.activeContactor.avatarPolicy=e,this.basicInfo.avatar=this.activeContactor.loadAvatar()}}},[["render",function(e,t,a,l,s,o){const n=q("el-image"),i=q("el-input"),c=q("el-option"),r=q("el-select"),d=q("el-switch"),u=q("ContactorSettings"),p=q("el-button"),v=q("el-dialog");return W(),L("div",St,[j("div",Pt,[j("div",Vt,[j("div",Ot,[j("div",Tt,[$(n,{src:s.activeContactor.avatar,"preview-src-list":[s.activeContactor.avatar]},null,8,["src","preview-src-list"])]),j("div",It,[j("div",Mt,A(s.activeContactor.name),1),j("div",Lt,"ID "+A(s.activeContactor.id),1),j("div",jt,[j("span",{class:R("delay-status "+o.getDelayStatus)},null,2),t[10]||(t[10]=H(" 在线 "))])])]),j("div",$t,[j("div",At,[t[16]||(t[16]=j("div",{class:"block-title"},"Bot 基本配置",-1)),j("div",Rt,[j("div",Ut,[t[11]||(t[11]=j("div",{class:"contactor-name item-title"},"昵称",-1)),j("div",Et,[$(i,{modelValue:s.basicInfo.name,"onUpdate:modelValue":t[0]||(t[0]=e=>s.basicInfo.name=e),disabled:1!==s.basicInfo.namePolicy},null,8,["modelValue","disabled"])])]),j("div",Bt,[t[12]||(t[12]=j("div",{class:"item-title"},"头像",-1)),j("div",zt,[1!==s.basicInfo.avatarPolicy?(W(),J(i,{key:0,value:"跟随模型",disabled:!0})):(W(),J(i,{key:1,modelValue:s.basicInfo.avatar,"onUpdate:modelValue":t[1]||(t[1]=e=>s.basicInfo.avatar=e),disabled:s.isOnebot},null,8,["modelValue","disabled"]))])]),s.isOnebot?U("",!0):(W(),L("div",qt,[t[13]||(t[13]=j("div",{class:"item-title"},"头像策略",-1)),j("div",Dt,[$(r,{modelValue:s.basicInfo.avatarPolicy,"onUpdate:modelValue":t[2]||(t[2]=e=>s.basicInfo.avatarPolicy=e),onChange:o.updateContactorAvatar},{default:F(()=>[(W(!0),L(D,null,N(s.avatarPolicyList,e=>(W(),J(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])])),s.isOnebot?U("",!0):(W(),L("div",Nt,[t[14]||(t[14]=j("div",{class:"item-title"},"昵称策略",-1)),j("div",Wt,[$(r,{modelValue:s.basicInfo.namePolicy,"onUpdate:modelValue":t[3]||(t[3]=e=>s.basicInfo.namePolicy=e),onChange:o.updateContactorName},{default:F(()=>[(W(!0),L(D,null,N(s.namePolicyList,e=>(W(),J(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])])),j("div",Jt,[t[15]||(t[15]=j("div",{class:"item-title"},"会话置顶",-1)),j("div",Ht,[$(d,{modelValue:s.basicInfo.priority,"onUpdate:modelValue":t[4]||(t[4]=e=>s.basicInfo.priority=e)},null,8,["modelValue"])])])])])]),j("div",Ft,[s.isOnebot?U("",!0):(W(),J(u,{key:0,"model-value":s.options,"onUpdate:modelValue":t[5]||(t[5]=e=>s.options=e),"active-contactor-platform":s.activeContactor.platform,"llm-providers-list":s.llmProviders,"tool-call-modes-list":s.toolCallModes,"all-llm-tools-data":s.allLLMTools,"safety-settings-params":s.safetyParams,"safety-simple-value-options":s.safetySimpleValue,"presets-history-data":s.options.presetSettings?.history,onProviderChanged:o.handleProviderSwitched,onUpdatePresets:o.handleUpdateOpenaiPresets},null,8,["model-value","active-contactor-platform","llm-providers-list","tool-call-modes-list","all-llm-tools-data","safety-settings-params","safety-simple-value-options","presets-history-data","onProviderChanged","onUpdatePresets"]))])])]),j("div",Qt,[$(p,{plain:"",onClick:t[6]||(t[6]=t=>e.$router.push(`/chat/${s.activeContactor.id}`))},{default:F(()=>t[17]||(t[17]=[H(" 发送消息 ")])),_:1}),$(p,{type:"danger",plain:"",onClick:t[7]||(t[7]=e=>s.centerDialogVisible=!0)},{default:F(()=>t[18]||(t[18]=[H(" 删除好友 ")])),_:1}),$(v,{modelValue:s.centerDialogVisible,"onUpdate:modelValue":t[9]||(t[9]=e=>s.centerDialogVisible=e),title:"警告",width:"300",center:"",class:"confirm-dialog"},{footer:F(()=>[j("div",Gt,[$(p,{onClick:t[8]||(t[8]=e=>s.centerDialogVisible=!1)},{default:F(()=>t[19]||(t[19]=[H("取消")])),_:1}),$(p,{type:"primary",onClick:o.delContactor},{default:F(()=>t[20]||(t[20]=[H(" 确认 ")])),_:1},8,["onClick"])])]),default:F(()=>[t[21]||(t[21]=j("span",null," 确认要删除此好友吗？该操作不可逆。 ",-1))]),_:1},8,["modelValue"])])])}],["__scopeId","data-v-af8b78ce"]]),Xt=Object.freeze(Object.defineProperty({__proto__:null,default:Kt},Symbol.toStringTag,{value:"Module"}));function Yt(){const t=Q([]),a=Q(!1),l=Q(null),s=Q(e.socket),o=Q(e.isConnected),n=new Map;let i=null;const c=()=>{s.value&&s.value.socket&&(r(),i=e=>{try{const t=JSON.parse(e);"logs"===t.protocol&&(e=>{const{request_id:t,type:s}=e;if(t&&n.has(t)){const l=n.get(t);return n.delete(t),"subscribe"===s&&e.success?a.value=!0:"unsubscribe"===s&&e.success&&(a.value=!1),void l(e)}switch(s){case"SUBSCRIBED":a.value=!0;break;case"UNSUBSCRIBED":a.value=!1;break;case"stream":u(e.data);break;case"LOG_STATS":e.success&&(l.value=e.data)}})(t)}catch(t){}},s.value.socket.on("message",i))},r=()=>{s.value&&s.value.socket&&i&&s.value.socket.off("message",i),i=null},d=(e,t)=>new Promise((a,l)=>{if(!s.value||!o.value)return void setTimeout(()=>{a("subscribe"===e?{success:!0,data:{message:"模拟订阅成功"}}:"unsubscribe"===e?{success:!0,data:{message:"模拟取消订阅成功"}}:{success:!0,data:{message:`模拟 ${e} 成功`}})},500);const i=p(16);n.set(i,a),setTimeout(()=>{if(n.has(i)){n.delete(i);const e=new Error("请求超时");l(e)}},3e4);const c={request_id:i,protocol:"logs",type:e,data:t};s.value.sendMessage(c)}),u=e=>{t.value.push(e),t.value.length>2e3&&t.value.splice(0,t.value.length-2e3)},v=async(e={})=>{const t={level:"INFO",modules:[],realtime:!0,bufferSize:1e3,sendHistory:!0};try{const l=await d("subscribe",{...t,...e});return!l.success||s.value&&o.value||(a.value=!0,h()),l}catch(l){throw l}};let m=null;const h=()=>{let e=1;m=setInterval(()=>{const t={id:`mock_stream_${e}`,timestamp:(new Date).toISOString(),level:["INFO","WARN","ERROR","DEBUG"][Math.floor(4*Math.random())],module:["llm","onebot","system"][Math.floor(3*Math.random())],message:`模拟实时日志消息 #${e}`,caller:`mock.js:${Math.floor(100*Math.random())}`,ip:"127.0.0.1"};u(t),e++},2e3)},g=()=>{m&&(clearInterval(m),m=null)},f=async()=>{try{const e=await d("unsubscribe",{});return!e.success||s.value&&o.value||(a.value=!1,g()),e}catch(e){throw e}},y=()=>{if(!e.socket)return null;const t=t=>{o.value=!0,s.value=e.socket,setTimeout(()=>{c(),a.value&&k()},100)},l=e=>{o.value=!1,r()},n=e=>{o.value=!1,r()};return e.socket.on("connect",t),e.socket.on("disconnect",l),e.socket.on("connect_error",n),()=>{e.socket&&(e.socket.off("connect",t),e.socket.off("disconnect",l),e.socket.off("connect_error",n))}},b=()=>{let t=s.value?s.value.id:null;const a=setInterval(()=>{const a=e.isConnected,l=e.socket,n=l?l.id:null;a!==o.value&&(o.value=a,a&&l?(s.value=l,t=n,c()):(s.value=null,t=null,r())),n!==t&&(s.value=l,t=n,a&&l?c():r())},2e3);return()=>{clearInterval(a)}};let w=null,_=null;const k=async()=>{try{await v({level:"INFO",modules:[],realtime:!0,bufferSize:1e3,sendHistory:!0})}catch(e){s.value&&o.value||(a.value=!0,h())}};return G(()=>{o.value=e.isConnected,s.value=e.socket,w=y(),_=b(),o.value&&s.value&&c(),setTimeout(()=>{k()},2e3)}),K(async()=>{if(a.value&&s.value&&o.value)try{await f()}catch(e){}r(),g(),w&&w(),_&&_(),n.clear()}),{logs:t,isConnected:o,stats:l,search:async e=>await d("search",e),exportLogs:async e=>await d("export",e),updateConfig:async(e,t)=>await d("config",{type:e,value:t}),getStats:async()=>{try{const e=await d("stats",{});return e.success&&(l.value=e.data),e}catch(e){return{success:!1,error:e}}},clearLogs:()=>{t.value=[]},subscribe:v,unsubscribe:f,manualInit:()=>{o.value=e.isConnected,s.value=e.socket,w=y(),_=b(),o.value&&s.value&&c(),setTimeout(()=>{k()},2e3)}}}let Zt=null;const ea=X("log",()=>{const e=Q(!1),t=Q([]),a=Q(!1),l=Q(null),s=Y(()=>t.value.length),o=()=>{Zt&&(t.value=Zt.logs.value,a.value=Zt.isConnected.value,l.value=Zt.stats.value)};return{isInitialized:e,logs:t,isConnected:a,stats:l,totalLogsCount:s,initialize:async()=>{if(e.value&&Zt)o();else try{Zt||(Zt=Yt(),Zt.manualInit(),setInterval(o,1e3)),e.value=!0,o()}catch(t){throw t}},clearLogs:()=>{Zt&&Zt.clearLogs()},getStats:async()=>Zt?await Zt.getStats():{success:!1,error:"LogViewer not initialized"},search:async e=>Zt?await Zt.search(e):{success:!1,error:"LogViewer not initialized"},exportLogs:async e=>Zt?await Zt.exportLogs(e):{success:!1,error:"LogViewer not initialized"},subscribe:async e=>Zt?await Zt.subscribe(e):{success:!1,error:"LogViewer not initialized"},unsubscribe:async()=>Zt?await Zt.unsubscribe():{success:!1,error:"LogViewer not initialized"},syncLogViewerState:o}}),ta=["title"],aa={key:0,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},la={key:1,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},sa={class:"mobile-title"},oa={class:"restart-banner-content"},na={class:"mobile-menu-content"},ia=["onClick"],ca={key:0,class:"settings-sidebar"},ra={class:"quick-actions"},da=t({__name:"SettingsView",setup(t){const a=Z(),l=ae(),s=v(),o=ea(),n=Q(!1),i=Q(!1),c=Q(!1),r=Y(()=>"/settings"===a.path),d=[{index:"overview",label:"概览",icon:ue},{index:"llm-adapters",label:"LLM 适配器",icon:pe},{index:"server",label:"服务器配置",icon:ve},{index:"web",label:"Web 配置",icon:me},{index:"onebot",label:"OneBot 配置",icon:he},{index:"plugins",label:"插件管理",icon:ge},{index:"presets",label:"预设管理",icon:fe},{index:"logs",label:"日志管理",icon:fe}],u=()=>{s.clearAdminCode(),l.push({path:"/auth",query:{redirect:a.fullPath||a.path}})},p=()=>{l.push("/")},h=()=>{i.value=window.innerWidth<=768},g=Y(()=>{const e=a.path;return e.includes("llm-adapters")?"llm-adapters":e.includes("server")?"server":e.includes("web")?"web":e.includes("onebot")?"onebot":e.includes("plugins")?"plugins":e.includes("presets")?"presets":e.includes("logs")?"logs":"overview"}),f=()=>{const e=a.path;return"/settings"!==e&&e.startsWith("/settings/")},y=()=>{if("/settings"===a.path)return"设置";const e=d.find(e=>e.index===g.value);return e?e.label:"设置"},b=()=>{c.value=!c.value},w=()=>{c.value=!1},_=()=>{const e=a.path;"/settings"!==e&&e.startsWith("/settings/")?l.push("/settings"):l.push("/")},k=e=>{"overview"===e?l.push("/settings"):l.push(`/settings/${e}`)},C=async()=>{try{await ye.confirm("重启服务将断开所有连接，是否继续？","确认重启",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),de.info("重启服务功能需要后端支持，暂未实现")}catch(e){}},x=async()=>{try{await ye.confirm("此操作将重置所有配置到默认状态，是否继续？","确认重置",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});await e.reset()&&(de.success("重置成功"),setTimeout(()=>{window.location.reload()},500))}catch(t){"cancel"!==t&&de.error("重置失败："+t.message)}},S=async()=>{try{await ye.confirm("此操作将清理所有缓存数据，是否继续？","确认清理",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await e.resetCache(),de.success("清理缓存成功"),setTimeout(()=>{window.location.reload()},500)}catch(t){"cancel"!==t&&de.error("清理缓存失败："+t.message)}};return G(async()=>{h(),window.addEventListener("resize",h);try{await o.initialize()}catch(e){}if(s.isAuthenticated)try{await s.fetchConfig()}catch(e){n.value=!0}else n.value=!0}),K(()=>{window.removeEventListener("resize",h)}),(e,t)=>{const a=q("el-button"),l=q("el-alert"),o=q("el-icon"),v=q("el-menu-item"),h=q("el-menu"),P=q("el-result"),V=q("router-view");return W(),L("div",{id:"settings-view",class:R({"mobile-layout":i.value})},[i.value?(W(),L("div",{key:0,class:R(["mobile-header",{"sub-page":f(),"main-page":!f()}])},[j("div",{class:R(["mobile-header-content",{"sub-page":f()}])},[j("button",{class:"back-button",onClick:_,title:f()?"返回设置":"关闭设置"},[f()?(W(),L("svg",aa,t[1]||(t[1]=[j("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(W(),L("svg",la,t[2]||(t[2]=[j("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1)])))],8,ta),j("h1",sa,A(y()),1),r.value?(W(),L("button",{key:0,class:"menu-button",onClick:b},t[3]||(t[3]=[j("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[j("path",{d:"M3 12h18M3 6h18M3 18h18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)]))):U("",!0)],2)],2)):U("",!0),ee(s).needRestart?(W(),J(l,{key:1,type:"warning",closable:!1,"show-icon":"",class:R(["restart-banner",{mobile:i.value}])},{title:F(()=>[j("div",oa,[j("span",null,A(i.value?"需要重启服务":"配置已更改，需要重启服务才能生效"),1),$(a,{type:"warning",size:(i.value,"small"),onClick:C},{default:F(()=>t[4]||(t[4]=[H(" 重启服务 ")])),_:1},8,["size"])])]),_:1},8,["class"])):U("",!0),i.value?(W(),L("div",{key:2,class:R(["mobile-menu-overlay",{show:c.value}]),onClick:w},[j("div",{class:R(["mobile-menu-drawer",{show:c.value}]),onClick:t[0]||(t[0]=te(()=>{},["stop"]))},[j("div",{class:"mobile-menu-header"},[t[6]||(t[6]=j("h2",null,"设置菜单",-1)),j("button",{class:"close-button",onClick:w},t[5]||(t[5]=[j("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[j("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)]))]),j("div",na,[(W(),L(D,null,N(d,e=>j("div",{key:e.index,class:R(["mobile-menu-item",{active:g.value===e.index}]),onClick:t=>{return a=e.index,k(a),void w();var a}},[(W(),J(le(e.icon),{class:"menu-icon"})),j("span",null,A(e.label),1)],10,ia)),64)),j("div",{class:"mobile-quick-actions"},[j("div",{class:"quick-action-item",onClick:x},t[7]||(t[7]=[j("span",null,"重置全部",-1)])),j("div",{class:"quick-action-item",onClick:S},t[8]||(t[8]=[j("span",null,"清理缓存",-1)]))])])],2)],2)):U("",!0),j("div",{class:R(["settings-container",{mobile:i.value}])},[i.value?U("",!0):(W(),L("aside",ca,[$(h,{"default-active":g.value,class:"settings-menu",onSelect:k},{default:F(()=>[(W(),L(D,null,N(d,e=>$(v,{key:e.index,index:e.index},{default:F(()=>[$(o,null,{default:F(()=>[(W(),J(le(e.icon)))]),_:2},1024),j("span",null,A(e.label),1)]),_:2},1032,["index"])),64))]),_:1},8,["default-active"]),j("div",ra,[$(a,{type:"info",plain:"",onClick:x,style:{width:"100%"}},{default:F(()=>t[9]||(t[9]=[H(" 重置全部 ")])),_:1}),$(a,{type:"info",plain:"",onClick:S,style:{width:"100%"}},{default:F(()=>t[10]||(t[10]=[H(" 清理缓存 ")])),_:1})])])),j("main",{class:R(["settings-content",{mobile:i.value}])},[t[13]||(t[13]=j("div",{class:"content-header-spacer"},null,-1)),n.value?(W(),L("div",{key:0,class:R(["forbidden-container",{mobile:i.value}])},[$(P,{icon:"error",title:"禁止访问","sub-title":"当前访问码无权限或已失效，您无法访问配置管理页面。"},{extra:F(()=>[$(a,{type:"primary",onClick:u},{default:F(()=>t[11]||(t[11]=[H("切换账号")])),_:1}),$(a,{onClick:p},{default:F(()=>t[12]||(t[12]=[H("返回首页")])),_:1})]),_:1})],2)):(W(),J(m,{key:1,"fallback-title":"页面加载失败","fallback-message":"配置页面加载时发生错误，请刷新页面重试"},{default:F(()=>[$(V,null,{default:F(({Component:e})=>[$(se,{name:"page-fade",mode:"out-in"},{default:F(()=>[(W(),J(le(e)))]),_:2},1024)]),_:1})]),_:1}))],2)],2)],2)}}},[["__scopeId","data-v-67e7198d"]]),ua=Object.freeze(Object.defineProperty({__proto__:null,default:da},Symbol.toStringTag,{value:"Module"})),pa={class:"auth-view"},va={class:"container"},ma={class:"controls"},ha=t({__name:"AuthView",setup(t){const a=v(),l=Q(),s=Q(!1),o=Q(),n=async t=>{if(await ne(()=>o.value.classList.add("active")),!s.value){s.value=!0;try{const l=await e.login(t);l&&(de.success(`成功以${l.is_admin?"管理员身份":"游客身份"}登录，欢迎使用!`),t&&l.is_admin&&a.setAdminCode(t),He.currentRoute.value.query.redirect?He.push(He.currentRoute.value.query.redirect):He.push("/"))}catch(l){de.error(l)}finally{await ne(()=>o.value.classList.remove("active")),s.value=!1}}};function i(e){"Enter"===e.key&&n(l.value)}return K(()=>{removeEventListener("keydown",i)}),G(()=>{addEventListener("keydown",i),He.currentRoute.value.query.key&&n(He.currentRoute.value.query.key)}),(e,t)=>(W(),L("div",pa,[j("div",va,[j("div",{ref_key:"iconContainer",ref:o,class:"icon-container"},t[3]||(t[3]=[j("i",{class:"iconfont ChatGPT"},null,-1)]),512),t[4]||(t[4]=j("h1",{class:"title"},"登录验证",-1)),t[5]||(t[5]=j("p",{class:"hint"},"管理员开启了密码验证，请在下方填入访问码",-1)),E(j("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),type:"password",placeholder:"在此处填写访问码"},null,512),[[oe,l.value]]),j("div",ma,[j("button",{class:"later",onClick:t[1]||(t[1]=e=>n())},"游客登录"),j("button",{class:"login",onClick:t[2]||(t[2]=e=>n(l.value))},"登录")])])]))}},[["__scopeId","data-v-c7b24051"]]),ga=Object.freeze(Object.defineProperty({__proto__:null,default:ha},Symbol.toStringTag,{value:"Module"}));const fa=new class{constructor(){this.configAPI=h}async getPresets(e={}){const t=new URLSearchParams(e).toString(),a="/api/config/presets"+(t?"?"+t:"");return this.configAPI.request(a)}async getPreset(e){return this.configAPI.request(`/api/config/presets/${encodeURIComponent(e)}`)}async createPreset(e){return this.configAPI.request("/api/config/presets",{method:"POST",body:JSON.stringify(e)})}async updatePreset(e,t){return this.configAPI.request(`/api/config/presets/${encodeURIComponent(e)}`,{method:"PUT",body:JSON.stringify(t)})}async deletePreset(e){return this.configAPI.request(`/api/config/presets/${encodeURIComponent(e)}`,{method:"DELETE"})}async reloadPresets(){return this.configAPI.request("/api/config/presets/reload",{method:"POST"})}async importPreset(e){const t=new FormData;t.append("file",e);const a={"X-Admin-Code":this.configAPI.adminCode};try{const e=await fetch("/api/config/presets/import",{method:"POST",headers:a,body:t}),l=await e.json();if(!e.ok)throw 401!==e.status&&403!==e.status||("UNAUTHORIZED"===l.error||"FORBIDDEN"===l.error||l.message?.includes("认证")||l.message?.includes("权限")||l.message?.includes("访问码"))&&(this.configAPI.adminCode="",localStorage.removeItem("admin_code")),new Error(l.message||l.error||"导入失败");if(0!==l.code&&void 0!==l.code)throw new Error(l.message||"导入失败");return l}catch(l){throw l}}async exportPreset(e){try{const t={"X-Admin-Code":this.configAPI.adminCode},a=await fetch(`/api/config/presets/${encodeURIComponent(e)}/export`,{method:"GET",headers:t});if(!a.ok){const e=await a.json();throw new Error(e.message||e.error||"导出失败")}const l=a.headers.get("Content-Disposition");let s=`${e}.json`;if(l){const e=l.match(/filename[*]?=['"]?([^'";\n]+)['"]?/);e&&(s=e[1])}const o=await a.blob(),n=window.URL.createObjectURL(o),i=document.createElement("a");i.href=n,i.download=s,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(n)}catch(t){try{const t=await this.getPreset(e),a={name:t.data.name,category:t.data.category,history:t.data.history,opening:t.data.opening,tools:t.data.tools},l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),s=window.URL.createObjectURL(l),o=document.createElement("a");o.href=s,o.download=`${e}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(s)}catch(a){throw t}}}async batchDeletePresets(e){const t=[];for(const l of e)try{const e=await this.deletePreset(l);t.push({success:!0,presetId:l,result:e})}catch(a){t.push({success:!1,presetId:l,error:a.message})}return t}async validatePreset(e){return this.configAPI.request("/api/config/presets/validate",{method:"POST",body:JSON.stringify(e)})}},ya=X("presets",()=>{const e=Q([]),t=Q({totalCount:0,categoryCount:{common:0,recommended:0,hidden:0},sourceCount:{"built-in":0,custom:0}}),a=Q({total:0,start:0,nums:50,hasMore:!1}),l=Q(!1),s=Y(()=>(e.value||[]).map(e=>({...e,id:e.name}))),o=Y(()=>t.value?.totalCount||0),n=Y(()=>t.value?.categoryCount||{common:0,recommended:0,hidden:0}),i=Y(()=>t.value?.sourceCount||{"built-in":0,custom:0}),c=Y(()=>{const t={common:[],recommended:[],hidden:[]};return(e.value||[]).forEach(e=>{e.category&&t.hasOwnProperty(e.category)&&t[e.category].push(e)}),t});async function r(s={},o=!1){l.value=!0;try{const l=(await fa.getPresets(s)).data||{};if(o&&s.start>0){const t=l.presets||[];e.value=[...e.value,...t]}else e.value=l.presets||[];return l.summary&&(t.value={totalCount:l.summary.totalCount||0,categoryCount:l.summary.categoryCount||{common:0,recommended:0,hidden:0},sourceCount:l.summary.sourceCount||{"built-in":0,custom:0}}),l.pagination&&(a.value={total:l.pagination.total||0,start:l.pagination.start||0,nums:l.pagination.nums||50,hasMore:l.pagination.hasMore||!1}),l}catch(n){throw n}finally{l.value=!1}}async function d(t){try{const a=await fa.deletePreset(t),l=e.value.findIndex(e=>e.name===t);return l>-1&&e.value.splice(l,1),a.data}catch(a){throw a}}return{presets:e,summary:t,pagination:a,loading:l,allPresets:s,totalCount:o,countByCategory:n,countBySource:i,presetsByCategory:c,fetchPresets:r,getPreset:async function(e){try{return(await fa.getPreset(e)).data}catch(t){throw t}},createPreset:async function(e){try{const t=await fa.createPreset(e);return await r(),t.data}catch(t){throw t}},updatePreset:async function(e,t){try{const a=await fa.updatePreset(e,t);return await r(),a.data}catch(a){throw a}},deletePreset:d,batchDeletePresets:async function(e){const t=[];for(const l of e)try{await d(l),t.push({success:!0,presetId:l})}catch(a){t.push({success:!1,presetId:l,error:a.message})}return t},importPreset:async function(e){try{const t=await fa.importPreset(e);return await r(),t.data}catch(t){throw t}},exportPreset:async function(e){try{await fa.exportPreset(e)}catch(t){throw t}},reloadPresets:async function(){try{const e=await fa.reloadPresets();return await r(),e.data}catch(e){throw e}},searchPresets:function(t){const a=e.value||[];if(!t)return a;const l=t.toLowerCase();return a.filter(e=>e.name?.toLowerCase().includes(l)||e.opening?.toLowerCase().includes(l)||e.history?.some(e=>e.content?.toLowerCase().includes(l)))},findPresetById:function(e){return(s.value||[]).find(t=>t.id===e)},findPresetByName:function(e){return(s.value||[]).find(t=>t.name===e)}}}),ba={class:"overview-view"},wa={key:0,class:"loading-container"},_a={class:"stats-grid"},ka={key:0,class:"content-container"},Ca={class:"overview-header"},xa={class:"header-actions"},Sa={class:"stats-grid"},Pa={class:"stat-icon",style:{"background-color":"#409eff20"}},Va={class:"stat-content"},Oa={class:"stat-value"},Ta={class:"stat-icon",style:{"background-color":"#67c23a20"}},Ia={class:"stat-content"},Ma={class:"stat-value"},La={class:"stat-icon",style:{"background-color":"#e6a23c20"}},ja={class:"stat-content"},$a={class:"stat-value"},Aa={class:"stat-icon",style:{"background-color":"#f56c6c20"}},Ra={class:"stat-content"},Ua={class:"stat-value"},Ea={class:"stat-content"},Ba={class:"stat-value"},za={class:"stat-icon",style:{"background-color":"#67c23a20"}},qa={class:"stat-content"},Da={class:"stat-value"},Na={class:"stat-icon",style:{"background-color":"#e6a23c20"}},Wa={class:"stat-content"},Ja={class:"stat-value"},Ha={class:"stat-icon",style:{"background-color":"#409eff20"}},Fa={class:"stat-content"},Qa={class:"stat-value"},Ga={class:"section-container"},Ka={class:"quick-actions-grid"},Xa={class:"action-icon",style:{background:"#ecf5ff",color:"#409eff"}},Ya={class:"action-icon",style:{background:"#f0f9eb",color:"#67c23a"}},Za={class:"action-icon",style:{background:"#fdf6ec",color:"#e6a23c"}},el={class:"action-icon",style:{background:"#f4f4f5",color:"#909399"}},tl={class:"action-icon",style:{background:"#fef0f0",color:"#f56c6c"}},al={class:"action-icon",style:{background:"#f4f4f5",color:"#909399"}},ll={class:"action-icon",style:{background:"#f0f9ff",color:"#409eff"}},sl={class:"action-icon",style:{background:"#f0f9eb",color:"#67c23a"}},ol={class:"card-header"},nl={class:"pending-items-list"},il={class:"card-header"},cl={class:"adapters-overview"},rl={class:"adapter-type-header"},dl={key:0,class:"empty-state"},ul={key:1,class:"adapter-list"},pl={class:"adapter-name"},vl={class:"adapter-model"},ml=t({__name:"OverviewView",setup(e){const t=ae(),a=v(),l=ya(),s=ea(),o=Q(!0),n=Q(!1),i=Q(!1),c=Y(()=>{if(a.needRestart)return"warning";return Object.values(a.adapters).some(e=>e.some(e=>!e.enable))?"warning":"normal"}),r=Y(()=>a.needRestart?"需要重启":"normal"===c.value?"正常":"有警告"),d=Y(()=>{const e=a?.adapterTypes?.types||[],t=Object.keys(a.adapters||{});return[...[...e],...t.filter(t=>!e.includes(t))]}),u=e=>(a.adapters?.[e]||[]).length,p=e=>a.adapters?.[e]||[],m=Y(()=>{const e=[];a.needRestart&&e.push({type:"warning",title:"配置已更改，需要重启服务才能生效",action:{text:"去重启",handler:()=>t.push("/settings")}}),Object.entries(a.adapters).forEach(([l,s])=>{s.forEach((s,o)=>{if(s.enable){const n=s.name||`${l}-${o+1}`,i=a.models[n];i&&0!==i.length||e.push({type:"error",title:`${n} 实例模型列表为空，请检查 API Key 或网络连接`,action:{text:"去检查",handler:()=>t.push("/settings/llm-adapters")}})}})});const l=Object.values(a.adapters).flat().filter(e=>!e.enable).length;if(l>0&&e.push({type:"info",title:`有 ${l} 个适配器处于禁用状态`,action:{text:"查看详情",handler:()=>t.push("/settings/llm-adapters")}}),a.config?.onebot?.enable){const l=a.config.onebot;l.reverse_ws_url&&l.bot_qq||e.push({type:"warning",title:"OneBot 已启用但配置不完整",action:{text:"去完善",handler:()=>t.push("/settings/onebot")}})}return e}),h=e=>{if(!a||!a.adapterTypes){const t={openai:"OpenAI",gemini:"Gemini",vertex:"Vertex AI",deepseek:"DeepSeek",anthropic:"Anthropic"};return t[e]?t[e]:e?e.charAt(0).toUpperCase()+e.slice(1):""}const t=a.adapterTypes.adapters?.find(t=>t.type===e);if(t?.name)return t.name;const l={openai:"OpenAI",gemini:"Gemini",vertex:"Vertex AI",deepseek:"DeepSeek",anthropic:"Anthropic"};return l[e]?l[e]:e?e.charAt(0).toUpperCase()+e.slice(1):""},y=async()=>{n.value=!0;try{await a.refreshAllModels(),de.success("模型列表刷新成功")}catch(e){de.error("刷新失败："+e.message)}finally{n.value=!1}},b=async()=>{try{const e=`mio-chat-config-${(new Date).toISOString().split("T")[0]}.json`;await a.exportConfig(e),de.success("配置导出成功")}catch(e){de.error("导出失败："+e.message)}},w=async e=>{try{await ye.confirm("导入配置将覆盖当前所有配置，是否继续？","确认导入",{confirmButtonText:"导入",cancelButtonText:"取消",type:"warning"});const t=await a.importConfig(e),l=await a.validateConfig(t);if(!l.valid)return ye.alert(`配置验证失败：\n${l.errors.join("\n")}`,"导入失败",{type:"error"}),!1;await a.updateConfig(t),de.success("配置导入成功，请重启服务使配置生效"),await a.fetchConfig()}catch(t){"cancel"!==t&&de.error("导入失败："+t.message)}return!1},_=e=>{t.push(`/settings/${e}`)},k=()=>{t.push("/")};return G(async()=>{o.value=!0;try{const e=[];a.config||e.push(a.fetchConfig()),a.adapterTypes.types.length||e.push(a.fetchAdapterTypes()),e.push(l.fetchPresets().catch(e=>{})),e.push(s.initialize().catch(e=>{})),e.push(a.fetchPlugins().catch(e=>{})),await Promise.all(e),await new Promise(e=>setTimeout(e,300))}catch(e){de.error("加载配置失败："+e.message)}finally{o.value=!1}}),(e,t)=>{const v=q("el-card"),C=q("el-button"),x=q("el-tooltip"),S=q("el-upload"),P=q("el-icon"),V=q("el-alert"),O=q("el-tag");return W(),L("div",ba,[o.value?(W(),L("div",wa,[j("div",_a,[(W(),L(D,null,N(4,e=>$(f,{key:e,type:"stat-card","is-card":""})),64))]),$(v,{class:"section-card"},{default:F(()=>[$(f,{type:"list",count:4})]),_:1})])):U("",!0),$(se,{name:"fade",mode:"out-in"},{default:F(()=>[o.value?U("",!0):(W(),L("div",ka,[j("div",Ca,[t[9]||(t[9]=j("div",{class:"header-title"},[j("h2",null,"概览"),j("span",{class:"subtitle"},"系统运行状态与快捷入口")],-1)),j("div",xa,[$(x,{content:"刷新模型列表",placement:"bottom"},{default:F(()=>[$(C,{circle:"",icon:ee(be),onClick:y,loading:n.value},null,8,["icon","loading"])]),_:1}),$(S,{"before-upload":w,"show-file-list":!1,accept:".json",style:{display:"inline-block",margin:"0 8px"}},{default:F(()=>[$(x,{content:"导入配置",placement:"bottom"},{default:F(()=>[$(C,{circle:"",icon:ee(we)},null,8,["icon"])]),_:1})]),_:1}),$(x,{content:"导出配置",placement:"bottom"},{default:F(()=>[$(C,{circle:"",icon:ee(_e),onClick:b},null,8,["icon"])]),_:1}),$(x,{content:"配置对比",placement:"bottom"},{default:F(()=>[$(C,{circle:"",icon:ee(ke),onClick:t[0]||(t[0]=e=>i.value=!0)},null,8,["icon"])]),_:1})])]),j("div",Sa,[$(v,{class:"stat-card"},{default:F(()=>[j("div",Pa,[$(P,{size:32,color:"#409eff"},{default:F(()=>[$(ee(pe))]),_:1})]),j("div",Va,[j("div",Oa,A(ee(a).totalAdapters),1),t[10]||(t[10]=j("div",{class:"stat-label"},"适配器总数",-1))])]),_:1}),$(v,{class:"stat-card"},{default:F(()=>[j("div",Ta,[$(P,{size:32,color:"#67c23a"},{default:F(()=>[$(ee(Ce))]),_:1})]),j("div",Ia,[j("div",Ma,A(ee(a).enabledAdaptersCount),1),t[11]||(t[11]=j("div",{class:"stat-label"},"已启用",-1))])]),_:1}),$(v,{class:"stat-card"},{default:F(()=>[j("div",La,[$(P,{size:32,color:"#e6a23c"},{default:F(()=>[$(ee(ge))]),_:1})]),j("div",ja,[j("div",$a,A(ee(a).totalModelsCount),1),t[12]||(t[12]=j("div",{class:"stat-label"},"可用模型",-1))])]),_:1}),$(v,{class:"stat-card"},{default:F(()=>[j("div",Aa,[$(P,{size:32,color:"#f56c6c"},{default:F(()=>[$(ee(fe))]),_:1})]),j("div",Ra,[j("div",Ua,A(ee(l).totalCount),1),t[13]||(t[13]=j("div",{class:"stat-label"},"预设总数",-1))])]),_:1}),$(v,{class:"stat-card"},{default:F(()=>[j("div",{class:"stat-icon",style:B({backgroundColor:"normal"===c.value?"#67c23a20":"#f5672020"})},[$(P,{size:32,color:"normal"===c.value?"#67c23a":"#f56720"},{default:F(()=>[(W(),J(le("normal"===c.value?ee(xe):ee(Se))))]),_:1},8,["color"])],4),j("div",Ea,[j("div",Ba,A(r.value),1),t[14]||(t[14]=j("div",{class:"stat-label"},"系统状态",-1))])]),_:1}),$(v,{class:"stat-card"},{default:F(()=>[j("div",za,[$(P,{size:32,color:"#67c23a"},{default:F(()=>[$(ee(fe))]),_:1})]),j("div",qa,[j("div",Da,A(ee(s).totalLogsCount),1),t[15]||(t[15]=j("div",{class:"stat-label"},"日志总数",-1))])]),_:1}),$(v,{class:"stat-card"},{default:F(()=>[j("div",Na,[$(P,{size:32,color:"#e6a23c"},{default:F(()=>[$(ee(ge))]),_:1})]),j("div",Wa,[j("div",Ja,A(ee(a).totalPluginsCount),1),t[16]||(t[16]=j("div",{class:"stat-label"},"可用插件",-1))])]),_:1}),$(v,{class:"stat-card"},{default:F(()=>[j("div",Ha,[$(P,{size:32,color:"#409eff"},{default:F(()=>[$(ee(ge))]),_:1})]),j("div",Fa,[j("div",Qa,A(ee(a).totalToolsCount),1),t[17]||(t[17]=j("div",{class:"stat-label"},"可用工具",-1))])]),_:1})]),j("div",Ga,[t[26]||(t[26]=j("div",{class:"section-header"},[j("h3",null,"快速操作")],-1)),j("div",Ka,[j("div",{class:"action-item",onClick:t[1]||(t[1]=e=>_("llm-adapters"))},[j("div",Xa,[$(P,null,{default:F(()=>[$(ee(pe))]),_:1})]),t[18]||(t[18]=j("div",{class:"action-info"},[j("div",{class:"action-title"},"LLM 适配器"),j("div",{class:"action-desc"},"管理模型与接口")],-1)),$(P,{class:"action-arrow"},{default:F(()=>[$(ee(Pe))]),_:1})]),j("div",{class:"action-item",onClick:t[2]||(t[2]=e=>_("server"))},[j("div",Ya,[$(P,null,{default:F(()=>[$(ee(ve))]),_:1})]),t[19]||(t[19]=j("div",{class:"action-info"},[j("div",{class:"action-title"},"服务器配置"),j("div",{class:"action-desc"},"端口与网络设置")],-1)),$(P,{class:"action-arrow"},{default:F(()=>[$(ee(Pe))]),_:1})]),j("div",{class:"action-item",onClick:t[3]||(t[3]=e=>_("web"))},[j("div",Za,[$(P,null,{default:F(()=>[$(ee(me))]),_:1})]),t[20]||(t[20]=j("div",{class:"action-info"},[j("div",{class:"action-title"},"Web 配置"),j("div",{class:"action-desc"},"界面与显示选项")],-1)),$(P,{class:"action-arrow"},{default:F(()=>[$(ee(Pe))]),_:1})]),j("div",{class:"action-item",onClick:t[4]||(t[4]=e=>_("onebot"))},[j("div",el,[$(P,null,{default:F(()=>[$(ee(he))]),_:1})]),t[21]||(t[21]=j("div",{class:"action-info"},[j("div",{class:"action-title"},"OneBot 配置"),j("div",{class:"action-desc"},"QQ 机器人连接")],-1)),$(P,{class:"action-arrow"},{default:F(()=>[$(ee(Pe))]),_:1})]),j("div",{class:"action-item",onClick:t[5]||(t[5]=e=>_("presets"))},[j("div",tl,[$(P,null,{default:F(()=>[$(ee(fe))]),_:1})]),t[22]||(t[22]=j("div",{class:"action-info"},[j("div",{class:"action-title"},"预设管理"),j("div",{class:"action-desc"},"对话预设与模板")],-1)),$(P,{class:"action-arrow"},{default:F(()=>[$(ee(Pe))]),_:1})]),j("div",{class:"action-item",onClick:t[6]||(t[6]=e=>_("logs"))},[j("div",al,[$(P,null,{default:F(()=>[$(ee(fe))]),_:1})]),t[23]||(t[23]=j("div",{class:"action-info"},[j("div",{class:"action-title"},"日志管理"),j("div",{class:"action-desc"},"实时查看系统日志")],-1)),$(P,{class:"action-arrow"},{default:F(()=>[$(ee(Pe))]),_:1})]),j("div",{class:"action-item",onClick:t[7]||(t[7]=e=>_("plugins"))},[j("div",ll,[$(P,null,{default:F(()=>[$(ee(ge))]),_:1})]),t[24]||(t[24]=j("div",{class:"action-info"},[j("div",{class:"action-title"},"插件管理"),j("div",{class:"action-desc"},"管理插件与工具")],-1)),$(P,{class:"action-arrow"},{default:F(()=>[$(ee(Pe))]),_:1})]),j("div",{class:"action-item",onClick:k},[j("div",sl,[$(P,null,{default:F(()=>[$(ee(he))]),_:1})]),t[25]||(t[25]=j("div",{class:"action-info"},[j("div",{class:"action-title"},"开始聊天"),j("div",{class:"action-desc"},"返回聊天界面")],-1)),$(P,{class:"action-arrow"},{default:F(()=>[$(ee(Pe))]),_:1})])])]),m.value.length>0?(W(),J(v,{key:0,class:"section-card"},{header:F(()=>[j("div",ol,[$(P,null,{default:F(()=>[$(ee(Ve))]),_:1}),j("span",null,"待处理事项 ("+A(m.value.length)+")",1)])]),default:F(()=>[j("div",nl,[(W(!0),L(D,null,N(m.value,(e,t)=>(W(),L("div",{key:t,class:"pending-item"},[$(V,{type:e.type,title:e.title,closable:!1},null,8,["type","title"]),e.action?(W(),J(C,{key:0,type:"primary",link:"",onClick:e.action.handler},{default:F(()=>[H(A(e.action.text),1)]),_:2},1032,["onClick"])):U("",!0)]))),128))])]),_:1})):U("",!0),$(v,{class:"section-card"},{header:F(()=>[j("div",il,[$(P,null,{default:F(()=>[$(ee(pe))]),_:1}),t[27]||(t[27]=j("span",null,"适配器概览",-1))])]),default:F(()=>[j("div",cl,[(W(!0),L(D,null,N(d.value,e=>(W(),L("div",{key:e,class:"adapter-type-section"},[j("div",rl,[j("h3",null,A(h(e)),1),$(O,null,{default:F(()=>[H(A(u(e))+" 个实例",1)]),_:2},1024)]),0===u(e)?(W(),L("div",dl," 暂无实例 ")):(W(),L("div",ul,[(W(!0),L(D,null,N(p(e),(t,a)=>(W(),L("div",{key:a,class:"adapter-item"},[$(O,{type:t.enable?"success":"info",size:"small"},{default:F(()=>[H(A(t.enable?"已启用":"已禁用"),1)]),_:2},1032,["type"]),j("span",pl,A(t.name||`${e}-${a+1}`),1),j("span",vl,A(t.default_model),1)]))),128))]))]))),128))])]),_:1})]))]),_:1}),$(g,{modelValue:i.value,"onUpdate:modelValue":t[8]||(t[8]=e=>i.value=e)},null,8,["modelValue"])])}}},[["__scopeId","data-v-7b8b619d"]]),hl=Object.freeze(Object.defineProperty({__proto__:null,default:ml},Symbol.toStringTag,{value:"Module"})),gl={class:"llm-adapters-view"},fl={key:0,class:"loading-container"},yl={class:"skeleton-header"},bl={class:"skeleton-actions"},wl={class:"skeleton-table"},_l={key:0,class:"content-container"},kl={key:0},Cl={key:1,class:"header-actions"},xl={key:2,class:"mobile-actions"},Sl={key:0,class:"mobile-batch-actions"},Pl={class:"batch-info"},Vl={class:"batch-buttons"},Ol={class:"stats-bar"},Tl={class:"stat-item"},Il={class:"stat-value"},Ml={class:"stat-item"},Ll={class:"stat-value"},jl={class:"stat-item"},$l={class:"stat-value"},Al={class:"adapters-list"},Rl={key:0,class:"empty-state"},Ul={class:"adapter-name"},El={class:"name"},Bl={class:"model-name"},zl={class:"action-buttons"},ql=t({__name:"LLMAdaptersView",setup(e){const t=v(),a=Q(!0),l=Q(!1),s=Q(!1),o=Q("add"),n=Q("openai"),i=Q(null),c=Q(!1),r=()=>{c.value=window.innerWidth<=768},d=Q(-1),u=Y(()=>t?.adapterTypes?.types||[]),p=Y(()=>{const e=[];return Object.entries(t.adapters).forEach(([a,l])=>{l.forEach((l,s)=>{const o=l.name||`${a}-${s+1}`,n=t.models[o]||[],i=n.reduce((e,t)=>e+(t.models?t.models.length:0),0);e.push({type:a,index:s,adapter:l,providerName:o,models:n,modelCount:i})})}),e}),m=Y(()=>p.value.filter(e=>e.adapter.enable).length),h=e=>{if(t?.adapterTypes?.adapters){const a=t.adapterTypes.adapters.find(t=>t.type===e);if(a?.name)return a.name}const a={openai:"OpenAI",gemini:"Gemini",vertex:"Vertex AI",deepseek:"DeepSeek",anthropic:"Anthropic"};return a[e]?a[e]:e.charAt(0).toUpperCase()+e.slice(1)},g=e=>{o.value="add",n.value=e,i.value=null,d.value=-1,s.value=!0},f=e=>{t.clearAdapterSelection(),e.forEach(e=>{t.toggleAdapterSelection(e.type,e.index)})},b=async()=>{l.value=!0;try{await t.refreshAllModels(),de.success("所有模型列表刷新成功")}catch(e){de.error("刷新失败："+e.message)}finally{l.value=!1}},w=async()=>{if(t.selectedAdapters&&0!==t.selectedAdapters.length)try{const e=(await t.batchToggleAdapters(t.selectedAdapters,!0)).filter(e=>e.success).length;de.success(`成功启用 ${e} 个适配器`),t.clearAdapterSelection()}catch(e){de.error("批量启用失败："+e.message)}else de.warning("请先选择要操作的适配器")},_=async()=>{if(t.selectedAdapters&&0!==t.selectedAdapters.length)try{const e=(await t.batchToggleAdapters(t.selectedAdapters,!1)).filter(e=>e.success).length;de.success(`成功禁用 ${e} 个适配器`),t.clearAdapterSelection()}catch(e){de.error("批量禁用失败："+e.message)}else de.warning("请先选择要操作的适配器")},k=async()=>{if(t.selectedAdapters&&0!==t.selectedAdapters.length)try{await ye.confirm(`确定要删除选中的 ${t.selectedAdapters.length} 个适配器吗？`,"批量删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"});const e=(await t.batchDeleteAdapters(t.selectedAdapters)).filter(e=>e.success).length;de.success(`成功删除 ${e} 个适配器`),t.clearAdapterSelection()}catch(e){"cancel"!==e&&de.error("批量删除失败："+e.message)}else de.warning("请先选择要删除的适配器")},C=()=>{s.value=!1},x=async({type:e,index:a,data:l,mode:s})=>{try{"add"===s?(await t.addAdapter(e,l),de.success("添加成功")):(await t.updateAdapter(e,a,l),de.success("更新成功"))}catch(o){throw de.error("add"===s?"添加失败：":"更新失败："+o.message),o}};return G(async()=>{r(),window.addEventListener("resize",r),a.value=!0;try{const e=[];t.adapterTypes.types.length||e.push(t.fetchAdapterTypes()),t.config||e.push(t.fetchConfig()),await Promise.all(e),await new Promise(e=>setTimeout(e,300))}catch(e){de.error("加载配置失败："+e.message)}finally{a.value=!1}}),K(()=>{window.removeEventListener("resize",r)}),(e,r)=>{const v=q("el-button"),S=q("el-icon"),P=q("el-dropdown-item"),V=q("el-dropdown-menu"),O=q("el-dropdown"),T=q("el-empty"),I=q("el-table-column"),M=q("el-tag"),E=q("el-switch"),B=q("el-table");return W(),L("div",gl,[a.value?(W(),L("div",fl,[j("div",yl,[r[0]||(r[0]=j("div",{class:"skeleton-title"},null,-1)),j("div",bl,[(W(),L(D,null,N(3,e=>j("div",{class:"skeleton-button",key:e})),64))])]),j("div",wl,[(W(),L(D,null,N(6,e=>j("div",{class:"skeleton-row",key:e},[(W(),L(D,null,N(6,e=>j("div",{class:"skeleton-cell",key:e})),64))])),64))])])):U("",!0),$(se,{name:"fade",mode:"out-in"},{default:F(()=>[a.value?U("",!0):(W(),L("div",_l,[j("div",{class:R(["page-header",{mobile:c.value}])},[c.value?U("",!0):(W(),L("h1",kl,"LLM 适配器管理")),c.value?U("",!0):(W(),L("div",Cl,[ee(t).selectedAdapters&&ee(t).selectedAdapters.length>0?(W(),J(v,{key:0,type:"success",icon:ee(Oe),onClick:w},{default:F(()=>[H(" 批量启用 ("+A(ee(t).selectedAdapters.length)+") ",1)]),_:1},8,["icon"])):U("",!0),ee(t).selectedAdapters&&ee(t).selectedAdapters.length>0?(W(),J(v,{key:1,type:"warning",icon:ee(Te),onClick:_},{default:F(()=>r[1]||(r[1]=[H(" 批量禁用 ")])),_:1},8,["icon"])):U("",!0),ee(t).selectedAdapters&&ee(t).selectedAdapters.length>0?(W(),J(v,{key:2,type:"danger",icon:ee(Ie),onClick:k},{default:F(()=>r[2]||(r[2]=[H(" 批量删除 ")])),_:1},8,["icon"])):U("",!0),$(v,{type:"primary",icon:ee(be),loading:l.value,onClick:b},{default:F(()=>r[3]||(r[3]=[H(" 刷新全部模型 ")])),_:1},8,["icon","loading"]),$(O,{onCommand:g,trigger:"click"},{dropdown:F(()=>[$(V,null,{default:F(()=>[(W(!0),L(D,null,N(u.value,e=>(W(),J(P,{key:e,command:e},{default:F(()=>[$(S,null,{default:F(()=>[$(ee(pe))]),_:1}),H(" "+A(h(e)),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:F(()=>[$(v,{type:"primary",icon:ee(Me)},{default:F(()=>[r[4]||(r[4]=H(" 添加适配器 ")),$(S,{class:"el-icon--right"},{default:F(()=>[$(ee(Le))]),_:1})]),_:1},8,["icon"])]),_:1})])),c.value?(W(),L("div",xl,[$(v,{type:"primary",icon:ee(be),loading:l.value,onClick:b,size:"small"},{default:F(()=>r[5]||(r[5]=[H(" 刷新 ")])),_:1},8,["icon","loading"]),$(O,{onCommand:g,trigger:"click"},{dropdown:F(()=>[$(V,null,{default:F(()=>[(W(!0),L(D,null,N(u.value,e=>(W(),J(P,{key:e,command:e},{default:F(()=>[$(S,null,{default:F(()=>[$(ee(pe))]),_:1}),H(" "+A(h(e)),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:F(()=>[$(v,{type:"primary",icon:ee(Me),size:"small"},{default:F(()=>r[6]||(r[6]=[H(" 添加 ")])),_:1},8,["icon"])]),_:1})])):U("",!0)],2),c.value&&ee(t).selectedAdapters&&ee(t).selectedAdapters.length>0?(W(),L("div",Sl,[j("div",Pl," 已选择 "+A(ee(t).selectedAdapters.length)+" 项 ",1),j("div",Vl,[$(v,{type:"success",size:"small",onClick:w},{default:F(()=>r[7]||(r[7]=[H("启用")])),_:1}),$(v,{type:"warning",size:"small",onClick:_},{default:F(()=>r[8]||(r[8]=[H("禁用")])),_:1}),$(v,{type:"danger",size:"small",onClick:k},{default:F(()=>r[9]||(r[9]=[H("删除")])),_:1})])])):U("",!0),j("div",Ol,[j("div",Tl,[r[10]||(r[10]=j("span",{class:"stat-label"},"总计：",-1)),j("span",Il,A(p.value.length)+" 个实例",1)]),j("div",Ml,[r[11]||(r[11]=j("span",{class:"stat-label"},"已启用：",-1)),j("span",Ll,A(m.value)+" 个",1)]),j("div",jl,[r[12]||(r[12]=j("span",{class:"stat-label"},"总模型数：",-1)),j("span",$l,A(ee(t).totalModelsCount)+" 个",1)])]),j("div",Al,[0===p.value.length?(W(),L("div",Rl,[$(T,{description:"暂无适配器实例"},{default:F(()=>[$(O,{onCommand:g,trigger:"click"},{dropdown:F(()=>[$(V,null,{default:F(()=>[(W(!0),L(D,null,N(u.value,e=>(W(),J(P,{key:e,command:e},{default:F(()=>[$(S,null,{default:F(()=>[$(ee(pe))]),_:1}),H(" "+A(h(e)),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:F(()=>[$(v,{type:"primary",icon:ee(Me)},{default:F(()=>r[13]||(r[13]=[H(" 添加适配器 ")])),_:1},8,["icon"])]),_:1})]),_:1})])):(W(),J(B,{key:1,data:p.value,style:{width:"100%"},onSelectionChange:f},{default:F(()=>[$(I,{type:"selection",width:"55"}),$(I,{label:"类型",width:"120"},{default:F(({row:e})=>{return[$(M,{type:(t=e.type,{openai:"success",gemini:"warning",vertex:"info"}[t]||"primary"),effect:"light"},{default:F(()=>[H(A(h(e.type)),1)]),_:2},1032,["type"])];var t}),_:1}),$(I,{label:"名称","min-width":"150"},{default:F(({row:e})=>[j("div",Ul,[j("span",El,A(e.adapter.name||`${e.type}-${e.index+1}`),1),e.adapter.enable?U("",!0):(W(),J(M,{key:0,type:"info",size:"small",effect:"plain"},{default:F(()=>r[14]||(r[14]=[H(" 已禁用 ")])),_:1}))])]),_:1}),$(I,{label:"默认模型","min-width":"200"},{default:F(({row:e})=>[j("span",Bl,A(e.adapter.default_model||"-"),1)]),_:1}),$(I,{label:"可用模型",width:"120",align:"center"},{default:F(({row:e})=>{return[$(M,{size:"small",type:(t=e.modelCount,0===t?"danger":t<5?"warning":"success"),effect:"plain",round:""},{default:F(()=>[H(A(e.modelCount)+" 个 ",1)]),_:2},1032,["type"])];var t}),_:1}),$(I,{label:"状态",width:"100",align:"center"},{default:F(({row:e})=>[$(E,{modelValue:e.adapter.enable,"onUpdate:modelValue":t=>e.adapter.enable=t,onChange:a=>(async e=>{const{type:a,index:l,adapter:s}=e,o=s.enable;try{const e={...s,enable:o};await t.updateAdapter(a,l,e),de.success(o?"已启用":"已禁用")}catch(n){s.enable=!o,de.error("操作失败："+n.message)}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),$(I,{label:"操作",width:"200",align:"center"},{default:F(({row:e})=>[j("div",zl,[$(v,{size:"small",type:"primary",text:"",onClick:t=>(e=>{const{type:t,index:a,adapter:l}=e;o.value="edit",n.value=t,i.value=l,d.value=a,s.value=!0})(e)},{default:F(()=>r[15]||(r[15]=[H(" 编辑 ")])),_:2},1032,["onClick"]),$(v,{size:"small",type:"success",text:"",onClick:a=>(async e=>{const{type:a,index:l}=e;try{await t.refreshAdapterModels(a,l),de.success("模型列表刷新成功")}catch(s){de.error("刷新失败："+s.message)}})(e)},{default:F(()=>r[16]||(r[16]=[H(" 刷新 ")])),_:2},1032,["onClick"]),$(v,{size:"small",type:"danger",text:"",onClick:a=>(async e=>{const{type:a,index:l,adapter:s}=e,o=s.name||`${a}-${l+1}`;try{await ye.confirm(`确定要删除适配器 "${o}" 吗？`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await t.deleteAdapter(a,l),de.success("删除成功")}catch(n){"cancel"!==n&&de.error("删除失败："+n.message)}})(e)},{default:F(()=>r[17]||(r[17]=[H(" 删除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]))])]))]),_:1}),$(y,{visible:s.value,mode:o.value,type:n.value,adapter:i.value,index:d.value,onClose:C,onSubmit:x},null,8,["visible","mode","type","adapter","index"])])}}},[["__scopeId","data-v-bbf14db3"]]),Dl=Object.freeze(Object.defineProperty({__proto__:null,default:ql},Symbol.toStringTag,{value:"Module"})),Nl={class:"server-config-view"},Wl={class:"page-header"},Jl={class:"header-actions"},Hl=t({__name:"ServerConfigView",setup(e){const t=v(),a=Q(null),l=Q(!1),s=ie({port:3080,host:"0.0.0.0",max_rate_pre_min:100,debug:!1}),o=ie({}),n={port:[{required:!0,message:"请输入服务器端口",trigger:"blur"},{type:"number",min:1,max:65535,message:"端口范围必须在 1-65535 之间",trigger:"blur"}],host:[{required:!0,message:"请输入服务器主机",trigger:"blur"}],max_rate_pre_min:[{required:!0,message:"请输入最大请求频率",trigger:"blur"},{type:"number",min:1,message:"最大请求频率必须大于 0",trigger:"blur"}]},i=async()=>{try{await a.value.validate(),await ye.confirm("修改服务器配置需要重启服务才能生效，是否继续？","确认保存",{confirmButtonText:"保存",cancelButtonText:"取消",type:"warning"}),l.value=!0,await t.updateConfigSection("server",{port:s.port,host:s.host,max_rate_pre_min:s.max_rate_pre_min}),t.config&&(t.config.debug=s.debug),de.success("配置保存成功，请重启服务使配置生效"),Object.assign(o,s)}catch(e){"cancel"!==e&&de.error("保存失败："+e.message)}finally{l.value=!1}},c=()=>{Object.assign(s,o),a.value?.clearValidate(),de.info("已重置为当前保存的配置")};return G(async()=>{t.config||await t.fetchConfig(),await(async()=>{try{const e=t.config?.server||await t.fetchConfigSection("server"),a=t.config?.debug??!1;Object.assign(s,{port:e.port||3080,host:e.host||"0.0.0.0",max_rate_pre_min:e.max_rate_pre_min||100,debug:a}),Object.assign(o,s)}catch(e){de.error("加载配置失败："+e.message)}})()}),(e,t)=>{const o=q("el-button"),r=q("el-alert"),d=q("el-input-number"),u=q("el-form-item"),p=q("el-input"),v=q("el-divider"),m=q("el-switch"),h=q("el-form"),g=q("el-card");return W(),L("div",Nl,[j("div",Wl,[t[6]||(t[6]=j("h1",null,"服务器配置",-1)),j("div",Jl,[$(o,{onClick:c},{default:F(()=>t[4]||(t[4]=[H("重置")])),_:1}),$(o,{type:"primary",loading:l.value,onClick:i},{default:F(()=>t[5]||(t[5]=[H(" 保存配置 ")])),_:1},8,["loading"])])]),$(r,{type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"24px"}},{title:F(()=>t[7]||(t[7]=[H(" 修改服务器配置需要重启服务才能生效 ")])),_:1}),$(g,null,{default:F(()=>[$(h,{ref_key:"formRef",ref:a,model:s,rules:n,"label-width":"140px","label-position":"left"},{default:F(()=>[$(u,{label:"服务器端口",prop:"port"},{extra:F(()=>t[8]||(t[8]=[j("span",{class:"form-item-tip"}," 服务器监听端口，范围：1-65535，默认 3080 ",-1)])),default:F(()=>[$(d,{modelValue:s.port,"onUpdate:modelValue":t[0]||(t[0]=e=>s.port=e),min:1,max:65535,step:1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),$(u,{label:"服务器主机",prop:"host"},{extra:F(()=>t[9]||(t[9]=[j("span",{class:"form-item-tip"}," 服务器绑定的主机地址，0.0.0.0 表示监听所有网卡 ",-1)])),default:F(()=>[$(p,{modelValue:s.host,"onUpdate:modelValue":t[1]||(t[1]=e=>s.host=e),placeholder:"0.0.0.0",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),$(u,{label:"最大请求频率",prop:"max_rate_pre_min"},{extra:F(()=>t[10]||(t[10]=[j("span",{class:"form-item-tip"}," 每个客户端每分钟允许的最大请求次数，用于限流保护 ",-1)])),default:F(()=>[$(d,{modelValue:s.max_rate_pre_min,"onUpdate:modelValue":t[2]||(t[2]=e=>s.max_rate_pre_min=e),min:1,max:1e4,step:10,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),t[11]||(t[11]=j("span",{style:{"margin-left":"12px",color:"#909399"}},"次/分钟",-1))]),_:1}),$(v),$(u,{label:"调试模式",prop:"debug"},{extra:F(()=>t[12]||(t[12]=[j("span",{class:"form-item-tip"}," 开启后将输出详细的调试信息，生产环境建议关闭 ",-1)])),default:F(()=>[$(m,{modelValue:s.debug,"onUpdate:modelValue":t[3]||(t[3]=e=>s.debug=e),"active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])}}},[["__scopeId","data-v-b03648f6"]]),Fl=Object.freeze(Object.defineProperty({__proto__:null,default:Hl},Symbol.toStringTag,{value:"Module"})),Ql={class:"web-config-view"},Gl={class:"page-header"},Kl={class:"header-actions"},Xl=t({__name:"WebConfigView",setup(e){const t=v(),a=Q(null),l=Q(!1),s=Q(!1),o=Q(!1),n=ie({title:"MioChat",beian:"",admin_code:"",user_code:"",full_screen:!0}),i=ie({}),c={title:[{required:!0,message:"请输入网站标题",trigger:"blur"}],admin_code:[{required:!0,message:"请输入管理员验证码",trigger:"blur"},{min:6,message:"验证码长度至少为 6 位",trigger:"blur"}]},r=async()=>{try{await a.value.validate(),await ye.confirm("修改 Web 配置需要重启服务才能生效，是否继续？","确认保存",{confirmButtonText:"保存",cancelButtonText:"取消",type:"warning"}),l.value=!0,await t.updateConfigSection("web",{title:n.title,beian:n.beian,admin_code:n.admin_code,user_code:n.user_code,full_screen:n.full_screen}),de.success("配置保存成功，请重启服务使配置生效"),Object.assign(i,n)}catch(e){"cancel"!==e&&de.error("保存失败："+e.message)}finally{l.value=!1}},d=()=>{Object.assign(n,i),a.value?.clearValidate(),de.info("已重置为当前保存的配置")};return G(async()=>{t.config||await t.fetchConfig(),await(async()=>{try{const e=t.config?.web||await t.fetchConfigSection("web");Object.assign(n,{title:e.title||"MioChat",beian:e.beian||"",admin_code:e.admin_code||"",user_code:e.user_code||"",full_screen:e.full_screen??!0}),Object.assign(i,n)}catch(e){de.error("加载配置失败："+e.message)}})()}),(e,t)=>{const i=q("el-button"),u=q("el-alert"),p=q("el-input"),v=q("el-form-item"),m=q("el-divider"),h=q("el-switch"),g=q("el-form"),f=q("el-card");return W(),L("div",Ql,[j("div",Gl,[t[9]||(t[9]=j("h1",null,"Web 配置",-1)),j("div",Kl,[$(i,{onClick:d},{default:F(()=>t[7]||(t[7]=[H("重置")])),_:1}),$(i,{type:"primary",loading:l.value,onClick:r},{default:F(()=>t[8]||(t[8]=[H(" 保存配置 ")])),_:1},8,["loading"])])]),$(u,{type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"24px"}},{title:F(()=>t[10]||(t[10]=[H(" 修改 Web 配置需要重启服务才能生效 ")])),_:1}),$(f,null,{default:F(()=>[$(g,{ref_key:"formRef",ref:a,model:n,rules:c,"label-width":"140px","label-position":"left"},{default:F(()=>[$(v,{label:"网站标题",prop:"title"},{extra:F(()=>t[11]||(t[11]=[j("span",{class:"form-item-tip"}," 显示在浏览器标签页和页面顶部的标题 ",-1)])),default:F(()=>[$(p,{modelValue:n.title,"onUpdate:modelValue":t[0]||(t[0]=e=>n.title=e),placeholder:"MioChat",maxlength:"50","show-word-limit":"",style:{width:"400px"}},null,8,["modelValue"])]),_:1}),$(v,{label:"备案号",prop:"beian"},{extra:F(()=>t[12]||(t[12]=[j("span",{class:"form-item-tip"}," 网站底部显示的备案信息，如：京ICP备12345678号 ",-1)])),default:F(()=>[$(p,{modelValue:n.beian,"onUpdate:modelValue":t[1]||(t[1]=e=>n.beian=e),placeholder:"留空则不显示",maxlength:"100","show-word-limit":"",style:{width:"400px"}},null,8,["modelValue"])]),_:1}),$(m),$(v,{label:"管理员验证码",prop:"admin_code"},{extra:F(()=>t[13]||(t[13]=[j("span",{class:"form-item-tip"}," 访问配置管理页面所需的验证码，请妥善保管 ",-1)])),default:F(()=>[$(p,{modelValue:n.admin_code,"onUpdate:modelValue":t[3]||(t[3]=e=>n.admin_code=e),type:s.value?"text":"password",placeholder:"用于访问配置管理",maxlength:"50","show-word-limit":"",style:{width:"400px"}},{append:F(()=>[$(i,{icon:s.value?ee(je):ee($e),onClick:t[2]||(t[2]=e=>s.value=!s.value)},null,8,["icon"])]),_:1},8,["modelValue","type"])]),_:1}),$(v,{label:"访客验证码",prop:"user_code"},{extra:F(()=>t[14]||(t[14]=[j("span",{class:"form-item-tip"}," 访客访问聊天功能所需的验证码，留空则无需验证 ",-1)])),default:F(()=>[$(p,{modelValue:n.user_code,"onUpdate:modelValue":t[5]||(t[5]=e=>n.user_code=e),type:o.value?"text":"password",placeholder:"留空则不需要验证码",maxlength:"50","show-word-limit":"",style:{width:"400px"}},{append:F(()=>[$(i,{icon:o.value?ee(je):ee($e),onClick:t[4]||(t[4]=e=>o.value=!o.value)},null,8,["icon"])]),_:1},8,["modelValue","type"])]),_:1}),$(m),$(v,{label:"全屏模式",prop:"full_screen"},{extra:F(()=>t[15]||(t[15]=[j("span",{class:"form-item-tip"}," 开启后界面将占据整个浏览器窗口 ",-1)])),default:F(()=>[$(h,{modelValue:n.full_screen,"onUpdate:modelValue":t[6]||(t[6]=e=>n.full_screen=e),"active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])}}},[["__scopeId","data-v-de858999"]]),Yl=Object.freeze(Object.defineProperty({__proto__:null,default:Xl},Symbol.toStringTag,{value:"Module"})),Zl={class:"onebot-config-view"},es={class:"page-header"},ts={class:"header-actions"},as=t({__name:"OnebotConfigView",setup(e){const t=v(),a=Q(null),l=Q(!1),s=Q(!1),o=ie({enable:!1,reverse_ws_url:"",token:"",bot_qq:"",admin_qq:""}),n=ie({}),i={reverse_ws_url:[{validator:(e,t,a)=>{o.enable&&!t?a(new Error("启用 OneBot 时必须输入反向 WebSocket URL")):!t||t.startsWith("ws://")||t.startsWith("wss://")?a():a(new Error("URL 必须以 ws:// 或 wss:// 开头"))},trigger:"blur"}],bot_qq:[{validator:(e,t,a)=>{o.enable&&!t?a(new Error("启用 OneBot 时必须输入机器人 QQ 号")):t&&!/^\d+$/.test(t)?a(new Error("QQ 号必须为纯数字")):a()},trigger:"blur"}],admin_qq:[{validator:(e,t,a)=>{t&&!/^\d+$/.test(t)?a(new Error("QQ 号必须为纯数字")):a()},trigger:"blur"}]},c=async()=>{try{await a.value.validate(),l.value=!0,await t.updateConfigSection("onebot",{enable:o.enable,reverse_ws_url:o.reverse_ws_url,token:o.token,bot_qq:o.bot_qq,admin_qq:o.admin_qq}),de.success("OneBot 配置保存成功"),Object.assign(n,o)}catch(e){"cancel"!==e&&de.error("保存失败："+e.message)}finally{l.value=!1}},r=()=>{Object.assign(o,n),a.value?.clearValidate(),de.info("已重置为当前保存的配置")};return G(async()=>{t.config||await t.fetchConfig(),await(async()=>{try{const e=t.config?.onebot||await t.fetchConfigSection("onebot");Object.assign(o,{enable:e.enable??!1,reverse_ws_url:e.reverse_ws_url||"",token:e.token||"",bot_qq:e.bot_qq||"",admin_qq:e.admin_qq||""}),Object.assign(n,o)}catch(e){de.error("加载 OneBot 配置失败："+e.message)}})()}),(e,t)=>{const n=q("el-button"),d=q("el-switch"),u=q("el-form-item"),p=q("el-divider"),v=q("el-input"),m=q("el-form"),h=q("el-card"),g=q("el-alert");return W(),L("div",Zl,[j("div",es,[t[8]||(t[8]=j("h1",null,"OneBot 配置",-1)),j("div",ts,[$(n,{onClick:r},{default:F(()=>t[6]||(t[6]=[H("重置")])),_:1}),$(n,{type:"primary",loading:l.value,onClick:c},{default:F(()=>t[7]||(t[7]=[H(" 保存配置 ")])),_:1},8,["loading"])])]),$(h,null,{default:F(()=>[$(m,{ref_key:"formRef",ref:a,model:o,rules:i,"label-width":"160px","label-position":"left"},{default:F(()=>[$(u,{label:"启用 OneBot",prop:"enable"},{extra:F(()=>t[9]||(t[9]=[j("span",{class:"form-item-tip"}," 是否启用 OneBot 协议支持（QQ 机器人） ",-1)])),default:F(()=>[$(d,{modelValue:o.enable,"onUpdate:modelValue":t[0]||(t[0]=e=>o.enable=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),$(p,{"content-position":"left"},{default:F(()=>t[10]||(t[10]=[H("连接配置")])),_:1}),$(u,{label:"反向 WebSocket URL",prop:"reverse_ws_url"},{extra:F(()=>t[11]||(t[11]=[j("span",{class:"form-item-tip"}," OneBot 实现端的反向 WebSocket 地址（如 go-cqhttp） ",-1)])),default:F(()=>[$(v,{modelValue:o.reverse_ws_url,"onUpdate:modelValue":t[1]||(t[1]=e=>o.reverse_ws_url=e),placeholder:"ws://localhost:8080/onebot/v11/ws",style:{width:"500px"},disabled:!o.enable},null,8,["modelValue","disabled"])]),_:1}),$(u,{label:"Access Token",prop:"token"},{extra:F(()=>t[12]||(t[12]=[j("span",{class:"form-item-tip"}," 与 OneBot 实现端配置的 access_token 保持一致 ",-1)])),default:F(()=>[$(v,{modelValue:o.token,"onUpdate:modelValue":t[3]||(t[3]=e=>o.token=e),type:s.value?"text":"password",placeholder:"留空则不使用 token 验证",maxlength:"100","show-word-limit":"",style:{width:"500px"},disabled:!o.enable},{append:F(()=>[$(n,{icon:s.value?ee(je):ee($e),onClick:t[2]||(t[2]=e=>s.value=!s.value)},null,8,["icon"])]),_:1},8,["modelValue","type","disabled"])]),_:1}),$(p,{"content-position":"left"},{default:F(()=>t[13]||(t[13]=[H("机器人配置")])),_:1}),$(u,{label:"机器人 QQ 号",prop:"bot_qq"},{extra:F(()=>t[14]||(t[14]=[j("span",{class:"form-item-tip"}," 接入的 QQ 机器人账号 ",-1)])),default:F(()=>[$(v,{modelValue:o.bot_qq,"onUpdate:modelValue":t[4]||(t[4]=e=>o.bot_qq=e),placeholder:"2698788044",maxlength:"20",style:{width:"300px"},disabled:!o.enable},null,8,["modelValue","disabled"])]),_:1}),$(u,{label:"管理员 QQ 号",prop:"admin_qq"},{extra:F(()=>t[15]||(t[15]=[j("span",{class:"form-item-tip"}," 机器人管理员的 QQ 号，拥有特殊权限 ",-1)])),default:F(()=>[$(v,{modelValue:o.admin_qq,"onUpdate:modelValue":t[5]||(t[5]=e=>o.admin_qq=e),placeholder:"1099834705",maxlength:"20",style:{width:"300px"},disabled:!o.enable},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),_:1}),$(h,{style:{"margin-top":"16px"}},{header:F(()=>t[16]||(t[16]=[j("div",{class:"card-header"},[j("span",null,"连接状态")],-1)])),default:F(()=>[$(g,{type:o.enable?"info":"warning",closable:!1,"show-icon":""},{title:F(()=>[H(A(o.enable?"连接状态监控功能需要后端支持，暂未实现":"OneBot 协议已禁用"),1)]),_:1},8,["type"])]),_:1})])}}},[["__scopeId","data-v-57bd1731"]]),ls=Object.freeze(Object.defineProperty({__proto__:null,default:as},Symbol.toStringTag,{value:"Module"})),ss={class:"plugins-view"},os={key:0,class:"loading-container"},ns={class:"skeleton-header"},is={class:"skeleton-actions"},cs={class:"plugins-grid"},rs={key:0,class:"content-container"},ds={class:"page-header"},us={class:"header-actions"},ps={class:"stats-row"},vs={class:"stat-icon",style:{"background-color":"#409eff20"}},ms={class:"stat-content"},hs={class:"stat-value"},gs={class:"stat-icon",style:{"background-color":"#67c23a20"}},fs={class:"stat-content"},ys={class:"stat-value"},bs={class:"stat-icon",style:{"background-color":"#e6a23c20"}},ws={class:"stat-content"},_s={class:"stat-value"},ks={class:"stat-icon",style:{"background-color":"#90939920"}},Cs={class:"stat-content"},xs={class:"stat-value"},Ss={class:"plugins-list"},Ps={class:"plugin-header"},Vs={class:"plugin-info"},Os={class:"plugin-title-row"},Ts={class:"plugin-name"},Is={class:"plugin-description"},Ms={class:"plugin-meta"},Ls={class:"meta-item"},js={class:"meta-item"},$s={class:"plugin-actions"},As={class:"dialog-content"},Rs={key:0,class:"plugin-detail"},Us={key:0,class:"tools-section"},Es={class:"tool-header"},Bs={class:"tool-description"},zs={class:"dialog-content"},qs={class:"config-editor"},Ds={class:"debug-container",style:{height:"60vh","overflow-y":"auto"}},Ns={class:"tool-info"},Ws={class:"info-row"},Js={class:"info-row"},Hs={class:"card-header"},Fs={class:"params-schema"},Qs={class:"param-header"},Gs={class:"param-name"},Ks={class:"param-description"},Xs={key:0,class:"param-enum"},Ys={key:1,class:"param-items"},Zs={class:"card-header"},eo={class:"params-hint"},to={key:1,class:"result-container"},ao={class:"result-header"},lo={class:"status-indicator"},so={class:"status-text"},oo={key:0,class:"execution-meta"},no={class:"meta-item"},io={class:"result-body"},co={class:"plugin-info-bar"},ro={class:"info-item"},uo={class:"value"},po={class:"info-item"},vo={class:"value"},mo={class:"json-viewer-container"},ho={class:"json-content"},go={key:1,class:"error-content"},fo={class:"error-message-box"},yo={class:"message-text"},bo={key:0,class:"error-stack"},wo={class:"stack-content"},_o=t({__name:"PluginsView",setup(e){const t=Q(!1),a=Q(!1),l=Q([]),s=Q(!1),o=Q(!1),n=Q(!1),i=Q(null),c=Q(null),r=Q([]),d=Q(""),u=Q(!1),p=Q("{}"),v=Q(null),m=Q(!1),h=Q([]),g=Y(()=>l.value.filter(e=>e.enabled).length),y=Y(()=>l.value.reduce((e,t)=>e+t.toolCount,0)),w=Y(()=>l.value.filter(e=>"custom"===e.type).length),_=async()=>{t.value=!0;try{const e=await b.listPlugins();0===e.code?l.value=e.data.plugins.map(e=>({...e,reloading:!1,toggling:!1})):de.error("加载插件列表失败："+e.message)}catch(e){de.error("加载插件列表失败："+e.message)}finally{t.value=!1}},k=async()=>{a.value=!0;try{await _(),de.success("刷新成功")}finally{a.value=!1}},C=async()=>{try{await ye.confirm("将重新加载所有插件的工具，是否继续？","确认重载",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const e=await b.reloadAllPlugins();0===e.code?(de.success(`重载完成：成功 ${e.data.successCount}/${e.data.totalCount}`),await _()):de.error("重载失败："+e.message)}catch(e){"cancel"!==e&&de.error("重载失败："+e.message)}},x=async e=>{e.reloading=!0;try{const t=await b.reloadPlugin(e.name);0===t.code?(de.success(`${e.displayName} 重载成功`),await _()):de.error("重载失败："+t.message)}catch(t){de.error("重载失败："+t.message)}finally{e.reloading=!1}},S=async()=>{try{const e=JSON.parse(d.value);u.value=!0;const t=await b.updatePluginConfig(i.value.name,e);0===t.code?(de.success("配置保存成功"),o.value=!1,ye.confirm("配置已更新，是否立即重载插件使配置生效？","提示",{confirmButtonText:"立即重载",cancelButtonText:"稍后",type:"info"}).then(async()=>{await x(i.value)}).catch(()=>{})):de.error("保存失败："+t.message)}catch(e){e instanceof SyntaxError?de.error("JSON 格式错误"):de.error("保存失败："+e.message)}finally{u.value=!1}},P=()=>{if(!c.value?.parameters?.properties)return void(p.value="{}");const e={},t=c.value.parameters.properties;for(const[a,l]of Object.entries(t))switch(l.type){case"string":l.enum&&l.enum.length>0?e[a]=l.enum[0]:a.toLowerCase().includes("url")?e[a]="https://example.com":a.toLowerCase().includes("path")?e[a]="/path/to/file":a.toLowerCase().includes("query")||a.toLowerCase().includes("search")?e[a]="搜索关键词":e[a]="示例文本";break;case"number":case"integer":e[a]=l.minimum||0;break;case"boolean":e[a]=!0;break;case"array":e[a]=[];break;case"object":e[a]={};break;default:e[a]=null}p.value=JSON.stringify(e,null,2)},V=async()=>{try{const e=JSON.parse(p.value);m.value=!0,v.value=null;const t=await b.debugTool(i.value.name,c.value.name,e);0===t.code?v.value=t.data:de.error("调试失败："+t.message)}catch(e){e instanceof SyntaxError?de.error("参数 JSON 格式错误"):de.error("调试失败："+e.message)}finally{m.value=!1}};return G(()=>{_()}),(e,_)=>{const O=q("el-button"),T=q("el-icon"),I=q("el-card"),M=q("el-tag"),E=q("el-switch"),B=q("el-descriptions-item"),z=q("el-descriptions"),Q=q("el-collapse-item"),G=q("el-collapse"),K=q("el-dialog"),X=q("el-alert"),Y=q("el-input");return W(),L("div",ss,[t.value?(W(),L("div",os,[j("div",ns,[_[9]||(_[9]=j("div",{class:"skeleton-title"},null,-1)),j("div",is,[(W(),L(D,null,N(2,e=>j("div",{class:"skeleton-button",key:e})),64))])]),j("div",cs,[(W(),L(D,null,N(6,e=>$(f,{key:e,type:"adapter-card","is-card":""})),64))])])):U("",!0),$(se,{name:"fade",mode:"out-in"},{default:F(()=>[t.value?U("",!0):(W(),L("div",rs,[j("div",ds,[_[12]||(_[12]=j("h1",null,"插件管理",-1)),j("div",us,[$(O,{type:"primary",icon:ee(be),loading:a.value,onClick:k},{default:F(()=>_[10]||(_[10]=[H(" 刷新插件 ")])),_:1},8,["icon","loading"]),$(O,{type:"success",icon:ee(Ae),onClick:C},{default:F(()=>_[11]||(_[11]=[H(" 重载全部 ")])),_:1},8,["icon"])])]),j("div",ps,[$(I,{class:"stat-card"},{default:F(()=>[j("div",vs,[$(T,{size:24,color:"#409eff"},{default:F(()=>[$(ee(ge))]),_:1})]),j("div",ms,[j("div",hs,A(l.value.length),1),_[13]||(_[13]=j("div",{class:"stat-label"},"插件总数",-1))])]),_:1}),$(I,{class:"stat-card"},{default:F(()=>[j("div",gs,[$(T,{size:24,color:"#67c23a"},{default:F(()=>[$(ee(Ce))]),_:1})]),j("div",fs,[j("div",ys,A(g.value),1),_[14]||(_[14]=j("div",{class:"stat-label"},"已启用",-1))])]),_:1}),$(I,{class:"stat-card"},{default:F(()=>[j("div",bs,[$(T,{size:24,color:"#e6a23c"},{default:F(()=>[$(ee(Re))]),_:1})]),j("div",ws,[j("div",_s,A(y.value),1),_[15]||(_[15]=j("div",{class:"stat-label"},"工具总数",-1))])]),_:1}),$(I,{class:"stat-card"},{default:F(()=>[j("div",ks,[$(T,{size:24,color:"#909399"},{default:F(()=>[$(ee(Ue))]),_:1})]),j("div",Cs,[j("div",xs,A(w.value),1),_[16]||(_[16]=j("div",{class:"stat-label"},"自定义插件",-1))])]),_:1})]),j("div",Ss,[(W(!0),L(D,null,N(l.value,e=>(W(),J(I,{key:e.name,class:R(["plugin-card",{disabled:!e.enabled}])},{default:F(()=>[j("div",Ps,[j("div",Vs,[j("div",Os,[j("h3",Ts,["custom"===e.type?(W(),J(M,{key:0,type:"warning",size:"small",style:{"margin-right":"8px"}},{default:F(()=>_[17]||(_[17]=[H(" 自定义 ")])),_:1})):U("",!0),H(" "+A(e.displayName),1)]),$(E,{modelValue:e.enabled,"onUpdate:modelValue":t=>e.enabled=t,onChange:t=>(async e=>{e.toggling=!0;try{const t=await b.togglePlugin(e.name,e.enabled);0===t.code?de.success(`${e.displayName} 已${e.enabled?"启用":"禁用"}`):(de.error("操作失败："+t.message),e.enabled=!e.enabled)}catch(t){de.error("操作失败："+t.message),e.enabled=!e.enabled}finally{e.toggling=!1}})(e),loading:e.toggling},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),j("p",Is,A(e.description||"暂无描述"),1),j("div",Ms,[$(M,{size:"small",type:"info"},{default:F(()=>[H("v"+A(e.version),1)]),_:2},1024),j("span",Ls,[$(T,null,{default:F(()=>[$(ee(Ee))]),_:1}),H(" "+A(e.author),1)]),j("span",js,[$(T,null,{default:F(()=>[$(ee(Re))]),_:1}),H(" "+A(e.toolCount)+" 个工具 ",1)]),e.hasConfig?(W(),J(M,{key:0,size:"small",type:"success"},{default:F(()=>[$(T,null,{default:F(()=>[$(ee(Be))]),_:1}),_[18]||(_[18]=H(" 可配置 "))]),_:1})):U("",!0)])])]),j("div",$s,[$(O,{size:"small",icon:ee(je),onClick:t=>(async e=>{i.value=e,s.value=!0;try{const t=await b.getPluginTools(e.name);0===t.code&&(r.value=t.data.tools,h.value=t.data.tools.map(e=>e.group))}catch(t){de.error("加载工具列表失败："+t.message)}})(e)},{default:F(()=>_[19]||(_[19]=[H(" 查看详情 ")])),_:2},1032,["icon","onClick"]),e.hasConfig?(W(),J(O,{key:0,size:"small",icon:ee(Be),onClick:t=>(async e=>{i.value=e;try{const t=await b.getPluginConfig(e.name);0===t.code?(d.value=JSON.stringify(t.data,null,2),o.value=!0):de.error("加载配置失败："+t.message)}catch(t){de.error("加载配置失败："+t.message)}})(e)},{default:F(()=>_[20]||(_[20]=[H(" 配置 ")])),_:2},1032,["icon","onClick"])):U("",!0),$(O,{size:"small",type:"primary",icon:ee(be),loading:e.reloading,onClick:t=>x(e)},{default:F(()=>_[21]||(_[21]=[H(" 重载 ")])),_:2},1032,["icon","loading","onClick"])])]),_:2},1032,["class"]))),128))])]))]),_:1}),$(K,{modelValue:s.value,"onUpdate:modelValue":_[1]||(_[1]=e=>s.value=e),title:`${i.value?.displayName} - 详情`,width:"800px","destroy-on-close":"",class:"config-dialog plugin-detail-dialog"},{default:F(()=>[j("div",As,[i.value?(W(),L("div",Rs,[$(z,{column:2,border:""},{default:F(()=>[$(B,{label:"插件名称"},{default:F(()=>[H(A(i.value.displayName),1)]),_:1}),$(B,{label:"版本"},{default:F(()=>[H(A(i.value.version),1)]),_:1}),$(B,{label:"作者"},{default:F(()=>[H(A(i.value.author),1)]),_:1}),$(B,{label:"类型"},{default:F(()=>[$(M,{type:"standard"===i.value.type?"success":"warning"},{default:F(()=>[H(A("standard"===i.value.type?"标准插件":"自定义插件"),1)]),_:1},8,["type"])]),_:1}),$(B,{label:"状态"},{default:F(()=>[$(M,{type:i.value.enabled?"success":"info"},{default:F(()=>[H(A(i.value.enabled?"已启用":"已禁用"),1)]),_:1},8,["type"])]),_:1}),$(B,{label:"工具数量"},{default:F(()=>[H(A(i.value.toolCount),1)]),_:1}),$(B,{label:"描述",span:2},{default:F(()=>[H(A(i.value.description||"暂无描述"),1)]),_:1})]),_:1}),r.value.length>0?(W(),L("div",Us,[_[23]||(_[23]=j("h4",null,"提供的工具",-1)),$(G,{modelValue:h.value,"onUpdate:modelValue":_[0]||(_[0]=e=>h.value=e)},{default:F(()=>[(W(!0),L(D,null,N(r.value,e=>(W(),J(Q,{key:e.group,name:e.group,title:`${e.group} (${e.tools.length})`},{default:F(()=>[(W(!0),L(D,null,N(e.tools,e=>(W(),L("div",{key:e.name,class:"tool-item"},[j("div",Es,[j("h5",null,A(e.name),1),$(O,{size:"small",type:"primary",icon:ee(ze),onClick:t=>(e=>{c.value=e,p.value="{}",v.value=null,n.value=!0})(e)},{default:F(()=>_[22]||(_[22]=[H(" 调试 ")])),_:2},1032,["icon","onClick"])]),j("p",Bs,A(e.description),1),$(M,{size:"small",type:"info"},{default:F(()=>[H(" 参数: "+A(Object.keys(e.parameters?.properties||{}).length),1)]),_:2},1024)]))),128))]),_:2},1032,["name","title"]))),128))]),_:1},8,["modelValue"])])):U("",!0)])):U("",!0)])]),_:1},8,["modelValue","title"]),$(K,{modelValue:o.value,"onUpdate:modelValue":_[4]||(_[4]=e=>o.value=e),title:`${i.value?.displayName} - 配置`,width:"700px","destroy-on-close":"",class:"config-dialog plugin-config-dialog"},{footer:F(()=>[$(O,{onClick:_[3]||(_[3]=e=>o.value=!1)},{default:F(()=>_[25]||(_[25]=[H("取消")])),_:1}),$(O,{type:"primary",loading:u.value,onClick:S},{default:F(()=>_[26]||(_[26]=[H(" 保存配置 ")])),_:1},8,["loading"])]),default:F(()=>[j("div",zs,[j("div",qs,[$(X,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"16px"}},{title:F(()=>_[24]||(_[24]=[H(" 配置将自动保存并触发热更新 ")])),_:1}),$(Y,{modelValue:d.value,"onUpdate:modelValue":_[2]||(_[2]=e=>d.value=e),type:"textarea",rows:15,placeholder:"JSON 配置",class:"config-textarea"},null,8,["modelValue"])])])]),_:1},8,["modelValue","title"]),$(K,{modelValue:n.value,"onUpdate:modelValue":_[8]||(_[8]=e=>n.value=e),title:`调试工具: ${c.value?.name}`,width:"800px","destroy-on-close":"",class:"debug-dialog"},{footer:F(()=>[$(O,{onClick:_[7]||(_[7]=e=>n.value=!1)},{default:F(()=>_[42]||(_[42]=[H("关闭")])),_:1}),$(O,{type:"primary",icon:ee(ze),loading:m.value,onClick:V},{default:F(()=>_[43]||(_[43]=[H(" 执行调试 ")])),_:1},8,["icon","loading"])]),default:F(()=>[j("div",Ds,[$(I,{class:"tool-info-card",shadow:"never"},{default:F(()=>[j("div",Ns,[j("div",Ws,[_[27]||(_[27]=j("label",null,"工具名称",-1)),$(M,{type:"primary"},{default:F(()=>[H(A(c.value?.name),1)]),_:1})]),j("div",Js,[_[28]||(_[28]=j("label",null,"描述",-1)),j("span",null,A(c.value?.description||"无描述"),1)])])]),_:1}),c.value?.parameters?(W(),J(I,{key:0,class:"params-schema-card",shadow:"never"},{header:F(()=>[j("div",Hs,[_[30]||(_[30]=j("span",null,"参数说明",-1)),$(O,{size:"small",type:"primary",text:"",onClick:P},{default:F(()=>_[29]||(_[29]=[H(" 填充示例参数 ")])),_:1})])]),default:F(()=>[j("div",Fs,[(W(!0),L(D,null,N(c.value?.parameters?.properties,(e,t)=>(W(),L("div",{key:t,class:"param-item"},[j("div",Qs,[j("span",Gs,[H(A(t)+" ",1),c.value?.parameters?.required?.includes(t)?(W(),J(M,{key:0,type:"danger",size:"small",effect:"plain"},{default:F(()=>_[31]||(_[31]=[H(" 必需 ")])),_:1})):(W(),J(M,{key:1,type:"info",size:"small",effect:"plain"},{default:F(()=>_[32]||(_[32]=[H(" 可选 ")])),_:1}))]),$(M,{size:"small",type:"info"},{default:F(()=>[H(A(e.type),1)]),_:2},1024)]),j("div",Ks,A(e.description||"无描述"),1),e.enum?(W(),L("div",Xs," 可选值: "+A(e.enum.join(", ")),1)):U("",!0),e.items?(W(),L("div",Ys," 数组项类型: "+A(e.items.type),1)):U("",!0)]))),128))])]),_:1})):U("",!0),$(I,{class:"params-input-card",shadow:"never"},{header:F(()=>[j("div",Zs,[_[34]||(_[34]=j("span",null,"参数输入 (JSON 格式)",-1)),$(O,{size:"small",type:"warning",text:"",onClick:_[5]||(_[5]=e=>p.value="{}")},{default:F(()=>_[33]||(_[33]=[H(" 清空 ")])),_:1})])]),default:F(()=>[$(Y,{modelValue:p.value,"onUpdate:modelValue":_[6]||(_[6]=e=>p.value=e),type:"textarea",rows:6,placeholder:'请输入 JSON 格式的参数，例如: {"query": "test", "limit": 10}',class:"params-textarea"},null,8,["modelValue"]),j("div",eo,[$(T,null,{default:F(()=>[$(ee(qe))]),_:1}),_[35]||(_[35]=H(" 提示: 请确保输入的是有效的 JSON 格式，必需参数不能缺失 "))])]),_:1}),v.value?(W(),L("div",to,[$(I,{class:"result-card",shadow:"never"},{header:F(()=>_[36]||(_[36]=[j("div",{class:"card-header"},[j("span",null,"执行结果")],-1)])),default:F(()=>[j("div",{class:R(["debug-result-wrapper",v.value.success?"status-success":"status-error"])},[j("div",ao,[j("div",lo,[$(T,{size:18,class:"icon"},{default:F(()=>[v.value.success?(W(),J(ee(De),{key:0})):(W(),J(ee(Ne),{key:1}))]),_:1}),j("span",so,A(v.value.success?"执行成功":"执行失败"),1)]),v.value.success?(W(),L("div",oo,[j("span",no,"耗时: "+A(v.value.executionTime),1)])):U("",!0)]),j("div",io,[v.value.success?(W(),L(D,{key:0},[j("div",co,[j("span",ro,[_[37]||(_[37]=j("span",{class:"label"},"插件:",-1)),j("span",uo,A(v.value.pluginName),1)]),_[39]||(_[39]=j("span",{class:"divider"},"|",-1)),j("span",po,[_[38]||(_[38]=j("span",{class:"label"},"工具:",-1)),j("span",vo,A(v.value.toolName),1)])]),j("div",mo,[_[40]||(_[40]=j("div",{class:"viewer-label"},"返回结果",-1)),j("div",ho,[j("pre",null,A(JSON.stringify(v.value.result,null,2)),1)])])],64)):(W(),L("div",go,[j("div",fo,[$(T,{class:"error-icon"},{default:F(()=>[$(ee(qe))]),_:1}),j("span",yo,A(v.value.error?.message||"未知错误"),1)]),v.value.error?.stack?(W(),L("div",bo,[_[41]||(_[41]=j("div",{class:"stack-label"},"错误堆栈",-1)),j("pre",wo,A(v.value.error.stack),1)])):U("",!0)]))])],2)]),_:1})])):U("",!0)])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-87e9a468"]]),ko=Object.freeze(Object.defineProperty({__proto__:null,default:_o},Symbol.toStringTag,{value:"Module"})),Co={class:"presets-view"},xo={key:0,class:"loading-container"},So={class:"skeleton-header"},Po={class:"skeleton-actions"},Vo={class:"skeleton-table"},Oo={key:0,class:"content-container"},To={class:"page-header"},Io={class:"header-actions"},Mo={class:"stats-bar"},Lo={class:"stat-item"},jo={class:"stat-value"},$o={class:"stat-item"},Ao={class:"stat-value"},Ro={class:"stat-item"},Uo={class:"stat-value"},Eo={class:"stat-item"},Bo={class:"stat-value"},zo={class:"stat-item"},qo={class:"stat-value"},Do={class:"stat-item"},No={class:"stat-value"},Wo={class:"search-filter-bar"},Jo={class:"search-section"},Ho={class:"filter-section"},Fo={class:"presets-list"},Qo={key:0,class:"empty-state"},Go={key:0,class:"loading-more"},Ko={key:1,class:"load-error"},Xo={key:2,class:"load-placeholder"},Yo={key:3,class:"no-more"},Zo={key:4,class:"loading-more"},en=t({__name:"PresetsView",setup(e){const t=ya(),a=Q(!0),l=Q(!1),s=Q(""),o=Q(""),n=Q(""),i=Q([]),c=Q(!1),r=Q("create"),d=Q(null),u=Q(null),p=Q(null),v=Q(null),m=Q(1),h=Q(50),g=Y(()=>t.pagination?.hasMore||!1),f=Y(()=>g.value||y.value),y=Q(!1),b=Q(!1),k=Y(()=>t.allPresets||[]),C=Y(()=>t.totalCount||0),x=Y(()=>k.value||[]),S=e=>e.name,P=e=>{const t=S(e);return t&&i.value.includes(t)};let V=null;ce([s],()=>{V&&clearTimeout(V),V=setTimeout(()=>{O()},500)}),ce([o,n],()=>{O()}),ce(g,(e,t)=>{e?e&&!t&&ne(()=>{ue()}):pe()});const O=async()=>{m.value=1,pe(),await T(),await ne(),g.value&&ue()},T=async()=>{const e={start:0,nums:h.value};s.value&&(e.keyword=s.value),o.value&&(e.category=o.value),n.value&&(e.source=n.value);try{await t.fetchPresets(e)}catch(a){de.error("获取预设失败："+a.message)}},I=async()=>{if(g.value&&!y.value){y.value=!0,b.value=!1;const a={start:t.pagination.start+t.pagination.nums,nums:h.value};s.value&&(a.keyword=s.value),o.value&&(a.category=o.value),n.value&&(a.source=n.value);try{await t.fetchPresets(a,!0)}catch(e){b.value=!0,de.error("加载更多失败："+e.message)}finally{y.value=!1}}},M=()=>{b.value=!1,I()},R=()=>{},E=async()=>{l.value=!0;try{await t.fetchPresets(),de.success("预设列表刷新成功")}catch(e){de.error("刷新失败："+e.message)}finally{l.value=!1}},B=()=>{r.value="create",d.value=null,c.value=!0},z=e=>{r.value="edit",d.value=e,c.value=!0},X=async e=>{try{await ye.confirm(`确定要删除预设 "${e.name}" 吗？`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"});const a=e.name;if(!a)throw new Error("预设名称不能为空");await t.deletePreset(a),de.success("删除成功")}catch(a){"cancel"!==a&&de.error("删除失败："+a.message)}},Z=async()=>{try{await ye.confirm(`确定要删除选中的 ${i.value.length} 个预设吗？`,"批量删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"});const e=(await t.batchDeletePresets(i.value)).filter(e=>e.success).length;de.success(`成功删除 ${e} 个预设`),i.value=[]}catch(e){"cancel"!==e&&de.error("批量删除失败："+e.message)}},te=async e=>{try{const a=e.name;if(!a)throw new Error("预设名称不能为空");await t.exportPreset(a),de.success("导出成功")}catch(a){de.error("导出失败："+a.message)}},ae=()=>{u.value?.click()},le=async e=>{const a=e.target.files[0];if(a)try{await t.importPreset(a),de.success("导入成功"),e.target.value=""}catch(l){de.error("导入失败："+l.message)}},oe=()=>{c.value=!1},ie=async({data:e,mode:a})=>{try{if("create"===a)await t.createPreset(e),de.success("创建成功"),c.value=!1;else{const a=d.value.name;if(!a)return void de.error("预设名称不能为空");await t.updatePreset(a,e),de.success("更新成功"),c.value=!1}}catch(l){de.error("create"===a?"创建失败：":"更新失败："+l.message)}};let re=null;const ue=()=>{v.value&&(re=new IntersectionObserver(e=>{e[0].isIntersecting&&g.value&&!y.value&&I()},{rootMargin:"100px",threshold:.1}),re.observe(v.value))},pe=()=>{re&&(re.disconnect(),re=null)};return G(async()=>{a.value=!0;try{await T(),await new Promise(e=>setTimeout(e,300))}catch(e){de.error("加载预设失败："+e.message)}finally{a.value=!1,await ne(),ue()}}),K(()=>{pe()}),(e,m)=>{const h=q("el-button"),k=q("el-input"),V=q("el-option"),T=q("el-select"),I=q("el-empty"),Q=q("el-skeleton"),G=q("el-result"),K=q("el-divider");return W(),L("div",Co,[a.value?(W(),L("div",xo,[j("div",So,[m[3]||(m[3]=j("div",{class:"skeleton-title"},null,-1)),j("div",Po,[(W(),L(D,null,N(3,e=>j("div",{class:"skeleton-button",key:e})),64))])]),j("div",Vo,[(W(),L(D,null,N(6,e=>j("div",{class:"skeleton-row",key:e},[(W(),L(D,null,N(5,e=>j("div",{class:"skeleton-cell",key:e})),64))])),64))])])):U("",!0),$(se,{name:"fade",mode:"out-in"},{default:F(()=>[a.value?U("",!0):(W(),L("div",Oo,[j("div",To,[m[7]||(m[7]=j("h1",null,"预设管理",-1)),j("div",Io,[i.value&&i.value.length>0?(W(),J(h,{key:0,type:"danger",icon:ee(Ie),onClick:Z},{default:F(()=>[H(" 批量删除 ("+A(i.value?.length||0)+") ",1)]),_:1},8,["icon"])):U("",!0),$(h,{type:"primary",icon:ee(be),loading:l.value,onClick:E},{default:F(()=>m[4]||(m[4]=[H(" 刷新 ")])),_:1},8,["icon","loading"]),$(h,{type:"primary",icon:ee(Me),onClick:B},{default:F(()=>m[5]||(m[5]=[H(" 创建预设 ")])),_:1},8,["icon"]),$(h,{type:"success",icon:ee(we),onClick:ae},{default:F(()=>m[6]||(m[6]=[H(" 导入预设 ")])),_:1},8,["icon"])])]),j("div",Mo,[j("div",Lo,[m[8]||(m[8]=j("span",{class:"stat-label"},"总计：",-1)),j("span",jo,A(C.value)+" 个预设",1)]),j("div",$o,[m[9]||(m[9]=j("span",{class:"stat-label"},"常用：",-1)),j("span",Ao,A(ee(t).countByCategory.common)+" 个",1)]),j("div",Ro,[m[10]||(m[10]=j("span",{class:"stat-label"},"推荐：",-1)),j("span",Uo,A(ee(t).countByCategory.recommended)+" 个",1)]),j("div",Eo,[m[11]||(m[11]=j("span",{class:"stat-label"},"隐藏：",-1)),j("span",Bo,A(ee(t).countByCategory.hidden)+" 个",1)]),j("div",zo,[m[12]||(m[12]=j("span",{class:"stat-label"},"内置：",-1)),j("span",qo,A(ee(t).countBySource["built-in"])+" 个",1)]),j("div",Do,[m[13]||(m[13]=j("span",{class:"stat-label"},"自定义：",-1)),j("span",No,A(ee(t).countBySource.custom)+" 个",1)])]),j("div",Wo,[j("div",Jo,[$(k,{modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=e=>s.value=e),placeholder:"搜索预设名称、开场白或内容...","prefix-icon":ee(We),clearable:"",onInput:R,style:{width:"300px"}},null,8,["modelValue","prefix-icon"])]),j("div",Ho,[$(T,{modelValue:o.value,"onUpdate:modelValue":m[1]||(m[1]=e=>o.value=e),placeholder:"分类筛选",clearable:"",style:{width:"120px"},onChange:O},{default:F(()=>[$(V,{label:"常用",value:"common"}),$(V,{label:"推荐",value:"recommended"}),$(V,{label:"隐藏",value:"hidden"})]),_:1},8,["modelValue"]),$(T,{modelValue:n.value,"onUpdate:modelValue":m[2]||(m[2]=e=>n.value=e),placeholder:"来源筛选",clearable:"",style:{width:"120px"},onChange:O},{default:F(()=>[$(V,{label:"内置",value:"built-in"}),$(V,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])])]),j("div",Fo,[x.value&&0!==x.value.length||a.value?(W(),L("div",{key:1,class:"presets-waterfall",ref_key:"waterfallRef",ref:p},[(W(!0),L(D,null,N(x.value,e=>(W(),J(_,{key:S(e),preset:e,selected:P(e),onSelect:t=>((e,t)=>{if(t)i.value.includes(e)||i.value.push(e);else{const t=i.value.indexOf(e);t>-1&&i.value.splice(t,1)}})(S(e),t),onEdit:z,onDelete:X,onExport:te},null,8,["preset","selected","onSelect"]))),128))],512)):(W(),L("div",Qo,[$(I,{description:"暂无预设"},{default:F(()=>[$(h,{type:"primary",icon:ee(Me),onClick:B},{default:F(()=>m[14]||(m[14]=[H(" 创建预设 ")])),_:1},8,["icon"])]),_:1})])),f.value?(W(),L("div",{key:2,ref_key:"loadTrigger",ref:v,class:"load-trigger"},[y.value?(W(),L("div",Go,[$(Q,{rows:2,animated:""})])):b.value?(W(),L("div",Ko,[$(G,{icon:"warning",title:"加载失败","sub-title":"网络错误，请重试"},{extra:F(()=>[$(h,{type:"primary",onClick:M},{default:F(()=>m[15]||(m[15]=[H("重试")])),_:1})]),_:1})])):(W(),L("div",Xo))],512)):U("",!0),!g.value&&x.value.length>0?(W(),L("div",Yo,[$(K,null,{default:F(()=>m[16]||(m[16]=[j("span",{class:"no-more-text"},"已加载全部预设",-1)])),_:1})])):U("",!0),a.value?(W(),L("div",Zo,[$(Q,{rows:3,animated:""})])):U("",!0)])]))]),_:1}),$(w,{visible:c.value,mode:r.value,preset:d.value,onClose:oe,onSubmit:ie},null,8,["visible","mode","preset"]),j("input",{ref_key:"fileInput",ref:u,type:"file",accept:".json",style:{display:"none"},onChange:le},null,544)])}}},[["__scopeId","data-v-ee352eca"]]),tn=Object.freeze(Object.defineProperty({__proto__:null,default:en},Symbol.toStringTag,{value:"Module"})),an={class:"logs-view"},ln={class:"connection-status"},sn={class:"connection-info"},on={key:0},nn={key:1},cn={key:2},rn={class:"debug-info",style:{"margin-top":"12px","font-size":"12px",color:"#909399"}},dn={class:"control-row"},un={class:"control-group"},pn={class:"filter-group"},vn={class:"logs-header-row"},mn={class:"logs-count"},hn={class:"logs-controls"},gn={class:"log-header"},fn={class:"log-timestamp"},yn={class:"log-module"},bn={key:0,class:"log-caller"},wn={class:"log-message"},_n=["onClick"],kn=["onClick"],Cn=["innerHTML"],xn={key:0,class:"log-extra"},Sn={key:0,class:"empty-logs"},Pn={class:"json-content"},Vn={class:"json-header"},On={class:"json-timestamp"},Tn={class:"json-module"},In={class:"json-body"},Mn={class:"json-pre"},Ln=t({__name:"LogsView",setup(e){const t=ea(),a=Y(()=>t.logs||[]),l=Y(()=>t.isConnected),s=Y(()=>t.stats),o=t.search,n=t.exportLogs,i=t.getStats,c=t.clearLogs,r=Q(""),d=Q(""),u=Q(""),p=Q(!0),v=Q(null),m=Q(!1),h=Q(!1),g=Q(!1),f=Q(null),y=Q(null),b=Q({format:"json",maxRecords:1e4,includeMetadata:!0}),w=Y(()=>{let e=a.value||[];if(r.value&&(e=e.filter(e=>e.level===r.value)),d.value&&(e=e.filter(e=>e.module===d.value)),u.value){const t=u.value.toLowerCase();e=e.filter(e=>e.message.toLowerCase().includes(t)||e.module.toLowerCase().includes(t)||e.caller&&e.caller.toLowerCase().includes(t))}return e}),_=async()=>{try{await ye.confirm("确定要清空所有日志吗？","确认清空",{type:"warning"}),c(),de.success("日志已清空")}catch(e){}},k=async()=>{if(u.value.trim())try{const e=await o({keyword:u.value,level:r.value||void 0,modules:d.value?[d.value]:[],page:1,pageSize:100});e.success&&de.success(`找到 ${e.data.total} 条匹配的日志`)}catch(e){de.error("搜索失败: "+e.message)}},C=()=>{m.value=!0},x=async()=>{h.value=!0;try{const e=await n({format:b.value.format,level:r.value||void 0,modules:d.value?[d.value]:[],keyword:u.value||void 0,maxRecords:b.value.maxRecords,includeMetadata:b.value.includeMetadata});if(e.success){const t=new Blob([e.data.data],{type:S(e.data.format)}),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`logs_${(new Date).toISOString().slice(0,19).replace(/:/g,"-")}.${e.data.format}`,l.click(),URL.revokeObjectURL(a),de.success("导出成功"),m.value=!1}}catch(e){de.error("导出失败: "+e.message)}finally{h.value=!1}},S=e=>({json:"application/json",csv:"text/csv",txt:"text/plain"}[e]||"text/plain"),P=e=>{if(!e)return"未知";const t=Math.floor(e/1e3),a=Math.floor(t/60),l=Math.floor(a/60),s=Math.floor(l/24);return s>0?`${s}天${l%24}小时`:l>0?`${l}小时${a%60}分钟`:a>0?`${a}分钟`:`${t}秒`},V=e=>{try{const t=e.extra?.originalObject;if(!t||"object"!=typeof t)return"JSON: 无效对象";const a=Object.keys(t);return 0===a.length?"JSON: {}":1===a.length?`JSON: { ${a[0]}: ... }`:`JSON: { ${a[0]}, ${a[1]}${a.length>2?`, +${a.length-2} more`:""} }`}catch(t){return"JSON: 解析错误"}},O=e=>{try{const t=e.extra?.originalObject;return t?JSON.stringify(t,null,2):"无 JSON 数据"}catch(t){return"格式化失败"}},T=async()=>{if(f.value)try{const e=O(f.value);await navigator.clipboard.writeText(e),de.success("内容已复制到剪贴板")}catch(e){de.error("复制失败: "+e.message)}},I=e=>{try{if(Array.isArray(e))return`Array[${e.length}]: ${e.length>0?JSON.stringify(e[0]).substring(0,30)+"...":"empty"}`;const t=Object.keys(e);return 0===t.length?"Object: {}":1===t.length?`Object: { ${t[0]}: ... }`:`Object: { ${t[0]}, ${t[1]}${t.length>2?`, +${t.length-2} more`:""} }`}catch(t){return"Object: 解析错误"}},M=e=>"object"==typeof e&&null!==e,E=e=>{if(!M(e))return((e,t)=>{if(!e)return"";const a=String(e);return a.length<=t?a:a.substring(0,t)+"..."})(String(e),20);if(Array.isArray(e))return`[${e.length} items]`;const t=Object.keys(e);return 0===t.length?"{}":1===t.length?`{${t[0]}}`:`{${t.length} keys}`},B=(e,t)=>M(t)?`${e}: 点击查看对象详情`:`${e}: ${t}`,z=e=>{if(!e)return{};const{type:t,originalObject:a,...l}=e;return l},X=()=>{v.value&&ne(()=>{v.value.scrollTop=v.value.scrollHeight})},Z=()=>{if(!v.value||!p.value)return;const{scrollTop:e,scrollHeight:t,clientHeight:a}=v.value;e+a>=t-10||(p.value=!1)};ce(w,()=>{p.value&&ne(()=>{X()})},{deep:!0}),ce(l,(e,t)=>{e&&!t&&i()},{immediate:!0});let te=null;return G(async()=>{try{await t.initialize()}catch(e){de.error("日志服务初始化失败: "+e.message)}te=setInterval(()=>{l.value&&i()},3e4),setTimeout(()=>{l.value&&i()},1e3)}),K(()=>{te&&clearInterval(te)}),(e,o)=>{const n=q("el-card"),i=q("el-button"),c=q("el-option"),S=q("el-select"),Q=q("el-input"),G=q("el-switch"),K=q("el-icon"),Y=q("el-tag"),te=q("el-empty"),ae=q("el-dialog"),le=q("el-radio"),se=q("el-radio-group"),oe=q("el-form-item"),ne=q("el-input-number"),ie=q("el-form");return W(),L("div",an,[o[22]||(o[22]=j("div",{class:"logs-header"},[j("h2",null,"日志管理"),j("p",{class:"logs-description"},"实时查看系统日志，支持搜索、过滤和导出功能")],-1)),$(n,{class:"connection-card",shadow:"never"},{default:F(()=>[j("div",ln,[j("div",{class:R(["status-indicator",{connected:l.value,disconnected:!l.value}])},[o[11]||(o[11]=j("div",{class:"status-dot"},null,-1)),j("span",null,A(l.value?"已连接":"未连接"),1)],2),j("div",sn,[l.value&&s.value?(W(),L("span",on," 服务运行时间: "+A(P(s.value.service?.uptime))+" | 总日志数: "+A(s.value.service?.totalLogsSent||0),1)):l.value?(W(),L("span",nn," 连接正常，正在加载日志... ")):(W(),L("span",cn," 请检查网络连接和服务器状态 "))])]),j("div",rn,[j("div",null,"连接状态: "+A(l.value?"✅ 已连接":"❌ 未连接"),1),j("div",null,"日志数量: "+A(a.value.length)+" 条",1),j("div",null,"过滤后日志数量: "+A(w.value.length)+" 条",1),j("div",null,"logStore是否初始化: "+A(ee(t).isInitialized?"是":"否"),1)])]),_:1}),$(n,{class:"control-panel",shadow:"never"},{default:F(()=>[j("div",dn,[j("div",un,[$(i,{onClick:_,disabled:0===a.value.length},{default:F(()=>o[12]||(o[12]=[H(" 清空日志 ")])),_:1},8,["disabled"]),$(i,{onClick:C,disabled:0===a.value.length},{default:F(()=>o[13]||(o[13]=[H(" 导出日志 ")])),_:1},8,["disabled"])]),j("div",pn,[$(S,{modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=e=>r.value=e),placeholder:"日志级别",style:{width:"120px"}},{default:F(()=>[$(c,{label:"全部",value:""}),$(c,{label:"ERROR",value:"ERROR"}),$(c,{label:"WARN",value:"WARN"}),$(c,{label:"MARK",value:"MARK"}),$(c,{label:"INFO",value:"INFO"}),$(c,{label:"DEBUG",value:"DEBUG"})]),_:1},8,["modelValue"]),$(S,{modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=e=>d.value=e),placeholder:"模块",style:{width:"120px"}},{default:F(()=>[$(c,{label:"全部",value:""}),$(c,{label:"llm",value:"llm"}),$(c,{label:"onebot",value:"onebot"}),$(c,{label:"system",value:"system"})]),_:1},8,["modelValue"]),$(Q,{modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=e=>u.value=e),placeholder:"搜索关键词",style:{width:"200px"},clearable:"",onKeyup:re(k,["enter"])},{append:F(()=>[$(i,{onClick:k,icon:ee(We)},null,8,["icon"])]),_:1},8,["modelValue"])])])]),_:1}),$(n,{class:"logs-container",shadow:"never"},{default:F(()=>[j("div",vn,[j("span",mn,"共 "+A(w.value.length)+" 条日志",1),j("div",hn,[$(G,{modelValue:p.value,"onUpdate:modelValue":o[3]||(o[3]=e=>p.value=e),"active-text":"自动滚动","inactive-text":""},null,8,["modelValue"]),$(i,{size:"small",onClick:X,disabled:0===w.value.length},{default:F(()=>o[14]||(o[14]=[H(" 滚动到底部 ")])),_:1},8,["disabled"])])]),j("div",{ref_key:"logsContainer",ref:v,class:"logs-list",onScroll:Z},[(W(!0),L(D,null,N(w.value,e=>{return W(),L("div",{key:e.id,class:R(["log-item",[`level-${e.level.toLowerCase()}`,{highlighted:e.highlighted}]])},[j("div",gn,[j("span",fn,A((a=e.timestamp,new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}))),1),j("span",{class:R(["log-level",`level-${e.level.toLowerCase()}`])},A(e.level),3),j("span",yn,A(e.module),1),e.caller?(W(),L("span",bn,A(e.caller),1)):U("",!0)]),j("div",wn,["json"===e.extra?.type?(W(),L("span",{key:0,class:"json-message",onClick:t=>(e=>{f.value=e,y.value=null,g.value=!0})(e)},[H(A(V(e))+" ",1),$(K,{class:"json-expand-icon"},{default:F(()=>[$(ee(je))]),_:1})],8,_n)):(t=e.message,"object"==typeof t&&null!==t?(W(),L("span",{key:1,class:"object-message",onClick:t=>(e=>{const t={...e,extra:{...e.extra,originalObject:e.message}};f.value=t,y.value=null,g.value=!0})(e)},[H(A(I(e.message))+" ",1),$(K,{class:"json-expand-icon"},{default:F(()=>[$(ee(je))]),_:1})],8,kn)):(W(),L("span",{key:2,innerHTML:e.message},null,8,Cn)))]),e.extra&&Object.keys(z(e.extra)).length>0?(W(),L("div",xn,[(W(!0),L(D,null,N(z(e.extra),(t,a)=>(W(),J(Y,{key:a,size:"small",type:M(t)?"warning":"info",class:R(["log-extra-tag",{clickable:M(t)}]),title:B(a,t),onClick:l=>M(t)?((e,t,a)=>{const l={...a,extra:{...a.extra,originalObject:t}};f.value=l,y.value=e,g.value=!0})(a,t,e):null},{default:F(()=>[H(A(a)+": "+A(E(t)),1)]),_:2},1032,["type","class","title","onClick"]))),128))])):U("",!0)],2);var t,a}),128)),0===w.value.length?(W(),L("div",Sn,[$(te,{description:"暂无日志数据"})])):U("",!0)],544)]),_:1}),$(ae,{modelValue:g.value,"onUpdate:modelValue":o[5]||(o[5]=e=>g.value=e),title:y.value?`Extra 字段详情: ${y.value}`:"json"===f.value?.extra?.type?"JSON 日志详情":"对象详情",width:"800px",class:"json-dialog"},{footer:F(()=>[$(i,{onClick:T},{default:F(()=>o[15]||(o[15]=[H("复制内容")])),_:1}),$(i,{type:"primary",onClick:o[4]||(o[4]=e=>g.value=!1)},{default:F(()=>o[16]||(o[16]=[H("关闭")])),_:1})]),default:F(()=>[j("div",Pn,[j("div",Vn,[j("span",On,A(f.value?.timestamp),1),j("span",{class:R(["json-level",`level-${f.value?.level?.toLowerCase()}`])},A(f.value?.level),3),j("span",Tn,A(f.value?.module),1)]),j("div",In,[j("pre",Mn,A(O(f.value)),1)])])]),_:1},8,["modelValue","title"]),$(ae,{modelValue:m.value,"onUpdate:modelValue":o[10]||(o[10]=e=>m.value=e),title:"导出日志",width:"500px"},{footer:F(()=>[$(i,{onClick:o[9]||(o[9]=e=>m.value=!1)},{default:F(()=>o[20]||(o[20]=[H("取消")])),_:1}),$(i,{type:"primary",onClick:x,loading:h.value},{default:F(()=>o[21]||(o[21]=[H(" 导出 ")])),_:1},8,["loading"])]),default:F(()=>[$(ie,{model:b.value,"label-width":"100px"},{default:F(()=>[$(oe,{label:"导出格式"},{default:F(()=>[$(se,{modelValue:b.value.format,"onUpdate:modelValue":o[6]||(o[6]=e=>b.value.format=e)},{default:F(()=>[$(le,{label:"json"},{default:F(()=>o[17]||(o[17]=[H("JSON")])),_:1}),$(le,{label:"csv"},{default:F(()=>o[18]||(o[18]=[H("CSV")])),_:1}),$(le,{label:"txt"},{default:F(()=>o[19]||(o[19]=[H("TXT")])),_:1})]),_:1},8,["modelValue"])]),_:1}),$(oe,{label:"最大记录数"},{default:F(()=>[$(ne,{modelValue:b.value.maxRecords,"onUpdate:modelValue":o[7]||(o[7]=e=>b.value.maxRecords=e),min:1,max:5e4,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),$(oe,{label:"包含元数据"},{default:F(()=>[$(G,{modelValue:b.value.includeMetadata,"onUpdate:modelValue":o[8]||(o[8]=e=>b.value.includeMetadata=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-61f7887b"]]),jn=Object.freeze(Object.defineProperty({__proto__:null,default:Ln},Symbol.toStringTag,{value:"Module"}));export{He as r};
//# sourceMappingURL=views-CrX0v3un.js.map
