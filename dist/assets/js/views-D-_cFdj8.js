import{_ as e,F as t,I as a,T as s,a as o,R as n,c as i,f as l,P as c,b as r}from"./components-QQKzUNSK.js";import{M as d,o as h,c as p,a as m,l as u,t as g,n as v,F as y,d as C,f,e as w,i as _,g as k,h as b,b as S,m as x,p as T,E as M,k as I,q as R,s as V,u as L,w as O,j as D,x as P}from"./vue-vendor-D3FW71PE.js";import{h as $,_ as E}from"./vendor-CEso2w_N.js";import"./emoji-BVjhSaBE.js";const U={id:"chat-window"},B={class:"upside-bar"},j={class:"delay-num"},A={class:"options"},H={id:"main-messages-window",ref:"chatWindow",class:"message-window"},W={key:0,class:"message-time"},z=["id"],F={key:0,class:"avatar"},q=["src","alt"],N=["src","alt"],G={key:1,class:"msg"},K={class:"wholename"},X={key:0,class:"title"},Y={class:"name"},J=["onContextmenu"],Q={key:6,class:"blank-message",style:{width:"10rem",height:"28.8px",position:"relative"}},Z={key:2,class:"system-message"};const ee=e({components:{MdPreview:d,ForwardMsg:t,InputEditor:a,ToolCallBar:s,FileBlock:o,ReasonBlock:n},data(){const e=parseInt(this.$route.params.id);return{activeContactor:i.getContactor(e),showwindow:!0,showemoji:!1,userInput:"",todld:!1,client:i,extraOptions:[],wraperPresets:{},selectedWraper:null,currentDelay:0,toupdate:!1,seletedText:"",seletedImage:"",showMenu:!1,menuTop:0,menuLeft:0,validMessageIndex:-1,repliedMessage:null,autoScroll:!1,fullScreen:!1,chatWindowRef:null}},computed:{getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},activeMessageChain(){return this.activeContactor.options.opening?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain}},watch:{"$route.params.id"(e,t){const a=parseInt(e),s=i.getContactor(a);if(this.activeContactor=s,this.initContactor(this.activeContactor),this.chatWindowRef&&this.toButtom(),t){const e=parseInt(t),a=i.getContactor(e);this.disableContactor(a)}}},mounted(){document.addEventListener("click",(()=>{this.showMenu=!1,this.seletedText="",this.seletedImage=""})),this.chatWindowRef=this.$refs.chatWindow,this.chatWindowRef.addEventListener("scroll",this.scrollHandler),this.toButtom();const e=this.$route.params.id,t=i.getContactor(e);this.initContactor(t),this.fullScreen=this.client.fullScreen,setInterval((()=>{this.currentDelay=this.client.socket.delay}),3e3)},updated(){this.toupdate&&this.autoScroll&&(this.toButtom(),this.toupdate=!1)},beforeUnmount(){this.disableContactor(this.activeContactor),this.chatWindowRef.removeEventListener("scroll",this.scrollHandler)},methods:{handleMouseUp(){const e=window.getSelection().toString();e&&(this.seletedText=e)},toButtom(e){setTimeout((()=>{if(this.chatWindowRef)this.chatWindowRef.scrollTop=this.chatWindowRef.scrollHeight;else{const e=document.getElementById("main-messages-window");e.scrollTop=e.scrollHeight}e&&this.$message("已滑至底部")}),20)},cleanScreen(){this.activeContactor.messageChain=[],this.activeContactor.updateFirstMessage(),i.setLocalStorage(),this.activeContactor.emit("updateMessageSummary"),this.toupdate=!0,this.$message({message:"已清除会话记录",type:"success"})},cleanHistory(){this.activeContactor.updateFirstMessage(),this.$message({message:"上下文信息已清除，之后的请求将不再记录上文记录",type:"success"})},isValidInput:e=>!/^[ \n]+$/.test(e),waiting(){this.$message({message:"此功能尚未开放",type:"warning"})},tolist(){this.$router.push({name:"home"})},async setModel(e){this.activeContactor.options.model=e,this.activeContactor.title=e,this.activeContactor.loadAvatar(),await i.setLocalStorage()},toimg(){const e=this.chatWindowRef.getBoundingClientRect();e.height=this.chatWindowRef.scrollHeight,$(this.chatWindowRef,{windowHeight:1.2*e.height,width:e.width}).then((e=>{const t=e.toDataURL("image/png"),a=document.createElement("a");a.download="chat.png",a.href=t,a.click()}))},hasOpening(){return!!this.activeContactor.options.opening},getFullMessages(){return this.hasOpening()?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain},showTime(e){const t=this.getFullMessages(),a=t[e].time;if(0===e)return{show:!0,time:this.activeContactor.getShownTime(a)};return a-t[e-1].time>6e5?{show:!0,time:this.activeContactor.getShownTime(a)}:{show:!1,time:""}},separateTextAndImages(e){const t=/!\[([^\]]*)\]\((.*)\)/g;let a,s=[],o=0;for(;null!==(a=t.exec(e));){if(a.index>o){const t=e.slice(o,a.index).trim();t&&s.push({type:"text",data:{text:t}})}s.push({type:"image",data:{file:a[2]}}),o=t.lastIndex}if(o<e.length){const t=e.slice(o).trim();t&&s.push({type:"text",data:{text:t}})}return s},getChatwindowScrollheight(){var e=this.chatWindowRef.scrollTop,t=this.chatWindowRef.clientHeight,a=this.chatWindowRef.scrollHeight;return a-e/(a-t)*a},initContactor(e){e.active=!0,e.on("revMessage",(e=>{this.activeContactor.messageChain.push(e),this.toupdate=!0})),e.on("delMessage",(e=>{this.activeContactor.messageChain.splice(e,1),this.toupdate=!0})),e.on("updateMessage",(()=>{this.$forceUpdate(),this.toupdate=!0})),e.on("completeMessage",(async e=>{const t=e.index,a=this.activeContactor.messageChain[t];a.status="completed",e.error?a.content=[{type:"text",data:{text:e.text}}]:a.content.forEach(((e,t)=>{if("text"===e.type&&"onebot"===this.activeContactor.platform){const s=this.separateTextAndImages(e.data.text);a.content.splice(t,1,...s)}})),this.$forceUpdate(),this.toupdate=!0,await this.activeContactor.loadName(),await i.setLocalStorage()}))},disableContactor(e){e.active=!1,e.off("updateMessage"),e.off("revMessage"),e.off("delMessage"),e.off("completeMessage")},getReplyText(e){let t="";const a=this.activeContactor.messageChain.find((t=>t.id===e));if(a)return a.content.forEach((e=>{"text"===e.type?t+=e.data.text:"image"===e.type&&(t+="[图片]")})),t.length>20?`> ${t.substr(0,20)}...`:`> ${t}`},showMessageMenu(e,t){if("img"===e.target.tagName.toLowerCase()){const t=e.target.src;this.seletedImage=t}this.validMessageIndex="openai"===this.activeContactor.platform&&this.hasOpening()?t-1:t,e.preventDefault(),this.showMenu=!0,this.menuTop=e.clientY,this.menuLeft=e.clientX;const a=window.getSelection().toString();this.seletedText=a||""},messageMenuClick(e){const t=e=>{const t=document.createElement("textarea");t.style.position="absolute",t.style.left="-9999px",t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999);try{document.execCommand("copy"),this.$message({message:"复制成功",type:"success"})}catch(a){this.$message({message:"复制失败",type:"error"})}finally{document.body.removeChild(t)}},a=e=>{try{fetch(e).then((e=>{if(!e.ok)throw new Error("网络错误，无法获取图片");return e.blob()})).then((e=>{const t=new Image,a=URL.createObjectURL(e);t.onload=()=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;e.getContext("2d").drawImage(t,0,0),e.toBlob((e=>{if(e){const t=new ClipboardItem({"image/png":e});navigator.clipboard.write([t]).then((()=>{this.$message({message:"图片已复制到剪贴板",type:"success"})})).catch((e=>{this.$message({message:"复制图片失败",type:"error"})}))}else this.$message({message:"转换为 PNG 失败",type:"error"});URL.revokeObjectURL(a)}),"image/png")},t.src=a})).catch((e=>{this.$message({message:"复制图片失败",type:"error"})}))}catch(t){this.$message({message:"复制图片失败",type:"error"})}};switch(e){case"copy":{let e="";this.activeContactor.messageChain[this.validMessageIndex].content.forEach((t=>{"text"===t.type?e+=t.data.text:"image"===t.type&&(e+="[图片]")})),t(e);break}case"copySeletedText":t(this.seletedText);break;case"copySeletedImage":a(this.seletedImage);break;case"saveSeletedImage":(e=>{const t=document.createElement("a");t.href=e,t.download="image.png",t.click()})(this.seletedImage);break;case"reply":"onebot"===this.activeContactor.platform?(this.repliedMessage=this.activeContactor.messageChain[this.validMessageIndex],this.$message({message:"已引用该消息",type:"success"})):this.userInput+=this.getReplyText(this.activeContactor.messageChain[this.validMessageIndex].id)+"\n\n";break;case"delete":this.activeContactor.platform,this.activeContactor.messageChain.splice(this.validMessageIndex,1),this.showMenu=!1}this.seletedText="",this.seletedImage="",this.showMenu=!1},scrollHandler(){this.showMenu=!1,this.showemoji&&(this.showemoji=!1);const e=this.getChatwindowScrollheight();this.autoScroll=!(e>300)}}},[["render",function(e,t,a,s,o,n){const i=S("MdPreview"),l=S("el-image"),c=S("ForwardMsg"),r=S("FileBlock"),d=S("ReasonBlock"),x=S("ToolCallBar"),T=S("InputEditor");return h(),p("div",U,[m("div",B,[m("div",{class:"return",onClick:t[0]||(t[0]=e=>n.tolist())},t[12]||(t[12]=[m("i",{class:"iconfont icon-return"},null,-1)])),m("div",{class:"name-area",onClick:t[1]||(t[1]=t=>e.$router.push(`/profile/${o.activeContactor.id}`))},[u(g(o.activeContactor.name)+" ",1),m("span",{class:v("delay-status "+n.getDelayStatus)},null,2),m("span",j,"当前延迟: "+g(o.currentDelay)+" ms",1)]),m("div",A,[m("div",{class:"share",onClick:t[2]||(t[2]=e=>n.toimg())},t[13]||(t[13]=[m("i",{class:"iconfont icon-share"},null,-1)]))])]),m("div",H,[(h(!0),p(y,null,C(n.activeMessageChain,((a,s)=>(h(),p("div",{key:s,ref_for:!0,ref:"message",class:"message-container"},[n.showTime(s).show?(h(),p("div",W,g(n.showTime(s).time),1)):f("",!0),m("div",{id:a.role,class:"message-body"},["mio_system"!==a.role?(h(),p("div",F,["other"===a.role?(h(),p("img",{key:0,src:o.activeContactor.avatar,alt:o.activeContactor.name,onClick:t[3]||(t[3]=t=>e.$router.push(`/profile/${o.activeContactor.id}`))},null,8,q)):(h(),p("img",{key:1,src:o.client.avatar,alt:o.client.name},null,8,N))])):f("",!0),"mio_system"!==a.role?(h(),p("div",G,[m("div",K,[("other"===a.role?o.activeContactor.title:o.client.title)?(h(),p("div",X,g("other"===a.role?o.activeContactor.title:o.client.title),1)):f("",!0),m("div",Y,g("other"===a.role?o.activeContactor.name:o.client.name),1)]),m("div",{class:"content",onMouseup:t[4]||(t[4]=(...e)=>n.handleMouseUp&&n.handleMouseUp(...e)),onContextmenu:e=>n.showMessageMenu(e,s)},[(h(!0),p(y,null,C(a.content,((e,a)=>(h(),p("div",{key:a,class:"inner-content"},["text"===e.type?(h(),w(i,{key:0,"no-img-zoom-in":!1,"preview-theme":"github","code-foldable":!1,"model-value":e.data.text},null,8,["model-value"])):"image"===e.type?(h(),w(l,{key:1,src:e.data.file,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.data.file],"initial-index":4,fit:"contain"},null,8,["src","preview-src-list"])):"reply"===e.type?(h(),w(i,{key:2,"preview-theme":"github","model-value":n.getReplyText(e.data.id)},null,8,["model-value"])):"nodes"===e.type?(h(),w(c,{key:3,contactor:o.activeContactor,messages:e.data.messages},null,8,["contactor","messages"])):"file"===e.type?(h(),w(r,{key:4,"file-url":e.data.file},null,8,["file-url"])):"reason"===e.type?(h(),w(d,{key:5,"end-time":e.data.endTime,"start-time":e.data.startTime,content:e.data.text},null,8,["end-time","start-time","content"])):"blank"===e.type?(h(),p("div",Q,t[14]||(t[14]=[m("span",{class:"blank_loader"},null,-1)]))):"tool_call"===e.type?(h(),w(x,{key:7,tool_call:e.data},null,8,["tool_call"])):(h(),w(i,{key:8,"preview-theme":"github","model-value":"未知的消息类型：\n```\n"+e+"\n```"},null,8,["model-value"]))])))),128))],40,J),o.showMenu&&o.validMessageIndex===s?(h(),p("div",{key:0,id:"message-menu",style:_({top:o.menuTop+"px",left:o.menuLeft+"px"})},[m("div",{onClick:t[5]||(t[5]=k((e=>n.messageMenuClick("copy")),["stop"]))},t[15]||(t[15]=[m("i",{class:"iconfont fuzhi"},null,-1),m("span",null,"复制消息",-1)])),o.seletedText?(h(),p("div",{key:0,onClick:t[6]||(t[6]=k((e=>n.messageMenuClick("copySeletedText")),["stop"]))},t[16]||(t[16]=[m("i",{class:"iconfont fuzhi"},null,-1),m("span",null,"复制选中",-1)]))):f("",!0),o.seletedImage?(h(),p("div",{key:1,onClick:t[7]||(t[7]=k((e=>n.messageMenuClick("copySeletedImage")),["stop"]))},t[17]||(t[17]=[m("i",{class:"iconfont fuzhi"},null,-1),m("span",null,"复制图片",-1)]))):f("",!0),o.seletedImage?(h(),p("div",{key:2,onClick:t[8]||(t[8]=k((e=>n.messageMenuClick("saveSeletedImage")),["stop"]))},t[18]||(t[18]=[m("i",{class:"iconfont fuzhi"},null,-1),m("span",null,"保存图片",-1)]))):f("",!0),m("div",{onClick:t[9]||(t[9]=k((e=>n.messageMenuClick("reply")),["stop"]))},t[19]||(t[19]=[m("i",{class:"iconfont yinyong"},null,-1),m("span",null,"引用消息",-1)])),m("div",{onClick:t[10]||(t[10]=k((e=>n.messageMenuClick("delete")),["stop"]))},t[20]||(t[20]=[m("i",{class:"iconfont shanchu"},null,-1),m("span",null,"删除消息",-1)]))],4)):f("",!0)])):(h(),p("div",Z,g(a.content[0].data.text),1))],8,z)])))),128))],512),b(T,{ref:"inputEditor","active-contactor":o.activeContactor,onStroge:t[11]||(t[11]=e=>o.client.setLocalStorage()),onSetModel:n.setModel,onCleanScreen:n.cleanScreen,onCleanHistory:n.cleanHistory,onSendMessage:n.toButtom,onToButtom:n.toButtom},null,8,["active-contactor","onSetModel","onCleanScreen","onCleanHistory","onSendMessage","onToButtom"])])}],["__scopeId","data-v-e3cdb428"]]),te=x({history:T("/"),routes:[{path:"/",name:"home",component:()=>E((()=>Promise.resolve().then((()=>ie))),void 0),children:[{path:"/",name:"blank",component:()=>E((()=>Promise.resolve().then((()=>re))),void 0)},{path:"/contactors",name:"contactors",component:()=>E((()=>Promise.resolve().then((()=>re))),void 0)},{path:"/chat/:id",name:"chat_view",component:ee},{path:"/profile/:id",name:"profile_view",component:()=>E((()=>Promise.resolve().then((()=>Be))),void 0)}]},{path:"/auth",name:"auth",component:()=>E((()=>Promise.resolve().then((()=>ze))),void 0)},{path:"/settings",name:"settings",component:()=>E((()=>Promise.resolve().then((()=>Ne))),void 0)}]});te.beforeEach((async e=>{let t=i.everLogin;if(t||(t=await i.getLoginHistory()),!t&&"auth"!==e.name&&"settings"!==e.name)return M.warning("请先登录"),{name:"auth"}}));const ae={key:0,id:"main"},se={key:1,id:"main-mobile"},oe={key:2,id:"main-mobile",class:"mobile-chat"};const ne=e({components:{friendlist:l},data(){return{onPhone:window.innerWidth<600,pagePath:this.$route.path}},watch:{$route:function(e){this.pagePath=e.path}}},[["render",function(e,t,a,s,o,n){const i=S("friendlist"),l=S("router-view");return o.onPhone?"/"===o.pagePath?(h(),p("div",se,[b(i)])):(h(),p("div",oe,[b(l)])):(h(),p("div",ae,[b(i),b(l)]))}]]),ie=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"})),le={class:"blank-view"};const ce=e({name:"BlankView",data:()=>({fullScreen:!1,client:i}),watch:{},created(){this.fullScreen=i.fullScreen},methods:{waiting(){this.$message({message:"此功能尚未开放",type:"warning"})}}},[["render",function(e,t,a,s,o,n){return h(),p("div",le,t[0]||(t[0]=[m("div",{class:"upside-bar"},[m("div",{class:"options"})],-1)]))}],["__scopeId","data-v-29ea73df"]]),re=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"})),de={class:"profile-body"},he={id:"profile"},pe={class:"profile-container"},me={class:"base-info"},ue={class:"base-info-avatar"},ge=["src"],ve={class:"base-info-content"},ye={class:"name"},Ce={class:"id"},fe={class:"status"},we={class:"info-blocks"},_e={key:0,class:"openai-settings"},ke={class:"block-content"},be={class:"item-title"},Se={class:"item-content"},xe={class:"block-content"},Te={class:"block-content-item"},Me={class:"item-content"},Ie={class:"block-content"},Re={class:"block-content-item"},Ve={class:"item-content"},Le={id:"tools-list"},Oe=["title"],De={class:"item-title"},Pe={class:"item-content"},$e={class:"action-bar"},Ee={class:"dialog-footer"};const Ue=e({components:{PresetsList:c},data(){const e=parseInt(this.$route.params.id),t=i.getContactor(e);return{activeContactor:t,openaiSettings:this.getShownOpenAISettings(t.options),currentDelay:0,centerDialogVisible:!1,sliderTypeARange:[0,2,.1],sliderTypeBRange:[0,1,.1],sliderTypeCRange:[-2,2,.1],showPresetsDetail:!1,showToolsDetail:!1,presetHistory:t.options.history,openaiTools:r.openaiTools,toolsList:[]}},computed:{getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"}},watch:{"$route.params.id"(e){this.activeContactor=i.getContactor(e),this.initContactor()}},mounted(){this.initContactor(),setInterval((()=>{this.currentDelay=i.socket.delay}),3e3)},methods:{handleToolConfig(){this.activeContactor.options.tools=this.toolsList.filter((e=>e.enabled)).map((e=>e.name)),i.setLocalStorage()},initContactor(){"openai"==this.activeContactor.platform&&(this.openaiSettings=this.getShownOpenAISettings(this.activeContactor.options),this.presetHistory=[...this.activeContactor.options.history],this.loadToolsList())},loadToolsList(){const e=this.activeContactor.options.tools;this.toolsList=this.openaiTools.map((t=>({name:t.name,description:t.description,enabled:e.includes(t.name)})))},updateOpenaiPresets(e){this.activeContactor.setOpenaiPresets(e),i.setLocalStorage()},updateOpenaiOptions(){this.activeContactor.options={...this.activeContactor.options,...this.openaiSettings},i.setLocalStorage()},getShownOpenAISettings(e){const t={};return["model","max_messages_num","stream","enable_tool_call","temperature","top_p","frequency_penalty","presence_penalty"].map((a=>{t[a]=e[a]})),t},getShownKey:e=>({enable_tool_call:"工具调用",model:"模型",max_messages_num:"最大历史消息数",stream:"流式响应",temperature:"温度 (temperature)",top_p:"核采样 (top_p)",frequency_penalty:"频率惩罚度 (frequency_penalty)",presence_penalty:"话题新鲜度 (presence_penalty)"}[e]),delContactor(){this.centerDialogVisible=!1,i.rmContactor(this.activeContactor.id),this.$router.push("/contactors")}}},[["render",function(e,t,a,s,o,n){const i=S("el-input"),l=S("el-switch"),c=S("el-slider"),r=S("PresetsList"),d=S("el-button"),_=S("el-dialog");return h(),p("div",de,[m("div",he,[m("div",pe,[m("div",me,[m("div",ue,[m("img",{src:o.activeContactor.avatar},null,8,ge)]),m("div",ve,[m("div",ye,g(o.activeContactor.name),1),m("div",Ce,"ID "+g(o.activeContactor.id),1),m("div",fe,[m("span",{class:v("delay-status "+n.getDelayStatus)},null,2),t[6]||(t[6]=u(" 在线 "))])])]),m("div",we,["openai"==o.activeContactor.platform?(h(),p("div",_e,[t[11]||(t[11]=m("div",{class:"block-title"},"OpenAI 基本配置",-1)),m("div",ke,[(h(!0),p(y,null,C(o.openaiSettings,((e,t)=>(h(),p("div",{key:t,class:"block-content-item"},[m("div",be,g(n.getShownKey(t)),1),m("div",Se,[["model","max_messages_num"].includes(t)?(h(),w(i,{key:0,modelValue:o.openaiSettings[t],"onUpdate:modelValue":e=>o.openaiSettings[t]=e,onChange:n.updateOpenaiOptions},null,8,["modelValue","onUpdate:modelValue","onChange"])):["stream","enable_tool_call"].includes(t)?(h(),w(l,{key:1,modelValue:o.openaiSettings[t],"onUpdate:modelValue":e=>o.openaiSettings[t]=e,onChange:n.updateOpenaiOptions},null,8,["modelValue","onUpdate:modelValue","onChange"])):["temperature"].includes(t)?(h(),w(c,{key:2,modelValue:o.openaiSettings[t],"onUpdate:modelValue":e=>o.openaiSettings[t]=e,step:o.sliderTypeARange[2],min:o.sliderTypeARange[0],max:o.sliderTypeARange[1],onChange:n.updateOpenaiOptions},null,8,["modelValue","onUpdate:modelValue","step","min","max","onChange"])):["top_p"].includes(t)?(h(),w(c,{key:3,modelValue:o.openaiSettings[t],"onUpdate:modelValue":e=>o.openaiSettings[t]=e,step:o.sliderTypeBRange[2],min:o.sliderTypeBRange[0],max:o.sliderTypeBRange[1],onChange:n.updateOpenaiOptions},null,8,["modelValue","onUpdate:modelValue","step","min","max","onChange"])):["frequency_penalty","presence_penalty"].includes(t)?(h(),w(c,{key:4,modelValue:o.openaiSettings[t],"onUpdate:modelValue":e=>o.openaiSettings[t]=e,step:o.sliderTypeCRange[2],min:o.sliderTypeCRange[0],max:o.sliderTypeCRange[1],onChange:n.updateOpenaiOptions},null,8,["modelValue","onUpdate:modelValue","step","min","max","onChange"])):f("",!0)])])))),128))]),t[12]||(t[12]=m("div",{class:"block-title"},"OpenAI 预设配置",-1)),m("div",xe,[m("div",Te,[t[8]||(t[8]=m("div",{class:"item-title"},"预设历史记录",-1)),m("div",Me,[m("button",{class:v({active:o.showPresetsDetail,"extra-info-button":!0}),onClick:t[0]||(t[0]=e=>o.showPresetsDetail=!o.showPresetsDetail)},t[7]||(t[7]=[m("svg",{t:"1731677922196",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5948",width:"16",height:"16"},[m("path",{d:"M778.965749 128.759549l-383.064442 383.063419 388.097062 388.096039-0.070608 0.033769c12.709463 13.137205 20.529569 31.024597 20.529569 50.731428 0 40.376593-32.736589 73.112158-73.115228 73.112158-19.705807 0-37.591153-7.819083-50.730405-20.528546l-0.034792 0.035816L241.890654 564.622498l0.035816-0.035816c-13.779841-13.281491-22.3838-31.915897-22.3838-52.585659 0-0.071631 0-0.106424 0-0.178055 0-0.072655 0-0.10847 0-0.144286 0-20.669762 8.603959-39.341007 22.3838-52.622498l-0.035816-0.034792L680.573835 20.337187l0.180102 0.179079c13.139252-12.5662 30.950919-20.313651 50.587142-20.313651 40.378639 0 73.115228 32.736589 73.115228 73.114205C804.455283 95.485725 794.567076 115.334795 778.965749 128.759549z","p-id":"5949"})],-1)]),2)])]),m("div",{class:v({hidden:!o.showPresetsDetail,"block-content-item":!0})},[b(r,{"presets-history":o.presetHistory,onUpdatePresetsHistory:n.updateOpenaiPresets},null,8,["presets-history","onUpdatePresetsHistory"])],2)]),t[13]||(t[13]=m("div",{class:"block-title"},"OpenAI 工具配置",-1)),m("div",Ie,[m("div",Re,[t[10]||(t[10]=m("div",{class:"item-title"},"工具函数列表",-1)),m("div",Ve,[m("button",{class:v({active:o.showToolsDetail,"extra-info-button":!0}),onClick:t[1]||(t[1]=e=>o.showToolsDetail=!o.showToolsDetail)},t[9]||(t[9]=[m("svg",{t:"1731677922196",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5948",width:"16",height:"16"},[m("path",{d:"M778.965749 128.759549l-383.064442 383.063419 388.097062 388.096039-0.070608 0.033769c12.709463 13.137205 20.529569 31.024597 20.529569 50.731428 0 40.376593-32.736589 73.112158-73.115228 73.112158-19.705807 0-37.591153-7.819083-50.730405-20.528546l-0.034792 0.035816L241.890654 564.622498l0.035816-0.035816c-13.779841-13.281491-22.3838-31.915897-22.3838-52.585659 0-0.071631 0-0.106424 0-0.178055 0-0.072655 0-0.10847 0-0.144286 0-20.669762 8.603959-39.341007 22.3838-52.622498l-0.035816-0.034792L680.573835 20.337187l0.180102 0.179079c13.139252-12.5662 30.950919-20.313651 50.587142-20.313651 40.378639 0 73.115228 32.736589 73.115228 73.114205C804.455283 95.485725 794.567076 115.334795 778.965749 128.759549z","p-id":"5949"})],-1)]),2)])]),m("div",{class:v({hidden:!o.showToolsDetail,"block-content-item":!0})},[m("ul",Le,[(h(!0),p(y,null,C(o.toolsList,((e,t)=>(h(),p("li",{key:t,class:"block-content-item",title:e.description},[m("div",De,g(e.name),1),m("div",Pe,[b(l,{modelValue:e.enabled,"onUpdate:modelValue":t=>e.enabled=t,onChange:n.handleToolConfig},null,8,["modelValue","onUpdate:modelValue","onChange"])])],8,Oe)))),128))])],2)])])):f("",!0)]),t[14]||(t[14]=m("div",{class:"extra-info"},null,-1))])]),m("div",$e,[b(d,{type:"primary",onClick:t[2]||(t[2]=t=>e.$router.push(`/chat/${o.activeContactor.id}`))},{default:I((()=>t[15]||(t[15]=[u("发送消息")]))),_:1}),b(d,{type:"danger",onClick:t[3]||(t[3]=e=>o.centerDialogVisible=!0)},{default:I((()=>t[16]||(t[16]=[u("删除好友")]))),_:1}),b(_,{modelValue:o.centerDialogVisible,"onUpdate:modelValue":t[5]||(t[5]=e=>o.centerDialogVisible=e),title:"警告",width:"300",center:""},{footer:I((()=>[m("div",Ee,[b(d,{onClick:t[4]||(t[4]=e=>o.centerDialogVisible=!1)},{default:I((()=>t[17]||(t[17]=[u("取消")]))),_:1}),b(d,{type:"primary",onClick:n.delContactor},{default:I((()=>t[18]||(t[18]=[u(" 确认 ")]))),_:1},8,["onClick"])])])),default:I((()=>[t[19]||(t[19]=m("span",null," 确认要删除此好友吗？该操作不可逆。 ",-1))])),_:1},8,["modelValue"])])])}],["__scopeId","data-v-baf67d24"]]),Be=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"})),je={class:"auth-view"},Ae={class:"container"},He={class:"controls"},We=e({__name:"AuthView",setup(e){const t=R(),a=R(!1),s=R(),o=async e=>{if(await P((()=>s.value.classList.add("active"))),!a.value){a.value=!0;try{const t=await i.login(e);t&&(M.success(`成功以${t.is_admin?"管理员身份":"游客身份"}登录，欢迎使用!`),await te.push("/"))}catch(t){M.error(t)}a.value=!1}};function n(e){"Enter"===e.key&&o(t.value)}return V((()=>{removeEventListener("keydown",n)})),L((()=>{addEventListener("keydown",n)})),(e,a)=>(h(),p("div",je,[m("div",Ae,[m("div",{ref_key:"iconContainer",ref:s,class:"icon-container"},a[3]||(a[3]=[m("i",{class:"iconfont ChatGPT"},null,-1)]),512),a[4]||(a[4]=m("h1",{class:"title"},"登录验证",-1)),a[5]||(a[5]=m("p",{class:"hint"},"管理员开启了密码验证，请在下方填入访问码",-1)),O(m("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),type:"password",placeholder:"在此处填写访问码"},null,512),[[D,t.value]]),m("div",He,[m("button",{class:"later",onClick:a[1]||(a[1]=e=>o())},"游客登录"),m("button",{class:"login",onClick:a[2]||(a[2]=e=>o(t.value))},"Login")])])]))}},[["__scopeId","data-v-02d99a9f"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:We},Symbol.toStringTag,{value:"Module"})),Fe={id:"settings-view"};const qe=e({name:"SettingsView",data:()=>({}),methods:{reset(){this.$router.push("/auth"),setTimeout((()=>{i.reset()}),50)}}},[["render",function(e,t,a,s,o,n){const i=S("el-button");return h(),p("div",Fe,[b(i,{type:"info",plain:"",onClick:t[0]||(t[0]=e=>n.reset())},{default:I((()=>t[1]||(t[1]=[u("点我重置")]))),_:1})])}],["__scopeId","data-v-d62ac5e7"]]),Ne=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"}));export{te as r};
