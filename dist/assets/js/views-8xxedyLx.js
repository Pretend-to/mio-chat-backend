import{c as e,_ as t,R as a,F as s,T as o,I as i,a as n,C as l,s as r,f as c,b as d,d as h}from"./components-BKapeL8s.js";import{a as u,R as m,u as p,q as v,H as g,_ as y,b as f}from"./vendor_editor_preview-hsMXmvV2.js";import"./vendor_emoji-C7BQ2utN.js";import{$ as C}from"./vendor_misc-BTiB9Zt4.js";import{aT as w,aU as b,c as k,a as S,e as _,t as M,n as I,b as P,w as T,j as x,v as L,f as V,F as O,d as R,o as $,g as D,l as E,i as B,s as j,x as U,u as W,k as A,V as H}from"./vendor_vue-DNlY4buj.js";import{E as F}from"./vendor_element_plus-DbStn1xk.js";const q=()=>u(()=>Promise.resolve().then(()=>fe),void 0),N=w({history:b("/"),routes:[{path:"/",name:"home",component:()=>u(()=>Promise.resolve().then(()=>Se),void 0),children:[{path:"/",name:"blank",component:q},{path:"/contactors",name:"contactors",component:q},{path:"/chat/:id",name:"chat_view",component:()=>u(()=>Promise.resolve().then(()=>ve),void 0)},{path:"/profile/:id",name:"profile_view",component:()=>u(()=>Promise.resolve().then(()=>Ye),void 0)}]},{path:"/auth",name:"auth",component:()=>u(()=>Promise.resolve().then(()=>ot),void 0)},{path:"/settings",name:"settings",component:()=>u(()=>Promise.resolve().then(()=>Ze),void 0)}]});N.beforeEach(async t=>{if(!e.everLogin()&&"auth"!==t.name){F.warning("请先登录");return{name:"auth",query:"/settings"===t.path?null:{redirect:t.fullPath}}}});const z={id:"chat-window"},J={class:"upside-bar"},G={class:"contactor-name"},X={class:"delay-num"},Y={class:"options"},K={key:0,class:"message-time"},Q=["id"],Z={key:0,class:"avatar"},ee=["src","alt"],te=["src","alt"],ae={key:1,class:"msg"},se={class:"wholename"},oe={key:0,class:"title"},ie={class:"name"},ne=["onContextmenu"],le={key:2,class:"reply-block"},re={key:5},ce={key:7,class:"blank-message",style:{width:"10rem",height:"28.8px",position:"relative"}},de={key:2,class:"system-message"},he={class:"system-message-content"},ue={class:"system-message-button"},me=["onClick"];const pe=t({components:{MdRenderer:m,ContextMenu:l,ForwardMsg:n,InputEditor:i,ToolCallBar:o,FileBlock:s,ReasonBlock:a},data(){let t,a,s=!1,o=!0;const i=window.location.href,n=new URL(i).searchParams;n.has("preview")&&"true"===n.get("preview")&&(s=!0),n.has("shareId")&&(t=n.get("shareId")),n.has("scroll")&&(o=n.get("scroll")||"true");const l=parseInt(this.$route.params.id);try{if(a=e.getContactor(l),!a)throw new Error("找不到联系人")}catch(r){const o=e.contactList[0].id;this.$router.push({path:`/chat/${o}`,query:{preview:s,shareId:t}}),a=e.getContactor(o)}return{scroll:o,preview:s,shareId:t,activeContactor:a,showwindow:!0,showemoji:!1,userInput:"",client:e,extraOptions:[],wraperPresets:{},selectedOption:null,currentDelay:0,toupdate:!1,seletedText:"",seletedImage:"",retryList:[],showMenu:!1,menuTop:0,menuLeft:0,validMessageIndex:-1,repliedMessageId:-1,autoScroll:!1,fullScreen:!1,chatWindowRef:null,prevScrollTop:0,showRollDown:!1,inputBarTop:0,clearMessageTip:"以上的对话记录已清除",loadingIcon:"<span id='message-loading-icon'></span>",katexPlugin:f,mioPlugins:[{plugin:p},{plugin:v},{plugin:g,options:{shape:"circle"}},{plugin:y}]}},computed:{getMenuStyle(){if(window.innerWidth<768){const e=160;return this.menuTop-e<0?{top:e+"px"}:{bottom:window.innerHeight-this.menuTop+16+"px"}}return this.menuLeft+110>window.innerWidth?{top:this.menuTop+"px",left:this.menuLeft-110+"px"}:{top:this.menuTop+"px",left:this.menuLeft+"px"}},getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},activeMessageChain(){return this.activeContactor.options.presetSettings?.opening?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain}},watch:{"$route.params.id"(t,a){const s=parseInt(t),o=e.getContactor(s);if(this.activeContactor=o,this.initContactor(this.activeContactor),this.chatWindowRef&&this.toButtom(),a){const t=parseInt(a),s=e.getContactor(t);this.disableContactor(s)}}},async mounted(){document.addEventListener("click",()=>{this.showMenu=!1,this.seletedText="",this.seletedImage=""}),this.chatWindowRef=this.$refs.chatWindow,this.chatWindowRef.addEventListener("scroll",this.scrollHandler),!this.preview&&this.scroll&&this.toButtom(),this.scroll=!0,this.initContactor(this.activeContactor),this.fullScreen=this.client.fullScreen;const t=document.querySelector(".input-bar");if(t){const e=window.innerHeight;this.inputBarTop=e-t.offsetTop}if(this.shareId){await e.loadOriginalContactors(this.shareId)?this.$router.push({path:"/chat/"+this.shareId,query:{preview:this.preview,scroll:!1}}):this.$message({message:"分享链接已失效",type:"error"})}},updated(){this.toupdate&&this.autoScroll&&0===this.retryList.length&&(this.toButtom(),this.toupdate=!1)},beforeUnmount(){this.disableContactor(this.activeContactor),this.chatWindowRef.removeEventListener("scroll",this.scrollHandler)},methods:{handleMouseUp(){const e=window.getSelection().toString();e&&(this.seletedText=e)},toButtom(e){setTimeout(()=>{(()=>{const t=this.chatWindowRef||document.getElementById("main-messages-window");t&&t.scrollTo({top:t.scrollHeight,behavior:e?"smooth":"instant"})})()},1)},cleanScreen(){this.activeContactor.messageChain=[],this.activeContactor.updateFirstMessage(),e.setLocalStorage(),this.activeContactor.emit("updateMessageSummary"),this.toupdate=!0,this.$message({message:"已清除会话记录",type:"success"})},cleanHistory(){this.activeContactor.updateFirstMessage(),this.$message({message:"上下文信息已清除，之后的请求将不再记录上文记录",type:"success"});for(let e=this.activeContactor.messageChain.length-1;e>=0;e--){const t=this.activeContactor.messageChain[e];"mio_system"===t.role&&"text"===t.content[0].type&&t.content[0].data.text===this.clearMessageTip&&this.activeContactor.messageChain.splice(e,1)}this.activeContactor.makeSystemMessage(this.clearMessageTip),e.setLocalStorage()},delSystemMessage(t){const a=this.activeContactor.messageChain[t];"text"===a.content[0].type&&a.content[0].data.text===this.clearMessageTip&&(this.activeContactor.firstMessageIndex=0),this.activeContactor.messageChain.splice(t,1),e.setLocalStorage()},isValidInput:e=>!/^[ \n]+$/.test(e),waiting(){this.$message({message:"此功能尚未开放",type:"warning"})},tolist(){this.$router.push({name:"home"})},async setModel(t){const a=t[0],s=t[2];this.activeContactor.options.provider=a,this.activeContactor.options.base.model=s,this.activeContactor.loadAvatar(),await e.setLocalStorage()},toimg(){const e=this.chatWindowRef.getBoundingClientRect();e.height=this.chatWindowRef.scrollHeight,C(this.chatWindowRef,{windowHeight:1.2*e.height,width:e.width}).then(e=>{const t=e.toDataURL("image/png"),a=document.createElement("a");a.download="chat.png",a.href=t,a.click()})},async share(){const t=await e.shareContactor(this.activeContactor.id);if(t&&t.shareUrl){const{shareUrl:e}=t,{success:a,message:s}=r(e);a?this.$message({message:s,type:"success"}):this.$message({message:s,type:"error"})}},hasOpening(){return!!this.activeContactor.options.presetSettings?.opening},getFullMessages(){return this.hasOpening()?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain},showTime(e){const t=this.getFullMessages(),a=t[e].time;if(0===e)return{show:!0,time:this.activeContactor.getShownTime(a)};return a-t[e-1].time>6e5?{show:!0,time:this.activeContactor.getShownTime(a)}:{show:!1,time:""}},separateTextAndImages(e){const t=/!\[([^\]]*)\]\((.*)\)/g;let a,s=[],o=0;for(;null!==(a=t.exec(e));){if(a.index>o){const t=e.slice(o,a.index).trim();t&&s.push({type:"text",data:{text:t}})}s.push({type:"image",data:{file:a[2]}}),o=t.lastIndex}if(o<e.length){const t=e.slice(o).trim();t&&s.push({type:"text",data:{text:t}})}return s},getChatwindowScrollheight(){var e=this.chatWindowRef.scrollTop,t=this.chatWindowRef.clientHeight,a=this.chatWindowRef.scrollHeight;return a-e/(a-t)*a},initContactor(t){t.active=!0,t.on("revMessage",e=>{this.activeContactor.messageChain.push(e),this.toupdate=!0}),t.on("delMessage",e=>{this.activeContactor.messageChain.splice(e,1),this.toupdate=!0}),t.on("updateMessage",()=>{this.$forceUpdate(),this.toupdate=!0,e.setLocalStorage()}),t.on("completeMessage",async t=>{const a=t.messageId,s=this.activeContactor.getMessageById(a);this.retryList.includes(a)&&(this.retryList=this.retryList.filter(e=>e!==a)),s.content.forEach((e,t)=>{if("text"===e.type&&"onebot"===this.activeContactor.platform){const a=this.separateTextAndImages(e.data.text);s.content.splice(t,1,...a)}}),this.toupdate=!0,this.$forceUpdate(),this.activeContactor.loadName(),e.setLocalStorage()})},disableContactor(e){e&&(e.active=!1,e.off("updateMessage"),e.off("revMessage"),e.off("delMessage"),e.off("completeMessage"))},getReplyText(e){let t="";const a=this.activeContactor.messageChain.find(t=>t.id===e||String(t.id)===String(e));return a?(a.content.forEach(e=>{"text"===e.type?t+=e.data.text:"image"===e.type&&(t+="[图片]")}),t.trim().slice(0,20)):"[消息已删除] "},imageLoaded(){this.scroll&&this.toButtom()},showMessageMenu(e,t){if("img"===e.target.tagName.toLowerCase()){const t=e.target.src;this.seletedImage=t}this.validMessageIndex="openai"===this.activeContactor.platform&&this.hasOpening()?t-1:t,e.preventDefault(),this.showMenu=!0,this.menuTop=e.clientY,this.menuLeft=e.clientX;const a=window.getSelection().toString();this.seletedText=a||""},toProfile(){this.$router.push({name:"profile_view",params:{id:this.activeContactor.id}})},scrollHandler(){const e=this.chatWindowRef.scrollTop,t=e>this.prevScrollTop,a=e<this.prevScrollTop;this.prevScrollTop=e,this.showMenu=!1,this.showemoji&&(this.showemoji=!1);const s=this.getChatwindowScrollheight();this.autoScroll=!(s>100);const o=s<=199;!t||this.autoScroll||o?(a||this.autoScroll||o)&&(this.showRollDown=!1):this.showRollDown=!0},getseletedMessage(){return this.activeContactor.messageChain[this.validMessageIndex]},handleMessageOption(t){const a=this.getseletedMessage();switch(t){case"retry":if("onebot"===this.activeContactor.platform)"user"===a.role?this.activeContactor.webSend(a):this.activeContactor.webSend({...a,role:"user"}),this.$message({message:"消息已重新发送",type:"success"});else{const e="user"===a.role?this.validMessageIndex+1:this.validMessageIndex;let t=this.activeContactor.messageChain[e];if(!t||"other"!==t.role){const a=this.activeContactor.getBaseUserContainer();a.role="other",this.activeContactor.insertMessage(a,e),t=a}if("retrying"===t.status)return void this.$message({message:"该消息正在重试中",type:"warning"});this.activeContactor.retryMessage(t.id),t.status="retrying",this.retryList.push(t.id)}this.toButtom();break;case"reply":"onebot"===this.activeContactor.platform?(this.repliedMessageId=a.id,this.$message({message:"已引用该消息",type:"success"})):this.userInput+=this.getReplyText(this.activeContactor.messageChain[this.validMessageIndex].id)+"\n\n";break;case"delete":this.activeContactor.messageChain.splice(this.validMessageIndex,1),e.setLocalStorage()}}}},[["render",function(e,t,a,s,o,i){const n=V("ContextMenu"),l=V("MdRenderer"),r=V("ForwardMsg"),c=V("FileBlock"),d=V("ReasonBlock"),h=V("ToolCallBar"),u=V("InputEditor");return $(),k("div",z,[S("div",J,[S("div",{class:"return",onClick:t[0]||(t[0]=e=>i.tolist())},t[8]||(t[8]=[S("i",{class:"iconfont icon-return"},null,-1)])),S("div",{class:"name-area",onClick:t[1]||(t[1]=(...e)=>i.toProfile&&i.toProfile(...e))},[S("div",G,M(o.activeContactor.name),1),S("span",{class:I("delay-status "+i.getDelayStatus)},null,2),S("span",X,"当前延迟: "+M(o.currentDelay)+" ms",1)]),S("ul",Y,[S("li",{class:"share",onClick:t[2]||(t[2]=e=>i.share())},t[9]||(t[9]=[S("i",{class:"iconfont icon-share"},null,-1)]))])]),S("div",{id:"main-messages-window",ref:"chatWindow",class:I({"message-window":!0,preview:o.preview})},[o.showRollDown?($(),k("div",{key:0,id:"roll-buttom-button",style:x({bottom:o.inputBarTop+24+"px"}),onClick:t[3]||(t[3]=e=>i.toButtom(!0))},t[10]||(t[10]=[S("i",{class:"iconfont down1"},null,-1)]),4)):P("",!0),T(_(n,{type:"message",message:i.getseletedMessage(),"seleted-text":o.seletedText,"seleted-image":o.seletedImage,style:x(i.getMenuStyle),onMessageOption:i.handleMessageOption,onClose:t[4]||(t[4]=e=>o.showMenu=!1)},null,8,["message","seleted-text","seleted-image","style","onMessageOption"]),[[L,o.showMenu]]),($(!0),k(O,null,R(i.activeMessageChain,(e,a)=>($(),k("div",{key:`${o.activeContactor.id}-${e.id}`,ref_for:!0,ref:"message",class:"message-container"},[i.showTime(a).show?($(),k("div",K,M(i.showTime(a).time),1)):P("",!0),S("div",{id:e.role,class:"message-body"},["mio_system"!==e.role?($(),k("div",Z,["other"===e.role?($(),k("img",{key:0,src:o.activeContactor.avatar,alt:o.activeContactor.name,onClick:t[5]||(t[5]=(...e)=>i.toProfile&&i.toProfile(...e))},null,8,ee)):($(),k("img",{key:1,src:o.client.avatar,alt:o.client.name},null,8,te))])):P("",!0),"mio_system"!==e.role?($(),k("div",ae,[S("div",se,[("other"===e.role?o.activeContactor.title:o.client.title)?($(),k("div",oe,M("other"===e.role?o.activeContactor.title:o.client.title),1)):P("",!0),S("div",ie,M("other"===e.role?o.activeContactor.name:o.client.name),1)]),S("div",{class:I(["content",e.status]),onMouseup:t[6]||(t[6]=(...e)=>i.handleMouseUp&&i.handleMouseUp(...e)),onContextmenu:e=>i.showMessageMenu(e,a)},[($(!0),k(O,null,R(e.content,(a,s)=>($(),k("div",{key:s,class:"inner-content"},["text"===a.type?($(),D(l,{key:0,md:a.data.text,theme:"github",isStreaming:["pending","retrying"].includes(e.status)&&e.content.length-1===s,"custom-plugins":o.mioPlugins,"markdown-it-plugins":[{plugin:o.katexPlugin}],"markdown-it-options":{breaks:"onebot"===o.activeContactor.platform}},null,8,["md","isStreaming","custom-plugins","markdown-it-plugins","markdown-it-options"])):P("",!0),"image"===a.type?($(),D(l,{md:`![image](${a.data.file})`,"custom-plugins":o.mioPlugins,theme:"github",key:a.data.file},null,8,["md","custom-plugins"])):"reply"===a.type?($(),k("div",le,M(i.getReplyText(a.data.id)),1)):"nodes"===a.type?($(),D(r,{key:3,contactor:o.activeContactor,messages:a.data.messages},null,8,["contactor","messages"])):"file"===a.type?($(),D(c,{key:4,"file-url":a.data.file},null,8,["file-url"])):"at"===a.type?($(),k("span",re)):"reason"===a.type?($(),D(d,{key:6,"end-time":a.data.endTime,"start-time":a.data.startTime,content:a.data.text},null,8,["end-time","start-time","content"])):"blank"===a.type?($(),k("div",ce,t[11]||(t[11]=[S("span",{class:"blank-loader"},null,-1)]))):"tool_call"===a.type?($(),D(h,{key:8,"tool-call":a.data},null,8,["tool-call"])):P("",!0)]))),128))],42,ne)])):($(),k("div",de,[S("div",he,M(e.content[0].data.text),1),S("div",ue,[S("i",{class:"iconfont close",onClick:e=>i.delSystemMessage(a)},null,8,me)])]))],8,Q)]))),128))],2),_(u,{ref:"inputEditor","active-contactor":o.activeContactor,"replied-message-id":o.repliedMessageId,onStroge:t[7]||(t[7]=e=>o.client.setLocalStorage()),onSetModel:i.setModel,onCleanScreen:i.cleanScreen,onCleanHistory:i.cleanHistory,onToButtom:i.toButtom},null,8,["active-contactor","replied-message-id","onSetModel","onCleanScreen","onCleanHistory","onToButtom"])])}],["__scopeId","data-v-f6edf145"]]),ve=Object.freeze(Object.defineProperty({__proto__:null,default:pe},Symbol.toStringTag,{value:"Module"})),ge={class:"blank-view"};const ye=t({name:"BlankView",data:()=>({fullScreen:!1,client:e}),watch:{},created(){this.fullScreen=e.fullScreen},methods:{waiting(){this.$message({message:"此功能尚未开放",type:"warning"})}}},[["render",function(e,t,a,s,o,i){return $(),k("div",ge,t[0]||(t[0]=[S("div",{class:"upside-bar"},[S("div",{class:"options"})],-1)]))}],["__scopeId","data-v-29ea73df"]]),fe=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"})),Ce={key:0,id:"main"},we={key:1,id:"main-mobile"},be={key:2,id:"main-mobile",class:"mobile-chat"};const ke=t({components:{friendlist:c,blankView:ye},data(){return{onPhone:window.innerWidth<600,pagePath:this.$route.path,loaded:!1}},watch:{$route:function(e){this.pagePath=e.path}},mounted(){e.inited?this.loaded=!0:e.on("loaded",()=>{this.loaded=!0},!1)}},[["render",function(e,t,a,s,o,i){const n=V("friendlist"),l=V("router-view"),r=V("blankView");return o.onPhone?"/"===o.pagePath?($(),k("div",we,[o.loaded?($(),D(n,{key:0})):($(),D(r,{key:1}))])):($(),k("div",be,[o.loaded?($(),D(l,{key:0})):($(),D(r,{key:1}))])):($(),k("div",Ce,[_(n),o.loaded?($(),D(l,{key:0})):($(),D(r,{key:1}))]))}]]),Se=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"})),_e={class:"profile-body"},Me={id:"profile"},Ie={class:"profile-container"},Pe={class:"base-info"},Te={class:"base-info-avatar"},xe={class:"base-info-content"},Le={class:"name"},Ve={class:"id"},Oe={class:"status"},Re={class:"info-blocks"},$e={class:"settings-block"},De={class:"block-content"},Ee={class:"block-content-item"},Be={class:"item-content"},je={class:"block-content-item"},Ue={class:"item-content"},We={key:0,class:"block-content-item"},Ae={class:"item-content"},He={key:1,class:"block-content-item"},Fe={class:"item-content"},qe={class:"block-content-item"},Ne={class:"item-content"},ze={class:"info-blocks"},Je={class:"action-bar"},Ge={class:"dialog-footer"};const Xe=t({components:{ContactorSettings:d},data(){const t=parseInt(this.$route.params.id),a=e.getContactor(t),s=h.getToolCallModes(),o=h.getLLMProviders(),i=h.getSafetySettingsParams(),n=Object.keys(i).map(e=>({value:e,label:e})),l=[];for(const e in h.llmTools){const t=h.llmTools[e],a=Object.keys(t).map(e=>({enabled:!1,...t[e]}));l.push({name:e,tools:a,collapsed:!0})}return{activeContactor:a,options:null,currentDelay:0,centerDialogVisible:!1,avatarPolicyList:[{value:0,label:"跟随模型"},{value:1,label:"自定义"}],namePolicyList:[{value:0,label:"跟随模型"},{value:1,label:"自定义"},{value:2,label:"对话摘要"}],isOnebot:"onebot"===a.platform,llmProviders:o,toolCallModes:s,safetyParams:i,safetySimpleValue:n,allLLMTools:l,basicInfo:null}},computed:{getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},getAvatarPolicyValue(){return 1===this.basicInfo.avatarPolicy?"自定义":"跟随模型"}},watch:{"$route.params.id"(t){const a=parseInt(t);this.activeContactor=e.getContactor(a),this.activeContactor&&(this.isOnebot="onebot"===this.activeContactor.platform),this.initContactor()},options:{handler(t){t&&this.activeContactor&&(this.activeContactor.options=JSON.parse(JSON.stringify(t)),e.setLocalStorage())},deep:!0},basicInfo:{handler(t){t&&this.activeContactor&&(this.activeContactor.name=t.name,this.activeContactor.avatar=t.avatar,this.activeContactor.namePolicy=t.namePolicy,this.activeContactor.avatarPolicy=t.avatarPolicy,this.activeContactor.priority=t.priority?0:1,e.setLocalStorage())},deep:!0}},created(){this.initContactor()},mounted(){this.delayInterval=setInterval(()=>{this.currentDelay=e.socket.delay},3e3)},beforeUnmount(){this.delayInterval&&clearInterval(this.delayInterval)},methods:{initContactor(){this.options=JSON.parse(JSON.stringify(this.activeContactor.options));const{name:e,avatar:t,namePolicy:a,avatarPolicy:s,priority:o}=this.activeContactor;this.basicInfo={name:e,avatar:t,namePolicy:a,avatarPolicy:s,priority:1!==o},"onebot"===this.activeContactor.platform&&this.options.toolCallSettings&&(this.options.toolCallSettings.mode="none",this.options.toolCallSettings.tools=[])},handleUpdateOpenaiPresets(e){this.options&&this.options.presetSettings&&(this.options.presetSettings.history=e,this.$message({message:"预设历史记录已更新",type:"success"}))},async delContactor(){this.centerDialogVisible=!1,await e.rmContactor(this.activeContactor.id),this.$router.push("/")},handleProviderSwitched(e){this.activeContactor.loadAvatar()},getBaseInfoShownValue(e){},updateContactorName(){0===this.basicInfo.namePolicy&&(this.basicInfo.name=this.activeContactor.options.base.model)},updateContactorAvatar(){const{avatarPolicy:e}=this.basicInfo;this.activeContactor.avatarPolicy=e,this.basicInfo.avatar=this.activeContactor.loadAvatar()}}},[["render",function(e,t,a,s,o,i){const n=V("el-image"),l=V("el-input"),r=V("el-option"),c=V("el-select"),d=V("el-switch"),h=V("ContactorSettings"),u=V("el-button"),m=V("el-dialog");return $(),k("div",_e,[S("div",Me,[S("div",Ie,[S("div",Pe,[S("div",Te,[_(n,{src:o.activeContactor.avatar,"preview-src-list":[o.activeContactor.avatar]},null,8,["src","preview-src-list"])]),S("div",xe,[S("div",Le,M(o.activeContactor.name),1),S("div",Ve,"ID "+M(o.activeContactor.id),1),S("div",Oe,[S("span",{class:I("delay-status "+i.getDelayStatus)},null,2),t[10]||(t[10]=E(" 在线 "))])])]),S("div",Re,[S("div",$e,[t[16]||(t[16]=S("div",{class:"block-title"},"Bot 基本配置",-1)),S("div",De,[S("div",Ee,[t[11]||(t[11]=S("div",{class:"item-title"},"昵称",-1)),S("div",Be,[_(l,{modelValue:o.basicInfo.name,"onUpdate:modelValue":t[0]||(t[0]=e=>o.basicInfo.name=e),disabled:1!==o.basicInfo.namePolicy},null,8,["modelValue","disabled"])])]),S("div",je,[t[12]||(t[12]=S("div",{class:"item-title"},"头像",-1)),S("div",Ue,[1!==o.basicInfo.avatarPolicy?($(),D(l,{key:0,value:"跟随模型",disabled:!0})):($(),D(l,{key:1,modelValue:o.basicInfo.avatar,"onUpdate:modelValue":t[1]||(t[1]=e=>o.basicInfo.avatar=e),disabled:o.isOnebot},null,8,["modelValue","disabled"]))])]),o.isOnebot?P("",!0):($(),k("div",We,[t[13]||(t[13]=S("div",{class:"item-title"},"头像策略",-1)),S("div",Ae,[_(c,{modelValue:o.basicInfo.avatarPolicy,"onUpdate:modelValue":t[2]||(t[2]=e=>o.basicInfo.avatarPolicy=e),onChange:i.updateContactorAvatar},{default:B(()=>[($(!0),k(O,null,R(o.avatarPolicyList,e=>($(),D(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])])),o.isOnebot?P("",!0):($(),k("div",He,[t[14]||(t[14]=S("div",{class:"item-title"},"昵称策略",-1)),S("div",Fe,[_(c,{modelValue:o.basicInfo.namePolicy,"onUpdate:modelValue":t[3]||(t[3]=e=>o.basicInfo.namePolicy=e),onChange:i.updateContactorName},{default:B(()=>[($(!0),k(O,null,R(o.namePolicyList,e=>($(),D(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])])),S("div",qe,[t[15]||(t[15]=S("div",{class:"item-title"},"会话置顶",-1)),S("div",Ne,[_(d,{modelValue:o.basicInfo.priority,"onUpdate:modelValue":t[4]||(t[4]=e=>o.basicInfo.priority=e)},null,8,["modelValue"])])])])])]),S("div",ze,[o.isOnebot?P("",!0):($(),D(h,{key:0,"model-value":o.options,"onUpdate:modelValue":t[5]||(t[5]=e=>o.options=e),"active-contactor-platform":o.activeContactor.platform,"llm-providers-list":o.llmProviders,"tool-call-modes-list":o.toolCallModes,"all-llm-tools-data":o.allLLMTools,"safety-settings-params":o.safetyParams,"safety-simple-value-options":o.safetySimpleValue,"presets-history-data":o.options.presetSettings?.history,onProviderChanged:i.handleProviderSwitched,onUpdatePresets:i.handleUpdateOpenaiPresets},null,8,["model-value","active-contactor-platform","llm-providers-list","tool-call-modes-list","all-llm-tools-data","safety-settings-params","safety-simple-value-options","presets-history-data","onProviderChanged","onUpdatePresets"]))])])]),S("div",Je,[_(u,{plain:"",onClick:t[6]||(t[6]=t=>e.$router.push(`/chat/${o.activeContactor.id}`))},{default:B(()=>t[17]||(t[17]=[E(" 发送消息 ")])),_:1}),_(u,{type:"danger",plain:"",onClick:t[7]||(t[7]=e=>o.centerDialogVisible=!0)},{default:B(()=>t[18]||(t[18]=[E(" 删除好友 ")])),_:1}),_(m,{modelValue:o.centerDialogVisible,"onUpdate:modelValue":t[9]||(t[9]=e=>o.centerDialogVisible=e),title:"警告",width:"300",center:""},{footer:B(()=>[S("div",Ge,[_(u,{onClick:t[8]||(t[8]=e=>o.centerDialogVisible=!1)},{default:B(()=>t[19]||(t[19]=[E("取消")])),_:1}),_(u,{type:"primary",onClick:i.delContactor},{default:B(()=>t[20]||(t[20]=[E(" 确认 ")])),_:1},8,["onClick"])])]),default:B(()=>[t[21]||(t[21]=S("span",null," 确认要删除此好友吗？该操作不可逆。 ",-1))]),_:1},8,["modelValue"])])])}],["__scopeId","data-v-2ffdcad2"]]),Ye=Object.freeze(Object.defineProperty({__proto__:null,default:Xe},Symbol.toStringTag,{value:"Module"})),Ke={id:"settings-view"};const Qe=t({name:"SettingsView",data:()=>({}),methods:{async reset(){await e.reset()&&(this.$message.success("重置成功"),setTimeout(()=>{window.location.reload()},500))},async resetCache(){await e.resetCache(),this.$message.success("清理缓存成功"),setTimeout(()=>{window.location.reload()},500)}}},[["render",function(e,t,a,s,o,i){const n=V("el-button");return $(),k("div",Ke,[_(n,{type:"info",plain:"",onClick:t[0]||(t[0]=e=>i.reset())},{default:B(()=>t[2]||(t[2]=[E("重置全部")])),_:1}),_(n,{type:"info",plain:"",onClick:t[1]||(t[1]=e=>i.resetCache())},{default:B(()=>t[3]||(t[3]=[E("清理缓存")])),_:1})])}],["__scopeId","data-v-330c2ae1"]]),Ze=Object.freeze(Object.defineProperty({__proto__:null,default:Qe},Symbol.toStringTag,{value:"Module"})),et={class:"auth-view"},tt={class:"container"},at={class:"controls"},st=t({__name:"AuthView",setup(t){const a=j(),s=j(!1),o=j(),i=async t=>{if(await H(()=>o.value.classList.add("active")),!s.value){s.value=!0;try{const a=await e.login(t);a&&(F.success(`成功以${a.is_admin?"管理员身份":"游客身份"}登录，欢迎使用!`),N.currentRoute.value.query.redirect?N.push(N.currentRoute.value.query.redirect):N.push("/"))}catch(a){F.error(a)}finally{await H(()=>o.value.classList.remove("active")),s.value=!1}}};function n(e){"Enter"===e.key&&i(a.value)}return U(()=>{removeEventListener("keydown",n)}),W(()=>{addEventListener("keydown",n),N.currentRoute.value.query.key&&i(N.currentRoute.value.query.key)}),(e,t)=>($(),k("div",et,[S("div",tt,[S("div",{ref_key:"iconContainer",ref:o,class:"icon-container"},t[3]||(t[3]=[S("i",{class:"iconfont ChatGPT"},null,-1)]),512),t[4]||(t[4]=S("h1",{class:"title"},"登录验证",-1)),t[5]||(t[5]=S("p",{class:"hint"},"管理员开启了密码验证，请在下方填入访问码",-1)),T(S("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),type:"password",placeholder:"在此处填写访问码"},null,512),[[A,a.value]]),S("div",at,[S("button",{class:"later",onClick:t[1]||(t[1]=e=>i())},"游客登录"),S("button",{class:"login",onClick:t[2]||(t[2]=e=>i(a.value))},"登录")])])]))}},[["__scopeId","data-v-02fd5e8c"]]),ot=Object.freeze(Object.defineProperty({__proto__:null,default:st},Symbol.toStringTag,{value:"Module"}));export{N as r};
//# sourceMappingURL=views-8xxedyLx.js.map
