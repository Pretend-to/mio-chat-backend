import{M as e,c as t,a,h as s,t as o,n as i,b as n,w as l,j as c,v as r,e as d,F as h,d as u,o as m,f as p,l as v,i as g,m as y,p as f,q as C,k as w,s as b,E as k,u as S,x as M}from"./vue-vendor-wXYCrOh9.js";import{_ as I,R as x,F as P,T,I as L,a as $,C as V,c as _,f as R,b as D,d as B}from"./components-QQ-HDEVT.js";import"./emoji-nU2WIqY_.js";import{h as O}from"./vendor-C0p4anTM.js";const U={id:"chat-window"},W={class:"upside-bar"},E={class:"contactor-name"},H={class:"delay-num"},j={class:"options"},F={key:0,class:"message-time"},q=["id"],A={key:0,class:"avatar"},N=["src","alt"],J=["src","alt"],z={key:1,class:"msg"},G={class:"wholename"},X={key:0,class:"title"},Y={class:"name"},K=["onContextmenu"],Q={key:5},Z={key:7,class:"blank-message",style:{width:"10rem",height:"28.8px",position:"relative"}},ee={key:2,class:"system-message"},te={class:"system-message-content"},ae={class:"system-message-button"},se=["onClick"];const oe=I({components:{MdPreview:e,ContextMenu:V,ForwardMsg:$,InputEditor:L,ToolCallBar:T,FileBlock:P,ReasonBlock:x},data(){let e,t,a=!1,s=!0;const o=window.location.href,i=new URL(o).searchParams;i.has("preview")&&"true"===i.get("preview")&&(a=!0),i.has("shareId")&&(e=i.get("shareId")),i.has("scroll")&&(s="true"===i.get("scroll"));const n=parseInt(this.$route.params.id);try{if(t=_.getContactor(n),!t)throw new Error("找不到联系人")}catch(l){const s=_.contactList[0].id;this.$router.push({path:`/chat/${s}`,query:{preview:a,shareId:e}}),t=_.getContactor(s)}return{scroll:s,preview:a,shareId:e,activeContactor:t,showwindow:!0,showemoji:!1,userInput:"",client:_,extraOptions:[],wraperPresets:{},selectedOption:null,currentDelay:0,toupdate:!1,seletedText:"",seletedImage:"",retryList:[],showMenu:!1,menuTop:0,menuLeft:0,validMessageIndex:-1,repliedMessageId:-1,autoScroll:!1,fullScreen:!1,chatWindowRef:null,prevScrollTop:0,showRollDown:!1,inputBarTop:0,clearMessageTip:"以上的对话记录已清除",loadingIcon:"<span id='message-loading-icon'></span>"}},computed:{getMenuStyle(){return this.menuLeft+110>window.innerWidth?{top:this.menuTop+"px",left:this.menuLeft-110+"px"}:{top:this.menuTop+"px",left:this.menuLeft+"px"}},getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},activeMessageChain(){return this.activeContactor.options.presetSettings?.opening?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain}},watch:{"$route.params.id"(e,t){const a=parseInt(e),s=_.getContactor(a);if(this.activeContactor=s,this.initContactor(this.activeContactor),this.chatWindowRef&&this.toButtom(),t){const e=parseInt(t),a=_.getContactor(e);this.disableContactor(a)}}},async mounted(){document.addEventListener("click",(()=>{this.showMenu=!1,this.seletedText="",this.seletedImage=""})),this.chatWindowRef=this.$refs.chatWindow,this.chatWindowRef.addEventListener("scroll",this.scrollHandler),!this.preview&&this.scroll&&this.toButtom(),this.scroll=!0,this.initContactor(this.activeContactor),this.fullScreen=this.client.fullScreen;const e=document.querySelector(".input-bar");if(e&&(this.inputBarTop=e.offsetTop),this.shareId){await _.loadOriginalContactors(this.shareId)?this.$router.push({path:"/chat/"+this.shareId,query:{preview:this.preview,scroll:!1}}):this.$message({message:"分享链接已失效",type:"error"})}},updated(){this.toupdate&&this.autoScroll&&0===this.retryList.length&&(this.toButtom(),this.toupdate=!1)},beforeUnmount(){this.disableContactor(this.activeContactor),this.chatWindowRef.removeEventListener("scroll",this.scrollHandler)},methods:{handleMouseUp(){const e=window.getSelection().toString();e&&(this.seletedText=e)},toButtom(e){setTimeout((()=>{(()=>{const t=this.chatWindowRef||document.getElementById("main-messages-window");t&&t.scrollTo({top:t.scrollHeight,behavior:e?"smooth":"instant"})})()}),1)},cleanScreen(){this.activeContactor.messageChain=[],this.activeContactor.updateFirstMessage(),_.setLocalStorage(),this.activeContactor.emit("updateMessageSummary"),this.toupdate=!0,this.$message({message:"已清除会话记录",type:"success"})},cleanHistory(){this.activeContactor.updateFirstMessage(),this.$message({message:"上下文信息已清除，之后的请求将不再记录上文记录",type:"success"});for(let e=this.activeContactor.messageChain.length-1;e>=0;e--){const t=this.activeContactor.messageChain[e];"mio_system"===t.role&&"text"===t.content[0].type&&t.content[0].data.text===this.clearMessageTip&&this.activeContactor.messageChain.splice(e,1)}this.activeContactor.makeSystemMessage(this.clearMessageTip),_.setLocalStorage()},delSystemMessage(e){const t=this.activeContactor.messageChain[e];"text"===t.content[0].type&&t.content[0].data.text===this.clearMessageTip&&(this.activeContactor.firstMessageIndex=0),this.activeContactor.messageChain.splice(e,1),_.setLocalStorage()},isValidInput:e=>!/^[ \n]+$/.test(e),waiting(){this.$message({message:"此功能尚未开放",type:"warning"})},tolist(){this.$router.push({name:"home"})},async setModel(e){const t=e[0],a=e[2];this.activeContactor.options.provider=t,this.activeContactor.options.base.model=a,this.activeContactor.loadAvatar(),await _.setLocalStorage()},toimg(){const e=this.chatWindowRef.getBoundingClientRect();e.height=this.chatWindowRef.scrollHeight,O(this.chatWindowRef,{windowHeight:1.2*e.height,width:e.width}).then((e=>{const t=e.toDataURL("image/png"),a=document.createElement("a");a.download="chat.png",a.href=t,a.click()}))},async share(){await _.shareContactor(this.activeContactor.id)?this.$message({message:"分享链接已复制",type:"success"}):this.$message({message:"分享失败",type:"error"})},hasOpening(){return!!this.activeContactor.options.presetSettings?.opening},getFullMessages(){return this.hasOpening()?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain},showTime(e){const t=this.getFullMessages(),a=t[e].time;if(0===e)return{show:!0,time:this.activeContactor.getShownTime(a)};return a-t[e-1].time>6e5?{show:!0,time:this.activeContactor.getShownTime(a)}:{show:!1,time:""}},separateTextAndImages(e){const t=/!\[([^\]]*)\]\((.*)\)/g;let a,s=[],o=0;for(;null!==(a=t.exec(e));){if(a.index>o){const t=e.slice(o,a.index).trim();t&&s.push({type:"text",data:{text:t}})}s.push({type:"image",data:{file:a[2]}}),o=t.lastIndex}if(o<e.length){const t=e.slice(o).trim();t&&s.push({type:"text",data:{text:t}})}return s},getChatwindowScrollheight(){var e=this.chatWindowRef.scrollTop,t=this.chatWindowRef.clientHeight,a=this.chatWindowRef.scrollHeight;return a-e/(a-t)*a},initContactor(e){e.active=!0,e.on("revMessage",(e=>{this.activeContactor.messageChain.push(e),this.toupdate=!0})),e.on("delMessage",(e=>{this.activeContactor.messageChain.splice(e,1),this.toupdate=!0})),e.on("updateMessage",(()=>{this.$forceUpdate(),this.toupdate=!0,_.setLocalStorage()})),e.on("completeMessage",(async e=>{const t=e.messageId,a=this.activeContactor.getMessageById(t);this.retryList.includes(t)&&(this.retryList=this.retryList.filter((e=>e!==t))),a.content.forEach(((e,t)=>{if("text"===e.type&&"onebot"===this.activeContactor.platform){const s=this.separateTextAndImages(e.data.text);a.content.splice(t,1,...s)}})),this.toupdate=!0,this.$forceUpdate(),this.activeContactor.loadName(),_.setLocalStorage()}))},disableContactor(e){e&&(e.active=!1,e.off("updateMessage"),e.off("revMessage"),e.off("delMessage"),e.off("completeMessage"))},getReplyText(e){let t="";const a=this.activeContactor.messageChain.find((t=>t.id===e));if(a)return a.content.forEach((e=>{"text"===e.type?t+=e.data.text:"image"===e.type&&(t+="[图片]")})),t.length>20?`> ${t.substr(0,20)}...`:`> ${t}`},showMessageMenu(e,t){if("img"===e.target.tagName.toLowerCase()){const t=e.target.src;this.seletedImage=t}this.validMessageIndex="openai"===this.activeContactor.platform&&this.hasOpening()?t-1:t,e.preventDefault(),this.showMenu=!0,this.menuTop=e.clientY,this.menuLeft=e.clientX;const a=window.getSelection().toString();this.seletedText=a||""},toProfile(){this.$router.push({name:"profile_view",params:{id:this.activeContactor.id}})},scrollHandler(){const e=this.chatWindowRef.scrollTop,t=e>this.prevScrollTop,a=e<this.prevScrollTop;this.prevScrollTop=e,this.showMenu=!1,this.showemoji&&(this.showemoji=!1);const s=this.getChatwindowScrollheight();this.autoScroll=!(s>100);const o=s<=199;!t||this.autoScroll||o?(a||this.autoScroll||o)&&(this.showRollDown=!1):this.showRollDown=!0},getseletedMessage(){return this.activeContactor.messageChain[this.validMessageIndex]},handleMessageOption(e){const t=this.getseletedMessage();switch(e){case"retry":if("onebot"===this.activeContactor.platform)"user"===t.role?this.activeContactor.webSend(t):this.activeContactor.webSend({...t,role:"user"}),this.$message({message:"消息已重新发送",type:"success"});else{const e="user"===t.role?this.validMessageIndex+1:this.validMessageIndex;let a=this.activeContactor.messageChain[e];if(!a||"other"!==a.role){const t=this.activeContactor.getBaseUserContainer();t.role="other",this.activeContactor.insertMessage(t,e),a=t}if("retrying"===a.status)return void this.$message({message:"该消息正在重试中",type:"warning"});this.activeContactor.retryMessage(a.id),a.status="retrying",this.retryList.push(a.id)}this.toButtom();break;case"reply":"onebot"===this.activeContactor.platform?(this.repliedMessageId=t.id,this.$message({message:"已引用该消息",type:"success"})):this.userInput+=this.getReplyText(this.activeContactor.messageChain[this.validMessageIndex].id)+"\n\n";break;case"delete":this.activeContactor.messageChain.splice(this.validMessageIndex,1),_.setLocalStorage()}}}},[["render",function(e,v,g,y,f,C){const w=d("ContextMenu"),b=d("MdPreview"),k=d("el-image"),S=d("ForwardMsg"),M=d("FileBlock"),I=d("ReasonBlock"),x=d("ToolCallBar"),P=d("InputEditor");return m(),t("div",U,[a("div",W,[a("div",{class:"return",onClick:v[0]||(v[0]=e=>C.tolist())},v[8]||(v[8]=[a("i",{class:"iconfont icon-return"},null,-1)])),a("div",{class:"name-area",onClick:v[1]||(v[1]=(...e)=>C.toProfile&&C.toProfile(...e))},[a("div",E,o(f.activeContactor.name),1),a("span",{class:i("delay-status "+C.getDelayStatus)},null,2),a("span",H,"当前延迟: "+o(f.currentDelay)+" ms",1)]),a("ul",j,[a("li",{class:"share",onClick:v[2]||(v[2]=e=>C.share())},v[9]||(v[9]=[a("i",{class:"iconfont icon-share"},null,-1)]))])]),a("div",{id:"main-messages-window",ref:"chatWindow",class:i({"message-window":!0,preview:f.preview})},[f.showRollDown?(m(),t("div",{key:0,id:"roll-buttom-button",style:c({top:f.inputBarTop-36+"px"}),onClick:v[3]||(v[3]=e=>C.toButtom(!0))},v[10]||(v[10]=[a("i",{class:"iconfont down1"},null,-1)]),4)):n("",!0),l(s(w,{type:"message",message:C.getseletedMessage(),"seleted-text":f.seletedText,"seleted-image":f.seletedImage,style:c(C.getMenuStyle),onMessageOption:C.handleMessageOption,onClose:v[4]||(v[4]=e=>f.showMenu=!1)},null,8,["message","seleted-text","seleted-image","style","onMessageOption"]),[[r,f.showMenu]]),(m(!0),t(h,null,u(C.activeMessageChain,((e,s)=>(m(),t("div",{key:`${f.activeContactor.id}-${e.id}`,ref_for:!0,ref:"message",class:"message-container"},[C.showTime(s).show?(m(),t("div",F,o(C.showTime(s).time),1)):n("",!0),a("div",{id:e.role,class:"message-body"},["mio_system"!==e.role?(m(),t("div",A,["other"===e.role?(m(),t("img",{key:0,src:f.activeContactor.avatar,alt:f.activeContactor.name,onClick:v[5]||(v[5]=(...e)=>C.toProfile&&C.toProfile(...e))},null,8,N)):(m(),t("img",{key:1,src:f.client.avatar,alt:f.client.name},null,8,J))])):n("",!0),"mio_system"!==e.role?(m(),t("div",z,[a("div",G,[("other"===e.role?f.activeContactor.title:f.client.title)?(m(),t("div",X,o("other"===e.role?f.activeContactor.title:f.client.title),1)):n("",!0),a("div",Y,o("other"===e.role?f.activeContactor.name:f.client.name),1)]),a("div",{class:"content",onMouseup:v[6]||(v[6]=(...e)=>C.handleMouseUp&&C.handleMouseUp(...e)),onContextmenu:e=>C.showMessageMenu(e,s)},[(m(!0),t(h,null,u(e.content,((o,i)=>(m(),t("div",{key:i,class:"inner-content"},["text"===o.type?(m(),p(b,{key:0,"no-img-zoom-in":!1,"preview-theme":"github","code-foldable":!1,"model-value":["pending","retrying"].includes(e.status)&&e.content.length-1===i?o.data.text+f.loadingIcon:o.data.text},null,8,["model-value"])):"image"===o.type?(m(),p(k,{key:`${f.activeContactor.id}-${s}-${i}-${o.data.file}`,src:o.data.file,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[o.data.file],"initial-index":4,loading:"lazy",fit:"contain"},null,8,["src","preview-src-list"])):"reply"===o.type?(m(),p(b,{key:2,"preview-theme":"github","model-value":C.getReplyText(o.data.id)},null,8,["model-value"])):"nodes"===o.type?(m(),p(S,{key:3,contactor:f.activeContactor,messages:o.data.messages},null,8,["contactor","messages"])):"file"===o.type?(m(),p(M,{key:4,"file-url":o.data.file},null,8,["file-url"])):"at"===o.type?(m(),t("span",Q)):"reason"===o.type?(m(),p(I,{key:6,"end-time":o.data.endTime,"start-time":o.data.startTime,content:o.data.text},null,8,["end-time","start-time","content"])):"blank"===o.type?(m(),t("div",Z,v[11]||(v[11]=[a("span",{class:"blank-loader"},null,-1)]))):"tool_call"===o.type?(m(),p(x,{key:8,"tool-call":o.data},null,8,["tool-call"])):n("",!0)])))),128))],40,K)])):(m(),t("div",ee,[a("div",te,o(e.content[0].data.text),1),a("div",ae,[a("i",{class:"iconfont close",onClick:e=>C.delSystemMessage(s)},null,8,se)])]))],8,q)])))),128))],2),s(P,{ref:"inputEditor","active-contactor":f.activeContactor,"replied-message-id":f.repliedMessageId,onStroge:v[7]||(v[7]=e=>f.client.setLocalStorage()),onSetModel:C.setModel,onCleanScreen:C.cleanScreen,onCleanHistory:C.cleanHistory,onToButtom:C.toButtom},null,8,["active-contactor","replied-message-id","onSetModel","onCleanScreen","onCleanHistory","onToButtom"])])}],["__scopeId","data-v-e66e79e7"]]),ie={class:"blank-view"};const ne=I({name:"BlankView",data:()=>({fullScreen:!1,client:_}),watch:{},created(){this.fullScreen=_.fullScreen},methods:{waiting(){this.$message({message:"此功能尚未开放",type:"warning"})}}},[["render",function(e,s,o,i,n,l){return m(),t("div",ie,s[0]||(s[0]=[a("div",{class:"upside-bar"},[a("div",{class:"options"})],-1)]))}],["__scopeId","data-v-29ea73df"]]),le={key:0,id:"main"},ce={key:1,id:"main-mobile"},re={key:2,id:"main-mobile",class:"mobile-chat"};const de=I({components:{friendlist:R,blankView:ne},data(){return{onPhone:window.innerWidth<600,pagePath:this.$route.path,loaded:!1}},watch:{$route:function(e){this.pagePath=e.path}},mounted(){_.inited?this.loaded=!0:_.on("loaded",(()=>{this.loaded=!0}),!1)}},[["render",function(e,a,o,i,n,l){const c=d("friendlist"),r=d("router-view"),h=d("blankView");return n.onPhone?"/"===n.pagePath?(m(),t("div",ce,[n.loaded?(m(),p(c,{key:0})):(m(),p(h,{key:1}))])):(m(),t("div",re,[n.loaded?(m(),p(r,{key:0})):(m(),p(h,{key:1}))])):(m(),t("div",le,[s(c),n.loaded?(m(),p(r,{key:0})):(m(),p(h,{key:1}))]))}]]),he={class:"profile-body"},ue={id:"profile"},me={class:"profile-container"},pe={class:"base-info"},ve={class:"base-info-avatar"},ge={class:"base-info-content"},ye={class:"name"},fe={class:"id"},Ce={class:"status"},we={class:"info-blocks"},be={class:"settings-block"},ke={class:"block-content"},Se={class:"block-content-item"},Me={class:"item-content"},Ie={class:"block-content-item"},xe={class:"item-content"},Pe={key:0,class:"block-content-item"},Te={class:"item-content"},Le={key:1,class:"block-content-item"},$e={class:"item-content"},Ve={class:"block-content-item"},_e={class:"item-content"},Re={class:"info-blocks"},De={class:"action-bar"},Be={class:"dialog-footer"};const Oe=I({components:{ContactorSettings:D},data(){const e=parseInt(this.$route.params.id),t=_.getContactor(e),a=B.getToolCallModes(),s=B.getLLMProviders(),o=B.getSafetySettingsParams(),i=Object.keys(o).map((e=>({value:e,label:e}))),n=[];for(const l in B.llmTools){const e=B.llmTools[l],t=Object.keys(e).map((t=>({enabled:!1,...e[t]})));n.push({name:l,tools:t,collapsed:!0})}return{activeContactor:t,options:null,currentDelay:0,centerDialogVisible:!1,avatarPolicyList:[{value:0,label:"跟随模型"},{value:1,label:"自定义"}],namePolicyList:[{value:0,label:"跟随模型"},{value:1,label:"自定义"},{value:2,label:"对话摘要"}],isOnebot:"onebot"===t.platform,llmProviders:s,toolCallModes:a,safetyParams:o,safetySimpleValue:i,allLLMTools:n,basicInfo:null}},computed:{getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},getAvatarValue(){return 1===this.basicInfo.avatarPolicy?this.basicInfo.avatar:"跟随模型"},getAvatarPolicyValue(){return 1===this.basicInfo.avatarPolicy?"自定义":"跟随模型"}},watch:{"$route.params.id"(e){const t=parseInt(e);this.activeContactor=_.getContactor(t),this.activeContactor&&(this.isOnebot="onebot"===this.activeContactor.platform),this.initContactor()},options:{handler(e){e&&this.activeContactor&&(this.activeContactor.options=JSON.parse(JSON.stringify(e)),_.setLocalStorage())},deep:!0},basicInfo:{handler(e){e&&this.activeContactor&&(this.activeContactor.name=e.name,this.activeContactor.avatar=e.avatar,this.activeContactor.namePolicy=e.namePolicy,this.activeContactor.avatarPolicy=e.avatarPolicy,this.activeContactor.priority=e.priority?0:1,_.setLocalStorage())},deep:!0}},created(){this.initContactor()},mounted(){this.delayInterval=setInterval((()=>{this.currentDelay=_.socket.delay}),3e3)},beforeUnmount(){this.delayInterval&&clearInterval(this.delayInterval)},methods:{initContactor(){this.options=JSON.parse(JSON.stringify(this.activeContactor.options));const{name:e,avatar:t,namePolicy:a,avatarPolicy:s,priority:o}=this.activeContactor;this.basicInfo={name:e,avatar:t,namePolicy:a,avatarPolicy:s,priority:1!==o},"onebot"===this.activeContactor.platform&&this.options.toolCallSettings&&(this.options.toolCallSettings.mode="none",this.options.toolCallSettings.tools=[])},handleUpdateOpenaiPresets(e){this.options&&this.options.presetSettings&&(this.options.presetSettings.history=e,this.$message({message:"预设历史记录已更新",type:"success"}))},async delContactor(){this.centerDialogVisible=!1,await _.rmContactor(this.activeContactor.id),this.$router.push("/")},handleProviderSwitched(e){this.activeContactor.loadAvatar()},getBaseInfoShownValue(e){},updateContactorName(){0===this.basicInfo.namePolicy&&(this.basicInfo.name=this.activeContactor.options.base.model)}}},[["render",function(e,l,c,r,y,f){const C=d("el-image"),w=d("el-input"),b=d("el-option"),k=d("el-select"),S=d("el-switch"),M=d("ContactorSettings"),I=d("el-button"),x=d("el-dialog");return m(),t("div",he,[a("div",ue,[a("div",me,[a("div",pe,[a("div",ve,[s(C,{src:y.activeContactor.avatar,"preview-src-list":[y.activeContactor.avatar]},null,8,["src","preview-src-list"])]),a("div",ge,[a("div",ye,o(y.activeContactor.name),1),a("div",fe,"ID "+o(y.activeContactor.id),1),a("div",Ce,[a("span",{class:i("delay-status "+f.getDelayStatus)},null,2),l[9]||(l[9]=v(" 在线 "))])])]),a("div",we,[a("div",be,[l[15]||(l[15]=a("div",{class:"block-title"},"Bot 基本配置",-1)),a("div",ke,[a("div",Se,[l[10]||(l[10]=a("div",{class:"item-title"},"昵称",-1)),a("div",Me,[s(w,{modelValue:y.basicInfo.name,"onUpdate:modelValue":l[0]||(l[0]=e=>y.basicInfo.name=e),disabled:1!==y.basicInfo.namePolicy},null,8,["modelValue","disabled"])])]),a("div",Ie,[l[11]||(l[11]=a("div",{class:"item-title"},"头像",-1)),a("div",xe,[s(w,{value:f.getAvatarValue,disabled:1!==y.basicInfo.avatarPolicy},null,8,["value","disabled"])])]),y.isOnebot?n("",!0):(m(),t("div",Pe,[l[12]||(l[12]=a("div",{class:"item-title"},"头像策略",-1)),a("div",Te,[s(k,{modelValue:y.basicInfo.avatarPolicy,"onUpdate:modelValue":l[1]||(l[1]=e=>y.basicInfo.avatarPolicy=e)},{default:g((()=>[(m(!0),t(h,null,u(y.avatarPolicyList,(e=>(m(),p(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])),y.isOnebot?n("",!0):(m(),t("div",Le,[l[13]||(l[13]=a("div",{class:"item-title"},"昵称策略",-1)),a("div",$e,[s(k,{modelValue:y.basicInfo.namePolicy,"onUpdate:modelValue":l[2]||(l[2]=e=>y.basicInfo.namePolicy=e),onChange:f.updateContactorName},{default:g((()=>[(m(!0),t(h,null,u(y.namePolicyList,(e=>(m(),p(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])])),a("div",Ve,[l[14]||(l[14]=a("div",{class:"item-title"},"会话置顶",-1)),a("div",_e,[s(S,{modelValue:y.basicInfo.priority,"onUpdate:modelValue":l[3]||(l[3]=e=>y.basicInfo.priority=e)},null,8,["modelValue"])])])])])]),a("div",Re,[y.isOnebot?n("",!0):(m(),p(M,{key:0,"model-value":y.options,"onUpdate:modelValue":l[4]||(l[4]=e=>y.options=e),"active-contactor-platform":y.activeContactor.platform,"llm-providers-list":y.llmProviders,"tool-call-modes-list":y.toolCallModes,"all-llm-tools-data":y.allLLMTools,"safety-settings-params":y.safetyParams,"safety-simple-value-options":y.safetySimpleValue,"presets-history-data":y.options.presetSettings?.history,onProviderChanged:f.handleProviderSwitched,onUpdatePresets:f.handleUpdateOpenaiPresets},null,8,["model-value","active-contactor-platform","llm-providers-list","tool-call-modes-list","all-llm-tools-data","safety-settings-params","safety-simple-value-options","presets-history-data","onProviderChanged","onUpdatePresets"]))])])]),a("div",De,[s(I,{plain:"",onClick:l[5]||(l[5]=t=>e.$router.push(`/chat/${y.activeContactor.id}`))},{default:g((()=>l[16]||(l[16]=[v(" 发送消息 ")]))),_:1}),s(I,{type:"danger",plain:"",onClick:l[6]||(l[6]=e=>y.centerDialogVisible=!0)},{default:g((()=>l[17]||(l[17]=[v(" 删除好友 ")]))),_:1}),s(x,{modelValue:y.centerDialogVisible,"onUpdate:modelValue":l[8]||(l[8]=e=>y.centerDialogVisible=e),title:"警告",width:"300",center:""},{footer:g((()=>[a("div",Be,[s(I,{onClick:l[7]||(l[7]=e=>y.centerDialogVisible=!1)},{default:g((()=>l[18]||(l[18]=[v("取消")]))),_:1}),s(I,{type:"primary",onClick:f.delContactor},{default:g((()=>l[19]||(l[19]=[v(" 确认 ")]))),_:1},8,["onClick"])])])),default:g((()=>[l[20]||(l[20]=a("span",null," 确认要删除此好友吗？该操作不可逆。 ",-1))])),_:1},8,["modelValue"])])])}],["__scopeId","data-v-55af2d39"]]),Ue={id:"settings-view"};const We=I({name:"SettingsView",data:()=>({}),methods:{async reset(){await _.reset()&&(this.$message.success("重置成功"),setTimeout((()=>{window.location.reload()}),500))},async resetCache(){await _.resetCache(),this.$message.success("清理缓存成功"),setTimeout((()=>{window.location.reload()}),500)}}},[["render",function(e,a,o,i,n,l){const c=d("el-button");return m(),t("div",Ue,[s(c,{type:"info",plain:"",onClick:a[0]||(a[0]=e=>l.reset())},{default:g((()=>a[2]||(a[2]=[v("重置全部")]))),_:1}),s(c,{type:"info",plain:"",onClick:a[1]||(a[1]=e=>l.resetCache())},{default:g((()=>a[3]||(a[3]=[v("清理缓存")]))),_:1})])}],["__scopeId","data-v-330c2ae1"]]),Ee={class:"auth-view"},He={class:"container"},je={class:"controls"},Fe=I({__name:"AuthView",setup(e){const s=y(),o=y(!1),i=y(),n=async e=>{if(await b((()=>i.value.classList.add("active"))),!o.value){o.value=!0;try{const t=await _.login(e);t&&(k.success(`成功以${t.is_admin?"管理员身份":"游客身份"}登录，欢迎使用!`),qe.currentRoute.value.query.redirect?qe.push(qe.currentRoute.value.query.redirect):qe.push("/"))}catch(t){k.error(t)}finally{await b((()=>i.value.classList.remove("active"))),o.value=!1}}};function c(e){"Enter"===e.key&&n(s.value)}return f((()=>{removeEventListener("keydown",c)})),C((()=>{addEventListener("keydown",c),qe.currentRoute.value.query.key&&n(qe.currentRoute.value.query.key)})),(e,o)=>(m(),t("div",Ee,[a("div",He,[a("div",{ref_key:"iconContainer",ref:i,class:"icon-container"},o[3]||(o[3]=[a("i",{class:"iconfont ChatGPT"},null,-1)]),512),o[4]||(o[4]=a("h1",{class:"title"},"登录验证",-1)),o[5]||(o[5]=a("p",{class:"hint"},"管理员开启了密码验证，请在下方填入访问码",-1)),l(a("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>s.value=e),type:"password",placeholder:"在此处填写访问码"},null,512),[[w,s.value]]),a("div",je,[a("button",{class:"later",onClick:o[1]||(o[1]=e=>n())},"游客登录"),a("button",{class:"login",onClick:o[2]||(o[2]=e=>n(s.value))},"登录")])])]))}},[["__scopeId","data-v-02fd5e8c"]]),qe=S({history:M("/"),routes:[{path:"/",name:"home",component:de,children:[{path:"/",name:"blank",component:ne},{path:"/contactors",name:"contactors",component:ne},{path:"/chat/:id",name:"chat_view",component:oe},{path:"/profile/:id",name:"profile_view",component:Oe}]},{path:"/auth",name:"auth",component:Fe},{path:"/settings",name:"settings",component:We}]});qe.beforeEach((async e=>{if(!_.everLogin()&&"auth"!==e.name){k.warning("请先登录");return{name:"auth",query:"/settings"===e.path?null:{redirect:e.fullPath}}}}));export{qe as r};
//# sourceMappingURL=views-BXMqbfVL.js.map
