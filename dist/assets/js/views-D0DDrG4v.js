import{M as e,b as t,o as s,c as a,a as o,t as i,n as l,w as n,v as c,h as r,i as d,F as h,d as m,f as u,e as p,l as g,k as v,m as y,p as C,E as f,q as w,s as S,u as b,j as k,x as M}from"./vue-vendor-Buo_xTdK.js";import{h as _,b as T}from"./vendor-DAtVPUKW.js";import{_ as x,C as L,F as P,I,T as V,a as R,R as E,c as D,f as $,P as O,b as G}from"./components-DdVEPZVW.js";import"./emoji-BVjhSaBE.js";const U={id:"chat-window"},A={class:"upside-bar"},B={class:"contactor-name"},H={class:"delay-num"},K={class:"options"},j={key:0,class:"message-time"},W=["id"],q={key:0,class:"avatar"},N=["src","alt"],F=["src","alt"],z={key:1,class:"msg"},Y={class:"wholename"},J={key:0,class:"title"},X={class:"name"},Q=["onContextmenu"],Z={key:5},ee={key:7,class:"blank-message",style:{width:"10rem",height:"28.8px",position:"relative"}},te={key:2,class:"system-message"},se={class:"system-message-content"},ae={class:"system-message-button"},oe=["onClick"];const ie=x({components:{MdPreview:e,ContextMenu:L,ForwardMsg:P,InputEditor:I,ToolCallBar:V,FileBlock:R,ReasonBlock:E},data(){let e,t,s=!1,a=!0;const o=window.location.href,i=new URL(o).searchParams;i.has("preview")&&"true"===i.get("preview")&&(s=!0),i.has("shareId")&&(e=i.get("shareId")),i.has("scroll")&&(a="true"===i.get("scroll"));const l=parseInt(this.$route.params.id);try{if(t=D.getContactor(l),!t)throw new Error("找不到联系人")}catch(n){const a=D.contactList[0].id;this.$router.push({path:`/chat/${a}`,query:{preview:s,shareId:e}}),t=D.getContactor(a)}return{scroll:a,preview:s,shareId:e,activeContactor:t,showwindow:!0,showemoji:!1,userInput:"",client:D,extraOptions:[],wraperPresets:{},selectedOption:null,currentDelay:0,toupdate:!1,seletedText:"",seletedImage:"",retryList:[],showMenu:!1,menuTop:0,menuLeft:0,validMessageIndex:-1,repliedMessageId:-1,autoScroll:!1,fullScreen:!1,chatWindowRef:null,clearMessageTip:"以上的对话记录已清除",loadingIcon:"<span id='message-loading-icon'></span>"}},computed:{getMenuStyle(){return this.menuLeft+110>window.innerWidth?{top:this.menuTop+"px",left:this.menuLeft-110+"px"}:{top:this.menuTop+"px",left:this.menuLeft+"px"}},getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},activeMessageChain(){return this.activeContactor.options.presetSettings?.opening?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain}},watch:{"$route.params.id"(e,t){const s=parseInt(e),a=D.getContactor(s);if(this.activeContactor=a,this.initContactor(this.activeContactor),this.chatWindowRef&&this.toButtom(),t){const e=parseInt(t),s=D.getContactor(e);this.disableContactor(s)}}},async mounted(){if(document.addEventListener("click",(()=>{this.showMenu=!1,this.seletedText="",this.seletedImage=""})),this.chatWindowRef=this.$refs.chatWindow,this.chatWindowRef.addEventListener("scroll",this.scrollHandler),!this.preview&&this.scroll&&this.toButtom(),this.scroll=!0,this.initContactor(this.activeContactor),this.fullScreen=this.client.fullScreen,this.shareId){await D.loadOriginalContactors(this.shareId)?this.$router.push({path:"/chat/"+this.shareId,query:{preview:this.preview,scroll:!1}}):this.$message({message:"分享链接已失效",type:"error"})}},updated(){this.toupdate&&this.autoScroll&&0===this.retryList.length&&(this.toButtom(),this.toupdate=!1)},beforeUnmount(){this.disableContactor(this.activeContactor),this.chatWindowRef.removeEventListener("scroll",this.scrollHandler)},methods:{handleMouseUp(){const e=window.getSelection().toString();e&&(this.seletedText=e)},toButtom(e){setTimeout((()=>{if(this.chatWindowRef)this.chatWindowRef.scrollTop=this.chatWindowRef.scrollHeight;else{const e=document.getElementById("main-messages-window");e.scrollTop=e.scrollHeight}e&&this.$message("已滑至底部")}),1)},cleanScreen(){this.activeContactor.messageChain=[],this.activeContactor.updateFirstMessage(),D.setLocalStorage(),this.activeContactor.emit("updateMessageSummary"),this.toupdate=!0,this.$message({message:"已清除会话记录",type:"success"})},cleanHistory(){this.activeContactor.updateFirstMessage(),this.$message({message:"上下文信息已清除，之后的请求将不再记录上文记录",type:"success"});for(let e=this.activeContactor.messageChain.length-1;e>=0;e--){const t=this.activeContactor.messageChain[e];"mio_system"===t.role&&"text"===t.content[0].type&&t.content[0].data.text===this.clearMessageTip&&this.activeContactor.messageChain.splice(e,1)}this.activeContactor.makeSystemMessage(this.clearMessageTip),D.setLocalStorage()},delSystemMessage(e){const t=this.activeContactor.messageChain[e];"text"===t.content[0].type&&t.content[0].data.text===this.clearMessageTip&&(this.activeContactor.firstMessageIndex=0),this.activeContactor.messageChain.splice(e,1),D.setLocalStorage()},isValidInput:e=>!/^[ \n]+$/.test(e),waiting(){this.$message({message:"此功能尚未开放",type:"warning"})},tolist(){this.$router.push({name:"home"})},async setModel(e){this.activeContactor.options.base.model=e,this.activeContactor.loadAvatar(),await D.setLocalStorage()},toimg(){const e=this.chatWindowRef.getBoundingClientRect();e.height=this.chatWindowRef.scrollHeight,_(this.chatWindowRef,{windowHeight:1.2*e.height,width:e.width}).then((e=>{const t=e.toDataURL("image/png"),s=document.createElement("a");s.download="chat.png",s.href=t,s.click()}))},async share(){await D.shareContactor(this.activeContactor.id)?this.$message({message:"分享链接已复制",type:"success"}):this.$message({message:"分享失败",type:"error"})},hasOpening(){return!!this.activeContactor.options.presetSettings?.opening},getFullMessages(){return this.hasOpening()?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain},showTime(e){const t=this.getFullMessages(),s=t[e].time;if(0===e)return{show:!0,time:this.activeContactor.getShownTime(s)};return s-t[e-1].time>6e5?{show:!0,time:this.activeContactor.getShownTime(s)}:{show:!1,time:""}},separateTextAndImages(e){const t=/!\[([^\]]*)\]\((.*)\)/g;let s,a=[],o=0;for(;null!==(s=t.exec(e));){if(s.index>o){const t=e.slice(o,s.index).trim();t&&a.push({type:"text",data:{text:t}})}a.push({type:"image",data:{file:s[2]}}),o=t.lastIndex}if(o<e.length){const t=e.slice(o).trim();t&&a.push({type:"text",data:{text:t}})}return a},getChatwindowScrollheight(){var e=this.chatWindowRef.scrollTop,t=this.chatWindowRef.clientHeight,s=this.chatWindowRef.scrollHeight;return s-e/(s-t)*s},initContactor(e){e.active=!0,e.on("revMessage",(e=>{this.activeContactor.messageChain.push(e),this.toupdate=!0})),e.on("delMessage",(e=>{this.activeContactor.messageChain.splice(e,1),this.toupdate=!0})),e.on("updateMessage",(()=>{this.$forceUpdate(),this.toupdate=!0,D.setLocalStorage()})),e.on("completeMessage",(async e=>{const t=e.messageId,s=this.activeContactor.getMessageById(t);"retrying"===s.status&&(this.retryList=this.retryList.filter((e=>e!==t))),s.status="completed",e.error?s.content=[{type:"text",data:{text:e.text}}]:s.content.forEach(((e,t)=>{if("text"===e.type&&"onebot"===this.activeContactor.platform){const a=this.separateTextAndImages(e.data.text);s.content.splice(t,1,...a)}})),this.toupdate=!0,this.activeContactor.loadName(),D.setLocalStorage()}))},disableContactor(e){e&&(e.active=!1,e.off("updateMessage"),e.off("revMessage"),e.off("delMessage"),e.off("completeMessage"))},getReplyText(e){let t="";const s=this.activeContactor.messageChain.find((t=>t.id===e));if(s)return s.content.forEach((e=>{"text"===e.type?t+=e.data.text:"image"===e.type&&(t+="[图片]")})),t.length>20?`> ${t.substr(0,20)}...`:`> ${t}`},showMessageMenu(e,t){if("img"===e.target.tagName.toLowerCase()){const t=e.target.src;this.seletedImage=t}this.validMessageIndex="openai"===this.activeContactor.platform&&this.hasOpening()?t-1:t,e.preventDefault(),this.showMenu=!0,this.menuTop=e.clientY,this.menuLeft=e.clientX;const s=window.getSelection().toString();this.seletedText=s||""},toProfile(){this.$router.push({name:"profile_view",params:{id:this.activeContactor.id}})},scrollHandler(){this.showMenu=!1,this.showemoji&&(this.showemoji=!1);const e=this.getChatwindowScrollheight();this.autoScroll=!(e>300)},getseletedMessage(){return this.activeContactor.messageChain[this.validMessageIndex]},handleMessageOption(e){const t=this.getseletedMessage();switch(e){case"retry":if("onebot"===this.activeContactor.platform)"user"===t.role?this.activeContactor.webSend(t):this.activeContactor.webSend({...t,role:"user"}),this.$message({message:"消息已重新发送",type:"success"});else{const e="user"===t.role?this.validMessageIndex+1:this.validMessageIndex,s=this.activeContactor.messageChain[e];this.activeContactor.retryMessage(s.id),s.status="retrying",this.retryList.push(s.id)}this.toButtom();break;case"reply":"onebot"===this.activeContactor.platform?(this.repliedMessageId=t.id,this.$message({message:"已引用该消息",type:"success"})):this.userInput+=this.getReplyText(this.activeContactor.messageChain[this.validMessageIndex].id)+"\n\n";break;case"delete":this.activeContactor.messageChain.splice(this.validMessageIndex,1),D.setLocalStorage()}}}},[["render",function(e,g,v,y,C,f){const w=t("ContextMenu"),S=t("MdPreview"),b=t("el-image"),k=t("ForwardMsg"),M=t("FileBlock"),_=t("ReasonBlock"),T=t("ToolCallBar"),x=t("InputEditor");return s(),a("div",U,[o("div",A,[o("div",{class:"return",onClick:g[0]||(g[0]=e=>f.tolist())},g[7]||(g[7]=[o("i",{class:"iconfont icon-return"},null,-1)])),o("div",{class:"name-area",onClick:g[1]||(g[1]=(...e)=>f.toProfile&&f.toProfile(...e))},[o("div",B,i(C.activeContactor.name),1),o("span",{class:l("delay-status "+f.getDelayStatus)},null,2),o("span",H,"当前延迟: "+i(C.currentDelay)+" ms",1)]),o("ul",K,[o("li",{class:"share",onClick:g[2]||(g[2]=e=>f.share())},g[8]||(g[8]=[o("i",{class:"iconfont icon-share"},null,-1)]))])]),o("div",{id:"main-messages-window",ref:"chatWindow",class:l({"message-window":!0,preview:C.preview})},[n(r(w,{type:"message",message:f.getseletedMessage(),"seleted-text":C.seletedText,"seleted-image":C.seletedImage,style:d(f.getMenuStyle),onMessageOption:f.handleMessageOption,onClose:g[3]||(g[3]=e=>C.showMenu=!1)},null,8,["message","seleted-text","seleted-image","style","onMessageOption"]),[[c,C.showMenu]]),(s(!0),a(h,null,m(f.activeMessageChain,((e,t)=>(s(),a("div",{key:`${C.activeContactor.id}-${e.id}`,ref_for:!0,ref:"message",class:"message-container"},[f.showTime(t).show?(s(),a("div",j,i(f.showTime(t).time),1)):u("",!0),o("div",{id:e.role,class:"message-body"},["mio_system"!==e.role?(s(),a("div",q,["other"===e.role?(s(),a("img",{key:0,src:C.activeContactor.avatar,alt:C.activeContactor.name,onClick:g[4]||(g[4]=(...e)=>f.toProfile&&f.toProfile(...e))},null,8,N)):(s(),a("img",{key:1,src:C.client.avatar,alt:C.client.name},null,8,F))])):u("",!0),"mio_system"!==e.role?(s(),a("div",z,[o("div",Y,[("other"===e.role?C.activeContactor.title:C.client.title)?(s(),a("div",J,i("other"===e.role?C.activeContactor.title:C.client.title),1)):u("",!0),o("div",X,i("other"===e.role?C.activeContactor.name:C.client.name),1)]),o("div",{class:"content",onMouseup:g[5]||(g[5]=(...e)=>f.handleMouseUp&&f.handleMouseUp(...e)),onContextmenu:e=>f.showMessageMenu(e,t)},[(s(!0),a(h,null,m(e.content,((i,l)=>(s(),a("div",{key:l,class:"inner-content"},["text"===i.type?(s(),p(S,{key:0,"no-img-zoom-in":!1,"preview-theme":"github","code-foldable":!1,"model-value":["pending","retrying"].includes(e.status)&&e.content.length-1===l?i.data.text+C.loadingIcon:i.data.text},null,8,["model-value"])):"image"===i.type?(s(),p(b,{key:`${C.activeContactor.id}-${t}-${l}-${i.data.file}`,src:i.data.file,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[i.data.file],"initial-index":4,loading:"lazy",fit:"contain"},null,8,["src","preview-src-list"])):"reply"===i.type?(s(),p(S,{key:2,"preview-theme":"github","model-value":f.getReplyText(i.data.id)},null,8,["model-value"])):"nodes"===i.type?(s(),p(k,{key:3,contactor:C.activeContactor,messages:i.data.messages},null,8,["contactor","messages"])):"file"===i.type?(s(),p(M,{key:4,"file-url":i.data.file},null,8,["file-url"])):"at"===i.type?(s(),a("span",Z)):"reason"===i.type?(s(),p(_,{key:6,"end-time":i.data.endTime,"start-time":i.data.startTime,content:i.data.text},null,8,["end-time","start-time","content"])):"blank"===i.type?(s(),a("div",ee,g[9]||(g[9]=[o("span",{class:"blank-loader"},null,-1)]))):"tool_call"===i.type?(s(),p(T,{key:8,"tool-call":i.data},null,8,["tool-call"])):u("",!0)])))),128))],40,Q)])):(s(),a("div",te,[o("div",se,i(e.content[0].data.text),1),o("div",ae,[o("i",{class:"iconfont close",onClick:e=>f.delSystemMessage(t)},null,8,oe)])]))],8,W)])))),128))],2),r(x,{ref:"inputEditor","active-contactor":C.activeContactor,"replied-message-id":C.repliedMessageId,onStroge:g[6]||(g[6]=e=>C.client.setLocalStorage()),onSetModel:f.setModel,onCleanScreen:f.cleanScreen,onCleanHistory:f.cleanHistory,onToButtom:f.toButtom},null,8,["active-contactor","replied-message-id","onSetModel","onCleanScreen","onCleanHistory","onToButtom"])])}],["__scopeId","data-v-61bd8c6f"]]),le={class:"blank-view"};const ne=x({name:"BlankView",data:()=>({fullScreen:!1,client:D}),watch:{},created(){this.fullScreen=D.fullScreen},methods:{waiting(){this.$message({message:"此功能尚未开放",type:"warning"})}}},[["render",function(e,t,i,l,n,c){return s(),a("div",le,t[0]||(t[0]=[o("div",{class:"upside-bar"},[o("div",{class:"options"})],-1)]))}],["__scopeId","data-v-29ea73df"]]),ce=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"})),re={key:0,id:"main"},de={key:1,id:"main-mobile"},he={key:2,id:"main-mobile",class:"mobile-chat"};const me=x({components:{friendlist:$,blankView:ne},data(){return{onPhone:window.innerWidth<600,pagePath:this.$route.path,loaded:!1}},watch:{$route:function(e){this.pagePath=e.path}},mounted(){D.inited?this.loaded=!0:D.on("loaded",(()=>{this.loaded=!0}),!1)}},[["render",function(e,o,i,l,n,c){const d=t("friendlist"),h=t("router-view"),m=t("blankView");return n.onPhone?"/"===n.pagePath?(s(),a("div",de,[n.loaded?(s(),p(d,{key:0})):(s(),p(m,{key:1}))])):(s(),a("div",he,[n.loaded?(s(),p(h,{key:0})):(s(),p(m,{key:1}))])):(s(),a("div",re,[r(d),n.loaded?(s(),p(h,{key:0})):(s(),p(m,{key:1}))]))}]]),ue={class:"profile-body"},pe={id:"profile"},ge={class:"profile-container"},ve={class:"base-info"},ye={class:"base-info-avatar"},Ce={class:"base-info-content"},fe={class:"name"},we={class:"id"},Se={class:"status"},be={key:0,class:"base-info-provider"},ke={class:"info-blocks"},Me={key:0,class:"openai-settings"},_e={class:"settings-block"},Te={class:"block-content"},xe={class:"item-title"},Le={class:"item-content"},Pe={class:"settings-block"},Ie={class:"block-content"},Ve={class:"block-content-item"},Re={class:"item-content"},Ee={class:"settings-block"},De={class:"block-content"},$e={class:"block-content-item"},Oe={class:"item-content"},Ge={class:"block-content-item"},Ue={class:"item-content"},Ae={id:"tools-list",class:"sub-items"},Be=["title"],He={class:"item-title"},Ke={class:"item-content"},je={key:0,class:"settings-block"},We={class:"block-content"},qe={class:"block-content-item"},Ne={class:"item-content"},Fe={id:"safety-settings",class:"sub-items"},ze={class:"item-title"},Ye={class:"item-content"},Je={class:"action-bar"},Xe={class:"dialog-footer"};const Qe=x({components:{PresetsList:O},data(){const e=parseInt(this.$route.params.id),t=D.getContactor(e),s=JSON.parse(JSON.stringify(t.options)),a=G.getToolCallModes(),o=G.getLLMProviders(),i=G.getSafetySettingsParams();return{safetyParams:i,geminiSafetySettings:{},safetySimpleValue:Object.keys(i).map((e=>({value:e,label:e}))),llmProviders:o,toolCallModes:a,currentDelay:0,activeContactor:t,options:s,llmProvider:s.provider,llmBaseSettings:s.base,llmChatParams:s.chatParams,llmToolCallMode:s.toolCallSettings?.mode,llmToolCallList:s.toolCallSettings?.tools,sliderTypeARange:[0,2,.1],sliderTypeBRange:[0,1,.1],sliderTypeCRange:[-2,2,.1],showSafetySettings:!1,showPresetsDetail:!1,showToolsDetail:!1,presetHistory:s.presetSettings?.history,allLLMTools:G.llmTools,toolsList:[],llmGeneralKeys:{},centerDialogVisible:!1}},computed:{getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"}},watch:{"$route.params.id"(e){this.activeContactor=D.getContactor(e),this.initContactor()},llmGeneralKeys:{handler(){this.setGeneralSettings()},deep:!0}},beforeMount(){this.loadToolsList(),this.loadGeneralSettings()},mounted(){this.initContactor(),setInterval((()=>{this.currentDelay=D.socket.delay}),3e3)},methods:{loadGeneralSettings(){this.llmGeneralKeys={...this.llmBaseSettings,...this.llmChatParams}},safeSimplify(e){const t={},s=new Map,a=G.getSafetySettingsParams();return Object.keys(a).forEach((e=>{s.set(a[e],e)})),Object.keys(e).forEach((a=>{t[a]=s.get(e[a])})),t},setGeneralSettings(){const{model:e,stream:t,max_messages_num:s,temperature:a,top_p:o,frequency_penalty:i,presence_penalty:l}=this.llmGeneralKeys;this.activeContactor.options.base={model:e,stream:t,max_messages_num:s},this.activeContactor.options.chatParams={temperature:a,top_p:o,frequency_penalty:i,presence_penalty:l},D.setLocalStorage()},switchSafetySettings(e){const t=this.geminiSafetySettings[e],s=this.safetyParams[t];this.activeContactor.options.safetySettings[e]=s,D.setLocalStorage()},handleToolConfig(){this.activeContactor.options.toolCallSettings.tools=this.toolsList.filter((e=>e.enabled)).map((e=>e.name)),D.setLocalStorage()},initContactor(){this.options=JSON.parse(JSON.stringify(this.activeContactor.options)),this.llmProvider=this.options.provider,this.llmBaseSettings=this.options.base,this.llmChatParams=this.options.chatParams,this.llmToolCallMode=this.options.toolCallSettings?.mode,this.llmToolCallList=this.options.toolCallSettings?.tools,this.presetHistory=this.options.presetSettings?.history,"gemini"===this.options.provider&&(this.geminiSafetySettings=this.safeSimplify(this.options.safetySettings)),"openai"===this.activeContactor.platform&&(this.loadGeneralSettings(),this.loadToolsList())},loadToolsList(){const e=this.llmToolCallList;this.toolsList=this.allLLMTools.map((t=>({name:t.name,description:t.description,enabled:e.includes(t.name)}))),this.toolsList.length},updateOpenaiPresets(e){this.activeContactor.options.presetSettings.history=e,this.$message({message:"预设历史记录已更新",type:"success"}),D.setLocalStorage()},getShownKey:e=>({mode:"工具调用",model:"模型",max_messages_num:"最大历史消息数",stream:"流式响应",temperature:"温度",top_p:"核采样",frequency_penalty:"重复惩罚度",presence_penalty:"话题新鲜度",HARM_CATEGORY_HARASSMENT:"骚扰",HARM_CATEGORY_HATE_SPEECH:"仇恨言论",HARM_CATEGORY_SEXUALLY_EXPLICIT:"色情",HARM_CATEGORY_DANGEROUS_CONTENT:"危险内容",HARM_CATEGORY_CIVIC_INTEGRITY:"公民诚信"}[e]),async delContactor(){this.centerDialogVisible=!1,await D.rmContactor(this.activeContactor.id),this.$router.push("/")},switchToolCallMode(){this.activeContactor.options.toolCallSettings.mode=this.llmToolCallMode,D.setLocalStorage()},switchLLMProvider(){const e=G.getDefaultModel(this.llmProvider);this.llmGeneralKeys.model=e,this.activeContactor.options.provider=this.llmProvider,this.setGeneralSettings(),this.activeContactor.loadAvatar()}}},[["render",function(e,n,c,d,y,C){const f=t("el-image"),w=t("el-option"),S=t("el-select"),b=t("el-input"),k=t("el-switch"),M=t("el-slider"),_=t("PresetsList"),T=t("el-button"),x=t("el-dialog");return s(),a("div",ue,[o("div",pe,[o("div",ge,[o("div",ve,[o("div",ye,[r(f,{src:y.activeContactor.avatar,"preview-src-list":[y.activeContactor.avatar]},null,8,["src","preview-src-list"])]),o("div",Ce,[o("div",fe,i(y.activeContactor.name),1),o("div",we,"ID "+i(y.activeContactor.id),1),o("div",Se,[o("span",{class:l("delay-status "+C.getDelayStatus)},null,2),n[9]||(n[9]=g(" 在线 "))])]),"openai"===y.activeContactor.platform?(s(),a("div",be,[r(S,{modelValue:y.llmProvider,"onUpdate:modelValue":n[0]||(n[0]=e=>y.llmProvider=e),style:{width:"10rem"},onChange:C.switchLLMProvider},{default:v((()=>[(s(!0),a(h,null,m(y.llmProviders,(e=>(s(),p(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])):u("",!0)]),o("div",ke,["openai"==y.activeContactor.platform?(s(),a("div",Me,[o("div",_e,[n[10]||(n[10]=o("div",{class:"block-title"},"LLM 基本配置",-1)),o("div",Te,[(s(!0),a(h,null,m(y.llmGeneralKeys,((e,t)=>(s(),a("div",{key:t,class:"block-content-item"},[o("div",xe,i(C.getShownKey(t)),1),o("div",Le,[["model","max_messages_num"].includes(t)?(s(),p(b,{key:0,modelValue:y.llmGeneralKeys[t],"onUpdate:modelValue":e=>y.llmGeneralKeys[t]=e},null,8,["modelValue","onUpdate:modelValue"])):["stream"].includes(t)?(s(),p(k,{key:1,modelValue:y.llmGeneralKeys[t],"onUpdate:modelValue":e=>y.llmGeneralKeys[t]=e},null,8,["modelValue","onUpdate:modelValue"])):["temperature"].includes(t)?(s(),p(M,{key:2,modelValue:y.llmGeneralKeys[t],"onUpdate:modelValue":e=>y.llmGeneralKeys[t]=e,step:y.sliderTypeARange[2],min:y.sliderTypeARange[0],max:y.sliderTypeARange[1]},null,8,["modelValue","onUpdate:modelValue","step","min","max"])):["top_p"].includes(t)?(s(),p(M,{key:3,modelValue:y.llmGeneralKeys[t],"onUpdate:modelValue":e=>y.llmGeneralKeys[t]=e,step:y.sliderTypeBRange[2],min:y.sliderTypeBRange[0],max:y.sliderTypeBRange[1]},null,8,["modelValue","onUpdate:modelValue","step","min","max"])):["frequency_penalty","presence_penalty"].includes(t)?(s(),p(M,{key:4,modelValue:y.llmGeneralKeys[t],"onUpdate:modelValue":e=>y.llmGeneralKeys[t]=e,step:y.sliderTypeCRange[2],min:y.sliderTypeCRange[0],max:y.sliderTypeCRange[1]},null,8,["modelValue","onUpdate:modelValue","step","min","max"])):u("",!0)])])))),128))])]),o("div",Pe,[n[13]||(n[13]=o("div",{class:"block-title"},"LLM 预设配置",-1)),o("div",Ie,[o("div",Ve,[n[12]||(n[12]=o("div",{class:"item-title"},"预设历史记录",-1)),o("div",Re,[o("button",{class:l({active:y.showPresetsDetail,"extra-info-button":!0}),onClick:n[1]||(n[1]=e=>y.showPresetsDetail=!y.showPresetsDetail)},n[11]||(n[11]=[o("svg",{t:"1731677922196",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5948",width:"16",height:"16"},[o("path",{d:"M778.965749 128.759549l-383.064442 383.063419 388.097062 388.096039-0.070608 0.033769c12.709463 13.137205 20.529569 31.024597 20.529569 50.731428 0 40.376593-32.736589 73.112158-73.115228 73.112158-19.705807 0-37.591153-7.819083-50.730405-20.528546l-0.034792 0.035816L241.890654 564.622498l0.035816-0.035816c-13.779841-13.281491-22.3838-31.915897-22.3838-52.585659 0-0.071631 0-0.106424 0-0.178055 0-0.072655 0-0.10847 0-0.144286 0-20.669762 8.603959-39.341007 22.3838-52.622498l-0.035816-0.034792L680.573835 20.337187l0.180102 0.179079c13.139252-12.5662 30.950919-20.313651 50.587142-20.313651 40.378639 0 73.115228 32.736589 73.115228 73.114205C804.455283 95.485725 794.567076 115.334795 778.965749 128.759549z","p-id":"5949"})],-1)]),2)])]),o("div",{class:l({hidden:!y.showPresetsDetail,"block-content-item":!0})},[r(_,{"presets-history":y.presetHistory,onUpdatePresets:C.updateOpenaiPresets},null,8,["presets-history","onUpdatePresets"])],2)])]),o("div",Ee,[n[17]||(n[17]=o("div",{class:"block-title"},"LLM 工具调用配置",-1)),o("div",De,[o("div",$e,[n[14]||(n[14]=o("div",{class:"item-title"},"工具调用模式",-1)),o("div",Oe,[r(S,{modelValue:y.llmToolCallMode,"onUpdate:modelValue":n[2]||(n[2]=e=>y.llmToolCallMode=e),placeholder:"AUTO",style:{width:"10rem"},onChange:C.switchToolCallMode},{default:v((()=>[(s(!0),a(h,null,m(y.toolCallModes,(e=>(s(),p(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])]),o("div",Ge,[n[16]||(n[16]=o("div",{class:"item-title"},"工具函数列表",-1)),o("div",Ue,[o("button",{class:l({active:y.showToolsDetail,"extra-info-button":!0}),onClick:n[3]||(n[3]=e=>y.showToolsDetail=!y.showToolsDetail)},n[15]||(n[15]=[o("svg",{t:"1731677922196",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5948",width:"16",height:"16"},[o("path",{d:"M778.965749 128.759549l-383.064442 383.063419 388.097062 388.096039-0.070608 0.033769c12.709463 13.137205 20.529569 31.024597 20.529569 50.731428 0 40.376593-32.736589 73.112158-73.115228 73.112158-19.705807 0-37.591153-7.819083-50.730405-20.528546l-0.034792 0.035816L241.890654 564.622498l0.035816-0.035816c-13.779841-13.281491-22.3838-31.915897-22.3838-52.585659 0-0.071631 0-0.106424 0-0.178055 0-0.072655 0-0.10847 0-0.144286 0-20.669762 8.603959-39.341007 22.3838-52.622498l-0.035816-0.034792L680.573835 20.337187l0.180102 0.179079c13.139252-12.5662 30.950919-20.313651 50.587142-20.313651 40.378639 0 73.115228 32.736589 73.115228 73.114205C804.455283 95.485725 794.567076 115.334795 778.965749 128.759549z","p-id":"5949"})],-1)]),2)])]),o("div",{class:l({hidden:!y.showToolsDetail,"block-content-item":!0})},[o("ul",Ae,[(s(!0),a(h,null,m(y.toolsList,((e,t)=>(s(),a("li",{key:t,class:"block-content-item",title:e.description},[o("div",He,i(e.name),1),o("div",Ke,[r(k,{modelValue:e.enabled,"onUpdate:modelValue":t=>e.enabled=t,onChange:C.handleToolConfig},null,8,["modelValue","onUpdate:modelValue","onChange"])])],8,Be)))),128))])],2)])]),"gemini"==y.llmProvider?(s(),a("div",je,[n[20]||(n[20]=o("div",{class:"block-title"},"Gimini 额外设置",-1)),o("div",We,[o("div",qe,[n[19]||(n[19]=o("div",{class:"item-title"},"过滤等级设置",-1)),o("div",Ne,[o("button",{class:l({active:y.showSafetySettings,"extra-info-button":!0}),onClick:n[4]||(n[4]=e=>y.showSafetySettings=!y.showSafetySettings)},n[18]||(n[18]=[o("svg",{t:"1731677922196",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5948",width:"16",height:"16"},[o("path",{d:"M778.965749 128.759549l-383.064442 383.063419 388.097062 388.096039-0.070608 0.033769c12.709463 13.137205 20.529569 31.024597 20.529569 50.731428 0 40.376593-32.736589 73.112158-73.115228 73.112158-19.705807 0-37.591153-7.819083-50.730405-20.528546l-0.034792 0.035816L241.890654 564.622498l0.035816-0.035816c-13.779841-13.281491-22.3838-31.915897-22.3838-52.585659 0-0.071631 0-0.106424 0-0.178055 0-0.072655 0-0.10847 0-0.144286 0-20.669762 8.603959-39.341007 22.3838-52.622498l-0.035816-0.034792L680.573835 20.337187l0.180102 0.179079c13.139252-12.5662 30.950919-20.313651 50.587142-20.313651 40.378639 0 73.115228 32.736589 73.115228 73.114205C804.455283 95.485725 794.567076 115.334795 778.965749 128.759549z","p-id":"5949"})],-1)]),2)])]),o("div",{class:l({hidden:!y.showSafetySettings,"block-content-item":!0})},[o("ul",Fe,[(s(!0),a(h,null,m(y.geminiSafetySettings,((e,t)=>(s(),a("li",{key:t,class:"block-content-item"},[o("div",ze,i(C.getShownKey(t)),1),o("div",Ye,[r(S,{modelValue:y.geminiSafetySettings[t],"onUpdate:modelValue":e=>y.geminiSafetySettings[t]=e,style:{width:"10rem"},onChange:e=>C.switchSafetySettings(t)},{default:v((()=>[(s(!0),a(h,null,m(y.safetySimpleValue,(e=>(s(),p(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])])))),128))])],2)])])):u("",!0)])):u("",!0)])])]),o("div",Je,[r(T,{plain:"",onClick:n[5]||(n[5]=t=>e.$router.push(`/chat/${y.activeContactor.id}`))},{default:v((()=>n[21]||(n[21]=[g("发送消息")]))),_:1}),r(T,{type:"danger",plain:"",onClick:n[6]||(n[6]=e=>y.centerDialogVisible=!0)},{default:v((()=>n[22]||(n[22]=[g("删除好友")]))),_:1}),r(x,{modelValue:y.centerDialogVisible,"onUpdate:modelValue":n[8]||(n[8]=e=>y.centerDialogVisible=e),title:"警告",width:"300",center:""},{footer:v((()=>[o("div",Xe,[r(T,{onClick:n[7]||(n[7]=e=>y.centerDialogVisible=!1)},{default:v((()=>n[23]||(n[23]=[g("取消")]))),_:1}),r(T,{type:"primary",onClick:C.delContactor},{default:v((()=>n[24]||(n[24]=[g(" 确认 ")]))),_:1},8,["onClick"])])])),default:v((()=>[n[25]||(n[25]=o("span",null," 确认要删除此好友吗？该操作不可逆。 ",-1))])),_:1},8,["modelValue"])])])}],["__scopeId","data-v-dbcc9cbd"]]),Ze=y({history:C("/"),routes:[{path:"/",name:"home",component:me,children:[{path:"/",name:"blank",component:()=>T((()=>Promise.resolve().then((()=>ce))),void 0)},{path:"/contactors",name:"contactors",component:()=>T((()=>Promise.resolve().then((()=>ce))),void 0)},{path:"/chat/:id",name:"chat_view",component:ie},{path:"/profile/:id",name:"profile_view",component:Qe}]},{path:"/auth",name:"auth",component:()=>T((()=>Promise.resolve().then((()=>ot))),void 0)},{path:"/settings",name:"settings",component:()=>T((()=>Promise.resolve().then((()=>nt))),void 0)}]});Ze.beforeEach((async e=>{if(!D.everLogin()&&"auth"!==e.name){f.warning("请先登录");return{name:"auth",query:"/settings"===e.path?null:{redirect:e.fullPath}}}}));const et={class:"auth-view"},tt={class:"container"},st={class:"controls"},at=x({__name:"AuthView",setup(e){const t=w(),i=w(!1),l=w(),c=async e=>{if(await M((()=>l.value.classList.add("active"))),!i.value){i.value=!0;try{const t=await D.login(e);t&&(f.success(`成功以${t.is_admin?"管理员身份":"游客身份"}登录，欢迎使用!`),Ze.currentRoute.value.query.redirect?Ze.push(Ze.currentRoute.value.query.redirect):Ze.push("/"))}catch(t){f.error(t)}finally{await M((()=>l.value.classList.remove("active"))),i.value=!1}}};function r(e){"Enter"===e.key&&c(t.value)}return S((()=>{removeEventListener("keydown",r)})),b((()=>{addEventListener("keydown",r),Ze.currentRoute.value.query.key&&c(Ze.currentRoute.value.query.key)})),(e,i)=>(s(),a("div",et,[o("div",tt,[o("div",{ref_key:"iconContainer",ref:l,class:"icon-container"},i[3]||(i[3]=[o("i",{class:"iconfont ChatGPT"},null,-1)]),512),i[4]||(i[4]=o("h1",{class:"title"},"登录验证",-1)),i[5]||(i[5]=o("p",{class:"hint"},"管理员开启了密码验证，请在下方填入访问码",-1)),n(o("input",{"onUpdate:modelValue":i[0]||(i[0]=e=>t.value=e),type:"password",placeholder:"在此处填写访问码"},null,512),[[k,t.value]]),o("div",st,[o("button",{class:"later",onClick:i[1]||(i[1]=e=>c())},"游客登录"),o("button",{class:"login",onClick:i[2]||(i[2]=e=>c(t.value))},"登录")])])]))}},[["__scopeId","data-v-02fd5e8c"]]),ot=Object.freeze(Object.defineProperty({__proto__:null,default:at},Symbol.toStringTag,{value:"Module"})),it={id:"settings-view"};const lt=x({name:"SettingsView",data:()=>({}),methods:{async reset(){await D.reset()&&(this.$message.success("重置成功"),setTimeout((()=>{window.location.reload()}),500))},async resetCache(){await D.resetCache(),this.$message.success("清理缓存成功"),setTimeout((()=>{window.location.reload()}),500)}}},[["render",function(e,o,i,l,n,c){const d=t("el-button");return s(),a("div",it,[r(d,{type:"info",plain:"",onClick:o[0]||(o[0]=e=>c.reset())},{default:v((()=>o[2]||(o[2]=[g("重置全部")]))),_:1}),r(d,{type:"info",plain:"",onClick:o[1]||(o[1]=e=>c.resetCache())},{default:v((()=>o[3]||(o[3]=[g("清理缓存")]))),_:1})])}],["__scopeId","data-v-330c2ae1"]]),nt=Object.freeze(Object.defineProperty({__proto__:null,default:lt},Symbol.toStringTag,{value:"Module"}));export{Ze as r};
//# sourceMappingURL=views-D0DDrG4v.js.map
