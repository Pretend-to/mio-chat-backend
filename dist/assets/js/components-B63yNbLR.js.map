{"version":3,"file":"components-B63yNbLR.js","sources":["../../../src/lib/event.js","../../../src/utils/generate.js","../../../src/lib/websocket.js","../../../src/lib/adapter/adapter.js","../../../src/lib/adapter/onebot.js","../../../src/lib/adapter/openai.js","../../../src/lib/contactor.js","../../../src/utils/tools.js","../../../src/lib/client.js","../../../src/lib/config.js","../../../src/lib/runtime.js","../../../src/components/SideBar.vue","../../../src/components/DisplayButtons.vue","../../../src/components/ForwardMsg.vue","../../../src/components/InputEditor.vue","../../../src/components/FileBlock.vue","../../../src/components/ToolCallBar.vue","../../../src/components/ReasonBlock.vue","../../../src/components/ContextMenu.vue","../../../src/components/AddContactor.vue","../../../src/components/FriendList.vue","../../../src/components/PresetsList.vue","../../../src/components/ContactorSettings.vue"],"sourcesContent":["export default class EventEmitter {\n  constructor() {\n    this.events = {};\n  }\n  on(eventName, listener, refresh = true) {\n    // 如果 refresh 为真，删除之前的回调函数\n    if (refresh) {\n      this.off(eventName);\n    }\n    // 如果事件名不存在，则初始化为一个空数组\n    if (!this.events[eventName]) {\n      this.events[eventName] = [];\n    }\n    // 添加新的回调函数到数组中\n    this.events[eventName].push(listener);\n  }\n  emit(eventName, data) {\n    if (this.events[eventName]) {\n      this.events[eventName].forEach((listener) => {\n        listener(data);\n      });\n    }\n  }\n  off(eventName) {\n    if (this.events[eventName]) {\n      delete this.events[eventName];\n    }\n  }\n}\n","export function uuidString() {\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    var r = (Math.random() * 16) | 0,\n      v = c == \"x\" ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport function numberString(length) {\n  let result = \"\";\n  const characters = \"0123456789\";\n  const charactersLength = characters.length;\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\n\nexport function randomString(length) {\n  let result = \"\";\n  const characters =\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n  const charactersLength = characters.length;\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\n","import EventEmitter from \"./event.js\";\nimport { randomString } from \"../utils/generate.js\";\nimport io from \"socket.io-client\";\n\n/**\n * WebSocket Connection Class\n * Handles WebSocket connection and message sending/receiving.\n */\nexport default class Socket extends EventEmitter {\n  /**\n   * Creates a Socket instance.\n   * @param {String} id - Robot QQ number\n   * @param {String} code - Login token\n   */\n  constructor(id, code) {\n    super();\n    this.available = null;\n    this.url = this.getURL();\n    this.socket = null;\n    this.code = code;\n    this.id = id;\n    this.requests = [];\n    this.pendingRequests = new Set(); // Track ongoing request_ids\n  }\n\n  /**\n   * Gets the WebSocket URL.\n   * @returns {String} WebSocket URL\n   */\n  getURL() {\n    const url = new URL(window.location.href);\n    // 保持原样，因为 io() 知道如何处理 host\n    return url.host;\n  }\n\n  /**\n   * Initializes WebSocket event listeners.\n   */\n  initEventListeners() {\n    if (!this.socket) return; // Safety check\n\n    // --- 清理旧监听器 (如果需要重新附加) ---\n    // 这对于确保在重新连接时不重复添加监听器很重要\n    // Socket.IO v3+ 的 off() 或 removeAllListeners()\n    this.socket.off(\"connect\");\n    this.socket.off(\"disconnect\");\n    this.socket.off(\"connect_error\");\n    this.socket.off(\"message\");\n    // --- 重新附加监听器 ---\n    this.socket.on(\"connect\", () => this.handleConnect());\n    this.socket.on(\"disconnect\", (reason) => this.handleDisconnect(reason)); // Pass reason\n    this.socket.on(\"connect_error\", (error) => this.handleConnectError(error));\n    this.socket.on(\"message\", (message) => this.messageHandler(message));\n  }\n\n  /**\n   * Handles the connect event.\n   */\n  handleConnect() {\n    this.available = true;\n    this.hasAttemptedPollingFallback = false; // Reset fallback flag on successful connect\n    this.isAttemptingWebSocket = false; // Reset attempt flag\n    const transport = this.socket.io?.engine?.transport?.name || \"unknown\";\n    console.log(`SocketIO connected successfully via: ${transport}`);\n  }\n\n  /**\n   * Handles the disconnect event.\n   * @param {String} reason - The reason for disconnection\n   */\n  handleDisconnect(reason) {\n    this.available = false;\n    console.error(`SocketIO disconnected. Reason: ${reason}`);\n    // 如果是 'io server disconnect' 或 'io client disconnect'，可能不需要自动重连或回退\n    // 如果是 'transport close' 或 'transport error'，Socket.IO 的 reconnection 机制会尝试处理\n    // 这里我们主要依赖 connect_error 来处理初始连接失败的回退\n  }\n\n  /**\n   * Handles the connect_error event.\n   * @param {Error} error - The error object\n   */\n  handleConnectError(error) {\n    this.emit(\"connect_error\", error);\n    // error 对象可能包含 transport 信息，例如 error.transport\n    console.log(\n      `Error occurred during ${this.isAttemptingWebSocket ? \"WebSocket\" : \"Polling\"} attempt.`,\n    );\n\n    // --- 手动回退逻辑 ---\n    // 1. 检查是否是 WebSocket 尝试失败\n    // 2. 检查是否 *已经* 尝试过回退到 Polling (防止无限循环)\n    if (this.isAttemptingWebSocket && !this.hasAttemptedPollingFallback) {\n      console.log(\n        \"WebSocket connection failed. Attempting fallback to Polling...\",\n      );\n      this.hasAttemptedPollingFallback = true; // Mark that we are now trying polling\n      this.isAttemptingWebSocket = false; // No longer attempting WebSocket initially\n\n      // 清理当前的 socket 实例\n      if (this.socket) {\n        this.socket.disconnect(); // 或 .close()\n        this.socket = null;\n      }\n\n      // 延迟一小段时间再尝试 Polling，避免立即重试可能遇到的瞬时问题\n      setTimeout(() => {\n        // 发起只使用 Polling 的新连接\n        this._connectWithTransport([\"polling\"]);\n      }, 500); // 延迟 500ms (可调整)\n    } else if (!this.isAttemptingWebSocket) {\n      // Polling 尝试也失败了\n      console.error(\"Polling connection attempt also failed.\");\n      this.available = false;\n      // 这里可以决定是否彻底放弃，或者依赖 Socket.IO 的 reconnection 机制（如果开启）\n      // 如果 Socket.IO 的 reconnection 开启，它会继续尝试用 polling 重连\n    } else {\n      // 如果 isAttemptingWebSocket 为 true 但 hasAttemptedPollingFallback 也为 true\n      // 理论上不应该发生，但作为保险\n      console.warn(\"Unexpected state in handleConnectError.\");\n      this.available = false;\n    }\n  }\n\n  /**\n   * Internal connect method allowing transport specification.\n   * @param {String[]} transports - Array of transports to use.\n   */\n  _connectWithTransport(transports) {\n    console.log(\n      `Attempting to connect using transports: ${transports.join(\", \")}...`,\n    );\n    // 确保清理可能存在的旧 socket\n    if (this.socket) {\n      this.socket.disconnect();\n    }\n\n    this.socket = io(this.url, {\n      path: \"/socket.io\",\n      transports: transports, // <-- 使用指定的 transports\n      auth: { id: this.id, token: this.code },\n      reconnection: true, // 保持开启，让 Socket.IO 处理后续的重连尝试\n      reconnectionAttempts: Infinity, // 可以为 polling 设置不同的重试次数\n      reconnectionDelay: 2000,\n      reconnectionDelayMax: 10000,\n      timeout: 15000, // 可以为 polling 调整超时\n      // 重要：强制新的连接尝试，而不是升级现有连接（如果适用）\n      // 对于 polling，这通常不是问题，但加上无妨\n      forceNew: true,\n    });\n\n    this.initEventListeners(); // 为新的 socket 实例初始化事件监听\n  }\n\n  /**\n   * Connects to the SocketIO server, starting with WebSocket.\n   */\n  async connect() {\n    if (this.socket && this.socket.connected) {\n      console.log(\"Already connected.\");\n      return;\n    }\n    this.isAttemptingWebSocket = true; // Mark that we are starting with WebSocket\n    this.hasAttemptedPollingFallback = false; // Reset fallback state\n    this._connectWithTransport([\"websocket\"]); // Start with WebSocket only\n  }\n\n  /**\n   * Disconnects from the WebSocket server.\n   */\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect(); // 使用 disconnect 更优雅\n      // socket 实例会在 disconnect 事件后由库内部清理或重用（如果重连）\n      // 我们可以在 handleDisconnect 中或这里设置 this.socket = null，取决于你的状态管理需求\n      // this.socket = null; // 如果希望彻底断开后清理引用\n      this.available = false;\n      console.log(\"Manual disconnection initiated.\");\n    }\n  }\n\n  /**\n   * Handles incoming messages.\n   * @param {String} message - The received message\n   */\n  messageHandler(message) {\n    console.log(\"WebSocket received message\", message);\n    try {\n      const e = JSON.parse(message);\n      if (e.protocol === \"llm\") {\n        this.emit(e.request_id, e);\n        this.emit(\"llm_message\", e);\n      }\n      if (e.protocol === \"onebot\") {\n        this.emit(\"onebot_message\", e);\n      } else if (e.protocol === \"system\") {\n        if (e.type === \"login\") this.emit(\"connect\", e.data);\n        this.emit(\"system_message\", e);\n      }\n      this.emit(e.request_id, e)\n      this.pendingRequests.delete(e.request_id); // Remove request_id\n    } catch (error) {\n      console.error(\"JSON parsing failed:\", error, \"Received:\", message); // Log received message on error\n    }\n  }\n\n  /**\n   * Sends a message.\n   * @param {Object} message - The message object to send\n   */\n  sendMessage(message) {\n    // 在发送前检查连接状态\n    // 注意：即使 available 为 true，socket 也可能在发送瞬间断开\n    // Socket.IO 客户端通常会缓存消息并在重连后发送，但要了解这个行为\n    if (!this.socket || !this.socket.connected) {\n      // 使用 socket.connected 更准确\n      console.warn(\"SocketIO not connected. Message sending skipped.\", message);\n      // 可以考虑将消息放入队列稍后重试，但这会增加复杂性\n      this.pendingRequests.delete(message.request_id); // 如果不发送，也应该移除 pending 状态\n      return Promise.reject(new Error(\"Socket not connected\")); // 让调用者知道失败了\n    }\n\n    // --- 原有的 pendingRequest 检查逻辑 ---\n    if (this.pendingRequests.has(message.request_id)) {\n      console.warn(\n        `Duplicate request_id: ${message.request_id}, request blocked`,\n      );\n      // 考虑是否应该 reject Promise 或返回特定错误\n      return Promise.reject(\n        new Error(`Duplicate request_id: ${message.request_id}`),\n      );\n    }\n    this.pendingRequests.add(message.request_id);\n    // --- 发送消息 ---\n    try {\n      this.socket.emit(\"message\", JSON.stringify(message));\n      console.log(\"WebSocket sending request\", message);\n      // 注意：emit 是异步的，但通常不返回 Promise\n      // 如果需要确认服务器收到，需要服务器发送回执\n      return Promise.resolve(); // 表示发送尝试已发出\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      this.pendingRequests.delete(message.request_id); // 发送失败，移除 pending 状态\n      return Promise.reject(error); // 传递错误\n    }\n  }\n\n  /**\n   * Sends a request and waits for a response.\n   * @param {String} url - API endpoint\n   * @param {Object} data - Request data\n   * @returns {Promise<any>} Response data\n   */\n  fetch(url, data) {\n    return new Promise((resolve, reject) => {\n      const pathArray = url.split(\"/\").filter(Boolean);\n      const request = {\n        request_id: randomString(16),\n        protocol: pathArray[1],\n        type: pathArray[2],\n        id: pathArray[3],\n        data: data,\n        metaData: {\n          contactorId: this.id,\n        },\n      };\n      const timeOut = new Promise((_, reject) => {\n        setTimeout(() => {\n          this.pendingRequests.delete(request.request_id); // Remove on timeout\n          reject(\"timeout\");\n        }, 60000);\n      });\n      const response = new Promise((resolve) => {\n        this.on(request.request_id, (res) => {\n          this.pendingRequests.delete(request.request_id); // Remove on response\n          resolve(res.data);\n        });\n      });\n      Promise.race([timeOut, response])\n        .then(resolve)\n        .catch(reject)\n        .finally(() => {\n          this.off(request.request_id);\n        });\n      this.sendMessage(request); // Use sendMessage to send the request\n      console.log(\"WebSocket sending request\", url, request);\n    });\n  }\n\n  /**\n   * Streams completion data.\n   * @param {Object} data - Completion request data\n   * @returns {AsyncGenerator<any>} - Completion data generator\n   */\n  streamCompletions(data, metaData) {\n    const request_id = randomString(16);\n    const request = {\n      request_id,\n      protocol: \"llm\",\n      type: \"completions\",\n      data: data,\n      metaData,\n    };\n    this.sendMessage(request);\n    console.log(\"WebSocket sending request\", request);\n  }\n}\n","/**\n * @author Mio-FCIP <1099834705@qq.com>\n * @lastEditor 彭志勇 <2457305628@qq.com>\n * @lastEditTime 2024-04-25 06:25:30\n */\n\nimport EventEmitter from \"../event.js\";\nimport { client } from \"@/lib/runtime.js\";\n\nexport default class Adapter extends EventEmitter {\n  constructor() {\n    super();\n  }\n\n  async fetch(url, data) {\n    return await client.socket.fetch(url, data);\n  }\n}\n","import Adapter from \"./adapter.js\";\n\nexport default class Onebot extends Adapter {\n  constructor() {\n    super();\n  }\n\n  convertMessage(data) {\n    console.log(data);\n    data.message.forEach((element, index) => {\n      if (element.type === \"image\") {\n        const base64Data = element.data.file.replace(\n          /^base64:\\/\\//,\n          \"data:image/jpeg;base64,\",\n        );\n        data.message[index].data.file = base64Data;\n        console.log(data.message[index]);\n      } else if (element.type === \"nodes\") {\n        element.data.messages.forEach((node) => {\n          if (node.type === \"image\") {\n            const base64Data = node.data.file.replace(\n              /^base64:\\/\\//,\n              \"data:image/jpeg;base64,\",\n            );\n            node.data.file = base64Data;\n          }\n        });\n      }\n    });\n\n    const rplMessage = data.message.filter(\n      (element) => element.type === \"reply\",\n    );\n    const midMessage = data.message.filter(\n      (element) => element.type !== \"reply\",\n    );\n    if (rplMessage.length > 0) {\n      midMessage.push(rplMessage[0]);\n    }\n\n    const webMessage = {\n      role: \"other\",\n      time: new Date().getTime(),\n      content: midMessage,\n      id: data.message_id,\n      status: \"completed\",\n    };\n    return webMessage;\n  }\n\n  /**\n   * Send message to server\n   * @param {id} string\n   * @param {WebMessage} message\n   * @returns {Promise<number>} message_id\n   */\n  async send(id, message) {\n    const response = await this.fetch(\n      \"/api/onebot/message\" + `/${id}`,\n      message,\n    );\n    return response.message_id;\n  }\n}\n","/**\n * @author Mio-FCIP <1099834705@qq.com>\n * @lastEditor 彭志勇 <2457305628@qq.com>\n * @lastEditTime 2024-04-25 06:25:30\n */\n\nimport Adapter from \"./adapter.js\";\nimport { client, config } from \"../runtime.js\";\nimport { numberString } from \"../../utils/generate.js\";\n\nexport default class Openai extends Adapter {\n  constructor(config) {\n    super();\n    this.id = config.id;\n  }\n\n  convertMessage(message) {\n    const webMessage = {\n      role: \"other\",\n      time: new Date().getTime(),\n      content: [{ type: \"blank\", data: {} }],\n      status: \"pending\",\n      id: numberString(16),\n    };\n    const mergedMessage = { ...webMessage, ...message };\n    return mergedMessage;\n  }\n\n  async getMessagesSummary(messageChain) {\n    const query = `请你根据以下对话的内容\\n${JSON.stringify(messageChain)}\\n，总结出一个简短的对话主题,你的回答必须只包含对话主题，不要包含任何其他内容，包括句号。`;\n    const settings = config.getLLMDefaultConfig();\n    settings.base.stream = false;\n    const messages = {\n      settings,\n      messages: [{ role: \"user\", content: query }],\n    };\n\n    const response = await this.fetch(`/api/llm/completions`, messages);\n    // debugger;\n    const { content } = response;\n    return content || \"未命名会话\";\n  }\n\n  handleMessageEvent(chunk) {\n    const data = chunk.data;\n\n    const messageId = data.metaData.messageId;\n\n    delete data.metaData;\n\n    const emitEvent = (eventName, detail) => {\n      this.emit(eventName, { ...detail, messageId });\n    };\n\n    console.log(\"Received chunk from LLM:\", chunk);\n    if (chunk.message === \"update\") {\n      const updateHandlers = {\n        reasoningContent: (content) =>\n          emitEvent(\"updateReasoning\", { reasoning_content: content }),\n        content: (content) => emitEvent(\"updateMessage\", { chunk: content }),\n        toolCall: (tool_call) => emitEvent(\"updateToolCall\", { tool_call }),\n      };\n\n      const data = chunk.data;\n      const handler = updateHandlers[data.type];\n      if (handler) {\n        handler(data.content);\n      }\n    } else if ([\"complete\", \"failed\"].includes(chunk.message)) {\n      const completionHandlers = {\n        complete: () => emitEvent(\"completeMessage\", {}),\n        failed: () => emitEvent(\"failedMessage\", { error: chunk.data }),\n      };\n\n      const handler = completionHandlers[chunk.message];\n      if (handler) {\n        handler();\n      }\n    }\n  }\n\n  async send(messages, messageId, settings) {\n    console.log(\"send message to openai\");\n\n    settings = config.getVerifiedLLMConfig(settings);\n\n    const metaData = {\n      contactorId: this.id,\n      messageId,\n    };\n    // Apply settings defaults\n    const data = {\n      settings, // Default to empty object\n      messages,\n    };\n\n    console.log(\"Data sent to LLM:\", data);\n\n    if (!client.socket) {\n      throw new Error(\"WebSocket connection not established.\");\n    }\n\n    client.socket.streamCompletions(data, metaData);\n  }\n}\n","import Onebot from \"./adapter/onebot.js\";\nimport Openai from \"./adapter/openai.js\";\nimport EventEmmiter from \"./event.js\";\nimport { numberString } from \"../utils/generate.js\";\nimport { config } from \"@/lib/runtime.js\";\n\nconst AVATAR_BASE_PATH =\n  \"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons\";\n\nconst AVATAR_MAP = {\n  OpenAI: \"openai.svg\",\n  Cohere: \"cohere-color.svg\",\n  Anthropic: \"claude-color.svg\",\n  Google: \"gemini-color.svg\",\n  \"X.AI\": \"grok.svg\",\n  DeepSeek: \"deepseek-color.svg\",\n  智谱清言: \"zhipu-color.svg\",\n  豆包: \"doubao-color.svg\",\n  \"月之暗面 (kimi)\": \"moonshot.svg\",\n  科大讯飞: \"spark-color.svg\",\n  通义千问: \"qwen-color.svg\",\n  腾讯混元: \"hunyuan-color.svg\",\n};\n\nconst avatarPolicy = [\"MODEL\", \"CUSTOM\"];\n\nconst namePolicy = [\"MODEL\", \"CUSTOM\", \"SUMMARY\"];\n\nexport default class Contactor extends EventEmmiter {\n  /**\n   * Contactor 构造函数\n   * @param {string} platform - 平台 (e.g., \"onebot\", \"openai\")\n   * @param {object} config - 配置对象\n   * @param {string} config.id - ID\n   * @param {string} config.name - 名称\n   * @param {string} config.avatar - 头像 URL\n   * @param {string} config.title - 标题\n   * @param {object} config.options - 选项\n   * @param {number} config.priority - 优先级 (0 最高)\n   * @param {number} config.namePolicy - 名称策略 (默认 0)\n   * @param {number} config.avatarPolicy - 头像策略 (默认 0)\n   * @param {number} config.firstMessageIndex - 首条消息索引 (默认 0)\n   * @param {array} config.messageChain - 消息链 (默认 [])\n   * @param {number} config.lastUpdate - 最后更新时间 (默认当前时间)\n   * @param {number} config.createTime - 创建时间 (默认当前时间)\n   */\n  constructor(platform, config) {\n    super();\n    this.platform = platform;\n    this.id = config.id;\n    this.namePolicy = config.namePolicy || 0;\n    this.avatarPolicy = config.avatarPolicy || 0;\n    this.title = config.title;\n    this.name = config.name;\n    this.avatar = config.avatar;\n    this.priority = config.priority;\n    this.firstMessageIndex = config.firstMessageIndex || 0;\n    this.messageChain = config.messageChain || [];\n    this.active = false;\n    this.lastUpdate = config.lastUpdate || Date.now(); // 使用 Date.now()\n    this.createTime = config.createTime || Date.now(); // 使用 Date.now()\n    this.lastMessageSummary = this.getLastMessageSummary();\n    this.options = this.loadOptions(config.options);\n    this.kernel =\n      platform === \"onebot\" ? new Onebot(config) : new Openai(config); // 简化条件判断\n\n    if (platform === \"openai\") {\n      this.enableOpenaiListener();\n    }\n  }\n\n  /**\n   * 将 Contactor 对象转换为 JSON 格式\n   * @returns {object} - 包含 Contactor 属性的 JSON 对象\n   */\n  toJSON() {\n    return {\n      platform: this.platform,\n      id: this.id,\n      options: this.options,\n      namePolicy: this.namePolicy,\n      avatarPolicy: this.avatarPolicy,\n      title: this.title,\n      name: this.name,\n      avatar: this.avatar,\n      priority: this.priority,\n      messageChain: this.messageChain,\n      active: this.active,\n      lastUpdate: this.lastUpdate,\n      createTime: this.createTime,\n      lastMessageSummary: this.lastMessageSummary,\n      firstMessageIndex: this.firstMessageIndex,\n    };\n  }\n\n  enableOpenaiListener() {\n    this.kernel.on(\"updateReasoning\", (e) => {\n      const { reasoning_content, messageId } = e;\n      const rawMessage = this.getMessageById(messageId);\n      if (!rawMessage) return;\n\n      // 查找现有的 reason 块\n      const existingReasonIndex = rawMessage.content.findIndex(\n        (msgElm) => msgElm.type === \"reason\",\n      );\n\n      const msgElm = {\n        type: \"reason\",\n        data: {\n          text: reasoning_content,\n          startTime: new Date().getTime(),\n          endTime: 0,\n        },\n      };\n\n      if (existingReasonIndex !== -1) {\n        // 如果已存在 reason 块，更新其内容\n        msgElm.data.text =\n          rawMessage.content[existingReasonIndex].data.text + reasoning_content;\n        msgElm.data.startTime =\n          rawMessage.content[existingReasonIndex].data.startTime;\n        rawMessage.content[existingReasonIndex] = msgElm;\n      } else if (rawMessage.content[0].type === \"blank\") {\n        // 如果是 blank 状态，直接更新第一个元素\n        rawMessage.content[0] = msgElm;\n      } else {\n        // 其他情况，追加到末尾\n        rawMessage.content.push(msgElm);\n      }\n\n      this.emit(\"updateMessage\");\n      this.emit(\"updateMessageSummary\");\n    });\n\n    this.kernel.on(\"updateMessage\", (e) => {\n      const { chunk, messageId } = e;\n      const rawMessage = this.getMessageById(messageId);\n      if (!rawMessage) return;\n\n      rawMessage.content.forEach((msgElm) => {\n        if (msgElm.type == \"reason\" && !msgElm.data.endTime)\n          msgElm.data.endTime = new Date().getTime();\n      });\n\n      const lastMsgElm = rawMessage.content[rawMessage.content.length - 1];\n      const isFirstElement = [\"blank\", \"text\"].includes(lastMsgElm.type);\n\n      const msgElm = {\n        type: \"text\",\n        data: {\n          text: (lastMsgElm.type == \"text\" ? lastMsgElm.data.text : \"\").concat(\n            chunk,\n          ),\n        },\n      };\n\n      if (isFirstElement)\n        rawMessage.content[rawMessage.content.length - 1] = msgElm;\n      else rawMessage.content.push(msgElm);\n\n      this.emit(\"updateMessage\"); // 更新响应式数据\n      this.emit(\"updateMessageSummary\");\n    });\n\n    this.kernel.on(\"updateToolCall\", (e) => {\n      const { tool_call, messageId } = e;\n      console.log(tool_call);\n\n      const rawMessage = this.getMessageById(messageId);\n      if (!rawMessage) return;\n\n      const lastMsgElm = rawMessage.content[rawMessage.content.length - 1];\n      const msgElm = {\n        type: \"tool_call\",\n        data: tool_call,\n      };\n\n      if (lastMsgElm.type == \"blank\") {\n        // 这种情况一定是第一条空白消息，直接更新成 toolCall 消息\n        rawMessage.content[0] = msgElm;\n      } else {\n        const previousCall = rawMessage.content.find(\n          (msgElm) => msgElm.data.id == tool_call.id,\n        );\n        if (previousCall) {\n          const updatedCall = JSON.parse(JSON.stringify(previousCall));\n          updatedCall.data.action = tool_call.action;\n          updatedCall.data.result = tool_call.result;\n          if (tool_call.action == \"pending\") {\n            updatedCall.data.parameters += tool_call.parameters;\n          }\n          const index = rawMessage.content.indexOf(previousCall);\n          rawMessage.content[index] = updatedCall;\n        } else {\n          // 这种情况就是新增一条 toolCall 消息\n          rawMessage.content.push(msgElm);\n        }\n      }\n\n      this.emit(\"updateMessage\"); // 更新响应式数据\n      this.emit(\"updateMessageSummary\");\n    });\n\n    this.kernel.on(\"completeMessage\", (e) => {\n      this.updateLastUpdate();\n      const messageId = e.messageId;\n      const rawMessage = this.getMessageById(messageId);\n      if (rawMessage) {\n        rawMessage.status = \"completed\";\n\n        this.emit(\"updateMessageSummary\");\n\n        this.emit(\"completeMessage\", {\n          messageId,\n        });\n      }\n    });\n\n    this.kernel.on(\"failedMessage\", (e) => {\n      console.error(e);\n      // case 1: e.error.message 为json字符串，需要解析\n      if (typeof e.error === \"string\") {\n        try {\n          e.error.message = JSON.parse(e.error.message);\n        } catch (error) {\n          console.error(\"Failed to parse error message:\", error);\n        }\n      }\n      const error = JSON.stringify(e.error, null, 2);\n\n      this.updateLastUpdate();\n      const messageId = e.messageId;\n      const rawMessage = this.getMessageById(messageId);\n      if (rawMessage) {\n        const errorMessage =\n          \"Error : LLM 响应失败！\\n```json\\n \" + error + \"\\n```\";\n        const errElem = {\n          type: \"text\",\n          data: {\n            text: errorMessage,\n          },\n        };\n\n        const withBlank = rawMessage.content.some(\n          (elm) => elm.type === \"blank\",\n        );\n\n        if (withBlank) {\n          rawMessage.content[0] = errElem;\n        } else {\n          rawMessage.content.push(errElem);\n        }\n\n        rawMessage.status = \"completed\";\n\n        this.emit(\"updateMessageSummary\");\n\n        this.emit(\"completeMessage\", {\n          messageId,\n        });\n      }\n    });\n  }\n\n  handleLLMMessageEvent(e) {\n    this.kernel.handleMessageEvent(e);\n  }\n\n  loadOptions(options) {\n    if (this.platform === \"openai\") {\n      return config.getVerifiedLLMConfig(options);\n    } else {\n      return options || {};\n    }\n  }\n\n  /**\n   * Send message to contactor\n   * @param {OnebotMessage} message\n   */\n  async send(message) {\n    await this.kernel.send(message);\n  }\n\n  _getFilePrompt(fileElms) {\n    const start = \"\\n以下是用户上传的文件：\\n\";\n    return start + fileElms.join(\"\\n\");\n  }\n\n  _getImagePrompt(imageElms) {\n    const start = \"\\n以下是用户所上传的图片链接：\\n\";\n    const result =  start + imageElms.map((elm)=>elm.content).join(\"\\n\");\n    return result\n  }\n\n  _getValidOpenaiMessage(\n    start = this.firstMessageIndex,\n    end = this.messageChain.length,\n    length = this.options.base.max_messages_num,\n  ) {\n    const cuttedMessageList = this.messageChain\n      .slice(start, end)\n      .slice(-length);\n\n    const validMessageList = cuttedMessageList.filter(\n      (msg) => msg.role != \"mio_system\",\n    );\n\n    const mergedMessages = validMessageList.map((message) => {\n      const fileList = [];\n      const imageList = [];\n      const subArray = [];\n      message.content.forEach((elm) => {\n        const role =\n          elm.type == \"tool_call\"\n            ? \"tool\"\n            : message.role == \"user\"\n              ? \"user\"\n              : \"assistant\";\n        const formatedMsg = {\n          role: role,\n          content: \"none\",\n          _content_type: undefined,\n        };\n        if (role == \"tool\") {\n          formatedMsg.role = \"assistant\";\n          formatedMsg.content = null;\n          formatedMsg.tool_calls = [\n            {\n              id: elm.data.id,\n              function: {\n                name: elm.data.name,\n                arguments: elm.data.parameters,\n              },\n              type: \"function\",\n            },\n          ];\n          subArray.push({ ...formatedMsg });\n\n          delete formatedMsg.tool_calls;\n          formatedMsg.role = \"tool\";\n          formatedMsg.content = JSON.stringify(elm.data.result);\n          formatedMsg.tool_call_id = elm.data.id;\n          formatedMsg.name = elm.data.name;\n          subArray.push({ ...formatedMsg });\n\n          formatedMsg.role = role;\n        } else if (role == \"user\" || role == \"assistant\") {\n          if (elm.type == \"image\") {\n            formatedMsg.content = elm.data.file;\n            formatedMsg._content_type = \"image\";\n            subArray.push(formatedMsg);\n            imageList.push(elm.data.file.content);\n          } else if (elm.type == \"text\") {\n            formatedMsg.content = elm.data.text;\n            formatedMsg._content_type = \"text\";\n            subArray.push(formatedMsg);\n          } else if (elm.type == \"file\") {\n            fileList.push(elm.data.file);\n          }\n        }\n      });\n      if (fileList.length > 0) {\n        const textElm = subArray.filter((elm) => elm._content_type == \"text\");\n        // 没有就创建一个\n        if (textElm.length == 0) {\n          subArray.push({\n            role: \"user\",\n            content: this._getFilePrompt(fileList),\n            _content_type: \"text\",\n          });\n        }\n      }\n      return subArray;\n    });\n    let finalMessages = [];\n\n    mergedMessages.forEach((subArray) => {\n      const textElm = subArray.filter((elm) => elm._content_type == \"text\");\n      const imageElm = subArray.filter((elm) => elm._content_type == \"image\");\n      const fileElm = subArray.filter((elm) => elm._content_type == \"file\");\n      const filePrompt = fileElm.length > 0 ? this._getFilePrompt(fileElm) : \"\";\n      const imagePrompt = imageElm.length > 0 ? this._getImagePrompt(imageElm) : \"\";\n    \n      let message = null;\n      if (\n        textElm.length > 0 &&\n        imageElm.length > 0 &&\n        imageElm[0].role == \"user\"\n      ) {\n        message = {\n          role: \"user\",\n          content: [\n            ...imageElm.map((elm) => {\n              return {\n                type: \"image_url\",\n                image_url: {\n                  url: elm.content,\n                },\n              };\n            }),\n            ...textElm.map((elm) => {\n              return {\n                type: \"text\",\n                text: elm.content + filePrompt + imagePrompt,\n              };\n            }),\n          ],\n        };\n      }\n      if (message?.content.length == subArray.length) {\n        finalMessages.push(message);\n      } else {\n        subArray.forEach((elm) => {\n          delete elm._content_type;\n        });\n        finalMessages.push(...subArray);\n      }\n    });\n\n    const presetHistory = this.options.presetSettings.history;\n\n    if (presetHistory) {\n      finalMessages = presetHistory.concat(finalMessages);\n    }\n\n    return finalMessages;\n  }\n  updateMessageSummary() {\n    this.lastMessageSummary = this.getLastMessageSummary();\n  }\n\n  getBaseUserContainer() {\n    const userContainer = {\n      role: \"user\",\n      time: new Date().getTime(),\n      status: \"completed\",\n      id: numberString(16),\n      content: [],\n    };\n    return userContainer;\n  }\n\n  /**\n   * 从网页前端发来的消息\n   */\n  async webSend(message, toServer = true) {\n    this.updateLastUpdate();\n    this.messageChain.push(message);\n    this.updateMessageSummary();\n    if (!toServer) return;\n    try {\n      if (this.platform == \"onebot\") {\n        const messageId = await this.kernel.send(this.id, message.content);\n\n        return messageId;\n      } else {\n        // 截取从this.firstMessageIndex到结尾的消息\n        const finalMessages = this._getValidOpenaiMessage();\n        const messageId = numberString(16);\n        await this.kernel.send(finalMessages, messageId, this.options);\n\n        this.revMessage({\n          id: messageId,\n        });\n\n        return numberString(16);\n      }\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      throw error;\n    }\n  }\n\n  insertMessage(message, index) {\n    this.messageChain.splice(index, 0, message);\n    this.updateMessageSummary();\n  }\n\n  async retryMessage(id) {\n    const message = this.getMessageById(id);\n    if (message) {\n      message.content = [\n        {\n          type: \"blank\",\n        },\n      ];\n      this.updateLastUpdate();\n      const index = this.messageChain.indexOf(message);\n      const finalMessages = this._getValidOpenaiMessage(0, index);\n      this.kernel.send(finalMessages, id, this.options);\n      return true;\n    }\n  }\n\n  as;\n\n  /**\n   * 接收到消息\n   * @param {string} id - ID of the contactor\n   * @param {object} message - Message received from contactor\n   */\n  revMessage(message) {\n    this.updateLastUpdate();\n\n    const webMessage = this.kernel.convertMessage(message);\n\n    if (!this.active) this.messageChain.push(webMessage);\n    else this.emit(\"revMessage\", webMessage);\n\n    this.emit(\"updateMessageSummary\");\n    return webMessage;\n  }\n\n  /**\n   * 删除消息\n   * @param {string} message_id - ID of the message to be deleted\n   * @returns {boolean} - Whether the message is successfully deleted\n   */\n  delMessage(message_id) {\n    for (let i = 0; i < this.messageChain.length; i++) {\n      if (this.messageChain[i].id === message_id) {\n        if (this.active) this.emit(\"delMessage\", i);\n        else this.acting.messageChain.splice(i, 1);\n        this.makeSystemMessage(`${this.name}撤回了一条消息`);\n        return true; // 删除成功\n      }\n    }\n    return false; // 没有找到要删除的消息\n  }\n\n  makeSystemMessage(text) {\n    const container = {\n      role: \"mio_system\",\n      time: new Date().getTime(),\n      id: new Date().getTime(),\n      content: [\n        {\n          type: \"text\",\n          data: {\n            text: text,\n          },\n        },\n      ],\n    };\n    if (this.active) this.emit(\"revMessage\", container);\n    else this.messageChain.push(container);\n  }\n\n  getLastTime() {\n    const last = this.messageChain[this.messageChain.length - 1];\n    if (!last) {\n      return \"\";\n    }\n\n    const currentTime = new Date().getTime();\n    const lastTime = new Date(last.time);\n    const timeDiff = currentTime - lastTime.getTime();\n\n    if (timeDiff < 24 * 60 * 60 * 1000) {\n      this.toinit = false;\n      // 小于24小时，返回 xx:xx (小时:分钟)\n      const hours = lastTime.getHours().toString().padStart(2, \"0\");\n      const minutes = lastTime.getMinutes().toString().padStart(2, \"0\");\n      return `${hours}:${minutes}`;\n    } else if (timeDiff < 48 * 60 * 60 * 1000) {\n      // 小于48小时，显示昨天\n      return \"昨天\";\n    } else if (timeDiff < 7 * 24 * 60 * 60 * 1000) {\n      // 小于7天，返回星期x\n      const weekdays = [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\"];\n      const weekday = lastTime.getDay();\n      return `星期${weekdays[weekday]}`;\n    } else {\n      // 7天以上，返回xxxx/xx/xx（年/月/日）\n      const year = lastTime.getFullYear();\n      const month = (lastTime.getMonth() + 1).toString().padStart(2, \"0\");\n      const day = lastTime.getDate().toString().padStart(2, \"0\");\n      return `${year}/${month}/${day}`;\n    }\n  }\n\n  getShownTime(timestamp) {\n    const currentTime = new Date().getTime();\n    // 如果传入时间和当前时间差在24h以内，则显示时间\n\n    const timeDiff = currentTime - timestamp;\n    if (timeDiff < 24 * 60 * 60 * 1000) {\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `${hours}:${minutes}`;\n    } else if (timeDiff < 48 * 60 * 60 * 1000) {\n      // 小于48小时，显示昨天+时间\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `昨天${hours}:${minutes}`;\n    } else if (timeDiff < 7 * 24 * 60 * 60 * 1000) {\n      // 小于7天，返回星期x+时间\n      const weekdays = [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\"];\n      const weekday = new Date(timestamp).getDay();\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `星期${weekdays[weekday]}${hours}:${minutes}`;\n    } else {\n      // 7天以上，返回xxxx/xx/xx（年/月/日）+时间\n      const year = new Date(timestamp).getFullYear();\n      const month = (new Date(timestamp).getMonth() + 1)\n        .toString()\n        .padStart(2, \"0\");\n      const day = new Date(timestamp).getDate().toString().padStart(2, \"0\");\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `${year}/${month}/${day} ${hours}:${minutes}`;\n    }\n  }\n\n  getLastMessageSummary(message) {\n    const getMessageText = (element) => {\n      switch (element.type) {\n        case \"text\":\n          return element.data.text;\n        case \"image\":\n          return \"[图片]\";\n        case \"record\":\n          return \"[语音]\";\n        case \"video\":\n          return \"[视频]\";\n        case \"file\":\n          return \"[文件]\";\n        case \"tool_call\":\n          return `[调用工具] ${element.data.name}`;\n        case \"reason\":\n          return element.data.text;\n        case \"blank\":\n          return \"正在思考中...\";\n        case \"reply\":\n          return \"\"; // 空字符串处理\n        case \"nodes\":\n          return \"[转发消息]\";\n        default:\n          return \"[未知消息类型] \" + element.type;\n      }\n    };\n\n    let msg = message || this.messageChain[this.messageChain.length - 1]\n    if (!msg) return \"\";\n    msg = JSON.parse(JSON.stringify(msg));\n    if (msg.type === \"node\") {\n      msg = msg.data\n    }\n\n    return getMessageText(msg.content ? msg.content[0] : msg);\n  }\n\n  updateFirstMessage() {\n    this.firstMessageIndex = this.messageChain.length;\n  }\n\n  updateLastUpdate() {\n    this.lastUpdate = new Date().getTime();\n  }\n\n  getMessageById(id) {\n    return this.messageChain.find((msg) => msg.id === id);\n  }\n\n  loadAvatar() {\n    let avatar = \"/static/avatar/miobot.png\";\n    if (avatarPolicy[this.avatarPolicy] == \"MODEL\") {\n      const model = this.options.base.model;\n      avatar = Contactor.getAvatarByModel(model);\n    } else if (avatarPolicy[this.avatarPolicy] == \"CUSTOM\") {\n      avatar = this.avatar;\n    }\n\n    if (this.platform == \"openai\") {\n      this.title = this.options.base.model;\n    }\n\n    this.avatar = avatar;\n    return avatar;\n  }\n\n  async loadName() {\n    let name = this.name ?? \"未命名 Bot\";\n    if (namePolicy[this.namePolicy] == \"MODEL\") {\n      const model = this.options.model;\n      name = model;\n    } else if (namePolicy[this.namePolicy] == \"CUSTOM\") {\n      name = this.name;\n    } else if (namePolicy[this.namePolicy] == \"SUMMARY\") {\n      if (this.messageChain.length < 2) {\n        name = \"新建的 Bot\";\n      } else if (\n        this.messageChain.length == 2 ||\n        this.messageChain.length % 6 == 0\n      ) {\n        name = await this.getMessagesSummary();\n      }\n    }\n    this.name = name;\n    return name;\n  }\n\n  getMessagesSummary() {\n    if (this.platform == \"openai\") {\n      return this.kernel.getMessagesSummary(\n        this._getValidOpenaiMessage().slice(-4),\n      );\n    } else {\n      return \"仅支持 OpenAI Chat Bot\";\n    }\n  }\n\n  static getAvatarByModel(model) {\n    const modelOwner = config.getModelOwner(model);\n    if (Object.keys(AVATAR_MAP).includes(modelOwner)) {\n      return `${AVATAR_BASE_PATH}/${AVATAR_MAP[modelOwner]}`;\n    }\n\n    return `${AVATAR_BASE_PATH}/openai.svg`;\n  }\n}\n","export function debounce(fn, delay) {\n  let timeoutId;\n  return function (...args) {\n    clearTimeout(timeoutId);\n    timeoutId = setTimeout(() => {\n      fn.apply(this, args);\n    }, delay);\n  };\n}\n","import Socket from \"./websocket.js\";\nimport Contactor from \"./contactor.js\";\nimport localforage from \"localforage\";\nimport EventEmitter from \"./event.js\";\nimport { reactive } from \"vue\";\nimport { debounce } from \"../utils/tools.js\";\nimport UploadWorker from \"../worker/fileUpload.js?worker\";\n\n// Configure localforage\nlocalforage.config({\n  name: \"mio-chat\",\n});\n\nexport default class Client extends EventEmitter {\n  constructor(config) {\n    super();\n    this.inited = false;\n    this.id = null; // Loaded from storage\n    this.code = null; // Loaded from storage\n    this.isConnected = false; // Dynamic\n    this.contactList = []; // Loaded from storage\n    this.socket = null; // Dynamic\n    this.qq = null; // Web\n    this.bot_qq = null; // Web\n    this.avatar = null; // Web\n    this.onPhone = null; // Dynamic\n    this.title = \"Mio\"; // Fixed\n    this.name = \"user\"; // Fixed\n    this.config = config; // Parameter\n\n    this.setLocalStorage = debounce(this.setLocalStorage.bind(this), 500); // 防抖时间设置为 1000 毫秒 (1 秒)\n  }\n\n  /**\n   * Prepare initialization\n   * @returns {object} Initialization information\n   */\n  async preInit() {\n    const localBaseInfo = this.config.getBaseConfig();\n    if (Object.keys(localBaseInfo).length === 0) {\n      await this.loadOriginBaseInfo();\n    } else {\n      this.loadOriginBaseInfo();\n      this.loadBaseInfo(localBaseInfo);\n    }\n\n    const localStorage = await this.getLocalStorage();\n    if (localStorage) {\n      this.loadLocalStorage(localStorage);\n    }\n\n    this.inited = true;\n    this.emit(\"loaded\");\n  }\n\n  genDefaultConctor(info) {\n    if (info.onebot_enabled) {\n      // Create default OneBot contactor\n      const onebotConfig = {\n        id: this.genFakeId(),\n        name: \"OneBot\",\n        namePolicy: 1,\n        avatarPolicy: 1,\n        avatar: `/p/qava?q=${this.bot_qq}`,\n        title: \"云崽\",\n        priority: 0,\n        options: {},\n        lastUpdate: -Infinity,\n      };\n      this.addConcator(\"onebot\", onebotConfig);\n    }\n\n    const options = this.config.getLLMDefaultConfig();\n    // const allTools = Object.values(this.config.llmTools).map((tool) => (\n    //   ...Object.keys(tool)\n    // ));\n    const allTools = [];\n    for (const key in this.config.llmTools) {\n      allTools.push(...Object.keys(this.config.llmTools[key]));\n    }\n    options.toolCallSettings.tools = allTools;\n\n    const LLMDefaultConfig = {\n      id: this.genFakeId(),\n      name: \"MioBot\",\n      avatar: \"/p/ava/miobot.png\",\n      namePolicy: 1,\n      avatarPolicy: 1,\n      title: \"chat\",\n      priority: 0,\n      lastUpdate: -Infinity,\n      options,\n    };\n\n    this.addConcator(\"openai\", LLMDefaultConfig);\n  }\n\n  async addConcator(platform, config) {\n    const bot = new Contactor(platform, config);\n    bot.loadName();\n    bot.loadAvatar();\n\n    const list = reactive(this.contactList);\n    list.push(bot);\n    await this.setLocalStorage();\n    return bot;\n  }\n\n  rmContactor(id) {\n    const list = reactive(this.contactList);\n    const index = list.findIndex((item) => item.id == id);\n\n    if (index != -1) {\n      list.splice(index, 1);\n      this.setLocalStorage();\n    }\n  }\n\n  async loadOriginalContactors(shareId) {\n    const path = `/api/share?id=${shareId}`;\n    let contactor = null;\n    try {\n      const res = await fetch(path);\n      const data = await res.json();\n      if (data.code == 0) {\n        contactor = data.data.contactor;\n        // 检查是否已经存在\n        if (!this.getContactor(contactor.id)) {\n          this.addConcator(contactor.platform, contactor);\n        }\n        return true;\n      } else {\n        console.error(\"Failed to load original contactors:\", data.message);\n        return false;\n      }\n    } catch (error) {\n      console.error(\"Failed to load original contactors:\", error);\n      return false;\n    }\n  }\n\n  async shareContactor(id) {\n    const uploadResult = await this.setOriginalContactor(id);\n    if (uploadResult) {\n      const { previewImage, shareUrl } = uploadResult;\n      console.log(shareUrl);\n      console.log(previewImage);\n      // 拼接完整链接\n      const originalUrl = document.location.origin;\n      // 复制链接到剪贴板\n      const clipboard = navigator.clipboard;\n      if (clipboard) {\n        clipboard.writeText(originalUrl + shareUrl);\n      }\n      return uploadResult;\n    } else {\n      return null;\n    }\n  }\n\n  async setOriginalContactor(id) {\n    const path = `/api/share/set`;\n    const body = {\n      contactor: this.getContactor(id),\n    };\n    try {\n      const res = await fetch(path, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(body),\n      });\n      const data = await res.json();\n      if (data.code == 0) {\n        return data.data;\n      }\n    } catch (error) {\n      console.error(\"Failed to set original contactor:\", error);\n      return null;\n    }\n  }\n\n  async reset() {\n    localforage.clear();\n    localStorage.clear();\n    try {\n      await this.resetCache();\n    } catch (error) {\n      console.error(\"Failed to reset cache:\", error);\n    }\n    return true;\n  }\n\n  async resetCache() {\n    try {\n      // 2. Send a message to the active Service Worker to clear its cache\n      if (navigator.serviceWorker.controller) {\n        console.log(\n          \"Sending message to active Service Worker to clear cache...\",\n        );\n        await new Promise((resolve, reject) => {\n          const messageChannel = new MessageChannel();\n          messageChannel.port1.onmessage = (event) => {\n            if (event.data.type === \"IDB_CACHE_CLEARED\") {\n              console.log(\"Service Worker cache cleared successfully.\");\n              resolve();\n            } else if (event.data.type === \"IDB_CACHE_CLEAR_FAILED\") {\n              console.error(\n                \"Service Worker cache clear failed:\",\n                event.data.error,\n              );\n              reject(event.data.error);\n            } else {\n              reject(new Error(\"Unknown message from Service Worker\"));\n            }\n          };\n          messageChannel.port1.onerror = (error) => {\n            console.error(\"Message port error:\", error);\n            reject(error);\n          };\n          navigator.serviceWorker.controller.postMessage(\n            { type: \"CLEAR_IDB_CACHE\" },\n            [messageChannel.port2],\n          );\n        });\n      } else {\n        console.log(\n          \"No active Service Worker found. Skipping cache clear message.\",\n        );\n      }\n\n      // 1. Unregister all service workers\n      const registrations = await navigator.serviceWorker.getRegistrations();\n      if (registrations && registrations.length > 0) {\n        console.log(\n          `Found ${registrations.length} registered Service Workers, unregistering...`,\n        );\n        for (const registration of registrations) {\n          // Use a for...of loop for cleaner async/await\n          try {\n            const unregistered = await registration.unregister();\n            if (unregistered) {\n              console.log(\n                `Service Worker ${registration.scope} unregistered successfully`,\n              );\n            } else {\n              console.warn(\n                `Service Worker ${registration.scope} unregistration failed`,\n              );\n            }\n          } catch (error) {\n            console.error(\n              `Failed to unregister Service Worker ${registration.scope}:`,\n              error,\n            );\n            // We don't reject here, to attempt to unregister other SWs. Log it, though.\n          }\n        }\n        console.log(\n          \"All Service Workers unregistration completed (with possible errors).\",\n        );\n      } else {\n        console.log(\"No registered Service Workers found.\");\n      }\n\n      return true; // Indicate success\n    } catch (error) {\n      console.error(\"Error during cache reset:\", error);\n      throw error; // Re-throw the error to be caught by the caller\n    }\n  }\n\n  everLogin() {\n    const stroge = localStorage.getItem(\"everLogin\");\n    if (stroge) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  setEverLogin() {\n    localStorage.setItem(\"everLogin\", true);\n  }\n\n  async init() {\n    await this.preInit();\n    if (this.everLogin()) {\n      console.log(\"Detected cache, attempting automatic reconnection\");\n      this.isConnected = false;\n      this.login(this.code);\n    } else {\n      console.log(\"Not logged in before, please login first\");\n    }\n  }\n\n  getContactors() {\n    return this.contactList;\n  }\n\n  getContactor(id, onebotId = null) {\n    if (onebotId) {\n      // TODO: 拓展 Onebot 协议功能，实现 IM\n      return this.contactList.find((item) => item.platform == \"onebot\");\n    } else {\n      return this.contactList.find((item) => item.id == id);\n    }\n  }\n\n  /**\n   * 生成一个保证唯一的10位纯数字ID\n   * 结合设备ID(this.id)、时间戳和随机数\n   * @returns {string} 10位纯数字ID\n   */\n  genFakeId() {\n    // 获取当前时间戳的后6位\n    const timestamp = Date.now().toString().slice(-6);\n    // 生成2位随机数\n    const randomNum = Math.floor(Math.random() * 100).toString().padStart(4, '1');\n\n    return randomNum + timestamp;\n  }\n\n  /**\n   * Get user information from localStorage\n   * @returns {object|false} User information or false if not found\n   */\n  async getLocalStorage() {\n    const client = await localforage.getItem(\"client\");\n    if (client) {\n      const localConfig = JSON.parse(client);\n      return localConfig;\n    } else {\n      // First-time user\n      this.id = this.genFakeId();\n      this.code = null;\n      return null;\n    }\n  }\n\n  /**\n   * Load user information from localStorage\n   * @param {object} client User information\n   */\n  loadLocalStorage(client) {\n    this.id = client.id;\n    this.code = client.code;\n\n    // If contact list exists, instantiate as contact objects\n    if (client.contactList && client.contactList.length != 0) {\n      this.contactList = client.contactList.map(\n        (item) => new Contactor(item.platform, item),\n      );\n    } else {\n      this.contactList = [];\n    }\n  }\n\n  /**\n   * Save user information to localStorage\n   */\n  async setLocalStorage() {\n    // await localforage.setItem(\"client\", JSON.stringify(this));\n    const client = {\n      id: this.id,\n      code: this.code,\n      contactList: this.contactList,\n    };\n    await localforage.setItem(\"client\", JSON.stringify(client));\n    console.log(\"Client saved\");\n  }\n\n  /**\n   * Login\n   * @param {string} code Access code\n   * @returns {Promise} Login result\n   */\n  async login(code) {\n    this.code = code;\n\n    return new Promise((resolve, reject) => {\n      const socket = new Socket(this.id, this.code);\n\n      socket.on(\"connect\", async (info) => {\n        console.log(\"Login successful\");\n        this.isConnected = true;\n        this.socket = socket;\n        this.config.setLlmModels(info.models);\n        this.addMsgListener();\n        if (this.contactList.length == 0) {\n          this.genDefaultConctor(info);\n        }\n        this.setEverLogin();\n        this.setLocalStorage();\n        resolve(info);\n      });\n\n      socket.on(\"connect_error\", (error) => {\n        console.log(\"Login failed\", error);\n        this.isConnected = false;\n        reject(error.message);\n      });\n\n      socket.connect();\n    });\n  }\n\n  addMsgListener() {\n    this.socket.on(\"onebot_message\", (e) => {\n      console.log(e);\n      const data = e.data;\n      const id = data.id;\n      const content = data.content;\n      const type = data.type;\n\n      if (type == \"message\") {\n        const contactor = this.getContactor(id, 10000);\n        if (contactor) {\n          contactor.revMessage(content);\n          this.setLocalStorage();\n        } else {\n          console.log(\"Contactor not found\");\n        }\n      } else if (type == \"del_msg\") {\n        const onebotContactors = this.contactList.filter(\n          (item) => item.platform == \"onebot\",\n        );\n        for (const onebotContactor of onebotContactors) {\n          const deleted = onebotContactor.delMessage(content.message_id);\n          if (deleted) {\n            this.setLocalStorage();\n            console.log(\"Message deleted successfully\");\n            break;\n          }\n        }\n      }\n    });\n\n    this.socket.on(\"llm_message\", (e) => {\n      const data = e.data;\n      const { metaData } = data;\n      if (metaData.contactorId) {\n        const contactor = this.getContactor(metaData.contactorId);\n        if (contactor) {\n          contactor.handleLLMMessageEvent(e);\n          // this.setLocalStorage();\n        }\n      }\n    });\n  }\n\n  /**\n   * Logout\n   */\n  async logout() {\n    this.isConnected = false;\n    this.socket.disconnect();\n    this.socket = null;\n    this.setLocalStorage();\n  }\n\n  /**\n   * Set base information\n   * @returns {Promise} Base information\n   */\n  async loadOriginBaseInfo() {\n    const res = await fetch(\"/api/base_info\");\n    const { data } = await res.json();\n    this.config.setBaseConfig(data);\n    this.loadBaseInfo(data);\n\n    return data;\n  }\n\n  loadBaseInfo(data) {\n    this.admin_qq = data.admin_qq;\n    this.bot_qq = data.bot_qq;\n\n    this.avatar = `/p/qava?q=${this.admin_qq}`;\n\n    const onebotContactor = this.getContactor(null, 10000);\n    if (onebotContactor) {\n      onebotContactor.avatar = `/p/qava?q=${this.bot_qq}`;\n    }\n  }\n\n  /**\n   * Upload file or image\n   * @param {File|Blob|string} fileOrImage - File object, Blob, or base64 string for images\n   * @param {Object} options - Upload options\n   * @param {boolean} options.isImage - Indicates if upload is an image\n   * @param {Function} options.onProgress - Progress callback (percent complete)\n   * @returns {Promise<Object>} Upload result\n   */\n  async uploadFile(fileOrImage, options = {}) {\n    const { isImage = false, onProgress = null } = options;\n\n    // Handle image upload (base64 string or blob)\n    if (\n      isImage ||\n      (typeof fileOrImage === \"string\" && fileOrImage.startsWith(\"data:\"))\n    ) {\n      return this.uploadImage(fileOrImage);\n    }\n\n    const file = fileOrImage;\n    return new Promise((resolve, reject) => {\n      const chunkSize = 1024 * 1024; // 1MB\n      let md5Hash = null;\n\n      const finalizeUpload = async (totalChunks) => {\n        try {\n          const response = await fetch(\"/api/upload/finalize\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              totalChunks,\n              md5: md5Hash,\n              filename: file.name,\n            }),\n          });\n\n          if (!response.ok) {\n            throw new Error(`HTTP error ${response.status}`);\n          }\n\n          const data = await response.json();\n          resolve(data);\n        } catch (error) {\n          reject({ error: `Finalization error: ${error.message}` });\n        }\n      };\n\n      const uploadChunk = async (chunk, index, totalChunks) => {\n        return new Promise((resolve, reject) => {\n          const formData = new FormData();\n          formData.append(\"file\", chunk);\n          formData.append(\"md5\", md5Hash);\n          formData.append(\"chunkIndex\", index);\n          formData.append(\"totalChunks\", totalChunks);\n          formData.append(\"filename\", file.name);\n\n          const xhr = new XMLHttpRequest();\n          xhr.open(\"POST\", \"/api/upload/chunk\", true);\n\n          // Track progress if callback provided\n          if (onProgress) {\n            xhr.upload.onprogress = (event) => {\n              if (event.lengthComputable) {\n                // Calculate overall progress based on chunks\n                const chunkProgress = event.loaded / event.total;\n                const overallProgress =\n                  (index / totalChunks + (1 / totalChunks) * chunkProgress) *\n                  100;\n                onProgress(Math.round(overallProgress));\n              }\n            };\n          }\n\n          xhr.onload = () => {\n            if (xhr.status >= 200 && xhr.status < 300) {\n              resolve(); // Successful upload\n            } else {\n              reject(xhr.statusText); // Failed upload\n            }\n          };\n\n          xhr.onerror = () => {\n            reject(\"Network Error\");\n          };\n\n          xhr.send(formData);\n        });\n      };\n\n      const uploadFileChunks = async () => {\n        if (!file || !md5Hash) {\n          return reject({ error: \"Invalid file or missing hash\" });\n        }\n\n        const totalChunks = Math.ceil(file.size / chunkSize);\n\n        try {\n          for (\n            let currentChunk = 0;\n            currentChunk < totalChunks;\n            currentChunk++\n          ) {\n            const start = currentChunk * chunkSize;\n            const end = Math.min(start + chunkSize, file.size);\n            const chunk = file.slice(start, end);\n\n            await uploadChunk(chunk, currentChunk, totalChunks);\n          }\n\n          // All chunks uploaded, finalize\n          await finalizeUpload(totalChunks);\n        } catch (error) {\n          reject({ error: `Upload error: ${error}` });\n        }\n      };\n\n      // Start worker to calculate MD5\n      const worker = new UploadWorker();\n      worker.postMessage({ file, chunkSize });\n\n      worker.onmessage = (e) => {\n        if (e.data.hash) {\n          md5Hash = e.data.hash;\n          console.log(\"MD5 calculated. Starting upload...\");\n          uploadFileChunks();\n        } else if (e.data.error) {\n          reject({ error: e.data.error });\n          worker.terminate();\n        }\n      };\n\n      worker.onerror = (error) => {\n        console.error(\"Worker error:\", error);\n        reject({ error: `Worker error: ${error.message}` });\n        worker.terminate();\n      };\n    });\n  }\n\n  /**\n   * Upload image (now integrated into uploadFile)\n   * @param {string|Blob} image - Base64 string or Blob\n   * @returns {Promise<Object>} Upload result\n   */\n  async uploadImage(formData) {\n    try {\n      const response = await fetch(\"/api/upload/image\", {\n        method: \"POST\",\n        body: formData,\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error(\"Error uploading image:\", error);\n      throw error; // Re-throw to be handled by caller\n    }\n  }\n\n  /**\n   * Convert Blob to base64 string\n   * @param {Blob} blob - Image blob\n   * @returns {Promise<string>} Base64 string\n   */\n  async _convertBlobToBase64(blob) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onloadend = () => resolve(reader.result);\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n}\n","// =============================================================\n// 常量定义\n// =============================================================\n\n// 工具调用模式\nconst TOOL_CALL_MODEDS = {\n  AUTO: \"AUTO\", // 自动模式，由模型决定是否调用工具\n  ANY: \"ANY\", // 任意模式，强制模型必须调用一个或多个工具\n  NONE: \"NONE\", // 无模式，强制模型不调用任何工具\n};\n\n// Gemini 安全设置 - 阻止阈值\nconst GEMINI_SAFETY_BLOCK_SETTINGS = {\n  NONE: \"BLOCK_NONE\", // 不阻止\n  LOW: \"BLOCK_ONLY_HIGH\", // 仅阻止高可能性内容\n  MEDIUM: \"BLOCK_MEDIUM_AND_ABOVE\", // 阻止中等及以上可能性内容\n  HIGH: \"BLOCK_LOW_AND_ABOVE\", // 阻止低等及以上可能性内容 (最严格)\n  DEFAULT: \"BLOCK_NONE\", // 默认设置为不阻止\n};\n\n// Gemini 安全设置 - 危害类别\nconst GEMINI_SAFETY_SETTINGS_TYPE = {\n  HARASSMENT: \"HARM_CATEGORY_HARASSMENT\", // 骚扰\n  HATE_SPEECH: \"HARM_CATEGORY_HATE_SPEECH\", // 仇恨言论\n  SEXUALLY_EXPLICIT: \"HARM_CATEGORY_SEXUALLY_EXPLICIT\", // 色情内容\n  DANGEROUS_CONTENT: \"HARM_CATEGORY_DANGEROUS_CONTENT\", // 危险内容\n  // CIVIC_INTEGRITY: \"HARM_CATEGORY_CIVIC_INTEGRITY\", // 如果需要，可以取消注释\n};\n\n// localStorage 中存储配置的主键\nconst CONFIG_KEY = \"app_config_v1\"; // 建议使用带版本号的键名\n\n// =============================================================\n// Config 类定义\n// =============================================================\n\nexport default class Config {\n  constructor() {\n    // --- 初始化实例属性 ---\n    this.localPresets = []; // 本地预设列表\n    this.toolsConfig = {}; // 工具特定配置 (如果需要)\n    this.llmTools = []; // 从后端加载的可用 LLM 工具列表/结构\n    this.onebotConfig = null; // OneBot 相关配置\n    this.llmModels = {}; // 按 provider 分类的可用 LLM 模型列表 { provider: [{ group, owner, models }], ... }\n    this.safetyConfig = {}; // 当前的安全设置状态 (可能用于UI显示或其他直接访问)\n    this.baseConfig = {}; // 基础配置，如 API Keys, providers 列表等\n    this.LLMDefaultConfig = {}; // 核心：存储合并后的默认 LLM 配置，会包含用户设置\n    this.baseConfigCallback = null; // baseConfig 变更时的回调函数\n\n    // --- 初始化流程 ---\n    // 1. 尝试从 localStorage 加载现有配置\n    this._loadStrogeConfig();\n\n    // 2. 初始化/验证安全设置状态 (简化版)\n    this.initSafetyConfig();\n\n    // 3. 初始化 LLM 默认配置 (核心：合并逻辑)\n    this.initLLMDefaultConfig();\n\n    // 4. 异步加载外部数据 (如可用工具、OneBot 插件等)\n    //    添加了错误捕获，防止加载失败影响主流程\n    this.loadllmTools().catch((error) =>\n      console.error(\"加载 LLM 工具失败:\", error)\n    );\n    this.loadonebotConfig().catch((error) =>\n      console.error(\"加载 OneBot 配置失败:\", error)\n    );\n\n    // 5. 如果是首次运行 (未从 localStorage 加载到配置), 则保存初始配置\n    if (!this._getLocalStorage(CONFIG_KEY)) {\n      console.log(\"未找到本地存储配置，保存初始默认配置。\");\n      this._saveStrogeConfig();\n    }\n  }\n\n  // --- 内部辅助方法：LocalStorage 操作 ---\n\n  /**\n   * 统一设置 localStorage\n   * @param {string} key - 存储键名\n   * @param {any} data - 需要存储的数据\n   */\n  _setLocalStorage(key, data) {\n    try {\n      localStorage.setItem(key, JSON.stringify(data));\n    } catch (error) {\n      console.error(`保存到 localStorage 时出错 (Key: ${key}):`, error);\n      // 可以考虑添加更复杂的错误处理，例如提示用户存储空间不足\n    }\n  }\n\n  /**\n   * 统一获取 localStorage\n   * @param {string} key - 读取键名\n   * @returns {any | null} - 解析后的数据，如果不存在或解析失败则返回 null\n   */\n  _getLocalStorage(key) {\n    try {\n      const storedValue = localStorage.getItem(key);\n      if (storedValue === null || storedValue === undefined) {\n        return null;\n      }\n      return JSON.parse(storedValue);\n    } catch (error) {\n      console.error(`从 localStorage 读取或解析时出错 (Key: ${key}):`, error);\n      // 清除可能已损坏的数据\n      localStorage.removeItem(key);\n      return null;\n    }\n  }\n\n  // --- 内部辅助方法：集中保存和加载配置 ---\n\n  /**\n   * 将当前实例的所有配置状态保存到 localStorage\n   */\n  _saveStrogeConfig() {\n    const configToSave = {\n      localPresets: this.localPresets,\n      toolsConfig: this.toolsConfig,\n      llmTools: this.llmTools, // 注意：频繁保存从API获取的数据可能不是最佳实践，取决于更新频率\n      onebotConfig: this.onebotConfig,\n      llmModels: this.llmModels,\n      baseConfig: this.baseConfig,\n      safetyConfig: this.safetyConfig, // 保存当前的安全设置状态\n      LLMDefaultConfig: this.LLMDefaultConfig, // 保存包含用户设置的默认配置\n    };\n    this._setLocalStorage(CONFIG_KEY, configToSave);\n    console.log(\"配置已保存到 localStorage。\");\n  }\n\n  /**\n   * 从 localStorage 加载配置并应用到当前实例\n   */\n  _loadStrogeConfig() {\n    const loadedConfig = this._getLocalStorage(CONFIG_KEY);\n    if (loadedConfig) {\n      console.log(\"从 localStorage 加载配置:\", loadedConfig);\n      // 使用 nullish coalescing (??) 为缺失的属性提供默认值\n      this.localPresets = loadedConfig.localPresets ?? [];\n      this.toolsConfig = loadedConfig.toolsConfig ?? {};\n      this.llmTools = loadedConfig.llmTools ?? [];\n      this.onebotConfig = loadedConfig.onebotConfig ?? null;\n      this.llmModels = loadedConfig.llmModels ?? {};\n      this.baseConfig = loadedConfig.baseConfig ?? {};\n      this.safetyConfig = loadedConfig.safetyConfig ?? {}; // 加载保存的安全状态\n      this.LLMDefaultConfig = loadedConfig.LLMDefaultConfig ?? {}; // 加载保存的LLM配置\n    } else {\n      console.log(\"未在 localStorage 中找到配置，将使用初始默认值。\");\n      // 初始默认值在构造函数和初始化方法中设置\n    }\n  }\n\n  // --- 内部辅助方法：递归合并默认配置 ---\n  /**\n   * 递归地将默认属性合并到目标对象中，并删除目标对象中不存在于默认对象的属性。\n   * 仅当目标对象缺少某个键时，才会从默认对象添加该键及其值。\n   * 不会覆盖目标对象中已存在的属性值。\n   * 能正确处理嵌套对象。\n   * 会删除目标对象中存在但默认对象中不存在的属性。\n   * @param {object} target - 需要合并默认值的目标对象 (例如 this.LLMDefaultConfig)\n   * @param {object} defaults - 包含默认值的源对象\n   * @returns {object} - 修改后的目标对象\n   */\n  _mergeDefaultsRecursive(target, defaults) {\n    if (\n      !target ||\n      typeof target !== \"object\" ||\n      !defaults ||\n      typeof defaults !== \"object\"\n    ) {\n      console.warn(\"递归合并需要有效的 target 和 defaults 对象。\");\n      return target; // 如果输入无效，返回原始 target\n    }\n\n    // 第一步：删除目标对象中存在但默认对象中不存在的属性\n    for (const key in target) {\n      if (Object.prototype.hasOwnProperty.call(target, key)) {\n        // 如果默认对象中不存在该键，则删除\n        if (!(key in defaults)) {\n          delete target[key];\n        }\n      }\n    }\n\n    // 第二步：按照原逻辑合并默认值\n    for (const key in defaults) {\n      // 确保 key 是 defaults 自身的属性，而不是继承来的\n      if (Object.prototype.hasOwnProperty.call(defaults, key)) {\n        const defaultValue = defaults[key];\n        const targetValue = target[key];\n\n        // 情况 1: 目标对象中不存在该键\n        if (!(key in target)) {\n          if (\n            typeof defaultValue === \"object\" &&\n            defaultValue !== null &&\n            !Array.isArray(defaultValue)\n          ) {\n            // 如果默认值是对象，进行深拷贝（通过递归创建新对象）\n            target[key] = this._mergeDefaultsRecursive({}, defaultValue);\n          } else if (Array.isArray(defaultValue)) {\n            // 如果默认值是数组，进行浅拷贝\n            target[key] = [...defaultValue];\n          } else {\n            // 如果默认值是原始类型，直接赋值\n            target[key] = defaultValue;\n          }\n        }\n        // 情况 2: 目标对象中存在该键，并且两者都是普通对象\n        else if (\n          typeof defaultValue === \"object\" &&\n          defaultValue !== null &&\n          !Array.isArray(defaultValue) &&\n          typeof targetValue === \"object\" &&\n          targetValue !== null &&\n          !Array.isArray(targetValue)\n        ) {\n          // 递归进入下一层进行合并（包括删除不存在的属性）\n          this._mergeDefaultsRecursive(targetValue, defaultValue);\n        }\n        // 情况 3: 目标对象中存在该键，但类型不匹配或不是普通对象\n        // 则保留目标对象中的现有值，不进行任何操作\n      }\n    }\n\n    return target; // 返回修改后的 target 对象\n  }\n\n  // --- 初始化方法 ---\n\n  /**\n   * 初始化或验证 this.safetyConfig (当前安全设置状态)。\n   * 主要确保它是一个包含所有必需安全类别的对象。\n   */\n  initSafetyConfig() {\n    const requiredCategories = Object.values(GEMINI_SAFETY_SETTINGS_TYPE);\n    let configChanged = false;\n\n    // 确保 this.safetyConfig 是一个对象\n    if (!this.safetyConfig || typeof this.safetyConfig !== \"object\") {\n      console.log(\"safetyConfig 未加载或格式无效，创建新的空对象。\");\n      this.safetyConfig = {};\n      configChanged = true; // 需要初始化\n    }\n\n    // 检查是否缺少必需的类别，如果缺少则添加默认值\n    for (const category of requiredCategories) {\n      if (!(category in this.safetyConfig)) {\n        console.warn(`为 safetyConfig 补充缺失的类别: ${category}`);\n        this.safetyConfig[category] = GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT;\n        configChanged = true;\n      }\n      // 可选：检查值的有效性，如果需要更严格的控制\n      // else if (!Object.values(GEMINI_SAFETY_BLOCK_SETTINGS).includes(this.safetyConfig[category])) {\n      //    console.warn(`safetyConfig 中类别 ${category} 的值无效 (${this.safetyConfig[category]})，重置为默认值。`);\n      //    this.safetyConfig[category] = GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT;\n      //    configChanged = true;\n      // }\n    }\n\n    // 可选：移除无效的键 (如果 safetyConfig 可能包含非预期的键)\n    // for (const loadedKey in this.safetyConfig) {\n    //   if (!requiredCategories.includes(loadedKey)) {\n    //     console.warn(`从 safetyConfig 移除未知类别: ${loadedKey}`);\n    //     delete this.safetyConfig[loadedKey];\n    //     configChanged = true;\n    //   }\n    // }\n\n    if (configChanged) {\n      console.log(\"初始化或修正后的 safetyConfig:\", this.safetyConfig);\n      // 注意：这里通常不需要保存，因为 `_saveStrogeConfig` 会在适当的时候保存整个配置。\n    } else {\n      console.log(\"使用已加载或验证通过的 safetyConfig:\", this.safetyConfig);\n    }\n  }\n\n  /**\n   * 初始化 LLM 默认配置 (this.LLMDefaultConfig)。\n   * 定义完整的默认结构，然后使用 _mergeDefaultsRecursive 将其合并到\n   * this.LLMDefaultConfig 中，确保用户设置被保留。\n   */\n  initLLMDefaultConfig() {\n    // 1. 确定动态值 (provider 和 model)，尝试从 baseConfig 获取，否则使用后备值\n    const defaultProvider = this.baseConfig?.llm_providers?.[0] ?? \"openai\"; // 默认使用第一个 provider 或 openai\n    const defaultModel = this.getDefaultModel(defaultProvider) ?? \"gpt-4o-mini\"; // 该 provider 的默认模型或 gpt-4o-mini\n\n    // 2. 定义完整的默认配置结构 (包括固定的 safetySettings 默认值)\n    const defaultConfigStructure = {\n      provider: defaultProvider, // 动态确定\n      base: {\n        model: defaultModel, // 动态确定\n        max_messages_num: 10,\n        stream: true,\n      },\n      chatParams: {\n        temperature: 1,\n        top_p: 1,\n        frequency_penalty: 0,\n        presence_penalty: 0,\n        reasoning_effort: -1,\n      },\n      toolCallSettings: {\n        mode: TOOL_CALL_MODEDS.AUTO,\n        tools: [], // 默认无激活工具\n      },\n      presetSettings: {\n        opening: \"\",\n        history: [],\n      },\n      extraSettings: {\n        gemini: {\n          imageGeneration: false,\n          // Gemini 特定示例\n          internalTools: {\n            google_search: false,\n            code_execution: false,\n            url_context: false,\n          },\n          safetySettings: {\n            // 使用固定的默认安全设置结构\n            [GEMINI_SAFETY_SETTINGS_TYPE.HARASSMENT]:\n              GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT,\n            [GEMINI_SAFETY_SETTINGS_TYPE.HATE_SPEECH]:\n              GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT,\n            [GEMINI_SAFETY_SETTINGS_TYPE.SEXUALLY_EXPLICIT]:\n              GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT,\n            [GEMINI_SAFETY_SETTINGS_TYPE.DANGEROUS_CONTENT]:\n              GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT,\n            // 如果有其他类别，也在这里添加\n          },\n        },\n      },\n    };\n\n    // 3. 确保 this.LLMDefaultConfig 是一个对象\n    if (!this.LLMDefaultConfig || typeof this.LLMDefaultConfig !== \"object\") {\n      console.log(\n        \"LLMDefaultConfig 未加载或格式无效，创建新的空对象用于合并。\"\n      );\n      this.LLMDefaultConfig = {};\n    }\n\n    // 4. 递归合并默认值到 this.LLMDefaultConfig\n    //    这个操作会保留 this.LLMDefaultConfig 中已有的用户设置，只添加缺失的部分\n    console.log(\n      \"合并 LLM 默认配置（之前）:\",\n      JSON.stringify(this.LLMDefaultConfig)\n    );\n    this.LLMDefaultConfig = this._mergeDefaultsRecursive(\n      this.LLMDefaultConfig,\n      defaultConfigStructure\n    );\n    console.log(\n      \"合并 LLM 默认配置（之后）:\",\n      JSON.stringify(this.LLMDefaultConfig)\n    );\n\n    // 注意：合并操作后，this.LLMDefaultConfig 可能已更新，保存操作会在适当时机触发。\n  }\n\n  // --- 公开方法：获取和设置配置 ---\n\n  /** 获取基础配置对象 */\n  getBaseConfig() {\n    return this.baseConfig;\n  }\n\n  /**\n   * 设置基础配置对象，并执行相关副作用（更新LLM默认值、触发回调）。\n   * @param {object} config - 新的基础配置对象\n   */\n  setBaseConfig(config) {\n    this.baseConfig = { ...config }; // 创建浅拷贝\n    console.log(\"设置基础配置:\", this.baseConfig);\n\n    // 副作用 1: 更新 LLMDefaultConfig 中的 provider 和 model (如果 baseConfig 中有定义)\n    const { llm_providers = [], default_model = {} } = this.baseConfig;\n    if (llm_providers.length > 0) {\n      const newDefaultProvider = llm_providers[0]; // 假设使用第一个 provider 作为新的默认\n      this.updateLLMDefaultConfig(null, { provider: newDefaultProvider });\n      if (default_model[newDefaultProvider]) {\n        this.updateLLMDefaultConfig(\"base\", {\n          model: default_model[newDefaultProvider],\n        });\n      } else {\n        console.warn(\n          `基础配置中未找到 Provider \"${newDefaultProvider}\" 的默认模型。`\n        );\n        // 可以考虑设置一个通用的后备模型\n      }\n    } else {\n      console.warn(\"基础配置中未定义 LLM providers。\");\n      // 可能需要重置 provider 和 model?\n    }\n\n    // 保存更新后的配置 (包括 baseConfig 和可能更新的 LLMDefaultConfig)\n    this._saveStrogeConfig(); // setBaseConfig 后立即保存\n\n    // 副作用 2: 调用注册的回调函数\n    if (this.baseConfigCallback) {\n      try {\n        this.baseConfigCallback(this.baseConfig);\n      } catch (error) {\n        console.error(\"执行 baseConfig 回调函数时出错:\", error);\n      }\n    }\n  }\n\n  /**\n   * 注册一个当 baseConfig 改变时被调用的回调函数\n   * @param {function | null} callback - 回调函数或 null\n   */\n  setBaseConfigCallback(callback) {\n    this.baseConfigCallback = callback;\n  }\n\n  /**\n   * 更新基础配置的一部分。\n   * @param {object} patch - 包含要更新的键值对的对象\n   */\n  updateBaseConfig(patch) {\n    console.log(\"准备使用 patch 更新 baseConfig:\", patch);\n    const newBaseConfig = {\n      ...this.baseConfig,\n      ...patch,\n    };\n    // 调用 setBaseConfig 来应用更改并触发副作用\n    this.setBaseConfig(newBaseConfig);\n  }\n\n  /** 获取可用的 LLM Providers 列表 (用于 UI 选择) */\n  getLLMProviders() {\n    const providers = this.baseConfig?.llm_providers ?? [];\n    return providers.map((provider) => ({\n      value: provider,\n      label: provider, // 可以根据需要提供更友好的标签\n    }));\n  }\n\n  /** 获取指定 Provider 的默认模型名称 */\n  getDefaultModel(provider) {\n    return this.baseConfig?.default_model?.[provider];\n  }\n\n  /** 获取工具调用模式列表 (用于 UI 选择) */\n  getToolCallModes() {\n    return Object.entries(TOOL_CALL_MODEDS).map(([key, value]) => ({\n      value: value,\n      label: key, // 使用 key 作为标签通常更易读\n    }));\n  }\n\n  /** 获取所有已加载的 LLM 模型信息 */\n  getLlmModels(provider) {\n    if (!provider) {\n      return this.llmModels ?? {};\n    }\n    return this.llmModels?.[provider] ?? [];\n  }\n\n  /** 设置 LLM 模型信息 (通常在从 API 加载后调用) */\n  setLlmModels(models) {\n    this.llmModels = models;\n    console.log(\"设置 LLM 模型列表:\", this.llmModels);\n    this._saveStrogeConfig();\n  }\n\n  /** 获取基础配置中定义的默认模型映射 { provider: model } */\n  getDefaultLLMModel() {\n    return this.baseConfig?.default_model ?? {};\n  }\n\n  /** 检查指定模型是否在指定 Provider 的可用模型列表中 */\n  isModelAvailable(provider, model) {\n    const providerModels = this.llmModels?.[provider] ?? [];\n    return providerModels.some((modelGroup) =>\n      modelGroup.models.includes(model)\n    );\n  }\n\n  /** 根据模型名称查找其所有者 (owner) */\n  getModelOwner(model) {\n    for (const provider in this.llmModels) {\n      const providerModels = this.llmModels[provider] ?? [];\n      const group = providerModels.find((modelGroup) =>\n        modelGroup.models.includes(model)\n      );\n      if (group) return group.owner;\n    }\n    return undefined; // 或 null\n  }\n\n  /** 获取安全设置的可选参数 (用于 UI 选择) */\n  getSafetySettingsParams() {\n    // 返回格式 { NONE: \"BLOCK_NONE\", LOW: \"BLOCK_ONLY_HIGH\", ... }\n    return GEMINI_SAFETY_BLOCK_SETTINGS;\n  }\n\n  /** 获取当前的安全设置状态对象 */\n  getSafetyConfig() {\n    return this.safetyConfig;\n  }\n\n  /**\n   * 设置当前的安全设置状态，并同步更新 LLMDefaultConfig 中的对应部分。\n   * @param {object} newSafetyConfig - 新的安全设置对象\n   */\n  setSafetyConfig(newSafetyConfig) {\n    // 可以在这里添加验证逻辑，确保 newSafetyConfig 的格式和值有效\n    this.safetyConfig = { ...newSafetyConfig }; // 更新当前状态\n    console.log(\"设置当前 safetyConfig 状态:\", this.safetyConfig);\n\n    // 同步更新 LLMDefaultConfig 中的 safetySettings\n    // updateLLMDefaultConfig 会处理保存逻辑 (如果检测到变化)\n    this.updateLLMDefaultConfig(\"safetySettings\", { ...this.safetyConfig });\n  }\n\n  /**\n   * 更新 LLM 默认配置 (LLMDefaultConfig) 的一部分或顶层属性。\n   * @param {string | null} type - 要更新的顶层键名 (如 'base', 'chatParams')，如果为 null 则更新顶层属性。\n   * @param {object} patch - 包含要更新的键值对的对象。\n   */\n  updateLLMDefaultConfig(type, patch) {\n    let configChanged = false;\n\n    if (\n      type &&\n      this.LLMDefaultConfig[type] &&\n      typeof this.LLMDefaultConfig[type] === \"object\"\n    ) {\n      // 更新指定类型的嵌套对象\n      const originalSubConfigString = JSON.stringify(\n        this.LLMDefaultConfig[type]\n      );\n      this.LLMDefaultConfig[type] = {\n        ...this.LLMDefaultConfig[type],\n        ...patch,\n      };\n      // 检查子对象是否有实际变化\n      if (\n        JSON.stringify(this.LLMDefaultConfig[type]) !== originalSubConfigString\n      ) {\n        configChanged = true;\n      }\n    } else if (!type) {\n      // 更新顶层属性\n      const originalTopLevelConfig = { ...this.LLMDefaultConfig };\n      this.LLMDefaultConfig = {\n        ...this.LLMDefaultConfig,\n        ...patch,\n      };\n      // 检查顶层是否有变化 (简单比较)\n      if (\n        JSON.stringify(originalTopLevelConfig) !==\n        JSON.stringify(this.LLMDefaultConfig)\n      ) {\n        configChanged = true;\n      }\n    } else {\n      console.warn(\n        `无法更新 LLMDefaultConfig: 类型 \"${type}\" 不存在或不是对象。`\n      );\n      return; // 没有做任何更改\n    }\n\n    if (configChanged) {\n      console.log(\n        `更新 LLMDefaultConfig${type ? `[${type}]` : \"\"} 使用 patch:`,\n        patch\n      );\n      // 只有在检测到实际变化时才保存\n      this._saveStrogeConfig();\n    } else {\n      console.log(`LLMDefaultConfig 更新被跳过，patch 未引起变化:`, patch);\n    }\n  }\n\n  /**\n   * 获取 LLM 默认配置。可以指定 provider 来获取针对该 provider 调整后的配置副本。\n   * @param {string} [provider] - 可选。如果提供，会尝试将返回的配置副本调整为使用此 provider 及其默认模型。\n   * @returns {object} - LLM 配置的深拷贝副本。\n   */\n  getLLMDefaultConfig(provider) {\n    // 创建深拷贝，防止外部修改影响原始配置\n    if (!this.LLMDefaultConfig || typeof this.LLMDefaultConfig !== \"object\") {\n      console.error(\"LLMDefaultConfig 不是有效对象，无法获取。\");\n      return {}; // 返回空对象或抛出错误\n    }\n    let copiedConfig;\n    try {\n      copiedConfig = JSON.parse(JSON.stringify(this.LLMDefaultConfig));\n    } catch (e) {\n      console.error(\"深拷贝 LLMDefaultConfig 失败:\", e);\n      return {}; // 返回空对象或进行错误处理\n    }\n\n    // 如果请求了特定 provider 且与当前默认 provider 不同\n    if (provider && provider !== copiedConfig.provider) {\n      const defaultModelForProvider = this.getDefaultModel(provider);\n      if (defaultModelForProvider) {\n        console.log(\n          `为 Provider \"${provider}\" 调整 LLM 配置副本 (模型: ${defaultModelForProvider})。`\n        );\n        copiedConfig.provider = provider;\n        copiedConfig.base.model = defaultModelForProvider;\n      } else {\n        console.warn(\n          `请求了 Provider \"${provider}\"，但在 baseConfig 中未找到其默认模型。返回的配置将使用原始 Provider 和模型。`\n        );\n        // 保持 copiedConfig 不变或进行其他处理\n      }\n    }\n    return copiedConfig;\n  }\n\n  // --- 公开方法：工具验证 ---\n\n  /**\n   * 获取在当前可用工具列表 (this.llmTools) 中有效的工具名称。\n   * @param {string[]} selectedToolNames - 用户选择或配置中指定的工具名称列表。\n   * @returns {string[]} - 只包含有效的、实际可用的工具名称列表。\n   */\n  getValidTools(selectedToolNames) {\n    if (!selectedToolNames || !Array.isArray(selectedToolNames)) {\n      return [];\n    }\n\n    const availableToolNames = new Set();\n\n    if (typeof this.llmTools === \"object\" && this.llmTools !== null) {\n      Object.values(this.llmTools).forEach((pluginTools) => {\n        // 如果是对象 {plugin: toolsObj}\n        if (pluginTools && typeof pluginTools === \"object\") {\n          Object.keys(pluginTools).forEach(\n            (toolName) => availableToolNames.add(toolName) // 只取工具名部分\n          );\n        }\n      });\n    }\n    \n    const validToolNames = selectedToolNames.filter(toolName =>{\n      return availableToolNames.has(toolName);\n    })\n\n    if (validToolNames.length < selectedToolNames.length) {\n      const invalidTools = selectedToolNames.filter(\n        (toolName) => !availableToolNames.has(toolName)\n      );\n      console.warn(\"配置中指定的以下工具当前不可用或未加载:\", invalidTools);\n    }\n\n    return validToolNames;\n  }\n\n  /**\n   * 获取一个经过验证的 LLM 配置对象副本。\n   * 主要验证其中的工具列表是否有效。\n   * @param {object} config - 原始的 LLM 配置对象。\n   * @returns {object} - 经过验证和清理的配置对象深拷贝副本。\n   */\n  getVerifiedLLMConfig(config) {\n    if (!config || typeof config !== \"object\") {\n      console.warn(\"getVerifiedLLMConfig 接收到的输入无效，按原样返回。\");\n      return config;\n    }\n\n    // 创建深拷贝以避免修改原始对象\n    let verifiedConfig = JSON.parse(JSON.stringify(config));\n\n    this._mergeDefaultsRecursive(verifiedConfig, this.LLMDefaultConfig);\n\n    // 验证工具列表\n    if (\n      verifiedConfig.toolCallSettings &&\n      Array.isArray(verifiedConfig.toolCallSettings.tools)\n    ) {\n       verifiedConfig.toolCallSettings.tools = this.getValidTools(\n         verifiedConfig.toolCallSettings.tools\n       );\n    } else if (verifiedConfig.toolCallSettings) {\n      // 如果 toolCallSettings 存在但 tools 不存在或不是数组，则设置为空数组\n      verifiedConfig.toolCallSettings.tools = [];\n    }\n\n    return verifiedConfig;\n  }\n\n  // --- 公开方法：异步加载外部数据 ---\n\n  /**\n   * 从后端 API 加载可用的 LLM 工具列表。\n   */\n  async loadllmTools() {\n    try {\n      const response = await fetch(\"/api/openai/tools\");\n      if (!response.ok) {\n        throw new Error(\n          `请求 LLM 工具失败: ${response.status} ${response.statusText}`\n        );\n      }\n      const data = await response.json();\n\n      // 假设 API 返回的数据结构是 { data: { tools: ... } }\n      if (data && data.data && data.data.tools) {\n        this.llmTools = data.data.tools;\n        console.log(\"LLM 工具已加载:\", this.llmTools);\n        // 考虑是否需要在加载后立即保存。如果工具列表不常变动，可能不需要。\n        // this._saveStrogeConfig();\n      } else {\n        console.warn(\"从 API 收到的 LLM 工具数据格式不符合预期:\", data);\n        this.llmTools = []; // 或保持旧数据？\n      }\n    } catch (error) {\n      console.error(\"加载 LLM 工具时发生网络或解析错误:\", error);\n      // 可以考虑加载失败时的回退逻辑，比如使用缓存的旧列表\n      // this.llmTools = this._getLocalStorage('cached_llm_tools') ?? [];\n    }\n  }\n\n  /**\n   * 从后端 API 加载 OneBot 相关配置。\n   */\n  async loadonebotConfig() {\n    try {\n      const response = await fetch(`/api/onebot/plugins`); // 示例端点\n      if (!response.ok) {\n        throw new Error(\n          `请求 OneBot 配置失败: ${response.status} ${response.statusText}`\n        );\n      }\n      const data = await response.json();\n\n      // 假设 API 返回的数据结构是 { data: { options: ... } }\n      if (data && data.data && data.data.options) {\n        this.onebotConfig = data.data.options;\n        console.log(\"OneBot 配置已加载:\", this.onebotConfig);\n        // 加载后立即保存\n        this._saveStrogeConfig();\n      } else {\n        console.warn(\"从 API 收到的 OneBot 配置数据格式不符合预期:\", data);\n        this.onebotConfig = null; // 或保持旧数据？\n      }\n    } catch (error) {\n      console.error(\"加载 OneBot 配置时发生网络或解析错误:\", error);\n      // 可以考虑加载失败时的回退逻辑\n    }\n  }\n}\n","/**\n * @author Mio-FCIP <1099834705@qq.com>\n * @lastEditor 彭志勇 <2457305628@qq.com>\n * @lastEditTime 2024-04-25 06:25:30\n */\n\nimport Client from \"./client.js\";\nimport Config from \"./config.js\";\n\nconst config = new Config();\nconst client = new Client(config);\n\nclient.init();\n\nexport { config, client };\n","<script>\nimport { client } from \"@/lib/runtime.js\";\n\nconst PageStatus = {\n  CHAT: \"chat\",\n  PROFILE: \"profile\",\n  SETTINGS: \"settings\",\n  NONE: \"none\",\n};\nexport default {\n  data() {\n    return {\n      processedImage: \"/p/qava?q=1099834705\",\n      activePage: PageStatus.NONE,\n    };\n  },\n  computed: {\n    isChatActive() {\n      return this.activePage === PageStatus.CHAT;\n    },\n    isProfileActive() {\n      return this.activePage === PageStatus.PROFILE;\n    },\n  },\n  watch: {\n    $route: {\n      handler(newRoute) {\n        this.activePage = this.getPageStatusFromRoute(newRoute);\n      },\n      immediate: true,\n    },\n  },\n  mounted() {\n    this.activePage = this.getPageStatusFromRoute();\n    const adminId = client.admin_qq;\n    if (adminId) {\n      this.loadAvatar(adminId);\n    } else {\n      client.on(\n        \"loaded\",\n        () => {\n          const adminId = client.admin_qq;\n          this.loadAvatar(adminId);\n        },\n        false,\n      );\n    }\n  },\n  methods: {\n    async processImage(imageUrl) {\n      return new Promise((resolve, reject) => {\n        const canvas = document.createElement(\"canvas\");\n        const ctx = canvas.getContext(\"2d\");\n        const img = new Image();\n        img.src = imageUrl;\n        img.onload = () => {\n          canvas.width = img.width;\n          canvas.height = img.height;\n          // 绘制原始图片\n          ctx.drawImage(img, 0, 0);\n          // 创建透明的缺口\n          let centerX = img.width * 0.8; // 圆心X坐标\n          let centerY = img.height * 0.86; // 圆心Y坐标\n          let radius = (5 / 24) * img.width; // 圆的半径\n          ctx.beginPath();\n          ctx.arc(centerX, centerY, radius, 0, Math.PI * 2, true);\n          ctx.clip();\n          ctx.clearRect(0, 0, img.width, img.height);\n          // 将处理后的图片转换为base64\n          canvas.toBlob((blob) => {\n            const url = URL.createObjectURL(blob);\n            resolve(url);\n          }, \"image/png\");\n        };\n        img.onerror = (error) => {\n          reject(error);\n        };\n      });\n    },\n    async toChat() {\n      this.activePage = PageStatus.CHAT;\n      this.$router.push({ name: \"blank\" });\n    },\n    async toProfile() {\n      this.activePage = PageStatus.PROFILE;\n      this.$router.push({ name: \"contactors\" });\n    },\n    async toConfig() {\n      this.activePage = PageStatus.SETTINGS;\n      this.$router.push({ name: \"settings\" });\n    },\n    async loadAvatar(adminId) {\n      const adminAvatar = `/p/qava?q=${adminId}`;\n      try {\n        this.processedImage = await this.processImage(adminAvatar);\n      } catch (error) {\n        console.error(\"Error loading avatar:\", error);\n      }\n    },\n    getPageStatusFromRoute(route = this.$route) {\n      if (route.path === \"/\" || route.path.includes(\"/chat/\")) {\n        return PageStatus.CHAT;\n      } else if (\n        route.path === \"/contactors\" ||\n        route.path.includes(\"/profile/\")\n      ) {\n        return PageStatus.PROFILE;\n      } else if (route.path === \"/settings\") {\n        return PageStatus.SETTINGS;\n      }\n      return PageStatus.NONE;\n    },\n  },\n};\n</script>\n<template>\n  <div id=\"sidebar\">\n    <div class=\"admin-avatar\">\n      <div class=\"status\"></div>\n      <img :src=\"processedImage\" alt=\"admin-avatar\" />\n    </div>\n    <div id=\"side\" class=\"options\">\n      <div class=\"up-half\">\n        <div class=\"icon-back\" :class=\"{ active: isChatActive }\">\n          <div id=\"chatting\" @click=\"toChat\">\n            <i class=\"iconfont chat\"></i>\n          </div>\n        </div>\n        <div class=\"icon-back\" :class=\"{ active: isProfileActive }\">\n          <div id=\"editing\" @click=\"toProfile\">\n            <i class=\"iconfont user\"></i>\n          </div>\n        </div>\n      </div>\n      <div class=\"down-half\">\n        <a\n          href=\"https://github.com/Pretend-to/mio-chat-backend\"\n          target=\"_blank\"\n          class=\"side-icon\"\n        >\n          <i class=\"iconfont github\"></i>\n        </a>\n        <div class=\"side-icon\" @click=\"toConfig\">\n          <i class=\"iconfont menu\"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<style scoped>\n#sidebar {\n  display: flex;\n  flex-basis: 3.8rem;\n  flex-direction: column;\n  background-color: hsla(0, 0%, 100%, 0.8);\n  backdrop-filter: blur(10px);\n  -webkit-app-region: drag;\n}\n.options {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n  /* margin: 1.2rem 1.2rem; */\n}\n\n.logo img {\n  width: 2.5rem;\n}\n.up-half,\n.down-half {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  flex-basis: 8rem;\n  justify-content: center;\n}\n.icon-back {\n  height: 2.5rem;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: 0.5rem 0rem;\n  border-radius: 0.5rem;\n}\n.icon-back.active {\n  padding: 0 0.5rem;\n  background-color: rgba(113, 113, 113, 0.1);\n}\n\n.icon-back i,\n.down-half i {\n  margin: 0.5rem 0rem;\n  width: 1.8rem;\n  height: 1.8rem;\n  font-size: 1.6rem;\n  color: black;\n}\n.admin-avatar {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-top: 1rem;\n  height: 4.5rem;\n  position: relative;\n  z-index: 10;\n}\n.admin-avatar img {\n  border-radius: 50%;\n  width: 60%;\n}\n.status {\n  position: absolute;\n  left: 68%;\n  top: 71%;\n  transform: translate(-50%, -50%);\n  width: 0.7rem;\n  height: 0.7rem;\n  border-radius: 50%;\n  background: linear-gradient(to bottom, rgb(52, 238, 143), rgb(54, 221, 150));\n}\n.side-icon {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.icon-back.active i {\n  color: #007bff;\n}\n\n@media screen and (max-width: 600px) {\n  .options {\n    justify-content: space-evenly;\n  }\n  #sidebar {\n    width: 100%;\n    flex-direction: row;\n    flex-basis: 4rem;\n    background-color: #f5f4f9;\n  }\n  .admin-avatar {\n    display: none;\n  }\n  .options {\n    flex-direction: row;\n    width: 100%;\n  }\n  .up-half,\n  .down-half {\n    flex-basis: 50%;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-around;\n    align-items: center;\n  }\n  .icon-back.active {\n    background-color: transparent;\n  }\n}\n</style>\n","<template>\n  <ul\n    :class=\"{\n      'window-controls': true,\n      fullscreen: fullScreen,\n      preview: preview,\n    }\"\n    data-tauri-drag-region=\"true\"\n  >\n    <li class=\"button\" data-tauri-drag-region @click=\"minimizeWindow\">\n      <span class=\"window-min\">—</span>\n    </li>\n    <li\n      v-if=\"fullScreen\"\n      class=\"button\"\n      data-tauri-drag-region\n      @click=\"configFullScreen(false)\"\n    >\n      <span class=\"window-inmax\">\n        <i class=\"iconfont chuangkouhua\"></i>\n      </span>\n    </li>\n    <li\n      v-else\n      class=\"button\"\n      data-tauri-drag-region\n      @click=\"configFullScreen(true)\"\n    >\n      <span class=\"window-max\">▢</span>\n    </li>\n    <li id=\"close\" class=\"button\" data-tauri-drag-region @click=\"closeWindow\">\n      <span class=\"window-close\">&times;</span>\n    </li>\n  </ul>\n</template>\n\n<script>\nimport { Window } from \"@tauri-apps/api/window\";\n\nlet mainWindow = null;\n\nexport default {\n  props: {\n    fullScreen: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\"set-screen\",\"close\"],\n  data() {\n    return {\n      preview: false,\n      isTauri: !!(window.__TAURI__ || window.__TAURI_INTERNALS__), // 检查是否存在任一对象\n    };\n  },\n  created() {\n    const urlParams = new URLSearchParams(window.location.search);\n    const preview = urlParams.get(\"preview\");\n    if (preview === \"true\") {\n      this.preview = true;\n    }\n    if (this.isTauri) {\n      mainWindow = new Window(\"main\");\n    }\n  },\n  methods: {\n    waiting() {\n      if (this.$message) {\n        this.$message({ message: \"此功能尚未开放\", type: \"warning\" });\n      } else {\n        console.warn(\"此功能尚未开放 (Tauri 环境外)\");\n        alert(\"此功能尚未开放\");\n      }\n    },\n\n    async getMainWindow() {\n      try {\n        if (!mainWindow) {\n          console.error(\"Failed to get main window.\");\n          return null;\n        }\n        return mainWindow;\n      } catch (error) {\n        console.error(\"Error getting main window:\", error);\n        return null;\n      }\n    },\n\n    async minimizeWindow() {\n      if (this.isTauri) {\n        if (mainWindow) {\n          try {\n            await mainWindow.minimize();\n          } catch (e) {\n            console.error(\"Failed to minimize window:\", e);\n            this.waiting(); // 最小化失败则提示\n          }\n        } else {\n          this.waiting(); // 获取 mainWindow 失败则提示\n        }\n      } else {\n        // this.waiting(); // Web 环境\n        this.$emit(\"close\");\n      }\n    },\n\n    configFullScreen(fullScreen) {\n      if (this.isTauri) {\n        (async () => {\n          if (mainWindow) {\n            try {\n              if (fullScreen) {\n                await mainWindow.maximize();\n              } else {\n                await mainWindow.unmaximize();\n              }\n              this.$emit(\"set-screen\", fullScreen); // Tauri 环境也 emit 事件，和 web 一致\n            } catch (e) {\n              console.error(\"Failed to toggle maximize:\", e);\n              this.waiting(); // Tauri 出错也 waiting\n            }\n          } else {\n            this.waiting(); // 获取 mainWindow 失败则提示\n          }\n        })();\n      } else {\n        this.$emit(\"set-screen\", fullScreen); // Web 环境使用原有的 emit 逻辑\n      }\n    },\n\n    async closeWindow() {\n      if (this.isTauri) {\n        if (mainWindow) {\n          try {\n            await mainWindow.close();\n          } catch (e) {\n            console.error(\"Failed to close window:\", e);\n            this.waiting(); // 关闭失败则提示\n          }\n        } else {\n          this.waiting(); // 获取 mainWindow 失败则提示\n        }\n      } else {\n        // this.waiting(); // Web 环境\n        this.$emit(\"close\");\n      }\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"sass\">\n.window-controls\n    position: absolute\n    display: flex\n    height: 30px\n    z-index: 1000\n    right: 0\n    top: 0\n    background-color: transparent\n    -webkit-app-region: drag\n\n    &.preview\n        display: none\n\n    .button\n        display: flex\n        justify-content: center\n        align-items: center\n        width: 45px\n        height: 100%\n        padding: 0\n        border: none\n        background-color: transparent\n        cursor: pointer\n        color: #333\n        font-size: 16px\n        outline: none\n        -webkit-app-region: no-drag\n\n        span\n          display: flex\n          align-items: center\n          justify-content: center\n          line-height: 1\n\n        .window-min\n            font-weight: bold\n            position: relative\n            top: -2px\n\n        .window-max\n            font-size: 14px\n            font-weight: bold\n\n        .window-inmax\n            i.iconfont\n              font-size: 14px\n\n        .window-close\n            font-weight: bold\n            font-size: 20px\n            position: relative\n            top: -1px\n\n        &:hover\n            background-color: rgba(0, 0, 0, 0.1)\n\n        &#close:hover\n            background-color: #e81123\n            color: white\n</style>\n","<template>\n  <div\n    id=\"forward-msg-preview\"\n    :class=\"onPhone ? 'on-phone' : ''\"\n    @click=\"showBox = true\"\n  >\n    <div id=\"forward-msg-head\">转发的聊天消息</div>\n    <div id=\"forward-msg-body\">\n      <div\n        v-for=\"(message, index) in messages.slice(0, 2)\"\n        id=\"forward-msg-summary\"\n        :key=\"index\"\n      >\n        {{ contactor.name }}: {{ contactor.getLastMessageSummary(message) }}\n      </div>\n    </div>\n    <div id=\"forward-msg-foot\">查看{{ messages.length }}条转发消息</div>\n  </div>\n  <div v-if=\"showBox\" id=\"forward-msg-box\" :class=\"onPhone ? 'on-phone' : ''\">\n    <div class=\"forward-msg-head\">\n      <div class=\"forward-msg-title\">转发的聊天消息</div>\n      <displayButtons class=\"cfg-btns\" @close=\"showBox = false\" />\n      <!-- <span class=\"close\" @click=\"showBox = false\">&times;</span> -->\n    </div>\n    <div class=\"body\">\n      <div\n        v-for=\"(message, index) of messages\"\n        :key=\"index\"\n        class=\"message-container\"\n      >\n        <div v-if=\"message.type === 'node'\" id=\"other\" class=\"message-body\">\n          <div class=\"avatar\">\n            <img :src=\"`/p/qava/?q=${message.data.uin}`\" :alt=\"message.data.name\" />\n          </div>\n          <div class=\"msg\">\n            <div class=\"wholename\">\n              <div class=\"title\">{{ contactor.title }}</div>\n              <div class=\"name\">{{ message.data.name }}</div>\n            </div>\n            <div\n              v-for=\"(elm,index) of message.data.content\" \n              :key=\"index\"\n              class=\"content\"\n            >\n              <div>\n                <MdRenderer\n                  v-if=\"elm.type === 'text'\"\n                  :md=\"elm.data.text\"\n                  :theme=\"'github'\"\n                />\n                <el-image\n                  v-else-if=\"elm.type === 'image'\"\n                  :key=\"index\"\n                  style=\"margin: 8px 0; max-width: 20rem; border-radius: 1rem\"\n                  :src=\"elm.data.file\"\n                  :zoom-rate=\"1.2\"\n                  :preview-teleported=\"true\"\n                  :max-scale=\"7\"\n                  :min-scale=\"0.2\"\n                  :preview-src-list=\"[elm.data.file]\"\n                  :initial-index=\"4\"\n                  fit=\"cover\"\n                />\n                <ForwardMsg\n                  v-else-if=\"elm.type === 'nodes'\"\n                  :contactor=\"activeContactor\"\n                  :messages=\"elm.data.messages\"\n                />\n                <MdRenderer\n                  v-else\n                  :md=\"`尚未支持的消息类型：${elm.type}`\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport MdRenderer from \"mio-previewer\";\nimport { client } from \"@/lib/runtime.js\";\nimport displayButtons from \"@/components/DisplayButtons.vue\";\n\nexport default {\n  name: \"ForwardMsg\",\n  components: {\n    MdRenderer,\n    displayButtons,\n  },\n  props: {\n    messages: {\n      type: Array,\n      default: () => [], // 对于数组，使用函数返回一个新的空数组\n    },\n    contactor: {\n      type: Object,\n      default: () => {}, // 对于字符串，使用空字符串\n    },\n  },\n  data() {\n    return {\n      showBox: false,\n      onPhone: false,\n    };\n  },\n  created() {\n    this.onPhone = window.innerWidth < 600;\n\n    client.on(\n      \"device-change\",\n      (type) => {\n        if (type == \"mobile\") {\n          this.onPhone = true;\n        } else {\n          this.onPhone = false;\n        }\n      },\n      false,\n    );\n  },\n};\n</script>\n\n<style scoped>\n#forward-msg-preview {\n  width: 15rem;\n  display: flex;\n  flex-direction: column;\n  padding: 0.2rem 0.5rem;\n}\n\n#forward-msg-preview.on-phone {\n  transform: translateX(-0.35rem);\n}\n\n#forward-msg-body {\n  margin: 0.5rem 0;\n  width: 100%;\n  text-overflow: ellipsis;\n}\n\n#forward-msg-summary {\n  width: 100%;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  overflow: hidden;\n  font-size: 0.8rem;\n  font-weight: 300;\n}\n\n#forward-msg-foot {\n  border-top: 1px solid #ccc;\n  padding-top: 0.2rem;\n  width: 100%;\n  font-size: 0.7rem;\n  color: rgb(150, 150, 150);\n}\n\n.cfg-btns {\n  transform: scale(0.8);\n  transform-origin: top right;\n}\n\n#forward-msg-box {\n  border: 1px solid rgb(199, 199, 199);\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 24rem;\n  height: 30rem;\n  z-index: 9999;\n  background-color: rgb(241, 241, 241);\n  border-radius: 0.25rem;\n  overflow: hidden;\n  box-shadow: 0 0 1rem rgba(0, 0, 0, 0.1);\n}\n\n.message-body > .avatar {\n  flex-basis: 2.65rem;\n  min-width: 2.65rem;\n  height: 2.65rem;\n}\n\n.avatar > img {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n}\n\n#forward-msg-box.on-phone {\n  border: null;\n  border-radius: null;\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  z-index: 9999;\n  background-color: rgb(241, 241, 241);\n  overflow: hidden;\n}\n\n.forward-msg-head {\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 1.5rem;\n  padding-left: 1rem;\n  border-bottom: 1px solid #ccc;\n  color: black;\n  font-size: .8rem;\n}\n\n.close {\n  width: 1.5rem;\n  font-size: 1.5rem;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.close:hover {\n  color: aliceblue;\n  background-color: rgb(196, 43, 28);\n}\n\n.body {\n  height: auto;\n  max-height: calc(100% - 2rem);\n  overflow: auto;\n}\n</style>\n","<template>\n  <div class=\"input-bar\">\n    <div class=\"options\">\n      <div class=\"bu-emoji\">\n        <emoji-picker v-show=\"showemoji\" ref=\"emojiPicker\" @emoji-click=\"getemoji\"></emoji-picker>\n        <p class=\"ho-emoji\">表情</p>\n        <i class=\"iconfont smile\" @click.prevent=\"ctrlEmojiPanel\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p class=\"ho-emoji\">{{ activeContactor.platform == \"openai\" ? \"模型选择\" : \"工具选择\" }}</p>\n        <el-tree-select id=\"wraper-selector\" v-model=\"selectedOption\" :data=\"extraOptions\" accordion\n          placement=\"top-start\" @node-click=\"currentChange\" />\n        <i class=\"iconfont robot\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p class=\"ho-emoji\">重置人格</p>\n        <i class=\"iconfont reset\" @click=\"$emit('cleanHistory')\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p class=\"ho-emoji\">上传</p>\n        <i class=\"iconfont upload\" @click=\"uploadFile\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p class=\"ho-emoji\">清除记录</p>\n        <el-popconfirm class=\"box-item\" title=\"此操作不可撤销\" confirm-button-text=\"确定\" cancel-button-text=\"取消\" placement=\"top\"\n          @confirm=\"$emit('cleanScreen')\">\n          <template #reference>\n            <i class=\"iconfont shanchu\"></i>\n          </template>\n        </el-popconfirm>\n      </div>\n      <div class=\"bu-emoji\">\n        <p class=\"ho-emoji\">更多</p>\n        <i class=\"iconfont more\" @click=\"unsupportedTip\"></i>\n      </div>\n    </div>\n\n    <div class=\"input-box\">\n      <div class=\"input-content\">\n        <div ref=\"textarea\" class=\"input-area\" contenteditable=\"true\"\n          @keydown=\"handleKeyDown\" @click=\"updateCursorPosition\"></div>\n      </div>\n      <button id=\"sendButton\" @click.prevent=\"send\">\n        发送{{ getWraperName() ? ` | ${getWraperName()}` : \"\" }}\n      </button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { client, config } from \"@/lib/runtime.js\";\nimport { debounce } from \"../utils/tools.js\";\n\nexport default {\n  props: {\n    activeContactor: {\n      type: Object,\n      required: true,\n    },\n  },\n  emits: [\"toButtom\", \"cleanHistory\", \"cleanScreen\", \"setModel\", \"stroge\"],\n  data() {\n    return {\n      selectedOption: null,\n      cursorPosition: [],\n      showemoji: false,\n      openaiModels: null,\n      onebotPresets: [],\n      host: \"\",\n      uploaded: { files: [], images: [] },\n      isPasting: false,\n    };\n  },\n  computed: {\n    extraOptions() {\n      if (this.activeContactor.platform == \"openai\") {\n        return this.openaiModels;\n      } else {\n        return this.onebotPresets;\n      }\n    },\n  },\n  watch: {\n    \"$route.params.id\"() {\n      this.loadSelected();\n    },\n  },\n  created() {\n    this.loadSelected();\n    this.debouncedAdjustHeight = debounce(this.adjustTextareaHeight, 100);\n  },\n  mounted() {\n    this.textareaRef = this.$refs.textarea;\n    this.textareaRef.addEventListener(\"input\", this.debouncedAdjustHeight);\n\n    // 拖拽文件\n    this.handleDragOver = (e) => {\n      e.preventDefault();\n      this.textareaRef.style.backgroundColor = \"#e0e0e0\";\n    };\n    this.handleDragLeave = (e) => {\n      e.preventDefault();\n      this.textareaRef.style.backgroundColor = \"#f1f1f1\";\n    };\n    this.handleDrop = (e) => {\n      e.preventDefault();\n      this.textareaRef.style.backgroundColor = \"#f1f1f1\";\n      const files = e.dataTransfer.files;\n      if (files.length > 0) {\n        this.handleDroppedFile(files[0]);\n      }\n    };\n    this.textareaRef.addEventListener(\"dragover\", this.handleDragOver);\n    this.textareaRef.addEventListener(\"dragleave\", this.handleDragLeave);\n    this.textareaRef.addEventListener(\"drop\", this.handleDrop);\n    // this.textareaRef.addEventListener(\"paste\", debounce(handlePaste.apply(this), 100));\n    this.textareaRef.addEventListener(\"paste\", this.handlePaste);\n\n    this.host = window.location.origin;\n    this.onebotPresets = config.onebotConfig.textwraper.options;\n  },\n  unmounted() {\n    this.textareaRef.removeEventListener(\"input\", this.adjustTextareaHeight);\n    this.textareaRef.removeEventListener(\"dragover\", this.handleDragOver);\n    this.textareaRef.removeEventListener(\"dragleave\", this.handleDragLeave);\n    this.textareaRef.removeEventListener(\"drop\", this.handleDrop);\n    this.textareaRef.removeEventListener(\"paste\", this.handlePaste);\n    this.textareaRef = null;\n  },\n  methods: {\n    unsupportedTip() {\n      this.$message.warning(\"功能暂未开放\");\n    },\n    hasInput() {\n      // const text = this.textareaRef?.innerText.trim();\n      const hasText = this.textareaRef?.innerText.trim();\n      const hasImage = this.textareaRef?.querySelector(\"img\");\n      return hasText || hasImage;\n    },\n    handleDroppedFile(file) {\n      if (file.type.startsWith(\"image/\")) {\n        this.handleUploadImage(file);\n      } else {\n        this.uploadFile(file);\n      }\n    },\n    // 把纯文本转换成可在contenteditable正确显示换行和空格的HTML\n    textToHtml(text) {\n      const escaped = text\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n        .replace(/\"/g, \"&quot;\")\n        .replace(/'/g, \"&#39;\");\n\n      // 换行符变成 <br>，空格用&nbsp;保留\n      return escaped\n        .replace(/  /g, \"&nbsp;&nbsp;\") // 连续空格至少保留两个才需要转换，单个空格是正常空格\n        .replace(/\\n/g, \"<br>\");\n    },\n\n    // 在光标处插入HTML片段（带换行和空格）\n    insertHtmlAtCursor(html) {\n      const selection = window.getSelection();\n      if (!selection || selection.rangeCount === 0) {\n        // 没有光标选区，追加到末尾\n        this.textareaRef.innerHTML += html;\n        this.setCursorToEnd(this.textareaRef);\n        return;\n      }\n      const range = selection.getRangeAt(0);\n      range.deleteContents();\n\n      // 使用临时容器把html转成节点\n      const tempEl = document.createElement(\"div\");\n      tempEl.innerHTML = html;\n\n      const frag = document.createDocumentFragment();\n      while (tempEl.firstChild) {\n        frag.appendChild(tempEl.firstChild);\n      }\n\n      range.insertNode(frag);\n\n      // 设置光标移动到插入节点后面\n      range.collapse(false);\n      selection.removeAllRanges();\n      selection.addRange(range);\n    },\n\n    // 粘贴事件处理：文本转html插入，图片异步队列上传\n    handlePaste(e) {\n      e.preventDefault();\n      const clipboardData = e.clipboardData || window.clipboardData;\n      const items = clipboardData.items;\n      let pastedText = \"\";\n      const imageFiles = [];\n\n      for (let i = 0; i < items.length; i++) {\n        const item = items[i];\n        if (item.type.indexOf(\"image\") !== -1) {\n          imageFiles.push(item.getAsFile());\n        } else if (item.type === \"text/plain\") {\n          pastedText += clipboardData.getData(\"text/plain\");\n        }\n      }\n\n      if (pastedText) {\n        const html = this.textToHtml(pastedText);\n        this.insertHtmlAtCursor(html);\n      }\n\n      if (imageFiles.length) {\n        this.$message.info(`检测到 ${imageFiles.length} 张图片，正在处理...`);\n        setTimeout(() => {\n          this.processImageQueue(imageFiles);\n        }, 0);\n      }\n    },\n\n    // 表情插入调用统一插入html方法，防止换行空格丢失\n    getemoji(e) {\n      const unicode = e.detail.unicode;\n      // 直接插unicode字符对应的html文本（一般没换行空格）\n      this.insertHtmlAtCursor(this.textToHtml(unicode));\n      this.ctrlEmojiPanel();\n    },\n\n    // 光标移动到内容最后函数\n    setCursorToEnd(element) {\n      element.focus();\n      const selection = window.getSelection();\n      const range = document.createRange();\n      range.selectNodeContents(element);\n      range.collapse(false);\n      selection.removeAllRanges();\n      selection.addRange(range);\n    },\n\n    // 顺序处理图片，防止堆积卡顿\n    async processImageQueue(files) {\n      for (const file of files) {\n        await this.handleUploadImage(file);\n        // 让主线程有时间渲染\n        await new Promise(r => setTimeout(r, 0));\n      }\n    },\n\n    handleUploadImage(file) {\n      return new Promise((resolve) => {\n        const maxSizeMB = 5;\n        const maxSizeByte = maxSizeMB * 1024 * 1024;\n\n        const img = new Image();\n        const blobUrl = URL.createObjectURL(file);\n        img.src = blobUrl;\n\n        img.onload = () => {\n          URL.revokeObjectURL(blobUrl); // 释放内存\n\n          const fileType = file.type.toLowerCase();\n\n          // GIF 直接上传\n          if (fileType === 'image/gif') {\n            if (file.size > maxSizeByte) {\n              this.$message.error(`GIF 图片不能超过 ${maxSizeMB}MB`);\n              resolve();\n              return;\n            }\n            const formData = new FormData();\n            formData.append('image', file, file.name);\n            client.uploadImage(formData)\n              .then((upload) => {\n                const imageUrl = upload.data.url;\n                this.uploaded.images.push(imageUrl);\n                this.insertImageToTextarea(imageUrl, file.name);\n                this.$message.success('上传 GIF 成功');\n              })\n              .catch(() => this.$message.error('上传 GIF 失败'))\n              .finally(resolve);\n            return;\n          }\n\n          // 其他类型进行压缩\n          const canvas = document.createElement('canvas');\n          const ctx = canvas.getContext('2d');\n          canvas.width = img.width;\n          canvas.height = img.height;\n          ctx.drawImage(img, 0, 0);\n          let mimeType, quality;\n          if (fileType === 'image/png') {\n            mimeType = 'image/png';\n          } else if (fileType === 'image/webp') {\n            mimeType = 'image/webp';\n            quality = 0.7;\n          } else {\n            mimeType = 'image/jpeg';\n            quality = 0.7;\n          }\n          canvas.toBlob(\n            (blob) => {\n              if (!blob) {\n                this.$message.error('图片压缩失败');\n                resolve();\n                return;\n              }\n              if (blob.size > maxSizeByte) {\n                this.$message.error(`压缩后仍超过 ${maxSizeMB}MB，请选小点的图片`);\n                resolve();\n                return;\n              }\n              const formData = new FormData();\n              formData.append('image', blob, file.name);\n              client.uploadImage(formData)\n                .then((upload) => {\n                  const imageUrl = upload.data.url;\n                  this.uploaded.images.push(imageUrl);\n                  this.insertImageToTextarea(imageUrl, file.name);\n                  this.$message.success('上传图片成功');\n                })\n                .catch(() => this.$message.error('上传失败'))\n                .finally(resolve);\n            },\n            mimeType,\n            quality\n          );\n        };\n      });\n    },\n    ctrlEmojiPanel() {\n      this.showemoji = !this.showemoji;\n      const editor = this.textareaRef;\n      editor.focus();\n    },\n    uploadFile(file) {\n      if (file instanceof File) {\n        this.handleFileUpload(file);\n        return;\n      }\n      const availableImageFormats = [\"png\", \"jpg\", \"jpeg\", \"webp\"];\n      const availableDocFormats = [\"docx\", \"txt\", \"pdf\", \"pptx\", \"xlsx\"];\n      const fileInput = document.createElement(\"input\");\n      fileInput.type = \"file\";\n      fileInput.accept = [...availableDocFormats, ...availableImageFormats]\n        .map((format) => `.${format}`)\n        .join(\",\");\n      const handleChange = async (e) => {\n        fileInput.removeEventListener(\"change\", handleChange);\n        const file = e.target.files[0];\n        if (!file) return;\n        this.handleFileUpload(file);\n      };\n      fileInput.addEventListener(\"change\", handleChange);\n      fileInput.click();\n    },\n    handleFileUpload(file) {\n      if (file.size > 50 * 1024 * 1024) {\n        this.$message.error(\"文件大小超过50MB，无法上传\");\n        return;\n      }\n      this.$message.info(\"文件上传中...\");\n      if (file.type.startsWith(\"image/\")) {\n        this.handleUploadImage(file);\n      } else {\n        this.uploadDocumentFile(file);\n      }\n    },\n    async uploadDocumentFile(file) {\n      try {\n        const upload = await client.uploadFile(file);\n        this.$message.success(\"文件上传成功\");\n        const fileUrl = `${upload.data.url}?size=${file.size}&name=${file.name}`;\n        const container = this.activeContactor.getBaseUserContainer();\n        container.content.push({\n          type: \"file\",\n          data: { file: this.host + fileUrl },\n        });\n        this.activeContactor.webSend(container, false);\n      } catch (error) {\n        console.error(\"文件上传失败:\", error);\n        this.$message.error(\"文件上传失败，请稍后再试\");\n      }\n      this.$emit(\"stroge\");\n      this.$emit(\"toButtom\");\n    },\n    insertImageToTextarea(imageUrl, imageName) {\n      const imageElement = document.createElement(\"img\");\n      imageElement.src = imageUrl;\n      imageElement.alt = imageName;\n      imageElement.style.maxWidth = \"10rem\";\n      imageElement.style.maxHeight = \"10rem\";\n      const range = document.createRange();\n      range.selectNodeContents(this.textareaRef);\n      range.collapse(false);\n      const selection = window.getSelection();\n      selection.removeAllRanges();\n      selection.addRange(range);\n      const fragment = range.createContextualFragment(\n        `<span>${imageElement.outerHTML}</span>`\n      );\n      range.insertNode(fragment);\n      setTimeout(() => {\n        const newRange = document.createRange();\n        newRange.selectNodeContents(this.textareaRef);\n        newRange.collapse(false);\n        const newSelection = window.getSelection();\n        newSelection.removeAllRanges();\n        newSelection.addRange(newRange);\n      }, 0);\n    },\n    initLLMExtraOptions() {\n      const allModels = client.config.getLlmModels();\n      this.openaiModels = Object.entries(allModels).map(([provider, models]) => {\n        return {\n          value: provider,\n          label: provider,\n          children: models.map((modelGroup) => {\n            return {\n              value: modelGroup.owner,\n              label: modelGroup.owner,\n              children: modelGroup.models.map((model) => {\n                return { value: model, label: model };\n              }),\n            };\n          }),\n        };\n      });\n    },\n    getOpenaiModelArray(model) {\n      const owner = client.config.getModelOwner(model);\n      return [owner, model];\n    },\n    wrapText(rawText) {\n      const preset = this.getOnebotPreset();\n      if (!this.selectedOption || !preset) return rawText;\n      const testText = \"{xxx}\";\n      return preset.replace(testText, rawText);\n    },\n    getOnebotPreset() {\n      const preset = this.onebotPresets\n        .reduce((acc = [], item) => {\n          const arr = item.children ?? [item];\n          return [...acc, ...arr];\n        }, [])\n        .find((child) => child.value == this.selectedOption)?.preset;\n      return preset;\n    },\n    loadSelected() {\n      if (this.activeContactor.platform === \"onebot\") {\n        if (this.activeContactor.preset) {\n          this.selectedOption = this.activeContactor.preset;\n        }\n      } else {\n        this.initLLMExtraOptions();\n        this.selectedOption = this.activeContactor.options.base.model;\n      }\n    },\n    adjustTextareaHeight() {\n      const textarea = this.textareaRef;\n      textarea.style.height = \"auto\";\n      textarea.style.height = textarea.scrollHeight + \"px\";\n    },\n    getWraperName() {\n      const preset = this.getOnebotPreset();\n      if (this.activeContactor.platform === \"onebot\" && preset) {\n        if (!this.selectedOption) return \"\";\n        return preset.replace(\"#\", \"\").replace(\"{xxx}\", \"\");\n      } else {\n        return \"\";\n      }\n    },\n    updateCursorPosition() {\n      const selection = window.getSelection();\n      if (!selection) return;\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        this.cursorPosition[0] = range.startOffset;\n        this.cursorPosition[1] = range.endOffset;\n      }\n    },\n    presend() {\n      this.textareaRef.focus();\n      const images = this.textareaRef.querySelectorAll(\"img\");\n      const ImageSrcs = Array.from(images).map((img) => img.src);\n      let msg = this.getSafeText(this.textareaRef.innerText);\n      const wrappedMessage =\n        this.activeContactor.platform === \"onebot\" ? this.wrapText(msg) : msg;\n      this.textareaRef.innerHTML = \"\";\n      this.adjustTextareaHeight();\n      const container = this.activeContactor.getBaseUserContainer();\n      if (wrappedMessage.trim()) {\n        container.content.push({\n          type: \"text\",\n          data: { text: wrappedMessage },\n        });\n      }\n      ImageSrcs.forEach((imgUrl) => {\n        container.content.unshift({\n          type: \"image\",\n          data: { file: imgUrl },\n        });\n      });\n      if (this.repliedMessageId) {\n        container.content.push({\n          type: \"reply\",\n          data: { id: this.repliedMessageId },\n        });\n      }\n      return container;\n    },\n    async send() {\n      if (!this.hasInput()) return;\n      this.$emit(\"toButtom\");\n      const container = this.presend();\n      try {\n        const message_id = await this.activeContactor.webSend(container);\n        container.id = message_id;\n        this.$emit(\"stroge\");\n        this.uploaded.images = [];\n        this.uploaded.files = [];\n      } catch (error) {\n        this.$message.error(\"发送消息失败\");\n      }\n    },\n    getSafeText(text) {\n      return text;\n    },\n    cleanScreen() {\n      this.$emit(\"cleanScreen\");\n    },\n    currentChange(data, event) {\n      if (event.level === 3) {\n        if (!event.parent || !event.parent.parent) {\n          console.error(\"父节点不存在!\");\n          return;\n        }\n        const selectedValues = [\n          event.parent.parent.data.value,\n          event.parent.data.value,\n          data.value,\n        ];\n        this.$message({\n          message: \"已切换到 \" + selectedValues[2] + \" 模型\",\n          type: \"success\",\n        });\n        const seletedProvider = selectedValues[0];\n        if (seletedProvider !== this.activeContactor.options?.provider) {\n          this.$message({\n            message: \"已切换到 \" + seletedProvider + \" 协议\",\n            type: \"success\",\n          });\n        }\n        this.$emit(\"setModel\", selectedValues);\n      } else if (event.level === 2) {\n        if (this.activeContactor.platform === \"onebot\") {\n          if (this.getOnebotPreset() && !this.getOnebotPreset().includes(\"xxx\")) {\n            this.send();\n          }\n        }\n      }\n    },\n    handleKeyDown(event) {\n      if (event.key === \"Enter\") {\n        if (event.ctrlKey) {\n          if (this.hasInput()) {\n            this.send();\n          } else {\n            this.$message({ message: \"不能发送空消息\", type: \"warning\" });\n          }\n        } else {\n          document.execCommand(\"insertHTML\", false, \"\\n\");\n        }\n      }\n      setTimeout(() => {\n        this.updateCursorPosition();\n      }, 0);\n    },\n  },\n};\n</script>\n\n<style lang=\"sass\" scoped>\n$mobile: 600px\n$icon-hover: #09f\n\ni:hover\n  color: $icon-hover\n\n.input-bar\n  flex-shrink: 0\n  display: flex\n  flex-direction: column\n  border: 0 solid rgba(161, 154, 154, 0.626)\n  flex-basis: 11rem\n  @media (max-width: $mobile)\n    flex-basis: 7rem\n    width: 100%\n    flex-direction: column-reverse\n    position: fixed\n    bottom: 0\n    z-index: 1000\n    background-color: hsla(0, 0%, 100%, 0.8)\n    backdrop-filter: blur(0.5rem)\n\n  .options\n    display: flex\n    border-top: 0.0625rem solid rgba(128, 128, 128, 0.502)\n    padding: 0.25rem 0.5rem\n    @media (max-width: $mobile)\n      border: none\n      justify-content: space-around\n\n.bu-emoji\n  position: relative\n  white-space: nowrap\n  @media screen and (min-width: $mobile)\n    &:hover p.ho-emoji\n      display: block\n\nemoji-picker\n  position: absolute\n  top: -25.75rem\n  right: -20rem\n\np.ho-emoji\n    text-wrap: nowrap\n    display: none\n    font-size: .75rem\n    padding: .125rem .25rem\n    background-color: #fff\n    border: none\n    box-shadow: 0 .125rem .25rem #0003\n    position: absolute\n    top: 80%\n    left: 50%\n    transform: translate(-60%)\ni\n  display: block\n  padding: 0.25rem 0.5rem 0 0\n  font-size: 1.25rem\n  width: 1.5rem\n  height: 1.5rem\n\n.input-box\n    flex-grow: 1\n    padding: 0 .5rem\n    display: flex\n    flex-direction: column\n    align-items: end\n\n    @media screen and (max-width: $mobile)\n      flex-direction: row\n      align-items: flex-end\n      flex-wrap: nowrap\n\n    .input-content\n      flex-wrap: wrap\n      display: flex\n      background-color: #f1f1f1\n      border: 0\n      flex-grow: 1\n      width: 100%\n\n      @media screen and (max-width: $mobile)\n        margin: 0.5rem 0.5rem 0.8rem 0\n        min-height: 2rem\n        flex-basis: calc( 100% - 4rem )\n        max-width: calc( 100% - 4rem )\n        flex-grow: 0\n        background-color: #fff\n\n      .input-area\n        overflow-y: auto\n        max-height: 20rem\n        resize: none\n        font-size: 1rem\n        background-color: #f1f1f1\n        border: 0\n        flex-grow: 1\n        width: 100%\n        moz-user-select: -moz-none\n        -moz-user-select: none\n        -o-user-select: none\n        -khtml-user-select: none\n        -webkit-user-select: none\n        -ms-user-select: none\n        user-select: none\n        &:focus\n          border: 0\n          outline: none\n\n        @media screen and (max-width: $mobile)\n          background-color: transparent\n          margin: 0.2rem\n          caret-color: #14C1EB\n\n    button\n        white-space: nowrap\n        color: #f0f8ff\n        border-radius: .3125rem\n        border: 0\n        background-color: $icon-hover\n        padding: .25rem 1rem\n        margin-bottom: .8rem\n        margin-right: .5rem\n        cursor: pointer\n\n        @media screen and (max-width: $mobile)\n          height: 2rem\n          margin-right: 0rem\n</style>\n","<template>\n  <div class=\"file-block\">\n    <div class=\"file-block-icon\">\n      <div class=\"file-icon\" :class=\"iconClass\">\n        <!-- Dynamic class binding -->\n        <span v-if=\"file_type\"> {{ file_type.toUpperCase() }}</span>\n      </div>\n    </div>\n    <div class=\"file-block-text\">\n      <div class=\"file-name\" :title=\"file_name\">{{ file_name }}</div>\n      <div class=\"file-info\">\n        {{ file_type.toUpperCase() }}, {{ formated_file_size }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    fileUrl: {\n      // 修改为 camelCase\n      type: String,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      file_name: \"\",\n      file_type: \"\",\n      formated_file_size: \"\",\n    };\n  },\n  computed: {\n    iconClass() {\n      //Use lower case for comparison, easier to manage\n      const type = this.file_type.toLowerCase();\n\n      if (type === \"pdf\") {\n        return \"file-icon-pdf\";\n      } else if ([\"xls\", \"xlsx\", \"csv\"].includes(type)) {\n        // Spreadsheet (Excel, CSV)\n        return \"file-icon-spreadsheet\";\n      } else if ([\"doc\", \"docx\"].includes(type)) {\n        // Word\n        return \"file-icon-word\";\n      } else if ([\"ppt\", \"pptx\"].includes(type)) {\n        // PowerPoint\n        return \"file-icon-ppt\";\n      } else {\n        return \"file-icon-other\"; // Default (gray)\n      }\n    },\n  },\n  created() {\n    // 从查询参数中获取文件大小\n    const url = this.fileUrl.split(\"?\");\n    const params = new URLSearchParams(url[1]);\n    const bits = params.get(\"size\");\n    this.file_name = params.get(\"name\");\n    this.formated_file_size = this.formatFileSize(bits);\n    // 从url中获取文件类型\n    const file_type = url[0].split(\".\");\n    this.file_type = file_type[file_type.length - 1];\n  },\n  methods: {\n    formatFileSize(bits) {\n      const units = [\"B\", \"KB\", \"MB\"];\n      let unitIndex = 0;\n      while (bits >= 1024) {\n        bits /= 1024;\n        unitIndex++;\n      }\n      return bits.toFixed(2) + \" \" + units[unitIndex];\n    },\n  },\n};\n</script>\n\n<style scoped>\n.file-block {\n  display: flex;\n  align-items: center;\n  padding: 8px;\n  border-radius: 5px;\n  background-color: #f5f5f5;\n  margin: 0.5rem 0;\n  width: 12rem;\n  position: relative;\n}\n\n.file-block-icon {\n  width: 40px;\n  height: 40px;\n  margin-right: 8px;\n}\n\n.file-icon {\n  width: 40px;\n  height: 40px;\n  /*  Remove default background  */\n  /* background-color: #4285f4; */\n  color: #fff;\n  border-radius: 5px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 14px;\n}\n/* Add specific styles for each file type */\n.file-icon-pdf {\n  background-color: #e70012;\n}\n\n.file-icon-spreadsheet {\n  background-color: #138147;\n}\n\n.file-icon-word {\n  background-color: #144eb3;\n}\n.file-icon-ppt {\n  background-color: #ca4b27;\n}\n\n.file-icon-other {\n  background-color: gray;\n}\n\n.file-block-text {\n  flex: 1;\n  overflow: hidden;\n}\n\n.file-name {\n  font-weight: bold;\n  font-size: 12px;\n  color: #333;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.file-info {\n  font-size: 10px;\n  color: #777;\n}\n</style>\n","<template>\n  <div class=\"tool-call-bar\">\n    <div class=\"status-icon\">\n      <span v-if=\"toolCallSuccess\" class=\"call-success-icon\">\n        <div class=\"checkmark-container\">\n          <svg\n            class=\"checkmark\"\n            viewBox=\"0 0 52 36\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n          >\n            <polyline points=\"1 20 15 36 51 1\" />\n          </svg>\n        </div>\n      </span>\n      <span v-else-if=\"toolCallFail\" class=\"call-fail-icon\">❌</span>\n      <span v-else class=\"call-pend-icon\"></span>\n    </div>\n    <div class=\"tool-info\">\n      <div>\n        <span class=\"tool-name\">{{ toolCall.name.split(\"_mid_\")[0] }}</span>\n      </div>\n      <div class=\"tool-status\">\n        {{ call_status }}\n      </div>\n    </div>\n    <div class=\"extra-info\">\n      <button\n        ref=\"show-extra-info\"\n        :class=\"{ active: showExtraInfo, 'extra-info-button': true }\"\n        @click=\"showExtraInfo = !showExtraInfo\"\n      >\n        <svg\n          t=\"1731677922196\"\n          class=\"icon\"\n          viewBox=\"0 0 1024 1024\"\n          version=\"1.1\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          p-id=\"5948\"\n          width=\"16\"\n          height=\"16\"\n        >\n          <path\n            d=\"M778.965749 128.759549l-383.064442 383.063419 388.097062 388.096039-0.070608 0.033769c12.709463 13.137205 20.529569 31.024597 20.529569 50.731428 0 40.376593-32.736589 73.112158-73.115228 73.112158-19.705807 0-37.591153-7.819083-50.730405-20.528546l-0.034792 0.035816L241.890654 564.622498l0.035816-0.035816c-13.779841-13.281491-22.3838-31.915897-22.3838-52.585659 0-0.071631 0-0.106424 0-0.178055 0-0.072655 0-0.10847 0-0.144286 0-20.669762 8.603959-39.341007 22.3838-52.622498l-0.035816-0.034792L680.573835 20.337187l0.180102 0.179079c13.139252-12.5662 30.950919-20.313651 50.587142-20.313651 40.378639 0 73.115228 32.736589 73.115228 73.114205C804.455283 95.485725 794.567076 115.334795 778.965749 128.759549z\"\n            p-id=\"5949\"\n          ></path>\n        </svg>\n      </button>\n    </div>\n    <div :class=\"{ active: showExtraInfo, 'extra-info-bar': true }\">\n      <div class=\"extra-detail\">\n        <div class=\"detail-params\">\n          <div class=\"detail-title\">参数</div>\n          <div class=\"detail-content\">\n            {{ toolCall.parameters }}\n          </div>\n        </div>\n\n        <div class=\"detail-result\">\n          <div class=\"detail-title\">返回值</div>\n          <div class=\"detail-content\">\n            {{ toolCall.result }}\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    toolCall: {\n      type: Object,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      showExtraInfo: false,\n    };\n  },\n  computed: {\n    toolCallSuccess() {\n      return (\n        this.toolCall.action === \"finished\" && !this.toolCall?.result?.error\n      );\n    },\n    toolCallFail() {\n      return (\n        this.toolCall.action === \"finished\" && this.toolCall?.result?.error\n      );\n    },\n    call_status() {\n      if (this.toolCall.action == \"started\") return \"开始运行\";\n      if (this.toolCall.action == \"pending\") return \"函数构建中\";\n      if (this.toolCall.action == \"running\") return \"函数运行中\";\n      if (this.toolCallSuccess) return \"函数运行成功\";\n      if (this.toolCallFail) return \"函数运行失败\";\n      else return \"未知状态\";\n    },\n  },\n  mounted() {},\n};\n</script>\n<style scoped>\n.extra-detail {\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 20rem;\n  max-height: 25rem;\n  flex-grow: 1;\n  padding-bottom: 1rem;\n}\n\n.detail-params,\n.detail-result {\n  margin-top: 1rem;\n  width: calc(100% - 2rem);\n  background-color: #fff;\n  border-radius: 0.5rem;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  flex-grow: 1;\n}\n\n.detail-title {\n  padding-top: 0.5rem;\n  flex-basis: 2rem;\n  width: 90%;\n  border-bottom: 1px solid #5c5c5c;\n}\n\n.detail-content {\n  user-select: text;\n  margin: 0.5rem 0rem;\n  font-size: 0.8rem;\n  color: #5c5c5c;\n  width: 90%;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 8rem;\n  flex-grow: 1;\n}\n\n.extra-info-bar {\n  position: absolute;\n  overflow: hidden;\n  z-index: 2;\n  max-height: 0px;\n  transition: 0.3s;\n  top: 4rem;\n  position: absolute;\n  background-color: #f5f5f5;\n  border-radius: 0.5rem;\n  box-shadow: 0px 0px 5px 0px rgba(0, 0, 0, 0.2);\n  display: flex;\n  flex-direction: column;\n}\n\n.extra-info-bar.active {\n  max-height: 50rem;\n}\n\n.tool-info {\n  flex-grow: 1;\n  flex-basis: 10rem;\n  flex-shrink: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-evenly;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  margin-right: 0.5rem;\n}\n\n.extra-info {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-basis: 3rem;\n  min-width: 3rem;\n}\n\nbutton.extra-info-button {\n  transition: transform 0.3s ease;\n  transform: rotate(90deg);\n}\n\nbutton.extra-info-button.active {\n  transform: rotate(-90deg);\n}\n\nbutton.extra-info-button:hover svg {\n  transition: transform 0.3s ease;\n  transform: scale(1.2);\n}\n\n.tool-name {\n  font-weight: bolder;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.tool-call-bar {\n  max-width: 100%;\n  margin-top: 0.5rem;\n  margin-bottom: 0.5rem;\n  height: 4rem;\n  flex-wrap: nowrap;\n  background-color: #f5f5f5;\n  border-radius: 5px;\n  display: flex;\n  position: relative;\n}\n\n.status-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  border-radius: 50%;\n  min-width: 4rem;\n}\n\n.call-pend-icon {\n  transform: rotateZ(45deg);\n  perspective: 1000px;\n  border-radius: 50%;\n  width: 48px;\n  height: 48px;\n  color: #fff;\n}\n\n.call-pend-icon:before,\n.call-pend-icon:after {\n  content: \"\";\n  display: block;\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: inherit;\n  height: inherit;\n  border-radius: 50%;\n  transform: rotateX(70deg);\n  animation: 1s spin linear infinite;\n}\n\n.call-pend-icon:after {\n  color: #ff3d00;\n  transform: rotateY(70deg);\n  animation-delay: 0.4s;\n}\n\n@keyframes rotate {\n  0% {\n    transform: translate(-50%, -50%) rotateZ(0deg);\n  }\n\n  100% {\n    transform: translate(-50%, -50%) rotateZ(360deg);\n  }\n}\n\n@keyframes rotateccw {\n  0% {\n    transform: translate(-50%, -50%) rotate(0deg);\n  }\n\n  100% {\n    transform: translate(-50%, -50%) rotate(-360deg);\n  }\n}\n\n@keyframes spin {\n  0%,\n  100% {\n    box-shadow: 0.2em 0px 0 0px currentcolor;\n  }\n\n  12% {\n    box-shadow: 0.2em 0.2em 0 0 currentcolor;\n  }\n\n  25% {\n    box-shadow: 0 0.2em 0 0px currentcolor;\n  }\n\n  37% {\n    box-shadow: -0.2em 0.2em 0 0 currentcolor;\n  }\n\n  50% {\n    box-shadow: -0.2em 0 0 0 currentcolor;\n  }\n\n  62% {\n    box-shadow: -0.2em -0.2em 0 0 currentcolor;\n  }\n\n  75% {\n    box-shadow: 0px -0.2em 0 0 currentcolor;\n  }\n\n  87% {\n    box-shadow: 0.2em -0.2em 0 0 currentcolor;\n  }\n}\n\n.checkmark-container {\n  width: 2.25rem;\n  height: 2rem;\n}\n\n.checkmark {\n  width: 100%;\n  height: 100%;\n}\n\n.checkmark polyline {\n  fill: none;\n  stroke: green;\n  /* 设置颜色为绿色 */\n  stroke-width: 10;\n  /* 设置线条的粗细 */\n  stroke-dasharray: 60;\n  /* 总长度 */\n  stroke-dashoffset: 60;\n  /* 起始偏移量 */\n  animation: draw 1s forwards;\n  /* 动画定义 */\n}\n\n@keyframes draw {\n  to {\n    stroke-dashoffset: 0;\n    /* 结束时偏移量为0，显示完整的对勾 */\n  }\n}\n</style>\n","<template>\n  <div class=\"reason-block\">\n    <div class=\"head-bar\">\n      <div class=\"reason-info\">{{ getReasonInfo }}</div>\n      <button\n        :class=\"{ active: show, 'extra-info-button': true }\"\n        @click=\"toggleShow\"\n      >\n        <i class=\"iconfont icon-return\" />\n      </button>\n    </div>\n    <div\n      ref=\"reasonContent\"\n      class=\"reason-content\"\n      :style=\"{ 'max-height': maxHeight }\"\n    >\n      {{ content }}\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    content: {\n      required: true,\n      type: String,\n      default: \"\",\n    },\n    startTime: {\n      required: true,\n      type: Number,\n    },\n    endTime: {\n      required: false,\n      type: Number,\n      default: 0,\n    },\n  },\n  data() {\n    return {\n      show: true,\n      maxHeight: \"auto\", // 初始值\n    };\n  },\n  computed: {\n    getReasonInfo() {\n      if (this.endTime) {\n        const timeDiff = this.endTime - this.startTime;\n        return `已深度思考（耗时 ${(timeDiff / 1000).toFixed(2)} 秒）`;\n      } else {\n        return `正在深度思考......`;\n      }\n    },\n  },\n  mounted() {\n    this.updateMaxHeight(); //初始展开\n  },\n  updated() {\n    this.updateMaxHeight(); //防止内容更新,导致高度计算错误\n  },\n  methods: {\n    toggleShow() {\n      this.show = !this.show;\n      this.updateMaxHeight();\n    },\n    updateMaxHeight() {\n      if (this.show) {\n        // 展开时，设置为内容实际高度 + 一些额外空间 (如 padding)\n        this.maxHeight = this.$refs.reasonContent.scrollHeight + 20 + \"px\";\n      } else {\n        // 收起时，设置为 0\n        this.maxHeight = \"0px\";\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.reason-block {\n  margin-bottom: 10px;\n  display: flex;\n  flex-direction: column;\n}\n\n.reason-info {\n  margin: 0.5rem 0;\n  font-size: 0.8rem;\n  min-width: 8rem;\n  flex-basis: 10rem;\n  text-wrap: nowrap;\n}\n\n.head-bar {\n  flex-basis: 1rem;\n  margin: 0.5rem 0;\n  display: flex;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n  width: fit-content;\n  background-color: #f5f5f5;\n  border-radius: 10px;\n  padding: 0px 0.5rem;\n}\n\n.head-bar:hover {\n  background-color: #ededed;\n}\n\n.head-bar button {\n  flex-basis: 1rem;\n  margin-left: 0.5rem;\n  background-color: transparent;\n  border: none;\n  cursor: pointer;\n  transition: transform 0.3s ease-in-out;\n  /* 使用 ease-in-out */\n  display: flex;\n  align-items: center;\n  gap: 2px;\n}\n\n.head-bar button i {\n  font-size: 0.8rem;\n}\n\n.head-bar button.active {\n  transform: rotate(-90deg);\n}\n\n.reason-content {\n  max-width: 100%;\n  /* max-height 在 JavaScript 中动态控制 */\n  overflow: hidden;\n  /* 隐藏超出部分 */\n  user-select: text;\n  font-size: 0.8rem;\n  color: #6f6f6f;\n  white-space: pre-line;\n  border-left: 2px solid #ccc;\n  transition: max-height 0.3s ease-in-out;\n  /* 对 max-height 应用过渡 */\n  padding-left: 1rem;\n}\n</style>\n","<template>\n  <div id=\"message-menu\">\n    <template v-if=\"type === 'friend'\">\n      <div @click.stop=\"enterChat\">\n        <i class=\"iconfont chat\"></i>\n        <span>进入对话</span>\n      </div>\n      <div @click.stop=\"togglePriority\">\n        <i class=\"iconfont star\"></i>\n        <span>{{ message.priority === 0 ? \"取消置顶\" : \"置顶\" }}</span>\n      </div>\n      <div @click.stop=\"shareBot\">\n        <i class=\"iconfont icon-share\"></i>\n        <span>分享</span>\n      </div>\n      <div @click.stop=\"deleteBot\">\n        <i class=\"iconfont shanchu\"></i>\n        <span>删除</span>\n      </div>\n    </template>\n    <template v-else>\n      <div v-if=\"seletedText\" @click.stop=\"copySeletedText\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>复制选中</span>\n      </div>\n      <div @click.stop=\"copyText\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>复制消息</span>\n      </div>\n      <div v-if=\"seletedImage\" @click.stop=\"copySeletedImage\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>复制图片</span>\n      </div>\n      <div v-if=\"seletedImage\" @click.stop=\"saveSeletedImage\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>保存图片</span>\n      </div>\n      <div @click.stop=\"retryMessage\">\n        <i class=\"iconfont reset\"></i>\n        <span>重试消息</span>\n      </div>\n      <div @click.stop=\"replyMessage\">\n        <i class=\"iconfont yinyong\"></i>\n        <span>引用消息</span>\n      </div>\n      <div @click.stop=\"deleteMessage\">\n        <i class=\"iconfont shanchu\"></i>\n        <span>删除消息</span>\n      </div>\n    </template>\n  </div>\n</template>\n<script>\nexport default {\n  name: \"MessageMenu\", // 建议添加组件 name，方便调试\n  props: {\n    type: {\n      type: String,\n      default: \"message\",\n    },\n    message: {\n      type: Object,\n      default: () => ({}),\n    },\n    seletedText: {\n      type: String,\n      default: \"\",\n    },\n    seletedImage: {\n      type: String,\n      default: \"\",\n    },\n  },\n  emits: [\"close\", \"message-option\"], //显式声明emit的事件\n  methods: {\n    async copySeletedImage() {\n      this.$emit(\"close\");\n      try {\n        await this.copyImageToClipboard(this.seletedImage);\n      } catch (error) {\n        console.error(\"复制选择图片失败：\", error);\n      }\n    },\n    async saveSeletedImage() {\n      this.$emit(\"close\");\n      try {\n        await this.downloadImage(this.seletedImage);\n      } catch (error) {\n        console.error(\"保存选择图片失败：\", error);\n      }\n    },\n    copyText() {\n      let text = \"\";\n      this.message.content.forEach((element) => {\n        if (element.type === \"text\") {\n          text += element.data.text;\n        } else if (element.type === \"image\") {\n          text += `\\n![图片](${element.data.file})`;\n        }\n      });\n      this.copyTextToClipboard(text);\n      this.$emit(\"close\");\n    },\n    copySeletedText() {\n      this.copyTextToClipboard(this.seletedText);\n      this.$emit(\"close\");\n    },\n    retryMessage() {\n      this.$emit(\"message-option\", \"retry\");\n      this.$emit(\"close\");\n    },\n    replyMessage() {\n      this.$emit(\"message-option\", \"reply\");\n      this.$emit(\"close\");\n    },\n    deleteMessage() {\n      this.$emit(\"message-option\", \"delete\");\n      this.$emit(\"close\");\n    },\n    enterChat() {\n      this.$emit(\"message-option\", \"enter\");\n      this.$emit(\"close\");\n    },\n    togglePriority() {\n      this.$emit(\"message-option\", \"priority\");\n      this.$emit(\"close\");\n    },\n    shareBot() {\n      this.$emit(\"message-option\", \"share\");\n      this.$emit(\"close\");\n    },\n    deleteBot() {\n      this.$emit(\"message-option\", \"delete\");\n      this.$emit(\"close\");\n    },\n    // 封装复制文本到剪贴板的函数\n    async copyTextToClipboard(text) {\n      let textarea;\n      try {\n        textarea = document.createElement(\"textarea\");\n        textarea.style.position = \"absolute\";\n        textarea.style.left = \"-9999px\";\n        textarea.value = text;\n        document.body.appendChild(textarea);\n        textarea.select();\n        textarea.setSelectionRange(0, 99999); // For mobile devices\n        await document.execCommand(\"copy\");\n        this.$message({ message: \"复制成功\", type: \"success\" });\n      } catch (err) {\n        console.error(\"复制失败:\", err);\n        this.$message({ message: \"复制失败\", type: \"error\" });\n      } finally {\n        document.body.removeChild(textarea);\n      }\n    },\n    // 封装复制图片到剪贴板的函数\n    async copyImageToClipboard(imgSrc) {\n      try {\n        const response = await fetch(imgSrc);\n        if (!response.ok) {\n          throw new Error(\"网络错误，无法获取图片\");\n        }\n        const blob = await response.blob();\n        const img = new Image();\n        const url = URL.createObjectURL(blob);\n        img.onload = async () => {\n          const canvas = document.createElement(\"canvas\");\n          canvas.width = img.width;\n          canvas.height = img.height;\n          const ctx = canvas.getContext(\"2d\");\n          ctx.drawImage(img, 0, 0);\n          // 使用 Promise 包装 toBlob\n          const pngBlob = await new Promise((resolve) => {\n            canvas.toBlob(resolve, \"image/png\");\n          });\n          if (pngBlob) {\n            const item = new ClipboardItem({ \"image/png\": pngBlob });\n            await navigator.clipboard.write([item]); // 使用 await\n            this.$message({\n              message: \"图片已复制到剪贴板\",\n              type: \"success\",\n            });\n          } else {\n            this.$message({\n              message: \"转换为 PNG 失败\",\n              type: \"error\",\n            });\n          }\n          URL.revokeObjectURL(url);\n        };\n        img.onerror = () => {\n          this.$message({ message: \"加载图片失败\", type: \"error\" });\n          URL.revokeObjectURL(url); // 确保在错误时也释放 URL\n        };\n        img.src = url;\n      } catch (err) {\n        console.error(\"复制图片失败:\", err);\n        this.$message({ message: \"复制图片失败\", type: \"error\" });\n      }\n    },\n    // 封装下载图片的函数\n    async downloadImage(imgSrc) {\n      try {\n        const link = document.createElement(\"a\");\n        link.href = imgSrc;\n        link.download = \"image.png\";\n        link.click();\n      } catch (err) {\n        console.error(\"保存图片失败：\", err);\n        this.$message({ message: \"保存图片失败\", type: \"error\" });\n      }\n    },\n  },\n};\n</script>\n<style lang=\"sass\" scoped>\n#message-menu\n    position: fixed\n    display: flex\n    flex-direction: column\n    justify-content: center\n    background-color: hsla(0, 0%, 100%, .78)\n    backdrop-filter: blur(0.5rem)\n    border-radius: 0.5rem\n    padding: .5rem\n    z-index: 9999\n    -webkit-user-select: none\n    -moz-user-select: none\n    -ms-user-select: none\n    user-select: none\n    \n    // 移动端样式 - 横向网格布局\n    @media (max-width: 768px)\n        display: grid\n        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr))\n        padding: 0.5rem\n        max-width: 16rem\n        background-color: rgba(40, 44, 52, 0.85)\n        border-radius: 1rem\n\n        left: 50%\n        transform: translateX(-50%)\n        \n    @keyframes pop-up\n        0%\n            transform: scale(1)\n        50%\n            transform: scale(1.2)\n        100%\n            transform: scale(1)\n            \n    & div\n        margin: 0.4rem 0\n        padding: .2rem .4rem\n        border-radius: .2rem\n        display: flex\n        justify-content: space-between\n        align-items: center\n        cursor: pointer\n        \n        // 移动端单个菜单项样式\n        @media (max-width: 768px)\n            margin: 0\n            flex-direction: column\n            justify-content: center\n            align-items: center\n            text-align: center\n            border-radius: 0.8rem\n            padding: 0rem 0rem\n            min-height: 3rem\n            background-color: transparent\n            transition: background-color 0.2s ease\n            \n    & div:hover\n        background-color: hsla(0, 0%, 90%, .88)\n        \n        // 移动端悬停效果\n        @media (max-width: 768px)\n            background-color: rgba(255, 255, 255, 0.1)\n            \n    & div:hover > i\n        animation: pop-up 0.5s ease-in-out 1 forwards\n        \n    & i\n        position: absolute\n        display: flex\n        justify-content: center\n        align-items: center\n        transform-origin: center\n        \n        // 移动端图标样式\n        @media (max-width: 768px)\n            position: static\n            font-size: 1rem\n            margin-bottom: 0.3rem\n            color: rgba(255, 255, 255, 0.9)\n            \n    & span\n        font-size: 0.8rem\n        color: rgb(120, 124, 127)\n        margin-left: 1.8rem\n        \n        // 移动端文字样式\n        @media (max-width: 768px)\n            margin-left: 0\n            font-size: 0.7rem\n            color: rgba(255, 255, 255, 0.8)\n            line-height: 1.2\n            word-break: break-all\n</style>\n","<template>\n  <div class=\"add-contactor\">\n    <div class=\"head\">\n      <div class=\"title\">添加机器人</div>\n      <div class=\"close-icon\" @click=\"close\">✕</div>\n    </div>\n    <div class=\"body\">\n      <div class=\"search\">\n        <i class=\"iconfont sousuo listicon\" />\n        <input\n          v-model=\"keyWord\"\n          type=\"text\"\n          placeholder=\"输入搜索关键词\"\n          @input=\"loadSerachPresets\"\n        />\n      </div>\n      <div class=\"info\">\n        <header class=\"presets-types\">\n          <nav\n            v-for=\"(type, index) in avaliablePresetTypes\"\n            :key=\"index\"\n            :class=\"activeTypeIndex === index ? 'active' : ''\"\n            @click=\"changeShownType(index)\"\n          >\n            {{ type }}\n          </nav>\n        </header>\n        <div :style=\"{ left: buttonTranslate }\" class=\"slide-button\"></div>\n        <div\n          v-if=\"shownPrestsList.length > 0 || [0, 3].includes(activeTypeIndex)\"\n          class=\"presets-list\"\n        >\n          <div\n            v-for=\"(preset, index) in shownPrestsList\"\n            :key=\"index\"\n            class=\"presets-item\"\n          >\n            <div v-if=\"preset.avatar\" class=\"preset-avatar custom\">\n              <img :src=\"preset.avatar\" />\n            </div>\n            <div v-else-if=\"preset.model\" class=\"preset-avatar model\">\n              <img :src=\"Contactor.getAvatarByModel(preset.model)\" />\n            </div>\n            <div v-else class=\"preset-avatar\">\n              {{ preset.name.slice(0, 2) }}\n            </div>\n            <div class=\"preset-info\">\n              <div class=\"preset-name\">{{ preset.name }}</div>\n              <div :title=\"preset.opening\" class=\"preset-description\">\n                {{ preset.opening }}\n              </div>\n            </div>\n            <el-button @click=\"addBot(preset)\">添加</el-button>\n          </div>\n          <div v-show=\"showPresetsLoader\" ref=\"loader\" class=\"loading\">\n            <div></div>\n            <div></div>\n            <div></div>\n            <div></div>\n            <div></div>\n          </div>\n        </div>\n        <div v-else class=\"empty-list\">\n          <el-empty :image-size=\"200\" />\n        </div>\n      </div>\n      <div class=\"options\"></div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Contactor from \"../lib/contactor\";\nexport default {\n  emits: [\"addBot\", \"close\"],\n  data() {\n    const avaliablePresetTypes = [\"推荐\", \"最近\", \"本地\", \"系统\"];\n    return {\n      show: false,\n      presetsList: [],\n      recommendPresets: [],\n      recentPresets: [],\n      localPresets: [],\n      systemPresets: [],\n      searchPresets: [],\n      systemShownNum: 0,\n      recommendShownNum: 0,\n      keyWord: \"\",\n      activeTypeIndex: 0,\n      buttonTranslate: 0,\n      avaliablePresetTypes,\n      moreSystemPresets: true,\n      moreRecommendPresets: true,\n      observer: null, // Store the observer instance\n      Contactor,\n    };\n  },\n  computed: {\n    showPresetsLoader() {\n      return this.activeTypeIndex == 3\n        ? this.moreSystemPresets\n        : this.activeTypeIndex == 0\n          ? this.moreRecommendPresets\n          : false;\n    },\n    shownPrestsList() {\n      // 如果 keyWord 不为空，返回 searchPresets\n      if (this.keyWord) {\n        return this.searchPresets;\n      }\n      return this.activeTypeIndex === 2\n        ? this.localPresets\n        : this.activeTypeIndex === 1\n          ? this.recentPresets\n          : this.activeTypeIndex === 0\n            ? this.recommendPresets\n            : this.activeTypeIndex === 3\n              ? this.systemPresets\n              : null; // 或者返回默认值\n    },\n  },\n  async mounted() {\n    this.getAddHistory();\n\n    await this.loadSpecificType();\n\n    if (\"IntersectionObserver\" in window) {\n      const callback = (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            this.loadMoreData();\n          }\n        });\n      };\n\n      this.observer = new IntersectionObserver(callback);\n      const presetsLoader = this.$refs.loader;\n      if (presetsLoader) {\n        this.observer.observe(presetsLoader);\n      }\n    } else {\n      // Fallback for browsers that do not support IntersectionObserver\n      // Use scroll event to detect when the loader is visible.\n      window.addEventListener(\"scroll\", this.handleScroll);\n    }\n  },\n  beforeUnmount() {\n    if (this.observer) {\n      this.observer.disconnect();\n    } else {\n      window.removeEventListener(\"scroll\", this.handleScroll);\n    }\n  },\n  methods: {\n    async addBot(preset) {\n      this.strogeAddHistory(preset);\n      this.$emit(\"addBot\", preset);\n      this.$message.success(\"添加成功\");\n    },\n    strogeAddHistory(preset) {\n      // 先检查现有列表中是否有重复项\n      const existingItem = this.recentPresets.find(\n        (item) => item.name === preset.name,\n      );\n      if (existingItem) {\n        // 如果有重复项，将其从数组中移除\n        this.recentPresets.splice(this.recentPresets.indexOf(existingItem), 1);\n      }\n      // 添加新项目到数组的最前面\n      this.recentPresets.unshift(preset);\n      // 检查数组长度并保持在小于或等于 10\n      if (this.recentPresets.length > 10) {\n        this.recentPresets.pop(); // 移除最后一个元素，即最旧的元素\n      }\n      // 更新到 localStorage\n      localStorage.setItem(\"addHistory\", JSON.stringify(this.recentPresets));\n    },\n    getAddHistory() {\n      const data = localStorage.getItem(\"addHistory\");\n      if (data) {\n        this.recentPresets = JSON.parse(data);\n      }\n    },\n    async changeShownType(index) {\n      this.activeTypeIndex = index;\n      this.buttonTranslate = `${49.6 * index}px`;\n      await this.loadSpecificType();\n    },\n    close() {\n      this.$emit(\"close\");\n    },\n    async loadSpecificType() {\n      const type = this.avaliablePresetTypes[this.activeTypeIndex];\n      this.presetsList = await this.getPresetList(type);\n    },\n    async getPresetList(type) {\n      if (type === \"系统\") {\n        return await this.loadSystemPresets();\n      } else if (type === \"推荐\") {\n        return await this.loadRecommendedPresets();\n      } else if (type === \"最近\") {\n        return this.recentPresets;\n      } else if (type === \"本地\") {\n        return this.localPresets;\n      }\n    },\n    async loadRecommendedPresets() {\n      const res = await fetch(\n        `/api/openai/presets?type=recommended&start=${this.recommendShownNum}`,\n      ).then((res) => res.json());\n      for (let i = 0; i < res.data.length; i++) {\n        this.recommendPresets.push(res.data[i]);\n      }\n      this.recommendShownNum += res.data.length;\n      if (res.data.length < 9) {\n        this.moreRecommendPresets = false;\n      }\n      return this.recommendPresets;\n    },\n    async loadSystemPresets() {\n      const res = await fetch(\n        `/api/openai/presets?type=system&start=${this.systemShownNum}`,\n      ).then((res) => res.json());\n      for (let i = 0; i < res.data.length; i++) {\n        this.systemPresets.push(res.data[i]);\n      }\n      this.systemShownNum += res.data.length;\n      if (res.data.length < 9) {\n        this.moreSystemPresets = false;\n      }\n      return this.systemPresets;\n    },\n    async loadSerachPresets() {\n      const load = async () => {\n        const res = await fetch(\n          `/api/openai/presets?type=search&keyword=${this.keyWord}`,\n        ).then((res) => res.json());\n        this.searchPresets = res.data;\n      };\n      // 添加节流逻辑\n      if (this.searchTimer) {\n        clearTimeout(this.searchTimer);\n      }\n      this.searchTimer = setTimeout(() => {\n        load();\n      }, 500);\n    },\n    loadMoreData() {\n      if (this.showPresetsLoader && this.activeTypeIndex === 3) {\n        this.loadSystemPresets();\n      } else if (this.showPresetsLoader && this.activeTypeIndex === 0) {\n        this.loadRecommendedPresets();\n      }\n    },\n    handleScroll() {\n      const loader = this.$refs.loader;\n      if (!loader) return;\n\n      const rect = loader.getBoundingClientRect();\n      const isVisible =\n        rect.top >= 0 &&\n        rect.left >= 0 &&\n        rect.bottom <=\n          (window.innerHeight || document.documentElement.clientHeight) &&\n        rect.right <=\n          (window.innerWidth || document.documentElement.clientWidth);\n\n      if (isVisible) {\n        this.loadMoreData();\n      }\n    },\n  },\n};\n</script>\n<style scoped>\n.empty-list {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n}\n\n.presets-list {\n  position: relative;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-top: 1rem;\n  height: calc(100% - 3rem);\n  overflow-y: auto;\n}\n\n.preset-description {\n  white-space: nowrap;\n  /* 不换行 */\n  overflow: hidden;\n  /* 内容超出隐藏 */\n  text-overflow: ellipsis;\n  /* 使用省略号 */\n  font-size: 0.8rem;\n  color: #888;\n  width: 100%;\n}\n\n.presets-item button {\n  flex-basis: 60px;\n}\n\n.presets-loader {\n  width: 100%;\n  height: 1rem;\n}\n\n.presets-item {\n  position: relative;\n  margin-top: 0.5rem;\n  width: 100%;\n  max-width: 100%;\n  display: flex;\n  flex-basis: 3rem;\n  justify-content: space-around;\n}\n\n.preset-avatar {\n  min-width: 2.8rem;\n  max-width: 2.8rem;\n  height: 2.8rem;\n  background-color: #0099ff;\n  color: #fff;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.preset-avatar.model {\n  background-color: #ffffff;\n  border-radius: 50%;\n}\n\n.preset-avatar.custom img {\n  width: 100%;\n  border-radius: 50%;\n}\n\n.preset-avatar.model img {\n  width: 90%;\n}\n\n.preset-info {\n  position: relative;\n  margin-left: 0.5rem;\n  width: calc(100% - 7.5rem);\n}\n\n.slide-button {\n  width: 2rem;\n  border-top: #0099ff 2px solid;\n  margin-left: 0.3rem;\n  position: relative;\n  left: 0;\n  transition: left 0.3s;\n}\n\n.body {\n  margin-top: 0.5rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding-left: 1rem;\n  padding-right: 1rem;\n  overflow: hidden;\n  position: relative;\n  height: calc(100% - 2.5rem);\n}\n\n.info {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  position: relative;\n  height: calc(100% - 2.5rem);\n}\n\n.presets-types {\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-start;\n  width: 100%;\n  margin-top: 1rem;\n  position: relative;\n}\n\n.presets-types nav {\n  cursor: pointer;\n  padding: 0.2rem 0.5rem;\n  margin-right: 0.5rem;\n  border-radius: 0.5rem;\n  font-size: 0.8rem;\n}\n\n.presets-types nav.active {\n  color: #0099ff;\n}\n\n.search {\n  position: relative;\n  box-sizing: border-box;\n  border-bottom: 1px solid #f1f1f1;\n  width: 100%;\n  height: 2em;\n  background-color: #f1f1f1;\n  border-radius: 0.5rem;\n  display: flex;\n  align-items: center;\n  padding-left: 0.5rem;\n}\n\n.search:has(input:focus) {\n  border: #0099ff 1px solid;\n}\n\n.search input {\n  position: absolute;\n  width: calc(100% - 2rem);\n  height: 1.5rem;\n  background-color: #f1f1f1;\n  border: none;\n  outline: none;\n  margin-left: 1rem;\n}\n\n.search i {\n  position: absolute;\n  font-size: 0.8rem;\n  color: #888;\n}\n\n.add-contactor {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 400px;\n  height: 500px;\n  background-color: #fff;\n  border-radius: 10px;\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n  z-index: 100;\n  overflow: hidden;\n}\n\n.head {\n  height: 2rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-bottom: 1px solid #f1f1f1;\n  font-size: 0.8rem;\n  padding-left: 1rem;\n}\n\n.close-icon {\n  width: 1.5rem;\n  font-size: 0.8rem;\n  height: 100%;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.close-icon:hover {\n  color: aliceblue;\n  background-color: rgb(196, 43, 28);\n}\n\n@media (max-width: 600px) {\n  .add-contactor {\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    transform: none;\n    border-radius: 0;\n  }\n}\n</style>\n<style>\n.loading,\n.loading > div {\n  position: relative;\n  box-sizing: border-box;\n}\n\n.loading {\n  display: block;\n  font-size: 0;\n  color: #000;\n}\n\n.loading.la-dark {\n  color: #333;\n}\n\n.loading > div {\n  display: inline-block;\n  float: none;\n  background-color: currentColor;\n  border: 0 solid currentColor;\n}\n\n.loading {\n  margin-top: 1rem;\n  width: 16px;\n  min-height: 1rem;\n}\n\n.loading > div {\n  position: absolute;\n  top: 0;\n  left: -100%;\n  display: block;\n  width: 16px;\n  width: 100%;\n  height: 16px;\n  height: 100%;\n  border-radius: 100%;\n  opacity: 0.5;\n  animation:\n    ball-circus-position 2.5s infinite cubic-bezier(0.25, 0, 0.75, 1),\n    ball-circus-size 2.5s infinite cubic-bezier(0.25, 0, 0.75, 1);\n}\n\n.loading > div:nth-child(1) {\n  animation-delay:\n    0s,\n    -0.5s;\n}\n\n.loading > div:nth-child(2) {\n  animation-delay:\n    -0.5s,\n    -1s;\n}\n\n.loading > div:nth-child(3) {\n  animation-delay:\n    -1s,\n    -1.5s;\n}\n\n.loading > div:nth-child(4) {\n  animation-delay:\n    -1.5s,\n    -2s;\n}\n\n.loading > div:nth-child(5) {\n  animation-delay:\n    -2s,\n    -2.5s;\n}\n\n@keyframes ball-circus-position {\n  50% {\n    left: 100%;\n  }\n}\n\n@keyframes ball-circus-size {\n  50% {\n    transform: scale(0.3, 0.3);\n  }\n}\n</style>\n","<script>\nimport { client, config } from \"@/lib/runtime.js\";\nimport AddContactor from \"@/components/AddContactor.vue\";\nimport ContextMenu from \"@/components/ContextMenu.vue\";\n\nexport default {\n  components: {\n    AddContactor,\n    ContextMenu,\n  },\n  data() {\n    return {\n      contactorList: [],\n      showAddOptions: false,\n      showAddWindow: false,\n      showMenu: false,\n      menuX: 0,\n      menuY: 0,\n      selectedFriend: null,\n    };\n  },\n  computed: {\n    sortedList() {\n      return [...this.contactorList].sort((a, b) =>\n        b.priority < a.priority ? 1 : b.lastUpdate - a.lastUpdate,\n      );\n    },\n    avaliableProvideres() {\n      return config.getLLMProviders().map((item) => item.value);\n    },\n  },\n  created() {\n    if (client.getContactors().length == 0) {\n      client.on(\n        \"loaded\",\n        () => {\n          this.contactorList = client.getContactors();\n          this.addReactiveListener();\n        },\n        false,\n      );\n    } else {\n      this.contactorList = client.getContactors();\n      this.addReactiveListener();\n    }\n  },\n  methods: {\n    genBotByPreset() {\n      this.showAddOptions = false;\n      this.showAddWindow = true;\n    },\n    showChat(id) {\n      // 如果当前路径 name 是 blank 或者 chat_view ，跳转到 /chat/:id\n      if (this.$route.name == \"blank\" || this.$route.name == \"chat_view\") {\n        this.$router.push({ name: \"chat_view\", params: { id: id } });\n      } else if (\n        this.$route.name == \"contactors\" ||\n        this.$route.name == \"profile_view\"\n      ) {\n        this.$router.push({ name: \"profile_view\", params: { id: id } });\n      } else {\n        // 否则，直接跳转到 /chat/:id\n        this.$router.replace({ name: \"chat_view\", params: { id: id } });\n      }\n    },\n    getId(item) {\n      // 获取当前页面的id\n      let currentId = this.$route.params.id;\n      // 获取当前页面的contactorId\n      let contactorId = item.id;\n      // 如果当前页面的id和contactorId相同，则返回active\n      if (currentId == contactorId) {\n        return \"active\";\n      } else {\n        return item.priority == 0 ? \"important\" : \"\";\n      }\n    },\n    async genBotByProvider(provider) {\n      const options = config.getLLMDefaultConfig(provider);\n      const blankConfig = {\n        id: this.genFakeId(),\n        title: options.default_model,\n        avatarPolicy: 0,\n        namePolicy: 2,\n        priority: 1,\n        options: options,\n      };\n\n      this.showAddOptions = false;\n      await client.addConcator(\"openai\", blankConfig);\n      this.addReactiveListener();\n    },\n    startResize(event) {\n      this.isResizing = true;\n      this.startX = event.clientX;\n      this.startWidth = this.$refs.friendlists.offsetWidth;\n      document.addEventListener(\"mousemove\", this.resize);\n      document.addEventListener(\"mouseup\", this.stopResize);\n    },\n    resize(event) {\n      if (this.isResizing) {\n        // debugger;\n        let newWidth = this.startWidth + (event.clientX - this.startX);\n        const remSize = document.documentElement.style.fontSize\n          ? parseFloat(document.documentElement.style.fontSize)\n          : 16;\n        const maxWidth = 20 * remSize;\n        const minWidth = 12 * remSize;\n        newWidth =\n          newWidth > maxWidth\n            ? maxWidth\n            : newWidth < minWidth\n              ? minWidth\n              : newWidth;\n        this.$refs.friendlists.style.minWidth = newWidth + \"px\";\n        this.$refs.friendlists.style.maxWidth = newWidth + \"px\";\n      }\n    },\n    stopResize() {\n      this.isResizing = false;\n      document.removeEventListener(\"mousemove\", this.resize);\n      document.removeEventListener(\"mouseup\", this.stopResize);\n    },\n    genFakeId() {\n      return client.genFakeId();\n    },\n    manageAddMenu() {\n      this.showAddOptions = !this.showAddOptions;\n    },\n    mergeOptions(options) {\n      const defaultOptions = config.getLLMDefaultConfig();\n      if (options.history)\n        defaultOptions.presetSettings.history = options.history;\n      if (options.tools?.length > 0)\n        defaultOptions.toolCallSettings.tools = config.getValidTools(\n          options.tools,\n        );\n      if (options.opening)\n        defaultOptions.presetSettings.opening = options.opening;\n\n      if (options.model) {\n        // 先获取可用的 provider 列表\n        const availableProviders = config\n          .getLLMProviders()\n          .map((item) => item.value);\n        // 看看哪个 provider 里面有这个 model\n        const provider = availableProviders.find((provider) =>\n          config.isModelAvailable(provider, options.model),\n        );\n        if (provider) {\n          // 如果找到了 provider，就使用这个 provider\n          defaultOptions.provider = provider;\n          defaultOptions.base.model = options.model;\n        } else {\n          // 如果没有找到 provider，就使用默认的 provider\n          defaultOptions.base.model = options.model;\n          this.$message({\n            message: \"预设模型不存在, 已使用默认模型\",\n            type: \"error\",\n          });\n        }\n      }\n      return defaultOptions;\n    },\n    async addPresetContactor(preset) {\n      const contactor = {\n        id: this.genFakeId(),\n        namePolicy: 1,\n        avatarPolicy: preset.avatar ? 1 : 0,\n        avatar: preset.avatar ? preset.avatar : undefined,\n        name: preset.name,\n        title: preset.title,\n        priority: 1,\n        options: this.mergeOptions(preset),\n      };\n      await client.addConcator(\"openai\", contactor);\n      this.addReactiveListener();\n    },\n    showFriendContextMenu(event, friend) {\n      this.selectedFriend = friend;\n      this.menuX = event.clientX;\n      this.menuY = event.clientY;\n      this.showMenu = true;\n\n      const closeMenu = () => {\n        this.showMenu = false;\n        document.removeEventListener(\"click\", closeMenu);\n      };\n      document.addEventListener(\"click\", closeMenu);\n    },\n\n    async handleFriendOption(option) {\n      switch (option) {\n        case \"enter\":\n          this.showChat(this.selectedFriend.id);\n          break;\n        case \"priority\":\n          this.selectedFriend.priority =\n            this.selectedFriend.priority === 0 ? 1 : 0;\n          client.setLocalStorage();\n          break;\n        case \"share\": {\n          const shareResult = await client.shareContactor(\n            this.selectedFriend.id,\n          );\n          if (shareResult) {\n            this.$message({\n              message: \"分享链接已复制\",\n              type: \"success\",\n            });\n          } else {\n            this.$message({\n              message: \"分享失败\",\n              type: \"error\",\n            });\n          }\n          break;\n        }\n        case \"delete\": {\n          let index;\n          index = this.contactorList.findIndex(\n            (c) => c.id === this.selectedFriend.id,\n          );\n          if (index !== -1) {\n            this.contactorList.splice(index, 1);\n            client.setLocalStorage();\n          }\n          break;\n        }\n      }\n      this.showMenu = false;\n    },\n\n    addReactiveListener() {\n      console.log(\"addReactiveListener\");\n      this.contactorList.map((contactor) => {\n        contactor.on(\"updateMessageSummary\", () => {\n          console.log(\"updateMessageSummary\");\n          contactor.lastMessageSummary = contactor.getLastMessageSummary();\n          this.$forceUpdate();\n        });\n      });\n    },\n  },\n};\n</script>\n\n<template>\n  <div id=\"friendlists\" ref=\"friendlists\">\n    <div id=\"friends\" class=\"upsidebar\">\n      <div class=\"search\">\n        <i class=\"iconfont sousuo listicon\"></i>\n        <input id=\"main-search\" type=\"text\" placeholder=\"搜索\" />\n      </div>\n      <div class=\"bu-add\">\n        <button id=\"addcont\" title=\"Add Bot\" @click=\"manageAddMenu\">\n          <i class=\"iconfont add\"></i>\n        </button>\n        <div v-show=\"showAddOptions\" id=\"add-options\">\n          <ul>\n            <li v-for=\"(provider, index) in avaliableProvideres\" :key=\"index\">\n              <button @click=\"genBotByProvider(provider)\">\n                新建 {{ provider }} Bot\n              </button>\n            </li>\n            <li>\n              <button @click=\"genBotByPreset\">从预设新建Bot</button>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n    <div class=\"people\">\n      <div\n        v-for=\"(item, index) of sortedList\"\n        :id=\"getId(item)\"\n        :key=\"index\"\n        class=\"lists\"\n        @click=\"showChat(item.id)\"\n        @contextmenu.prevent=\"showFriendContextMenu($event, item)\"\n      >\n        <div\n          class=\"avatar\"\n          :class=\"item.avatarPolicy == 1 ? 'custom' : 'model'\"\n        >\n          <img :src=\"item.avatar\" :alt=\"item.name\" />\n        </div>\n        <div class=\"info\">\n          <div class=\"name\">{{ item.name }}</div>\n          <div id=\"time\" class=\"msginfo\">{{ item.getLastTime() }}</div>\n          <div id=\"msgctt\" class=\"msginfo\">{{ item.lastMessageSummary }}</div>\n        </div>\n      </div>\n    </div>\n    <div class=\"resizer\" @mousedown=\"startResize\"></div>\n    <AddContactor\n      v-if=\"showAddWindow\"\n      @close=\"showAddWindow = false\"\n      @add-bot=\"addPresetContactor\"\n    ></AddContactor>\n    <ContextMenu\n      v-if=\"showMenu\"\n      type=\"friend\"\n      :message=\"selectedFriend\"\n      :style=\"{\n        position: 'fixed',\n        left: menuX + 'px',\n        top: menuY + 'px',\n      }\"\n      @message-option=\"handleFriendOption\"\n      @close=\"showMenu = false\"\n    />\n  </div>\n</template>\n\n<style scoped>\n#add-options {\n  position: absolute;\n  top: 2.5rem;\n  background-color: white;\n  width: 8rem;\n  left: 0;\n  border: 0.0625rem solid rgba(161, 154, 154, 0.626);\n  border-radius: 0.3125rem;\n  z-index: 2;\n}\n#add-options li {\n  display: flex;\n  flex-direction: row-reverse;\n  padding: 0.1rem 0.5rem;\n}\n#add-options li:hover {\n  background-color: #f5f5f5;\n}\n#add-options ul {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-around;\n  height: 100%;\n  box-shadow: 0 0 0.5rem rgba(0, 0, 0, 0.1);\n}\n#add-options button {\n  background-color: transparent;\n}\n#friendlists {\n  height: 100%;\n  display: flex;\n  min-width: 14rem;\n  max-width: 14rem;\n  flex-direction: column;\n  position: relative;\n  background-color: #fff;\n}\n\n.resizer {\n  width: 5px;\n  cursor: ew-resize;\n  background-color: transparent; /* 可视化的样式，你可以根据需求进行调整 */\n  position: absolute;\n  right: 0;\n  top: 0;\n  height: 100%;\n}\n\n.upsidebar {\n  justify-content: space-between;\n  display: flex;\n  flex-direction: row;\n  background-color: rgb(255, 255, 255);\n  flex: 0 0 4rem;\n  align-items: flex-end;\n  -webkit-app-region: drag;\n}\n\n#main-search {\n  width: calc(100% - 1.125rem);\n  margin-top: 0.1875rem;\n  padding-left: 0.3125rem;\n  height: 1.125rem;\n  background-color: transparent;\n  border: 0rem;\n}\n\n#main-search:focus {\n  outline: none;\n  border: 0rem;\n}\n\nbutton#searchButton {\n  width: 1rem;\n  border: 0rem;\n  border-radius: 0.3125rem;\n  margin-left: 0.5rem;\n  text-wrap: nowrap;\n}\n\n.search {\n  flex-grow: 1;\n  flex-basis: 1rem;\n  border-radius: 0.3125rem;\n  background-color: rgb(245 245, 245);\n  height: 2rem;\n  display: flex;\n  padding: 0rem 0.5rem;\n  align-items: center;\n  margin: 0 0 0.5rem 0.5rem;\n}\n\n.bu-add {\n  flex-basis: 2rem;\n  font-size: 1rem;\n  margin: 0.5rem;\n  height: 2rem;\n  position: relative;\n}\n\n.listicon {\n  padding-top: 0.0625rem;\n  width: 1rem;\n  height: 1rem;\n}\n\nbutton#addcont {\n  border-radius: 0.3125rem;\n  width: 100%;\n  height: 100%;\n  border: none;\n}\n\n.lists {\n  align-items: center;\n  min-width: 10rem;\n  display: flex;\n  padding: 0.25rem 0.5rem;\n  height: 3.75rem;\n  max-height: 3.75rem;\n  min-height: 3.75rem;\n  /* border: .0625rem solid pink; */\n}\n\n.lists#important {\n  background-color: rgb(240, 240, 240);\n}\n\n.lists:hover {\n  background-color: rgb(240, 240, 240);\n  /* border: .0625rem solid pink; */\n}\n\n.lists#important:hover {\n  background-color: rgb(231, 231, 231);\n  /* border: .0625rem solid pink; */\n}\n\n.lists#active {\n  background-color: rgb(0, 153, 255);\n}\n\n.lists > .avatar {\n  flex-basis: 2.65rem;\n  min-width: 2.65rem;\n  height: 2.65rem;\n  border-radius: 50%;\n  overflow: hidden;\n  background-color: white;\n}\n\n.avatar > img {\n  width: 100%;\n  height: 100%;\n}\n\n.avatar.model > img {\n  scale: 0.9;\n}\n\n.info {\n  height: 100%;\n  display: flex;\n  align-items: baseline;\n  justify-content: space-between;\n  flex: 0 0 calc(100% - 2.65rem);\n  max-width: calc(100% - 2.65rem);\n  flex-wrap: wrap;\n}\n\n.lists#active * {\n  color: #f0f8ff;\n}\n\n.lists .name {\n  flex-basis: 4rem;\n  flex-grow: 1;\n  margin-top: 0.75rem;\n  font-size: 0.875rem;\n  margin-left: 0.5rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.info #time {\n  font-size: 0.625rem;\n  flex-grow: 1;\n  text-align: right;\n}\n\n.info #msgctt {\n  flex-basis: 100%;\n  padding-right: 1rem;\n  font-size: 0.625rem;\n  margin-left: 0.5rem;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.people {\n  overflow-y: auto;\n}\n\n@media screen and (max-width: 600px) {\n  #friendlists {\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    max-width: none;\n  }\n\n  #add-options {\n    left: -6rem;\n  }\n}\n</style>\n","<template>\n  <div class=\"presets-list\">\n    <div\n      v-for=\"(message, index) of presetMessages\"\n      :key=\"index\"\n      class=\"preset-message\"\n    >\n      <div class=\"preset-message-block\">\n        <div\n          class=\"message-avatar\"\n          @mouseover=\"hoveredIndex = index\"\n          @mouseleave=\"hoveredIndex = null\"\n        >\n          <div v-if=\"hoveredIndex != index\" class=\"avatar-emoji\">\n            {{ getMessageAvatar(message.role) }}\n          </div>\n          <div\n            v-else\n            title=\"删除消息\"\n            class=\"avatar-emoji hovered\"\n            @click=\"delPresetMessage\"\n          >\n            🗑️\n          </div>\n        </div>\n        <div\n          :ref=\"`message-${index}`\"\n          class=\"message-content\"\n          contenteditable=\"true\"\n          @blur=\"handleMessageUpdate(index)\"\n        >\n          {{ presetMessages[index].content }}\n        </div>\n      </div>\n    </div>\n    <div class=\"messages-buttons\">\n      <el-button title=\"添加系统消息\" plain @click=\"addPresetMessage('system')\"\n        >➕ ⚙️</el-button\n      >\n      <el-button\n        title=\"添加助手消息\"\n        plain\n        @click=\"addPresetMessage('assistant')\"\n        >➕ 🤖</el-button\n      >\n      <el-button title=\"添加用户消息\" plain @click=\"addPresetMessage('user')\"\n        >➕ 👤</el-button\n      >\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    presetsHistory: {\n      type: Array,\n      default: () => [],\n    },\n  },\n  emits: [\"updatePresets\"],\n  data() {\n    const presetMessages = [...this.presetsHistory];\n    return {\n      presetMessages,\n      hoveredIndex: undefined,\n    };\n  },\n  watch: {\n    presetsHistory(newVal) {\n      this.presetMessages = [...newVal];\n    },\n  },\n  methods: {\n    delPresetMessage() {\n      this.presetMessages.splice(this.hoveredIndex, 1);\n      this.$emit(\"updatePresets\", this.presetMessages);\n    },\n    addPresetMessage(role) {\n      if (role == \"system\" && this.presetMessages.length > 0) {\n        this.$message.warning(\"系统消息必须是第一条消息\");\n        return;\n      }\n      this.presetMessages.push({\n        role,\n        content: \"\",\n      });\n      this.$emit(\"updatePresets\", this.presetMessages);\n    },\n    getMessageAvatar(role) {\n      return role == \"assistant\" ? \"🤖\" : role == \"system\" ? \"⚙️\" : \"👤\";\n    },\n    handleMessageUpdate(index) {\n      this.presetMessages[index].content =\n        this.$refs[`message-${index}`][0].innerText;\n      this.$emit(\"updatePresets\", this.presetMessages);\n    },\n  },\n};\n</script>\n<style scoped>\n.presets-list {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 100%;\n}\n\n.messages-buttons {\n  width: 100%;\n  display: flex;\n  justify-content: space-evenly;\n  align-items: center;\n  margin: 0.5rem;\n}\n\n.preset-message {\n  width: 100%;\n}\n\n.preset-message-block {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  margin: 0.5rem;\n  justify-content: space-between;\n  align-items: flex-start;\n}\n\n.preset-message-block .message-avatar {\n  flex-basis: 2rem;\n  font-size: 2rem;\n  border: 1px solid #ccc;\n  border-radius: 10%;\n}\n\n.message-avatar .hovered {\n  cursor: pointer;\n  box-shadow: inset 0px 0px 10px rgba(0, 0, 0, 0.493); /* 内阴影 */\n}\n\n.preset-message-block .message-content {\n  margin-left: 0.5rem;\n  font-size: 0.8rem;\n  border: 1px solid #5a9cf8;\n  border-radius: 0.5rem;\n  flex-grow: 1;\n  max-height: 10rem;\n  overflow-y: auto;\n  padding: 0.5rem;\n  min-height: 2rem;\n}\n\n.message-content input {\n  width: 100%;\n  border: none;\n  outline: none;\n}\n</style>\n","<template>\n  <div class=\"settings-container\">\n    <div v-if=\"activeContactorPlatform == 'openai'\" class=\"openai-settings\">\n      <div class=\"settings-block\">\n        <div class=\"block-title\">LLM 基本配置</div>\n        <div class=\"block-content\">\n          <div class=\"block-content-item\">\n            <div class=\"item-title\">来源渠道</div>\n            <div class=\"item-content\">\n              <el-select\n                v-model=\"localLlmProvider\"\n                style=\"width: 10rem\"\n                @change=\"handleProviderChange\"\n              >\n                <el-option\n                  v-for=\"item in llmProvidersList\"\n                  :key=\"item.value\"\n                  :label=\"item.label\"\n                  :value=\"item.value\"\n                />\n              </el-select>\n            </div>\n          </div>\n          <div\n            v-for=\"(_, key) in localLlmGeneralKeys\"\n            :key=\"key\"\n            class=\"block-content-item\"\n          >\n            <div class=\"item-title\">{{ getShownKey(key) }}</div>\n            <div class=\"item-content\">\n              <el-input\n                v-if=\"key === 'model'\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                @change=\"updateGeneralSettings\"\n              ></el-input>\n              <el-input-number\n                v-else-if=\"key === 'max_messages_num'\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                :min=\"1\"\n                :step=\"1\"\n                @change=\"updateGeneralSettings\"\n              />\n              <el-switch\n                v-else-if=\"['stream'].includes(key)\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                @change=\"updateGeneralSettings\"\n              ></el-switch>\n              <el-slider\n                v-else-if=\"['temperature'].includes(key)\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                :step=\"sliderTypes.a.step\"\n                :min=\"sliderTypes.a.min\"\n                :max=\"sliderTypes.a.max\"\n                @change=\"updateGeneralSettings\"\n              />\n              <el-slider\n                v-else-if=\"['top_p'].includes(key)\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                :step=\"sliderTypes.b.step\"\n                :min=\"sliderTypes.b.min\"\n                :max=\"sliderTypes.b.max\"\n                @change=\"updateGeneralSettings\"\n              />\n              <el-slider\n                v-else-if=\"\n                  ['frequency_penalty', 'presence_penalty'].includes(key)\n                \"\n                v-model=\"localLlmGeneralKeys[key]\"\n                :step=\"sliderTypes.c.step\"\n                :min=\"sliderTypes.c.min\"\n                :max=\"sliderTypes.c.max\"\n                @change=\"updateGeneralSettings\"\n              />\n              <el-slider\n                v-else-if=\"['reasoning_effort'].includes(key)\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                :step=\"sliderTypes.d.step\"\n                :min=\"sliderTypes.d.min\"\n                :max=\"sliderTypes.d.max\"\n                :format-tooltip=\"sliderTypes.d.formatter\"\n                @change=\"updateGeneralSettings\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"settings-block\">\n        <div class=\"block-title\">LLM 预设配置</div>\n        <div class=\"block-content\">\n          <div class=\"block-content-item\">\n            <div class=\"item-title\">预设历史记录</div>\n            <div class=\"item-content\">\n              <button\n                :class=\"{\n                  active: showPresetsDetail,\n                  'extra-info-button': true,\n                }\"\n                @click=\"showPresetsDetail = !showPresetsDetail\"\n              >\n                <i class=\"iconfont icon-return\"></i>\n              </button>\n            </div>\n          </div>\n          <transition name=\"expand-slide\">\n            <div\n              v-show=\"showPresetsDetail\"\n              class=\"block-content-item\"\n              style=\"overflow: hidden\"\n            >\n              <PresetsList\n                :presets-history=\"presetsHistoryData\"\n                @update-presets=\"handleUpdatePresets\"\n              />\n            </div>\n          </transition>\n        </div>\n      </div>\n\n      <div class=\"settings-block\">\n        <div class=\"block-title\">LLM 工具调用配置</div>\n        <div class=\"block-content\">\n          <div class=\"block-content-item\">\n            <div class=\"item-title\">工具调用模式</div>\n            <div class=\"item-content\">\n              <el-select\n                v-model=\"localLlmToolCallMode\"\n                placeholder=\"AUTO\"\n                style=\"width: 10rem\"\n                @change=\"handleToolCallModeChange\"\n              >\n                <el-option\n                  v-for=\"item in toolCallModesList\"\n                  :key=\"item.value\"\n                  :label=\"item.label\"\n                  :value=\"item.value\"\n                />\n              </el-select>\n            </div>\n          </div>\n          <div\n            v-for=\"(plugin, index) in localAllLLMTools\"\n            :key=\"index\"\n            class=\"block-content-item parent-item\"\n          >\n            <div class=\"item-title\">{{ plugin.name }}</div>\n            <div class=\"item-content\">\n              <button\n                :class=\"{\n                  active: !plugin.collapsed,\n                  'extra-info-button': true,\n                }\"\n                @click=\"plugin.collapsed = !plugin.collapsed\"\n              >\n                <i class=\"iconfont icon-return\"></i>\n              </button>\n            </div>\n            <transition name=\"expand-slide\">\n              <div\n                v-show=\"!plugin.collapsed\"\n                class=\"item-hidden-content plugin-tools-container\"\n              >\n                <div\n                  v-for=\"(tool, toolIndex) in plugin.tools\"\n                  :key=\"toolIndex\"\n                  class=\"block-content-item child-item\"\n                  :title=\"tool.description\"\n                >\n                  <div class=\"item-title\">\n                    {{ tool.name.split(\"_mid_\")[0] }}\n                  </div>\n                  <div class=\"item-content\">\n                    <el-switch\n                      v-model=\"tool.enabled\"\n                      @change=\"handleToolEnableChange\"\n                    ></el-switch>\n                  </div>\n                </div>\n              </div>\n            </transition>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div\n      v-if=\"['gemini', 'vertex'].includes(localLlmProvider)\"\n      class=\"settings-block\"\n    >\n      <div class=\"block-title\">Gemini 额外设置</div>\n      <div class=\"block-content\">\n        <div class=\"block-content-item\">\n          <div class=\"item-title\">图像生成</div>\n          <div class=\"item-content\">\n            <el-switch\n              v-model=\"localGeminiExtraSettings.imageGeneration\"\n              @change=\"handleGeminiSettingsChange\"\n            ></el-switch>\n          </div>\n        </div>\n        <div class=\"block-content-item\">\n          <div class=\"item-title\">内置工具</div>\n          <div class=\"item-content\">\n            <button\n              :class=\"{\n                active: showInternalTools,\n                'extra-info-button': true,\n              }\"\n              @click=\"showInternalTools = !showInternalTools\"\n            >\n              <i class=\"iconfont icon-return\"></i>\n            </button>\n          </div>\n        </div>\n        <transition name=\"expand-slide\">\n          <div\n            v-show=\"showInternalTools\"\n            class=\"block-content-item\"\n            style=\"overflow: hidden\"\n          >\n            <ul id=\"internal-tools-settings\" class=\"sub-items\">\n              <li\n                v-for=\"(value, key) of localGeminiExtraSettings.internalTools\"\n                :key=\"key\"\n                class=\"block-content-item child-item\"\n              >\n                <div class=\"item-title\">{{ getShownKey(key) }}</div>\n                <div class=\"item-content\">\n                  <el-switch\n                    v-model=\"localGeminiExtraSettings.internalTools[key]\"\n                    @change=\"handleGeminiSettingsChange\"\n                  ></el-switch>\n                </div>\n              </li>\n            </ul>\n          </div>\n        </transition>\n        <div class=\"block-content-item\">\n          <div class=\"item-title\">过滤等级设置</div>\n          <div class=\"item-content\">\n            <button\n              :class=\"{\n                active: showSafetySettings,\n                'extra-info-button': true,\n              }\"\n              @click=\"showSafetySettings = !showSafetySettings\"\n            >\n              <i class=\"iconfont icon-return\"></i>\n            </button>\n          </div>\n        </div>\n        <transition name=\"expand-slide\">\n          <div\n            v-show=\"showSafetySettings\"\n            class=\"block-content-item\"\n            style=\"overflow: hidden\"\n          >\n            <ul id=\"safety-settings\" class=\"sub-items\">\n              <li\n                v-for=\"(value, key) of localGeminiSafetySettings\"\n                :key=\"key\"\n                class=\"block-content-item child-item\"\n              >\n                <div class=\"item-title\">{{ getShownKey(key) }}</div>\n                <div class=\"item-content\">\n                  <el-select\n                    v-model=\"localGeminiSafetySettings[key]\"\n                    style=\"width: 10rem\"\n                    @change=\"handleSafetySettingChange(key)\"\n                  >\n                    <el-option\n                      v-for=\"item in safetySimpleValueOptions\"\n                      :key=\"item.value\"\n                      :label=\"item.label\"\n                      :value=\"item.value\"\n                    />\n                  </el-select>\n                </div>\n              </li>\n            </ul>\n          </div>\n        </transition>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport PresetsList from \"@/components/PresetsList.vue\";\nimport { config } from \"@/lib/runtime.js\";\n\nexport default {\n  name: \"ContactorSettings\",\n  components: {\n    PresetsList,\n  },\n  props: {\n    modelValue: {\n      // for v-model:options\n      type: Object,\n      required: true,\n    },\n    activeContactorPlatform: {\n      type: String,\n      required: true,\n    },\n    llmProvidersList: {\n      type: Array,\n      required: true,\n    },\n    toolCallModesList: {\n      type: Array,\n      required: true,\n    },\n    allLlmToolsData: {\n      // Renamed from allLLMTools to avoid confusion\n      type: Array,\n      required: true,\n    },\n    safetySettingsParams: {\n      type: Object,\n      required: true,\n    },\n    safetySimpleValueOptions: {\n      type: Array,\n      required: true,\n    },\n    presetsHistoryData: {\n      type: Array,\n      default: () => [],\n    },\n  },\n  emits: [\"update:modelValue\", \"provider-changed\", \"update-presets\"],\n  data() {\n    return {\n      localLlmProvider: this.modelValue.provider,\n      localLlmGeneralKeys: {},\n      localLlmToolCallMode: this.modelValue.toolCallSettings?.mode,\n      localAllLLMTools: JSON.parse(JSON.stringify(this.allLlmToolsData)), // Deep copy\n      localGeminiExtraSettings: JSON.parse(\n        JSON.stringify(this.modelValue.extraSettings.gemini),\n      ), // Deep copy\n      localGeminiSafetySettings: {},\n\n      showPresetsDetail: false,\n      showInternalTools: false,\n      showSafetySettings: false,\n      // Moved from parent\n      sliderTypes: {\n        a: { min: 0, max: 2, step: 0.1 },\n        b: { min: 0, max: 1, step: 0.1 },\n        c: { min: -2, max: 2, step: 0.1 },\n        d: {\n          min: -1,\n          max: 3,\n          step: 1,\n          formatter: (value) => {\n            const map = {\n              \"-1\": \"默认\",\n              0: \"关闭思考\",\n              1: \"基础思考\",\n              2: \"均衡思考\",\n              3: \"深度思考\",\n            };\n            return map[value];\n          },\n        },\n      },\n    };\n  },\n  watch: {\n    modelValue: {\n      handler(newVal) {\n        this.localLlmProvider = newVal.provider;\n        this.localLlmToolCallMode = newVal.toolCallSettings?.mode;\n        this.localGeminiExtraSettings = JSON.parse(\n          JSON.stringify(newVal.extraSettings.gemini),\n        );\n        this.initializeSettings();\n      },\n      deep: true,\n    },\n    allLlmToolsData: {\n      handler(newVal) {\n        this.localAllLLMTools = JSON.parse(JSON.stringify(newVal));\n        this.updateEnabledTools();\n      },\n      deep: true,\n    },\n  },\n  created() {\n    this.initializeSettings();\n  },\n  methods: {\n    initializeSettings() {\n      this.localLlmGeneralKeys = {\n        ...this.modelValue.base,\n        ...this.modelValue.chatParams,\n      };\n      if ([\"gemini\", \"vertex\"].includes(this.localLlmProvider)) {\n        this.localGeminiSafetySettings = this.safeSimplify(\n          this.localGeminiExtraSettings.safetySettings,\n        );\n      }\n      this.updateEnabledTools();\n    },\n    updateEnabledTools() {\n      const enabledTools = this.modelValue.toolCallSettings?.tools || [];\n      this.localAllLLMTools = this.localAllLLMTools.map((plugin) => ({\n        ...plugin,\n        tools: plugin.tools.map((tool) => ({\n          ...tool,\n          enabled: enabledTools.includes(tool.name),\n        })),\n      }));\n    },\n    getShownKey(key) {\n      const shownNameMap = {\n        mode: \"工具调用\",\n        model: \"模型\",\n        max_messages_num: \"最大历史消息数\",\n        stream: \"流式响应\",\n        reasoning_effort: \"思考强度\",\n        temperature: \"温度\",\n        top_p: \"核采样\",\n        frequency_penalty: \"重复惩罚度\",\n        presence_penalty: \"话题新鲜度\",\n        HARM_CATEGORY_HARASSMENT: \"骚扰\",\n        HARM_CATEGORY_HATE_SPEECH: \"仇恨言论\",\n        HARM_CATEGORY_SEXUALLY_EXPLICIT: \"色情\",\n        HARM_CATEGORY_DANGEROUS_CONTENT: \"危险内容\",\n        HARM_CATEGORY_CIVIC_INTEGRITY: \"公民诚信\",\n        imageGeneration: \"图像生成\",\n        google_search: \"联网搜索\",\n        code_execution: \"代码执行\",\n        url_context: \"网页解析\",\n      };\n      return shownNameMap[key] || key;\n    },\n    emitUpdate() {\n      const newOptions = JSON.parse(JSON.stringify(this.modelValue)); // Start with a copy of the prop\n\n      const {\n        model,\n        stream,\n        max_messages_num,\n        temperature,\n        top_p,\n        frequency_penalty,\n        presence_penalty,\n        reasoning_effort,\n      } = this.localLlmGeneralKeys;\n      newOptions.base = { model, max_messages_num, stream };\n      newOptions.chatParams = {\n        temperature,\n        top_p,\n        frequency_penalty,\n        presence_penalty,\n        reasoning_effort,\n      };\n\n      newOptions.provider = this.localLlmProvider;\n      if (!newOptions.toolCallSettings) newOptions.toolCallSettings = {};\n      newOptions.toolCallSettings.mode = this.localLlmToolCallMode;\n\n      const activeTools = this.localAllLLMTools.flatMap((plugin) =>\n        plugin.tools.filter((tool) => tool.enabled).map((tool) => tool.name),\n      );\n      console.log(\"Active tools:\", activeTools);\n      newOptions.toolCallSettings.tools = activeTools;\n\n      if (!newOptions.extraSettings) newOptions.extraSettings = {};\n      if (!newOptions.extraSettings.gemini)\n        newOptions.extraSettings.gemini = {\n          internalTools: {},\n          safetySettings: {},\n        };\n      newOptions.extraSettings.gemini = JSON.parse(\n        JSON.stringify(this.localGeminiExtraSettings),\n      );\n\n      this.$emit(\"update:modelValue\", newOptions);\n    },\n    updateGeneralSettings() {\n      this.emitUpdate();\n    },\n    handleProviderChange(newProvider) {\n      this.localLlmProvider = newProvider;\n      const defaultModel = config.getDefaultModel(newProvider);\n      if (defaultModel) {\n        this.localLlmGeneralKeys.model = defaultModel;\n      }\n      this.emitUpdate();\n      this.$emit(\"provider-changed\", newProvider); // Inform parent for avatar, etc.\n\n      // Re-initialize Gemini settings if switching to/from Gemini\n      if ([\"gemini\", \"vertex\"].includes(newProvider)) {\n        this.localGeminiSafetySettings = this.safeSimplify(\n          this.localGeminiExtraSettings.safetySettings,\n        );\n      }\n    },\n    handleUpdatePresets(presets) {\n      this.$emit(\"update-presets\", presets); // Pass through to parent\n    },\n    handleToolCallModeChange() {\n      this.emitUpdate();\n    },\n    handleToolEnableChange() {\n      this.emitUpdate();\n    },\n    handleGeminiSettingsChange() {\n      this.emitUpdate();\n    },\n    safeSimplify(rawSafetySettings) {\n      const result = {};\n      const simplifyMethod = new Map();\n      const table = this.safetySettingsParams;\n      Object.keys(table).forEach((key) => {\n        simplifyMethod.set(table[key], key);\n      });\n      Object.keys(rawSafetySettings || {}).forEach((key) => {\n        result[key] = simplifyMethod.get(rawSafetySettings[key]);\n      });\n      return result;\n    },\n    handleSafetySettingChange(key) {\n      const simplifiedValue = this.localGeminiSafetySettings[key];\n      const originalValue = this.safetySettingsParams[simplifiedValue];\n      if (!this.localGeminiExtraSettings.safetySettings) {\n        // Ensure safetySettings exists\n        this.localGeminiExtraSettings.safetySettings = {};\n      }\n      this.localGeminiExtraSettings.safetySettings[key] = originalValue;\n      this.emitUpdate();\n    },\n  },\n};\n</script>\n"],"names":["EventEmitter","constructor","this","events","on","eventName","listener","refresh","off","push","emit","data","forEach","numberString","length","result","characters","i","charAt","Math","floor","random","randomString","Socket","id","code","super","available","url","getURL","socket","requests","pendingRequests","Set","URL","window","location","href","host","initEventListeners","handleConnect","reason","handleDisconnect","error","handleConnectError","message","messageHandler","hasAttemptedPollingFallback","isAttemptingWebSocket","io","disconnect","setTimeout","_connectWithTransport","transports","path","auth","token","reconnection","reconnectionAttempts","Infinity","reconnectionDelay","reconnectionDelayMax","timeout","forceNew","connect","connected","e","JSON","parse","protocol","request_id","type","delete","sendMessage","Promise","reject","Error","has","add","stringify","resolve","fetch","pathArray","split","filter","Boolean","request","metaData","contactorId","timeOut","_","response","res","race","then","catch","finally","streamCompletions","Adapter","client","Onebot","convertMessage","element","index","base64Data","file","replace","messages","node","rplMessage","midMessage","role","time","Date","getTime","content","message_id","status","send","Openai","config","getMessagesSummary","messageChain","query","settings","getLLMDefaultConfig","base","stream","handleMessageEvent","chunk","messageId","emitEvent","detail","updateHandlers","reasoningContent","reasoning_content","toolCall","tool_call","handler","includes","complete","failed","getVerifiedLLMConfig","AVATAR_BASE_PATH","AVATAR_MAP","OpenAI","Cohere","Anthropic","Google","DeepSeek","avatarPolicy","namePolicy","Contactor","EventEmmiter","platform","title","name","avatar","priority","firstMessageIndex","active","lastUpdate","now","createTime","lastMessageSummary","getLastMessageSummary","options","loadOptions","kernel","enableOpenaiListener","toJSON","rawMessage","getMessageById","existingReasonIndex","findIndex","msgElm","text","startTime","endTime","lastMsgElm","isFirstElement","concat","previousCall","find","updatedCall","action","parameters","indexOf","updateLastUpdate","errElem","some","elm","handleLLMMessageEvent","_getFilePrompt","fileElms","join","_getImagePrompt","imageElms","map","_getValidOpenaiMessage","start","end","max_messages_num","mergedMessages","slice","msg","fileList","imageList","subArray","formatedMsg","_content_type","tool_calls","function","arguments","tool_call_id","finalMessages","textElm","imageElm","fileElm","filePrompt","imagePrompt","image_url","presetHistory","presetSettings","history","updateMessageSummary","getBaseUserContainer","webSend","toServer","revMessage","insertMessage","splice","retryMessage","as","webMessage","delMessage","acting","makeSystemMessage","container","getLastTime","last","currentTime","lastTime","timeDiff","toinit","getHours","toString","padStart","getMinutes","getDay","getFullYear","getMonth","getDate","getShownTime","timestamp","weekdays","weekday","hours","minutes","getMessageText","updateFirstMessage","loadAvatar","model","getAvatarByModel","loadName","modelOwner","getModelOwner","Object","keys","debounce","fn","delay","timeoutId","args","clearTimeout","apply","localforage","TOOL_CALL_MODEDS","AUTO","ANY","NONE","GEMINI_SAFETY_BLOCK_SETTINGS","LOW","MEDIUM","HIGH","DEFAULT","GEMINI_SAFETY_SETTINGS_TYPE","HARASSMENT","HATE_SPEECH","SEXUALLY_EXPLICIT","DANGEROUS_CONTENT","CONFIG_KEY","localPresets","toolsConfig","llmTools","onebotConfig","llmModels","safetyConfig","baseConfig","LLMDefaultConfig","baseConfigCallback","_loadStrogeConfig","initSafetyConfig","initLLMDefaultConfig","loadllmTools","loadonebotConfig","_getLocalStorage","_saveStrogeConfig","_setLocalStorage","key","localStorage","setItem","storedValue","getItem","removeItem","configToSave","loadedConfig","_mergeDefaultsRecursive","target","defaults","prototype","hasOwnProperty","call","defaultValue","targetValue","Array","isArray","requiredCategories","values","configChanged","category","defaultProvider","llm_providers","defaultConfigStructure","provider","getDefaultModel","chatParams","temperature","top_p","frequency_penalty","presence_penalty","reasoning_effort","toolCallSettings","mode","tools","opening","extraSettings","gemini","imageGeneration","internalTools","google_search","code_execution","url_context","safetySettings","getBaseConfig","setBaseConfig","default_model","newDefaultProvider","updateLLMDefaultConfig","setBaseConfigCallback","callback","updateBaseConfig","patch","newBaseConfig","getLLMProviders","value","label","getToolCallModes","entries","getLlmModels","setLlmModels","models","getDefaultLLMModel","isModelAvailable","modelGroup","group","owner","getSafetySettingsParams","getSafetyConfig","setSafetyConfig","newSafetyConfig","originalSubConfigString","originalTopLevelConfig","copiedConfig","defaultModelForProvider","getValidTools","selectedToolNames","availableToolNames","pluginTools","toolName","validToolNames","verifiedConfig","ok","statusText","json","inited","isConnected","contactList","qq","bot_qq","onPhone","setLocalStorage","bind","preInit","localBaseInfo","loadOriginBaseInfo","loadBaseInfo","getLocalStorage","loadLocalStorage","genDefaultConctor","info","onebot_enabled","genFakeId","addConcator","allTools","bot","reactive","rmContactor","list","item","loadOriginalContactors","shareId","contactor","getContactor","shareContactor","uploadResult","setOriginalContactor","previewImage","shareUrl","originalUrl","document","origin","clipboard","navigator","writeText","body","method","headers","reset","clear","resetCache","serviceWorker","controller","messageChannel","MessageChannel","port1","onmessage","event","onerror","postMessage","port2","registrations","getRegistrations","registration","unregister","everLogin","setEverLogin","init","login","getContactors","onebotId","async","addMsgListener","onebotContactors","onebotContactor","logout","admin_qq","uploadFile","fileOrImage","isImage","onProgress","startsWith","uploadImage","chunkSize","md5Hash","uploadChunk","totalChunks","formData","FormData","append","xhr","XMLHttpRequest","open","upload","onprogress","lengthComputable","chunkProgress","loaded","total","overallProgress","round","onload","uploadFileChunks","ceil","size","currentChunk","min","md5","filename","finalizeUpload","worker","UploadWorker","hash","terminate","_convertBlobToBase64","blob","reader","FileReader","onloadend","readAsDataURL","PageStatus","_hoisted_1","_hoisted_2","class","_hoisted_3","_hoisted_5","_hoisted_6","processedImage","activePage","computed","isChatActive","isProfileActive","watch","$route","newRoute","getPageStatusFromRoute","immediate","mounted","adminId","methods","imageUrl","canvas","createElement","ctx","getContext","img","Image","src","width","height","drawImage","centerX","centerY","radius","beginPath","arc","PI","clip","clearRect","toBlob","createObjectURL","toChat","$router","toProfile","toConfig","adminAvatar","processImage","route","_openBlock","_createElementBlock","_createElementVNode","$data","alt","_hoisted_4","_normalizeClass","$options","onClick","mainWindow","props","fullScreen","default","emits","preview","isTauri","__TAURI__","__TAURI_INTERNALS__","created","URLSearchParams","search","get","Window","waiting","$message","alert","getMainWindow","minimizeWindow","minimize","$emit","configFullScreen","maximize","unmaximize","closeWindow","close","$props","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","components","MdRenderer","displayButtons","showBox","innerWidth","_Fragment","$event","_cache","_renderList","_createVNode","_component_displayButtons","onClose","uin","_toDisplayString","_createBlock","_component_MdRenderer","md","theme","_component_el_image","style","margin","fit","_component_ForwardMsg","_ctx","activeContactor","_createCommentVNode","required","selectedOption","cursorPosition","showemoji","openaiModels","onebotPresets","uploaded","files","images","isPasting","extraOptions","loadSelected","debouncedAdjustHeight","adjustTextareaHeight","textareaRef","$refs","textarea","addEventListener","handleDragOver","preventDefault","backgroundColor","handleDragLeave","handleDrop","dataTransfer","handleDroppedFile","handlePaste","textwraper","unmounted","removeEventListener","unsupportedTip","warning","hasInput","hasText","innerText","trim","hasImage","querySelector","handleUploadImage","textToHtml","insertHtmlAtCursor","html","selection","getSelection","rangeCount","innerHTML","setCursorToEnd","range","getRangeAt","deleteContents","tempEl","frag","createDocumentFragment","firstChild","appendChild","insertNode","collapse","removeAllRanges","addRange","clipboardData","items","pastedText","imageFiles","getAsFile","getData","processImageQueue","getemoji","unicode","ctrlEmojiPanel","focus","createRange","selectNodeContents","r","maxSizeByte","maxSizeMB","blobUrl","revokeObjectURL","fileType","toLowerCase","insertImageToTextarea","success","mimeType","quality","File","handleFileUpload","fileInput","accept","format","handleChange","click","uploadDocumentFile","fileUrl","imageName","imageElement","maxWidth","maxHeight","fragment","createContextualFragment","outerHTML","newRange","newSelection","initLLMExtraOptions","allModels","children","getOpenaiModelArray","wrapText","rawText","preset","getOnebotPreset","reduce","acc","child","scrollHeight","getWraperName","updateCursorPosition","startOffset","endOffset","presend","querySelectorAll","ImageSrcs","from","getSafeText","wrappedMessage","imgUrl","unshift","repliedMessageId","cleanScreen","currentChange","level","parent","selectedValues","seletedProvider","handleKeyDown","ctrlKey","execCommand","ref","onEmojiClick","_withModifiers","_component_el_tree_select","modelValue","accordion","placement","onNodeClick","_component_el_popconfirm","onConfirm","reference","contenteditable","onKeydown","String","file_name","file_type","formated_file_size","iconClass","params","bits","formatFileSize","unitIndex","toFixed","toUpperCase","_hoisted_12","_hoisted_13","_hoisted_14","showExtraInfo","toolCallSuccess","toolCallFail","call_status","viewBox","xmlns","points","t","version","d","Number","show","getReasonInfo","updateMaxHeight","updated","toggleShow","reasonContent","_normalizeStyle","seletedText","seletedImage","copySeletedImage","copyImageToClipboard","saveSeletedImage","downloadImage","copyText","copyTextToClipboard","copySeletedText","replyMessage","deleteMessage","enterChat","togglePriority","shareBot","deleteBot","position","left","select","setSelectionRange","err","removeChild","imgSrc","pngBlob","ClipboardItem","write","link","download","_hoisted_15","_hoisted_16","AddContactor","presetsList","recommendPresets","recentPresets","systemPresets","searchPresets","systemShownNum","recommendShownNum","keyWord","activeTypeIndex","buttonTranslate","avaliablePresetTypes","moreSystemPresets","moreRecommendPresets","observer","showPresetsLoader","shownPrestsList","getAddHistory","loadSpecificType","entry","isIntersecting","loadMoreData","IntersectionObserver","presetsLoader","loader","observe","handleScroll","beforeUnmount","addBot","strogeAddHistory","existingItem","pop","changeShownType","getPresetList","loadSystemPresets","loadRecommendedPresets","loadSerachPresets","load","searchTimer","rect","getBoundingClientRect","top","bottom","innerHeight","documentElement","clientHeight","right","clientWidth","placeholder","onInput","_component_el_button","_withCtx","_createTextVNode","_withDirectives","_hoisted_17","_hoisted_18","_component_el_empty","ContextMenu","contactorList","showAddOptions","showAddWindow","showMenu","menuX","menuY","selectedFriend","sortedList","sort","a","b","avaliableProvideres","addReactiveListener","genBotByPreset","showChat","getId","genBotByProvider","blankConfig","startResize","isResizing","startX","clientX","startWidth","friendlists","offsetWidth","resize","stopResize","newWidth","remSize","fontSize","parseFloat","minWidth","manageAddMenu","mergeOptions","defaultOptions","addPresetContactor","showFriendContextMenu","friend","clientY","closeMenu","handleFriendOption","option","c","$forceUpdate","onContextmenu","onMousedown","_component_AddContactor","onAddBot","_component_ContextMenu","onMessageOption","overflow","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_39","_hoisted_40","PresetsList","presetsHistory","presetMessages","hoveredIndex","newVal","delPresetMessage","addPresetMessage","getMessageAvatar","handleMessageUpdate","onMouseover","onMouseleave","ref_for","onBlur","plain","activeContactorPlatform","llmProvidersList","toolCallModesList","allLlmToolsData","safetySettingsParams","safetySimpleValueOptions","presetsHistoryData","localLlmProvider","localLlmGeneralKeys","localLlmToolCallMode","localAllLLMTools","localGeminiExtraSettings","localGeminiSafetySettings","showPresetsDetail","showInternalTools","showSafetySettings","sliderTypes","max","step","formatter","initializeSettings","deep","updateEnabledTools","safeSimplify","enabledTools","plugin","tool","enabled","getShownKey","HARM_CATEGORY_HARASSMENT","HARM_CATEGORY_HATE_SPEECH","HARM_CATEGORY_SEXUALLY_EXPLICIT","HARM_CATEGORY_DANGEROUS_CONTENT","HARM_CATEGORY_CIVIC_INTEGRITY","emitUpdate","newOptions","activeTools","flatMap","updateGeneralSettings","handleProviderChange","newProvider","defaultModel","handleUpdatePresets","presets","handleToolCallModeChange","handleToolEnableChange","handleGeminiSettingsChange","rawSafetySettings","simplifyMethod","Map","table","set","handleSafetySettingChange","simplifiedValue","originalValue","_component_el_select","onChange","_component_el_option","_component_el_input","_component_el_input_number","_component_el_switch","_component_el_slider","_Transition","_component_PresetsList","onUpdatePresets","collapsed","toolIndex","description","_vShow","_hoisted_25","_hoisted_31","_hoisted_32","_hoisted_37","_hoisted_38"],"mappings":"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"}