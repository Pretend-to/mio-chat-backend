{"version":3,"file":"components-DfD8-J9r.js","sources":["../../../src/lib/event.js","../../../src/lib/websocket.js","../../../src/lib/adapter/adapter.js","../../../src/lib/adapter/onebot.js","../../../src/lib/adapter/openai.js","../../../src/lib/contactor.js","../../../src/lib/client.js","../../../src/lib/runtime.js","../../../src/lib/config.js","../../../src/components/SideBar.vue","../../../src/components/DisplayButtons.vue","../../../src/components/ForwardMsg.vue","../../../src/components/InputEditor.vue","../../../src/components/FileBlock.vue","../../../src/components/ToolCallBar.vue","../../../src/components/ReasonBlock.vue","../../../src/components/ContextMenu.vue","../../../src/components/AddContactor.vue","../../../src/components/FriendList.vue","../../../src/components/PresetsList.vue"],"sourcesContent":["export default class EventEmitter {\n  constructor() {\n    this.events = {};\n  }\n  on(eventName, listener, refresh = true) {\n    // 如果 refresh 为真，删除之前的回调函数\n    if (refresh) {\n      this.off(eventName);\n    }\n    // 如果事件名不存在，则初始化为一个空数组\n    if (!this.events[eventName]) {\n      this.events[eventName] = [];\n    }\n    // 添加新的回调函数到数组中\n    this.events[eventName].push(listener);\n  }\n  emit(eventName, data) {\n    if (this.events[eventName]) {\n      this.events[eventName].forEach((listener) => {\n        listener(data);\n      });\n    }\n  }\n  off(eventName) {\n    if (this.events[eventName]) {\n      delete this.events[eventName];\n    }\n  }\n}\n","import EventEmitter from \"./event.js\";\n\n/**\n * WebSocket Connection Class\n * This class handles the WebSocket connection, manages message sending and receiving, and supports heartbeats.\n */\nexport default class Socket extends EventEmitter {\n  /**\n   * Creates an instance of Socket.\n   * @param {String} id - The QQ number of the bot.\n   * @param {String} code - The login token for the bot.\n   */\n  constructor(id, code) {\n    super();\n    this.available = null;\n    this.url = this.getURL();\n    this.socket = null;\n    this.code = code;\n    this.id = id;\n    this.requests = [];\n    this.heartBeat = null;\n    this.delay = null;\n  }\n\n  /**\n   * Retrieves the WebSocket URL based on the current host and port.\n   * @returns {String} - The WebSocket URL.\n   */\n  getURL() {\n    const url = new URL(window.location.href);\n    const host = url.host;\n    return url.protocol === \"https:\"\n      ? `wss://${host}/api/gateway`\n      : `ws://${host}/api/gateway`;\n  }\n\n  /**\n   * Connects to the WebSocket server.\n   */\n  async connect() {\n    const params = { \"mio-chat-id\": this.id, \"mio-chat-token\": this.code };\n    const fullUrl = `${this.url}?${new URLSearchParams(params).toString()}`;\n    this.socket = new WebSocket(fullUrl);\n    console.log(\"WebSocket连接中...\");\n\n    this.socket.onopen = () => {\n      this.available = true;\n      console.log(\"WebSocket连接成功\");\n\n      // Sending heartbeat every 3 seconds\n      this.heartBeat = setInterval(async () => {\n        if (this.socket.readyState === WebSocket.OPEN) {\n          const res = await this.fetch(\"/api/system/heartbeat\", {\n            timestamp: Date.now(),\n          });\n          const serverRevTime = res.revTime;\n          const cuurentTime = Date.now();\n          const delayTo = res.delay;\n          const delayBack = cuurentTime - serverRevTime;\n          this.delay = delayTo + delayBack;\n        }\n      }, 3000);\n    };\n\n    this.socket.onclose = () => {\n      this.available = false;\n      this.disconnect();\n      console.error(\"WebSocket连接断开，将在2秒后尝试重新连接...\");\n      setTimeout(() => this.connect(), 2000); // Attempt to reconnect after 5 seconds\n    };\n\n    this.socket.onerror = (error) => {\n      console.error(\"WebSocket连接出错\", error);\n    };\n\n    this.socket.onmessage = (event) => {\n      this.messageHandler(event.data);\n    };\n  }\n\n  /**\n   * Disconnects the WebSocket connection.\n   */\n  disconnect() {\n    if (this.socket) {\n      this.socket.close();\n      this.socket = null;\n      this.available = false;\n      clearInterval(this.heartBeat);\n      console.log(\"WebSocket连接已断开\");\n    }\n  }\n\n  /**\n   * Sends a message to the WebSocket server.\n   * @param {String} message - The message content to send.\n   */\n  send(message) {\n    if (this.available) {\n      this.socket.send(message);\n    } else {\n      console.log(\"WebSocket连接不可用\");\n    }\n  }\n\n  /**\n   * Handles incoming messages from the WebSocket server.W\n   * @param {String} message - The message received from the server.\n   */\n  messageHandler(message) {\n    try {\n      const e = JSON.parse(message);\n      // if (!(e.protocol == \"system\"))\n      //   console.log(\"WebSocket收到事件，原始数据：\", e);\n      this.emit(e.request_id, e);\n      if (e.protocol == \"onebot\") {\n        this.emit(\"onebot_message\", e);\n      } else if (e.protocol == \"system\") {\n        if (e.type == \"login\") this.emit(\"connect\", e.data);\n        this.emit(\"system_message\", e);\n      }\n    } catch (error) {\n      console.error(\"JSON解析失败:\", error);\n      // Error handling, e.g., provide default values or other operations\n    }\n  }\n\n  /**\n   * Sends an object type message to the WebSocket server.\n   * @param {Object} message - The message object to send.\n   */\n  sendObject(message) {\n    if (this.available) {\n      this.socket.send(JSON.stringify(message));\n    } else {\n      console.log(\"WebSocket连接不可用\");\n    }\n  }\n\n  /**\n   * Generates a unique request ID using a timestamp and a secure random number generator.\n   * @returns {String} - The unique request ID.\n   */\n  genRequestID() {\n    const timestamp = Date.now().toString(36); // Convert current timestamp to base 36 string\n    const randomPart = crypto\n      .getRandomValues(new Uint32Array(1))[0]\n      .toString(36); // Generate a secure random number\n    const id = timestamp + randomPart.substring(0, 5); // Take a part of the random number to ensure length\n    return id;\n  }\n\n  /**\n   * Sends a request to the specified URL with the provided data and returns a promise.\n   * @param {String} url - The API endpoint.\n   * @param {Object} data - The data to be sent with the request.\n   * @returns {Promise<any>} - A promise that resolves with the response data.\n   */\n  fetch(url, data) {\n    return new Promise((resolve, reject) => {\n      const pathArray = url.split(\"/\").filter(Boolean);\n      const protocol = pathArray[1];\n      const type = pathArray[2];\n      const id = pathArray[3];\n      let request_id = this.genRequestID();\n      const request = {\n        request_id: request_id,\n        protocol: protocol,\n        type: type,\n        id: id,\n        data: data,\n      };\n      this.requests.push(request_id);\n      const timeOut = new Promise((reject) => {\n        setTimeout(() => {\n          reject(\"timeout\");\n        }, 60000); // Timeout after 60 seconds\n      });\n      const response = new Promise((resolve) => {\n        this.on(request_id, (res) => {\n          this.requests.splice(this.requests.indexOf(request_id), 1);\n          resolve(res.data);\n        });\n      });\n      Promise.race([timeOut, response])\n        .then((res) => {\n          resolve(res);\n        })\n        .catch((err) => {\n          reject(err);\n        });\n      this.sendObject(request);\n      if (type !== \"heartbeat\") console.log(\"WebSocket发送请求\", url, request);\n    });\n  }\n\n  /**\n   * Streams completion data from the WebSocket server.\n   * @param {Object} data - The data to be sent with the completion request.\n   * @returns {AsyncGenerator<any>} - An async generator that yields completion data chunks.\n   */\n  async *streamCompletions(data) {\n    console.log(\"WebSocket开始流式获取补全数据\");\n    const request = {\n      request_id: this.genRequestID(),\n      protocol: \"openai\",\n      type: \"completions\",\n      data: data,\n    };\n    this.requests.push(request.request_id);\n    this.sendObject(request);\n    let resolve;\n    let reject;\n    let promise = new Promise((r, j) => {\n      resolve = r;\n      reject = j;\n    });\n    this.on(request.request_id, (data) => {\n      if (data.message === \"update\") {\n        resolve(data);\n        promise = new Promise((r, j) => {\n          resolve = r;\n          reject = j;\n        }); // Create a new promise for the next data chunk\n      } else if (data.message === \"completed\" || data.message === \"failed\") {\n        console.log(\"WebSocket流式获取补全数据结束\", data.message);\n        this.off(request.request_id);\n        reject({ done: true, data: data }); // Reject the promise to stop the iteration\n      }\n    });\n    try {\n      while (true) {\n        const chunk = await promise; // Wait for the 'on' callback to be called\n        yield chunk; // Yield the data chunk\n      }\n    } catch (e) {\n      if (e.done) {\n        yield e.data;\n        return; // Stop the iteration\n      }\n      throw e; // If it's another error, rethrow it\n    }\n  }\n}\n","/**\n * @author Mio-FCIP <1099834705@qq.com>\n * @lastEditor 彭志勇 <2457305628@qq.com>\n * @lastEditTime 2024-04-25 06:25:30\n */\n\nimport EventEmitter from \"../event.js\";\nimport { client } from \"@/lib/runtime.js\";\n\nexport default class Adapter extends EventEmitter {\n  constructor() {\n    super();\n  }\n\n  async fetch(url, data) {\n    return await client.socket.fetch(url, data);\n  }\n}\n","import Adapter from \"./adapter.js\";\n\nexport default class Onebot extends Adapter {\n  constructor() {\n    super();\n  }\n\n  convertMessage(data) {\n    console.log(data);\n    data.message.forEach((element, index) => {\n      if (element.type === \"image\") {\n        const base64Data = element.data.file.replace(\n          /^base64:\\/\\//,\n          \"data:image/jpeg;base64,\",\n        );\n        data.message[index].data.file = base64Data;\n        console.log(data.message[index]);\n      } else if (element.type === \"nodes\") {\n        element.data.messages.forEach((node) => {\n          if (node.type === \"image\") {\n            const base64Data = node.data.file.replace(\n              /^base64:\\/\\//,\n              \"data:image/jpeg;base64,\",\n            );\n            node.data.file = base64Data;\n          }\n        });\n      }\n    });\n\n    const rplMessage = data.message.filter(\n      (element) => element.type === \"reply\",\n    );\n    const midMessage = data.message.filter(\n      (element) => element.type !== \"reply\",\n    );\n    if (rplMessage.length > 0) {\n      midMessage.push(rplMessage[0]);\n    }\n\n    const webMessage = {\n      role: \"other\",\n      time: new Date().getTime(),\n      content: midMessage,\n      id: data.message_id,\n      status: \"completed\",\n    };\n    return webMessage;\n  }\n\n  /**\n   * Send message to server\n   * @param {id} string\n   * @param {WebMessage} message\n   * @returns {Promise<number>} message_id\n   */\n  async send(id, message) {\n    const response = await this.fetch(\n      \"/api/onebot/message\" + `/${id}`,\n      message,\n    );\n    return response.message_id;\n  }\n}\n","/**\n * @author Mio-FCIP <1099834705@qq.com>\n * @lastEditor 彭志勇 <2457305628@qq.com>\n * @lastEditTime 2024-04-25 06:25:30\n */\n\nimport Adapter from \"./adapter.js\";\nimport { client, config } from \"../runtime.js\";\n\nexport default class Openai extends Adapter {\n  constructor(config) {\n    super();\n    this.settings = config.settings || {};\n  }\n\n  convertMessage() {\n    const webMessage = {\n      role: \"other\",\n      time: new Date().getTime(),\n      content: [{ type: \"blank\", data: {} }],\n      status: \"pending\",\n      id: this.genRequestID(),\n    };\n    return webMessage;\n  }\n\n  genRequestID() {\n    return Math.random().toString(36).substr(2, 9);\n  }\n\n  async getMessagesSummary(messageChain) {\n    const query = `请你根据以下对话的内容\\n${JSON.stringify(messageChain)}\\n，总结出一个简短的对话主题,不得超出10个字。`;\n    const messages = {\n      model: config.openaiDefaultConfig.model,\n      messages: [{ role: \"user\", content: query }],\n    };\n\n    const response = await this.fetch(`/api/openai/completions`, messages);\n    const { chunk } = response;\n    return chunk;\n  }\n\n  async send(messages, index, settings) {\n    console.log(\"send message to openai\");\n\n    if (!settings.enable_tool_call) settings.tools = [];\n\n    // Correct the spelling and add default value for model:\n    const validSettingKeys = [\n      \"top_p\",\n      \"temperature\",\n      \"stream\",\n      \"model\",\n      \"tools\",\n    ];\n\n    const validSettings = settings\n      ? Object.fromEntries(\n          Object.entries(settings).filter(([key]) =>\n            validSettingKeys.includes(key),\n          ),\n        )\n      : {};\n    const data = {\n      ...validSettings, // Use the filtered settings\n      messages,\n    };\n\n    console.log(data);\n\n    for await (const chunk of client.socket.streamCompletions(data)) {\n      const chunkDataHandlers = {\n        reasoning_content: (data) =>\n          this.emit(`updateReasoning`, {\n            reasoning_content: data.reasoning_content,\n            index: index,\n          }),\n        chunk: (data) =>\n          this.emit(`updateMessage`, { chunk: data.chunk, index: index }),\n        tool_call: (data) =>\n          this.emit(`updateToolCall`, {\n            tool_call: data.tool_call,\n            index: index,\n          }),\n      };\n\n      for (const key in chunkDataHandlers) {\n        if (chunk.data && chunk.data[key]) {\n          chunkDataHandlers[key](chunk.data);\n        }\n      }\n\n      const chunkMessageHandlers = {\n        completed: () => this.emit(`completeMessage`, { index: index }),\n        failed: () =>\n          this.emit(`failedMessage`, { error: chunk.data.error, index: index }),\n      };\n\n      if (chunk.message && chunkMessageHandlers[chunk.message]) {\n        chunkMessageHandlers[chunk.message]();\n      }\n    }\n  }\n\n  updateSettings(settings) {\n    this.settings = settings;\n  }\n}\n","import Onebot from \"./adapter/onebot.js\";\nimport Openai from \"./adapter/openai.js\";\nimport EventEmmiter from \"./event.js\";\nimport { config } from \"@/lib/runtime.js\"\n\nconst AVATAR_BASE_PATH =\n  \"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons\";\n\nconst AVATAR_MAP = {\n  \"OpenAI\": \"openai.svg\",\n  \"Cohere\": \"cohere-color.svg\",\n  \"Anthropic\": \"claude-color.svg\",\n  \"Google\": \"gemini-color.svg\", \n  \"X.AI\": \"grok.svg\", \n  \"DeepSeek\": \"deepseek-color.svg\",\n  \"智谱清言\": \"zhipu-color.svg\",\n  \"豆包\": \"doubao-color.svg\", \n  \"月之暗面 (kimi)\": \"moonshot.svg\",\n  \"科大讯飞\": \"spark-color.svg\", \n  \"通义千问\": \"qwen-color.svg\", \n  \"腾讯混元\": \"hunyuan-color.svg\"\n};\n\nconst avatarPolicy = [\"MODEL\", \"CUSTOM\"];\n\nconst namePolicy = [\"MODEL\", \"CUSTOM\", \"SUMMARY\"];\n\nexport default class Contactor extends EventEmmiter {\n  /**\n   * Constructor of Contactor class\n   * @param {string} platform - Platform of contactor\n   * @param {object} config - Configuration of contactor\n   * @param {string} config.id - ID of the contactor\n   * @param {string} config.name - Name of the contactor\n   * @param {string} config.avatar - Avatar of the contactor\n   * @param {string} config.title - Title of the contactor\n   * @param {object} config.options - Options of the contactor\n   * @param {number} config.priority - Priority of the contactor,from 0 to 1, 0 means highest priority\n   */\n  constructor(platform, config) {\n    super();\n    this.platform = platform;\n    this.id = config.id;\n    this.options = config.options;\n    this.namePolicy = config.namePolicy || 0;\n    this.avatarPolicy = config.avatarPolicy || 0;\n    this.title = config.title;\n    this.name = config.name;\n    this.avatar = config.avatar;\n    this.priority = config.priority;\n    this.firstMessageIndex = 0;\n    this.messageChain = config.messageChain || [];\n    this.active = false;\n    this.lastUpdate = config.lastUpdate || new Date().getTime();\n    this.createTime = config.createTime || new Date().getTime();\n    this.lastMessageSummary = this.getLastMessageSummary();\n\n    this.kernel =\n      this.platform == \"onebot\" ? new Onebot(config) : new Openai(config);\n\n    if (this.platform == \"openai\") this.enableOpenaiListener();\n  }\n\n  enableOpenaiListener() {\n    this.kernel.on(\"updateReasoning\", (e) => {\n      const { reasoning_content, index } = e;\n      const rawMessage = this.messageChain[index];\n      if (!rawMessage) return;\n\n      const lastMsgElm = rawMessage.content[rawMessage.content.length - 1];\n      const isFirstElement = [\"blank\", \"reason\"].includes(lastMsgElm.type);\n\n      const msgElm = {\n        type: \"reason\",\n        data: {\n          text: (lastMsgElm.type == \"reason\"\n            ? lastMsgElm.data.text\n            : \"\"\n          ).concat(reasoning_content),\n          startTime:\n            lastMsgElm.type !== \"reason\"\n              ? new Date().getTime()\n              : lastMsgElm.data.startTime,\n          endTime: 0,\n        },\n      };\n\n      if (isFirstElement)\n        rawMessage.content[rawMessage.content.length - 1] = msgElm;\n      else rawMessage.content.push(msgElm);\n\n      this.emit(\"updateMessage\"); // 更新响应式数据\n      this.emit(\"updateMessageSummary\");\n    });\n\n    this.kernel.on(\"updateMessage\", (e) => {\n      const { chunk, index } = e;\n      const rawMessage = this.messageChain[index];\n      if (!rawMessage) return;\n\n      rawMessage.content.forEach((msgElm) => {\n        if (msgElm.type == \"reason\" && !msgElm.data.endTime)\n          msgElm.data.endTime = new Date().getTime();\n      });\n\n      const lastMsgElm = rawMessage.content[rawMessage.content.length - 1];\n      const isFirstElement = [\"blank\", \"text\"].includes(lastMsgElm.type);\n\n      const msgElm = {\n        type: \"text\",\n        data: {\n          text: (lastMsgElm.type == \"text\" ? lastMsgElm.data.text : \"\").concat(\n            chunk,\n          ),\n        },\n      };\n\n      if (isFirstElement)\n        rawMessage.content[rawMessage.content.length - 1] = msgElm;\n      else rawMessage.content.push(msgElm);\n\n      this.emit(\"updateMessage\"); // 更新响应式数据\n      this.emit(\"updateMessageSummary\");\n    });\n\n    this.kernel.on(\"updateToolCall\", (e) => {\n      const { tool_call, index } = e;\n      const rawMessage = this.messageChain[index];\n      if (!rawMessage) return;\n\n      const lastMsgElm = rawMessage.content[rawMessage.content.length - 1];\n      const isFirstElement = [\"blank\", \"tool_call\"].includes(lastMsgElm.type);\n      const continuousCall =\n        lastMsgElm.type == \"tool_call\" && lastMsgElm.data.id !== tool_call.id;\n\n      const msgElm = {\n        type: \"tool_call\",\n        data: {\n          ...tool_call,\n          params:\n            tool_call.action == \"pending\"\n              ? (lastMsgElm.data.params += tool_call.params)\n              : tool_call.params,\n        },\n      };\n\n      if (isFirstElement && !continuousCall)\n        rawMessage.content[rawMessage.content.length - 1] = msgElm;\n      else rawMessage.content.push(msgElm);\n\n      this.emit(\"updateMessage\"); // 更新响应式数据\n      this.emit(\"updateMessageSummary\");\n    });\n\n    this.kernel.on(\"completeMessage\", (e) => {\n      this.updateLastUpdate();\n      const messageIndex = e.index;\n      const rawMessage = this.messageChain[messageIndex];\n      if (rawMessage) {\n        this.emit(\"updateMessageSummary\");\n\n        this.emit(\"completeMessage\", {\n          index: messageIndex,\n        });\n      }\n    });\n\n    this.kernel.on(\"failedMessage\", (e) => {\n      console.error(e);\n      this.updateLastUpdate();\n      const messageIndex = e.index;\n      const rawMessage = this.messageChain[messageIndex];\n      if (rawMessage) {\n        this.emit(\"updateMessageSummary\");\n\n        this.emit(\"completeMessage\", {\n          text: \"请求发生错误！\\n```json\\n\" + e.error + \"\\n```\\n\",\n          index: messageIndex,\n          error: true,\n        });\n      }\n    });\n  }\n\n  /**\n   * Send message to contactor\n   * @param {OnebotMessage} message\n   */\n  async send(message) {\n    await this.kernel.send(message);\n  }\n\n  _getFilePrompt(fileElms) {\n    const start = \"以下是用户上传的文件：\\n\";\n    return start + fileElms.join(\"\\n\");\n  }\n\n  _getValidOpenaiMessage(start = this.firstMessageIndex, end = this.messageChain.length, length = this.options.max_messages_num) {\n    const cuttedMessageList = this.messageChain\n      .slice(start, end)\n      .slice(-length);\n\n    const validMessageList = cuttedMessageList.filter(\n      (msg) => msg.role != \"mio_system\",\n    );\n\n    const mergedMessages = validMessageList.map((message) => {\n      const fileList = [];\n      const subArray = [];\n      message.content.forEach((elm) => {\n        const role =\n          elm.type == \"tool_call\"\n            ? \"tool\"\n            : message.role == \"user\"\n              ? \"user\"\n              : \"assistant\";\n        const formatedMsg = {\n          role: role,\n          content: \"none\",\n          _content_type: undefined,\n        };\n        if (role == \"tool\") {\n          formatedMsg.role = \"assistant\";\n          formatedMsg.content = null;\n          formatedMsg.tool_calls = [\n            {\n              id: elm.data.id,\n              function: {\n                name: elm.data.name,\n                arguments: elm.data.params,\n              },\n              type: \"function\",\n            },\n          ];\n          subArray.push({ ...formatedMsg });\n\n          delete formatedMsg.tool_calls;\n          formatedMsg.role = \"tool\";\n          formatedMsg.content = JSON.stringify(elm.data.result);\n          formatedMsg.tool_call_id = elm.data.id;\n          subArray.push({ ...formatedMsg });\n\n          formatedMsg.role = role;\n        } else if (role == \"user\" || role == \"assistant\") {\n          if (elm.type == \"text\") {\n            formatedMsg.content = elm.data.text;\n            formatedMsg._content_type = \"text\";\n            subArray.push(formatedMsg);\n          } else if (elm.type == \"image\") {\n            formatedMsg.content = elm.data.file;\n            formatedMsg._content_type = \"image\";\n            subArray.push(formatedMsg);\n          } else if (elm.type == \"file\") {\n            fileList.push(elm.data.file);\n          }\n        }\n      });\n      if (fileList.length > 0) {\n        const textElm = subArray.filter((elm) => elm._content_type == \"text\");\n        textElm[0].content = textElm[0].content + this._getFilePrompt(fileList);\n      }\n      return subArray;\n    });\n    let finalMessages = [];\n\n    mergedMessages.forEach((subArray) => {\n      const textElm = subArray.filter((elm) => elm._content_type == \"text\");\n      const imageElm = subArray.filter((elm) => elm._content_type == \"image\");\n      const fileElm = subArray.filter((elm) => elm._content_type == \"file\");\n      const filePrompt = fileElm.length > 0 ? this._getFilePrompt(fileElm) : \"\";\n      let message = null;\n      if (\n        textElm.length > 0 &&\n        imageElm.length > 0 &&\n        imageElm[0].role == \"user\"\n      ) {\n        message = {\n          role: \"user\",\n          content: [\n            ...textElm.map((elm) => {\n              return {\n                type: \"text\",\n                text: elm.content + filePrompt,\n              };\n            }),\n            ...imageElm.map((elm) => {\n              return {\n                type: \"image_url\",\n                image_url: {\n                  url: elm.content,\n                },\n              };\n            }),\n          ],\n        };\n      }\n      if (message?.content.length == subArray.length) {\n        finalMessages.push(message);\n      } else {\n        subArray.forEach((elm) => {\n          delete elm._content_type;\n        });\n        finalMessages.push(...subArray);\n      }\n    });\n\n    if (this.options.history) {\n      finalMessages = this.options.history.concat(finalMessages);\n    }\n\n    return finalMessages;\n  }\n  /**\n   * 从网页前端发来的消息\n   */\n  async webSend(message) {\n    this.updateLastUpdate();\n    this.messageChain.push(message);\n    if (this.platform == \"onebot\") {\n      return await this.kernel.send(this.id, message.content);\n    } else {\n      // 截取从this.firstMessageIndex到结尾的消息\n      const finalMessages = this._getValidOpenaiMessage();\n\n      // 立即发生回复消息\n      this.revMessage({ content: [] });\n\n      const replyIndex = this.messageChain.length - 1;\n\n      this.kernel.send(finalMessages, replyIndex, this.options);\n\n      return Math.floor(Math.random() * 100000000)\n        .toString()\n        .padStart(8, \"0\");\n    }\n  }\n\n  async retryMessage(index) {\n    const message = this.messageChain[index];\n    if (message) {\n      message.content = [{\n        type: \"blank\",\n      }];\n      this.updateLastUpdate();\n      const finalMessages = this._getValidOpenaiMessage(0,index);\n      this.kernel.send(finalMessages, index, this.options);\n      return true;\n    }\n  }\n\n  /**\n   * 接收到消息\n   * @param {string} id - ID of the contactor\n   * @param {object} message - Message received from contactor\n   */\n  revMessage(message) {\n    this.updateLastUpdate();\n\n    const webMessage = this.kernel.convertMessage(message);\n\n    if (!this.active) this.messageChain.push(webMessage);\n    else this.emit(\"revMessage\", webMessage);\n\n    this.emit(\"updateMessageSummary\");\n    return webMessage;\n  }\n\n  /**\n   * 删除消息\n   * @param {string} message_id - ID of the message to be deleted\n   * @returns {boolean} - Whether the message is successfully deleted\n   */\n  delMessage(message_id) {\n    for (let i = 0; i < this.messageChain.length; i++) {\n      if (this.messageChain[i].id === message_id) {\n        if (this.active) this.emit(\"delMessage\", i);\n        else this.acting.messageChain.splice(i, 1);\n        this.makeSystemMessage(`${this.name}撤回了一条消息`);\n        return true; // 删除成功\n      }\n    }\n    return false; // 没有找到要删除的消息\n  }\n\n  makeSystemMessage(text) {\n    const container = {\n      role: \"mio_system\",\n      time: new Date().getTime(),\n      id: new Date().getTime(),\n      content: [\n        {\n          type: \"text\",\n          data: {\n            text: text,\n          },\n        },\n      ],\n    };\n    if (this.active) this.emit(\"revMessage\", container);\n    else this.messageChain.push(container);\n  }\n\n  getLastTime() {\n    const last = this.messageChain[this.messageChain.length - 1];\n    if (!last) {\n      return \"\";\n    }\n\n    const currentTime = new Date().getTime();\n    const lastTime = new Date(last.time);\n    const timeDiff = currentTime - lastTime.getTime();\n\n    if (timeDiff < 24 * 60 * 60 * 1000) {\n      this.toinit = false;\n      // 小于24小时，返回 xx:xx (小时:分钟)\n      const hours = lastTime.getHours().toString().padStart(2, \"0\");\n      const minutes = lastTime.getMinutes().toString().padStart(2, \"0\");\n      return `${hours}:${minutes}`;\n    } else if (timeDiff < 48 * 60 * 60 * 1000) {\n      // 小于48小时，显示昨天\n      return \"昨天\";\n    } else if (timeDiff < 7 * 24 * 60 * 60 * 1000) {\n      // 小于7天，返回星期x\n      const weekdays = [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\"];\n      const weekday = lastTime.getDay();\n      return `星期${weekdays[weekday]}`;\n    } else {\n      // 7天以上，返回xxxx/xx/xx（年/月/日）\n      const year = lastTime.getFullYear();\n      const month = (lastTime.getMonth() + 1).toString().padStart(2, \"0\");\n      const day = lastTime.getDate().toString().padStart(2, \"0\");\n      return `${year}/${month}/${day}`;\n    }\n  }\n\n  getShownTime(timestamp) {\n    const currentTime = new Date().getTime();\n    // 如果传入时间和当前时间差在24h以内，则显示时间\n\n    const timeDiff = currentTime - timestamp;\n    if (timeDiff < 24 * 60 * 60 * 1000) {\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `${hours}:${minutes}`;\n    } else if (timeDiff < 48 * 60 * 60 * 1000) {\n      // 小于48小时，显示昨天+时间\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `昨天${hours}:${minutes}`;\n    } else if (timeDiff < 7 * 24 * 60 * 60 * 1000) {\n      // 小于7天，返回星期x+时间\n      const weekdays = [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\"];\n      const weekday = new Date(timestamp).getDay();\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `星期${weekdays[weekday]}${hours}:${minutes}`;\n    } else {\n      // 7天以上，返回xxxx/xx/xx（年/月/日）+时间\n      const year = new Date(timestamp).getFullYear();\n      const month = (new Date(timestamp).getMonth() + 1)\n        .toString()\n        .padStart(2, \"0\");\n      const day = new Date(timestamp).getDate().toString().padStart(2, \"0\");\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `${year}/${month}/${day} ${hours}:${minutes}`;\n    }\n  }\n\n  getLastMessageSummary(message) {\n    const getMessageText = (element) => {\n      switch (element.type) {\n        case \"text\":\n          return element.data.text;\n        case \"image\":\n          return \"[图片]\";\n        case \"record\":\n          return \"[语音]\";\n        case \"video\":\n          return \"[视频]\";\n        case \"file\":\n          return \"[文件]\";\n        case \"tool_call\":\n          return `[调用工具] ${element.data.name}`;\n        case \"reason\":\n          return element.data.text;\n        case \"blank\":\n          return \"正在思考中...\";\n        case \"reply\":\n          return \"\"; // 空字符串处理\n        default:\n          return \"[未知消息类型] \" + element.type;\n      }\n    };\n\n    const msg = message || this.messageChain[this.messageChain.length - 1];\n    if (!msg) return \"\";\n\n    return getMessageText(msg.content ? msg.content[0] : msg);\n  }\n\n  updateFirstMessage() {\n    this.firstMessageIndex = this.messageChain.length;\n  }\n\n  updateLastUpdate() {\n    this.lastUpdate = new Date().getTime();\n  }\n\n  loadAvatar() {\n    let avatar = \"/static/avatar/miobot.png\";\n    if (avatarPolicy[this.avatarPolicy] == \"MODEL\") {\n      const model = this.options.model;\n      avatar = Contactor.getAvatarByModel(model);\n    } else if (avatarPolicy[this.avatarPolicy] == \"CUSTOM\") {\n      avatar = this.avatar;\n    }\n    this.avatar = avatar;\n    return avatar;\n  }\n\n  async loadName() {\n    let name = this.name ?? \"未命名 Bot\";\n    if (namePolicy[this.namePolicy] == \"MODEL\") {\n      const model = this.options.model;\n      name = model;\n    } else if (namePolicy[this.namePolicy] == \"CUSTOM\") {\n      name = this.name;\n    } else if (namePolicy[this.namePolicy] == \"SUMMARY\") {\n      if (this.messageChain.length < 2) {\n        name = \"新建的 Bot\";\n      } else if (\n        this.messageChain.length == 2 ||\n        this.messageChain.length % 6 == 0\n      ) {\n        name = await this.getMessagesSummary();\n      }\n    }\n    this.name = name;\n    return name;\n  }\n\n  getMessagesSummary() {\n    if (this.platform == \"openai\") {\n      return this.kernel.getMessagesSummary(\n        this._getValidOpenaiMessage().slice(-4),\n      );\n    } else {\n      return \"仅支持 OpenAI Chat Bot\";\n    }\n  }\n\n  static getAvatarByModel(model) {\n\n    const modelOwner = config.getOpenaiModelOwner(model)\n    if (Object.keys(AVATAR_MAP).includes(modelOwner)) {\n      return `${AVATAR_BASE_PATH}/${AVATAR_MAP[modelOwner]}`;\n    }\n\n    return `${AVATAR_BASE_PATH}/openai.svg`;\n  }\n}\n","import Socket from \"./websocket.js\";\nimport Contactor from \"./contactor.js\";\nimport localforage from \"localforage\";\nimport EventEmitter from \"./event.js\";\nimport { reactive } from \"vue\";\nimport UploadWorker from \"../worker/fileUpload.js?worker\";\n\n// Configure localforage\nlocalforage.config({\n  name: \"mio-chat\",\n});\n\nexport default class Client extends EventEmitter {\n  constructor(config) {\n    super();\n    this.everLogin = false; // Loaded from storage\n    this.id = null; // Loaded from storage\n    this.code = null; // Loaded from storage\n    this.isConnected = false; // Dynamic\n    this.contactList = []; // Loaded from storage\n    this.socket = null; // Dynamic\n    this.qq = null; // Web\n    this.botqq = null; // Web\n    this.avatar = null; // Web\n    this.onPhone = null; // Dynamic\n    this.title = \"Mio\"; // Fixed\n    this.name = \"user\"; // Fixed\n    this.displaySettings = null; // Web\n    this.config = config; // Parameter\n  }\n\n  /**\n   * Prepare initialization\n   * @returns {object} Initialization information\n   */\n  async beforeInit() {\n    await this.setDisplayInfo();\n    const localConfig = await this.getLocalStorage();\n    await this.config.loadOnebotDefaultConfig();\n\n    if (localConfig) {\n      localConfig.isConnected = false;\n      this.loadLocalStorage(localConfig);\n    } else {\n      // First-time user\n      this.id = this.genFakeId();\n      this.code = null;\n    }\n\n    this.emit(\"loaded\");\n  }\n\n  async genDefaultConctor() {\n    // Create default OneBot contactor\n    const onebotDefaultConfig = {\n      id: this.genFakeId(),\n      name: \"OneBot\",\n      namePolicy: 1,\n      avatarPolicy: 1,\n      avatar: `/api/qava?q=${this.botqq}`,\n      title: \"云崽\",\n      priority: 0,\n      options: this.config.onebotDefaultConfig,\n      lastUpdate: -Infinity,\n    };\n    this.addConcator(\"onebot\", onebotDefaultConfig);\n\n    // Update and create OpenAI contactor\n    this.config.updateOpenaiDefaultConfig({\n      model: this.default_model,\n    });\n\n    const openaiDefaultConfig = {\n      id: this.genFakeId(),\n      name: \"MioBot\",\n      avatar: \"/static/avatar/miobot.png\",\n      namePolicy: 1,\n      avatarPolicy: 1,\n      title: \"chat\",\n      priority: 0,\n      lastUpdate: -Infinity,\n      options: { ...this.config.openaiDefaultConfig },\n    };\n\n    openaiDefaultConfig.options.tools = this.config.openaiTools.map(\n      (tool) => tool.name,\n    );\n    openaiDefaultConfig.options.enable_tool_call = true;\n    this.addConcator(\"openai\", openaiDefaultConfig);\n  }\n\n  async addConcator(platform, config) {\n    const bot = new Contactor(platform, config);\n    bot.loadName();\n    bot.loadAvatar();\n\n    const list = reactive(this.contactList);\n    list.push(bot);\n\n    await this.setLocalStorage();\n    return bot;\n  }\n\n  rmContactor(id) {\n    const list = reactive(this.contactList);\n    const index = list.findIndex((item) => item.id == id);\n\n    if (index != -1) {\n      list.splice(index, 1);\n      this.setLocalStorage();\n    }\n  }\n\n  reset() {\n    localforage.clear();\n    localStorage.clear();\n    window.location.reload();\n  }\n\n  async init() {\n    await this.beforeInit();\n    if (this.everLogin) {\n      console.log(\"Detected cache, attempting automatic reconnection\");\n      this.isConnected = false;\n      await this.login(this.code);\n    } else {\n      console.log(\"Not logged in before, please login first\");\n    }\n  }\n\n  getContactors() {\n    return this.contactList;\n  }\n\n  /**\n   * Generate a random 5-digit ID starting with 1\n   * @returns {number} 5-digit random ID starting with 1\n   */\n  genFakeId() {\n    if (!this.id) {\n      // Generate 5-digit random number starting with 1\n      const randomNum = Math.floor(1000 + Math.random() * 9000);\n      return parseInt(`1${randomNum}`);\n    } else {\n      // Generate 4-digit random number and append to existing ID\n      const subRandomNum = Math.floor(1000 + Math.random() * 9000);\n      return parseInt(`${this.id}${subRandomNum}`);\n    }\n  }\n\n  /**\n   * Get user information from localStorage\n   * @returns {object|false} User information or false if not found\n   */\n  async getLocalStorage() {\n    const client = await localforage.getItem(\"client\");\n    return client ? JSON.parse(client) : false;\n  }\n\n  /**\n   * Load user information from localStorage\n   * @param {object} client User information\n   */\n  loadLocalStorage(client) {\n    this.everLogin = client.everLogin;\n    this.id = client.id;\n    this.code = client.code;\n    this.avatar = client.avatar;\n\n    // If contact list exists, instantiate as contact objects\n    if (client.contactList && client.contactList.length != 0) {\n      this.contactList = client.contactList.map(\n        (item) => new Contactor(item.platform, item),\n      );\n    } else {\n      this.contactList = [];\n    }\n  }\n\n  /**\n   * Save user information to localStorage\n   */\n  async setLocalStorage() {\n    await localforage.setItem(\"client\", JSON.stringify(this));\n  }\n\n  /**\n   * Login\n   * @param {string} code Access code\n   * @returns {Promise} Login result\n   */\n  async login(code) {\n    this.code = code;\n\n    return new Promise((resolve) => {\n      const socket = new Socket(this.id, this.code);\n\n      socket.on(\"connect\", async (info) => {\n        console.log(\"Login successful\");\n        this.qq = info.admin_qq;\n        this.avatar = `/api/qava?q=${this.qq}`;\n        this.botqq = info.bot_qq;\n        this.default_model = info.default_model;\n        this.everLogin = true;\n        this.isConnected = true;\n        this.socket = socket;\n\n        this.config.setOpenaiModels(info.models);\n        this.addMsgListener();\n        this.config.updateOpenaiDefaultConfig({\n          model: info.default_model,\n        });\n\n        if (this.contactList.length == 0) {\n          await this.genDefaultConctor();\n        }\n\n        this.setLocalStorage();\n        resolve(info);\n      });\n\n      socket.connect();\n    });\n  }\n\n  addMsgListener() {\n    this.socket.on(\"onebot_message\", (e) => {\n      console.log(e);\n      const data = e.data;\n      const id = data.id;\n      const content = data.content;\n      const type = data.type;\n\n      if (type == \"message\") {\n        const contactor = this.getContactor(id);\n        if (contactor) {\n          contactor.revMessage(content);\n          this.setLocalStorage();\n        }\n      } else if (type == \"del_msg\") {\n        const onebotContactors = this.contactList.filter(\n          (item) => item.platform == \"onebot\",\n        );\n        for (const onebotContactor of onebotContactors) {\n          const deleted = onebotContactor.delMessage(content.message_id);\n          if (deleted) {\n            this.setLocalStorage();\n            console.log(\"Message deleted successfully\");\n            break;\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * Logout\n   */\n  async logout() {\n    this.isConnected = false;\n    this.socket.disconnect();\n    this.socket = null;\n    this.setLocalStorage();\n  }\n\n  /**\n   * Get a contactor by ID\n   * @param {number} id Contactor ID\n   * @returns {Contactor} Contactor object or first contactor if not found\n   */\n  getContactor(id) {\n    return (\n      this.contactList.find((item) => item.id == id) ?? this.contactList[0]\n    );\n  }\n\n  async setDisplayInfo() {\n    const res = await fetch(\"/api/base_info\");\n    const { data } = await res.json();\n    const stored = this.config.getDisplayConfig();\n\n    if (!stored) {\n      this.config.setDisplayConfig(data);\n    }\n\n    this.admin_qq = data.admin_qq;\n    this.bot_qq = data.bot_qq;\n    this.displaySettings = data;\n\n    const keyWidth = 600;\n    this.onPhone = window.innerWidth < keyWidth;\n\n    const handleResize = () => {\n      if (window.innerWidth < keyWidth && !this.onPhone) {\n        this.emit(\"device-change\", \"mobile\");\n        this.onPhone = true;\n      } else if (window.innerWidth >= keyWidth && this.onPhone) {\n        this.emit(\"device-change\", \"desktop\");\n        this.onPhone = false;\n      }\n    };\n\n    window.addEventListener(\"resize\", handleResize);\n  }\n\n  getDisplaySettings() {\n    return this.displaySettings;\n  }\n\n  async getLoginHistory() {\n    const myclient = await this.getLocalStorage();\n    return myclient.everLogin;\n  }\n\n  /**\n   * Upload file or image\n   * @param {File|Blob|string} fileOrImage - File object, Blob, or base64 string for images\n   * @param {Object} options - Upload options\n   * @param {boolean} options.isImage - Indicates if upload is an image\n   * @param {Function} options.onProgress - Progress callback (percent complete)\n   * @returns {Promise<Object>} Upload result\n   */\n  async uploadFile(fileOrImage, options = {}) {\n    const { isImage = false, onProgress = null } = options;\n\n    // Handle image upload (base64 string or blob)\n    if (\n      isImage ||\n      (typeof fileOrImage === \"string\" && fileOrImage.startsWith(\"data:\"))\n    ) {\n      return this.uploadImage(fileOrImage);\n    }\n\n    const file = fileOrImage;\n    return new Promise((resolve, reject) => {\n      const chunkSize = 1024 * 1024; // 1MB\n      let md5Hash = null;\n\n      const finalizeUpload = async (totalChunks) => {\n        try {\n          const response = await fetch(\"/api/upload/finalize\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              totalChunks,\n              md5: md5Hash,\n              filename: file.name,\n            }),\n          });\n\n          if (!response.ok) {\n            throw new Error(`HTTP error ${response.status}`);\n          }\n\n          const data = await response.json();\n          resolve(data);\n        } catch (error) {\n          reject({ error: `Finalization error: ${error.message}` });\n        }\n      };\n\n      const uploadChunk = async (chunk, index, totalChunks) => {\n        return new Promise((resolve, reject) => {\n          const formData = new FormData();\n          formData.append(\"file\", chunk);\n          formData.append(\"md5\", md5Hash);\n          formData.append(\"chunkIndex\", index);\n          formData.append(\"totalChunks\", totalChunks);\n          formData.append(\"filename\", file.name);\n\n          const xhr = new XMLHttpRequest();\n          xhr.open(\"POST\", \"/api/upload/chunk\", true);\n\n          // Track progress if callback provided\n          if (onProgress) {\n            xhr.upload.onprogress = (event) => {\n              if (event.lengthComputable) {\n                // Calculate overall progress based on chunks\n                const chunkProgress = event.loaded / event.total;\n                const overallProgress =\n                  (index / totalChunks + (1 / totalChunks) * chunkProgress) *\n                  100;\n                onProgress(Math.round(overallProgress));\n              }\n            };\n          }\n\n          xhr.onload = () => {\n            if (xhr.status >= 200 && xhr.status < 300) {\n              resolve(); // Successful upload\n            } else {\n              reject(xhr.statusText); // Failed upload\n            }\n          };\n\n          xhr.onerror = () => {\n            reject(\"Network Error\");\n          };\n\n          xhr.send(formData);\n        });\n      };\n\n      const uploadFileChunks = async () => {\n        if (!file || !md5Hash) {\n          return reject({ error: \"Invalid file or missing hash\" });\n        }\n\n        const totalChunks = Math.ceil(file.size / chunkSize);\n\n        try {\n          for (\n            let currentChunk = 0;\n            currentChunk < totalChunks;\n            currentChunk++\n          ) {\n            const start = currentChunk * chunkSize;\n            const end = Math.min(start + chunkSize, file.size);\n            const chunk = file.slice(start, end);\n\n            await uploadChunk(chunk, currentChunk, totalChunks);\n          }\n\n          // All chunks uploaded, finalize\n          await finalizeUpload(totalChunks);\n        } catch (error) {\n          reject({ error: `Upload error: ${error}` });\n        }\n      };\n\n      // Start worker to calculate MD5\n      const worker = new UploadWorker();\n      worker.postMessage({ file, chunkSize });\n\n      worker.onmessage = (e) => {\n        if (e.data.hash) {\n          md5Hash = e.data.hash;\n          console.log(\"MD5 calculated. Starting upload...\");\n          uploadFileChunks();\n        } else if (e.data.error) {\n          reject({ error: e.data.error });\n          worker.terminate();\n        }\n      };\n\n      worker.onerror = (error) => {\n        console.error(\"Worker error:\", error);\n        reject({ error: `Worker error: ${error.message}` });\n        worker.terminate();\n      };\n    });\n  }\n\n  /**\n   * Upload image (now integrated into uploadFile)\n   * @param {string|Blob} image - Base64 string or Blob\n   * @returns {Promise<Object>} Upload result\n   */\n  async uploadImage(formData) {\n    try {\n      const response = await fetch(\"/api/upload/image\", {\n        method: \"POST\",\n        body: formData,\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error(\"Error uploading image:\", error);\n      throw error; // Re-throw to be handled by caller\n    }\n  }\n\n  /**\n   * Convert Blob to base64 string\n   * @param {Blob} blob - Image blob\n   * @returns {Promise<string>} Base64 string\n   */\n  async _convertBlobToBase64(blob) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onloadend = () => resolve(reader.result);\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n}\n","/**\n * @author Mio-FCIP <1099834705@qq.com>\n * @lastEditor 彭志勇 <2457305628@qq.com>\n * @lastEditTime 2024-04-25 06:25:30\n */\n\nimport Client from \"./client.js\";\nimport Config from \"./config.js\";\n\nconst config = new Config();\nconst client = new Client(config);\n\nawait client.init();\n\nexport { config, client };\n","export default class Config {\n  constructor() {\n    this.localPresets = [];\n    this.openaiDefaultConfig = {\n      model: \"gpt-4o-mini\",\n      stream: true,\n      temperature: 1,\n      top_p: 1,\n      frequency_penalty: 0,\n      presence_penalty: 0,\n      history: [],\n      tools: [],\n      enable_tool_call: false,\n      opening: \"\",\n      max_messages_num: 10,\n    };\n    this.openaiTools = [];\n    this.onebotDefaultConfig = null;\n    this.displayConfig = {};\n    this.loadOpenaiTools();\n    this._loadStrogeConfig();\n  }\n\n  setDisplayConfig(config) {\n    this.displayConfig = config;\n    localStorage.setItem(\"display_config\", JSON.stringify(config));\n  }\n\n  setOpenaiModels(models) {\n    this.openaiModels = models;\n    this._saveStrogeConfig();\n  }\n\n  getOpenaiModels() {\n    return this.openaiModels;\n  }\n\n  getOpenaiModelOwner(model) {\n    const group = this.openaiModels.find((modelGroup) =>\n      modelGroup.models.includes(model),\n    )\n    return group?.owner;\n  }\n\n  updateDisplayConfig(patch) {\n    this.displayConfig = {\n      ...this.displayConfig,\n      ...patch,\n    };\n    localStorage.setItem(\"display_config\", JSON.stringify(this.displayConfig));\n  }\n\n  getDisplayConfig() {\n    const config = localStorage.getItem(\"display_config\");\n    if (config) {\n      return JSON.parse(config);\n    }\n  }\n\n  updateOpenaiDefaultConfig(patch) {\n    this.openaiDefaultConfig = {\n      ...this.openaiDefaultConfig,\n      ...patch,\n    };\n    this._saveStrogeConfig();\n  }\n\n  async loadOpenaiTools() {\n    const res = await fetch(\"/api/openai/tools\");\n    const data = await res.json();\n    this.openaiTools = Object.values(data.data.tools);\n    this._saveStrogeConfig();\n  }\n\n  async loadOnebotDefaultConfig() {\n    const onebotOptionsData = await fetch(`/api/onebot/plugins`);\n    const onebotOptionsJson = await onebotOptionsData.json();\n    this.onebotDefaultConfig = onebotOptionsJson.data.options;\n    this._saveStrogeConfig();\n  }\n\n  _loadStrogeConfig() {\n    const config = localStorage.getItem(\"config\");\n    if (config) {\n      Object.assign(this, JSON.parse(config));\n    } else {\n      this._saveStrogeConfig();\n    }\n  }\n\n  _saveStrogeConfig() {\n    localStorage.setItem(\"config\", JSON.stringify(this));\n  }\n}\n","<script>\nimport { client } from \"@/lib/runtime.js\";\n\nconst PageStatus = {\n  CHAT: \"chat\",\n  PROFILE: \"profile\",\n  SETTINGS: \"settings\",\n  NONE: \"none\",\n};\nexport default {\n  data() {\n    return {\n      defaultAvatar: \"/api/qava?q=1099834705\",\n      processedImage: \"\",\n      activePage: PageStatus.NONE,\n      adminAvatar: \"\",\n    };\n  },\n  computed: {\n    isChatActive() {\n      return this.activePage === PageStatus.CHAT;\n    },\n    isProfileActive() {\n      return this.activePage === PageStatus.PROFILE;\n    },\n  },\n  watch: {\n    $route: {\n      handler(newRoute) {\n        this.activePage = this.getPageStatusFromRoute(newRoute);\n      },\n      immediate: true,\n    },\n  },\n  mounted() {\n    this.activePage = this.getPageStatusFromRoute();\n    const adminId = client.admin_qq;\n    if (adminId) {\n      this.loadAvatar(adminId);\n    } else {\n      client.on(\n        \"loaded\",\n        () => {\n          const adminId = client.admin_qq;\n          this.loadAvatar(adminId);\n        },\n        false,\n      );\n    }\n  },\n  methods: {\n    async processImage(imageUrl) {\n      return new Promise((resolve, reject) => {\n        const canvas = document.createElement(\"canvas\");\n        const ctx = canvas.getContext(\"2d\");\n        const img = new Image();\n        img.crossOrigin = \"anonymous\"; // 设置跨域属性\n        img.src = imageUrl;\n        img.onload = () => {\n          canvas.width = img.width;\n          canvas.height = img.height;\n          // 绘制原始图片\n          ctx.drawImage(img, 0, 0);\n          // 创建透明的缺口\n          let centerX = img.width * 0.8; // 圆心X坐标\n          let centerY = img.height * 0.86; // 圆心Y坐标\n          let radius = (5 / 24) * img.width; // 圆的半径\n          ctx.beginPath();\n          ctx.arc(centerX, centerY, radius, 0, Math.PI * 2, true);\n          ctx.clip();\n          ctx.clearRect(0, 0, img.width, img.height);\n          // 将处理后的图片转换为base64\n          canvas.toBlob((blob) => {\n            const url = URL.createObjectURL(blob);\n            resolve(url);\n          }, \"image/png\");\n        };\n        img.onerror = (error) => reject(error);\n      });\n    },\n    async toChat() {\n      this.activePage = PageStatus.CHAT;\n      this.$router.push({ name: \"blank\" });\n    },\n    async toProfile() {\n      this.activePage = PageStatus.PROFILE;\n      this.$router.push({ name: \"contactors\" });\n    },\n    async toConfig() {\n      this.activePage = PageStatus.SETTINGS;\n      this.$router.push({ name: \"settings\" });\n    },\n    async loadAvatar(adminId) {\n      this.adminAvatar = `/api/qava?q=${adminId}`;\n      try {\n        this.processedImage = await this.processImage(this.adminAvatar);\n      } catch (error) {\n        console.error(\"Error loading avatar:\", error);\n      }\n    },\n    getPageStatusFromRoute(route = this.$route) {\n      if (route.path === \"/\" || route.path.includes(\"/chat/\")) {\n        return PageStatus.CHAT;\n      } else if (\n        route.path === \"/contactors\" ||\n        route.path.includes(\"/profile/\")\n      ) {\n        return PageStatus.PROFILE;\n      } else if (route.path === \"/settings\") {\n        return PageStatus.SETTINGS;\n      }\n      return PageStatus.NONE;\n    },\n  },\n};\n</script>\n<template>\n  <div id=\"sidebar\">\n    <div class=\"admin-avatar\">\n      <div class=\"status\"></div>\n      <img :src=\"processedImage\" alt=\"admin-avatar\" />\n    </div>\n    <div id=\"side\" class=\"options\">\n      <div class=\"up-half\">\n        <div class=\"icon-back\" :class=\"{ active: isChatActive }\">\n          <div id=\"chatting\" @click=\"toChat\">\n            <svg\n              t=\"1695149921092\"\n              class=\"icon\"\n              viewBox=\"0 0 1024 1024\"\n              version=\"1.1\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n              p-id=\"6286\"\n            >\n              <path\n                d=\"M512 64c259.2 0 469.333333 200.576 469.333333 448s-210.133333 448-469.333333 448a484.48 484.48 0 0 1-232.725333-58.88l-116.394667 50.645333a42.666667 42.666667 0 0 1-58.517333-49.002666l29.76-125.013334C76.629333 703.402667 42.666667 611.477333 42.666667 512 42.666667 264.576 252.8 64 512 64z m0 64C287.488 128 106.666667 300.586667 106.666667 512c0 79.573333 25.557333 155.434667 72.554666 219.285333l5.525334 7.317334 18.709333 24.192-26.965333 113.237333 105.984-46.08 27.477333 15.018667C370.858667 878.229333 439.978667 896 512 896c224.512 0 405.333333-172.586667 405.333333-384S736.512 128 512 128z m-157.696 341.333333a42.666667 42.666667 0 1 1 0 85.333334 42.666667 42.666667 0 0 1 0-85.333334z m159.018667 0a42.666667 42.666667 0 1 1 0 85.333334 42.666667 42.666667 0 0 1 0-85.333334z m158.997333 0a42.666667 42.666667 0 1 1 0 85.333334 42.666667 42.666667 0 0 1 0-85.333334z\"\n                p-id=\"6287\"\n              ></path>\n            </svg>\n          </div>\n        </div>\n        <div class=\"icon-back\" :class=\"{ active: isProfileActive }\">\n          <div id=\"editing\" @click=\"toProfile\">\n            <svg\n              t=\"1695150310032\"\n              class=\"icon\"\n              viewBox=\"0 0 1024 1024\"\n              version=\"1.1\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n              p-id=\"11383\"\n            >\n              <path\n                d=\"M800 384c0-160-128-288-288-288S224 224 224 384c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 16 6.4 35.2 25.6 38.4h6.4c16 0 28.8-9.6 32-25.6C224 784 355.2 675.2 508.8 672h6.4C672 672 800 544 800 384z m-512 0c0-124.8 99.2-224 224-224s224 99.2 224 224c0 121.6-99.2 220.8-220.8 224h-9.6C384 604.8 288 505.6 288 384z m435.2 291.2c-16-9.6-35.2-6.4-44.8 9.6-9.6 16-6.4 35.2 9.6 44.8 73.6 51.2 124.8 121.6 140.8 204.8 3.2 16 16 25.6 32 25.6h6.4c16-3.2 28.8-19.2 25.6-38.4-19.2-99.2-80-185.6-169.6-246.4z\"\n                p-id=\"11384\"\n              ></path>\n            </svg>\n          </div>\n        </div>\n      </div>\n      <div class=\"down-half\">\n        <a\n          href=\"https://github.com/Pretend-to/mio-chat-backend\"\n          target=\"_blank\"\n          class=\"side-icon\"\n        >\n          <svg\n            t=\"1695150961459\"\n            viewBox=\"0 0 1024 1024\"\n            version=\"1.1\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n            p-id=\"16393\"\n          >\n            <path\n              d=\"M512 42.666667A464.64 464.64 0 0 0 42.666667 502.186667 460.373333 460.373333 0 0 0 363.52 938.666667c23.466667 4.266667 32-9.813333 32-22.186667v-78.08c-130.56 27.733333-158.293333-61.44-158.293333-61.44a122.026667 122.026667 0 0 0-52.053334-67.413333c-42.666667-28.16 3.413333-27.733333 3.413334-27.733334a98.56 98.56 0 0 1 71.68 47.36 101.12 101.12 0 0 0 136.533333 37.973334 99.413333 99.413333 0 0 1 29.866667-61.44c-104.106667-11.52-213.333333-50.773333-213.333334-226.986667a177.066667 177.066667 0 0 1 47.36-124.16 161.28 161.28 0 0 1 4.693334-121.173333s39.68-12.373333 128 46.933333a455.68 455.68 0 0 1 234.666666 0c89.6-59.306667 128-46.933333 128-46.933333a161.28 161.28 0 0 1 4.693334 121.173333A177.066667 177.066667 0 0 1 810.666667 477.866667c0 176.64-110.08 215.466667-213.333334 226.986666a106.666667 106.666667 0 0 1 32 85.333334v125.866666c0 14.933333 8.533333 26.88 32 22.186667A460.8 460.8 0 0 0 981.333333 502.186667 464.64 464.64 0 0 0 512 42.666667\"\n              p-id=\"16394\"\n            ></path>\n          </svg>\n        </a>\n        <div class=\"side-icon\" @click=\"toConfig\">\n          <svg\n            t=\"1695150463577\"\n            viewBox=\"0 0 1024 1024\"\n            version=\"1.1\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n            p-id=\"15301\"\n          >\n            <path\n              d=\"M904.533333 422.4l-85.333333-14.933333-17.066667-38.4 49.066667-70.4c14.933333-21.333333 12.8-49.066667-6.4-68.266667l-53.333333-53.333333c-19.2-19.2-46.933333-21.333333-68.266667-6.4l-70.4 49.066666-38.4-17.066666-14.933333-85.333334c-2.133333-23.466667-23.466667-42.666667-49.066667-42.666666h-74.666667c-25.6 0-46.933333 19.2-53.333333 44.8l-14.933333 85.333333-38.4 17.066667L296.533333 170.666667c-21.333333-14.933333-49.066667-12.8-68.266666 6.4l-53.333334 53.333333c-19.2 19.2-21.333333 46.933333-6.4 68.266667l49.066667 70.4-17.066667 38.4-85.333333 14.933333c-21.333333 4.266667-40.533333 25.6-40.533333 51.2v74.666667c0 25.6 19.2 46.933333 44.8 53.333333l85.333333 14.933333 17.066667 38.4L170.666667 727.466667c-14.933333 21.333333-12.8 49.066667 6.4 68.266666l53.333333 53.333334c19.2 19.2 46.933333 21.333333 68.266667 6.4l70.4-49.066667 38.4 17.066667 14.933333 85.333333c4.266667 25.6 25.6 44.8 53.333333 44.8h74.666667c25.6 0 46.933333-19.2 53.333333-44.8l14.933334-85.333333 38.4-17.066667 70.4 49.066667c21.333333 14.933333 49.066667 12.8 68.266666-6.4l53.333334-53.333334c19.2-19.2 21.333333-46.933333 6.4-68.266666l-49.066667-70.4 17.066667-38.4 85.333333-14.933334c25.6-4.266667 44.8-25.6 44.8-53.333333v-74.666667c-4.266667-27.733333-23.466667-49.066667-49.066667-53.333333z m-19.2 117.333333l-93.866666 17.066667c-10.666667 2.133333-19.2 8.533333-23.466667 19.2l-29.866667 70.4c-4.266667 10.666667-2.133333 21.333333 4.266667 29.866667l53.333333 76.8-40.533333 40.533333-76.8-53.333333c-8.533333-6.4-21.333333-8.533333-29.866667-4.266667L576 768c-10.666667 4.266667-17.066667 12.8-19.2 23.466667l-17.066667 93.866666h-57.6l-17.066666-93.866666c-2.133333-10.666667-8.533333-19.2-19.2-23.466667l-70.4-29.866667c-10.666667-4.266667-21.333333-2.133333-29.866667 4.266667l-76.8 53.333333-40.533333-40.533333 53.333333-76.8c6.4-8.533333 8.533333-21.333333 4.266667-29.866667L256 576c-4.266667-10.666667-12.8-17.066667-23.466667-19.2l-93.866666-17.066667v-57.6l93.866666-17.066666c10.666667-2.133333 19.2-8.533333 23.466667-19.2l29.866667-70.4c4.266667-10.666667 2.133333-21.333333-4.266667-29.866667l-53.333333-76.8 40.533333-40.533333 76.8 53.333333c8.533333 6.4 21.333333 8.533333 29.866667 4.266667L448 256c10.666667-4.266667 17.066667-12.8 19.2-23.466667l17.066667-93.866666h57.6l17.066666 93.866666c2.133333 10.666667 8.533333 19.2 19.2 23.466667l70.4 29.866667c10.666667 4.266667 21.333333 2.133333 29.866667-4.266667l76.8-53.333333 40.533333 40.533333-53.333333 76.8c-6.4 8.533333-8.533333 21.333333-4.266667 29.866667L768 448c4.266667 10.666667 12.8 17.066667 23.466667 19.2l93.866666 17.066667v55.466666z\"\n              p-id=\"15302\"\n            ></path>\n            <path\n              d=\"M512 394.666667c-64 0-117.333333 53.333333-117.333333 117.333333s53.333333 117.333333 117.333333 117.333333 117.333333-53.333333 117.333333-117.333333-53.333333-117.333333-117.333333-117.333333z m0 170.666666c-29.866667 0-53.333333-23.466667-53.333333-53.333333s23.466667-53.333333 53.333333-53.333333 53.333333 23.466667 53.333333 53.333333-23.466667 53.333333-53.333333 53.333333z\"\n              p-id=\"15303\"\n            ></path>\n          </svg>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<style scoped>\n#sidebar {\n  display: flex;\n  flex-basis: 4.5rem;\n  flex-direction: column;\n  background-color: hsla(0, 0%, 100%, 0.8);\n  backdrop-filter: blur(0.5rem);\n  /* 添加模糊效果，值可以根据需要调整 */\n}\n.options {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n  /* margin: 1.2rem 1.2rem; */\n}\n.up-half,\n.down-half {\n  width: 50%;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  flex-basis: 8rem;\n  justify-content: center;\n}\n.icon-back {\n  width: 2.5rem;\n  height: 2.5rem;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: 0.5rem 0rem;\n  border-radius: 0.5rem;\n}\n.icon-back.active {\n  background-color: rgba(0, 0, 0, 0.1);\n}\n.icon-back svg,\n.down-half svg {\n  margin: 0.5rem 0rem;\n  width: 1.8rem;\n  height: 1.8rem;\n}\n.admin-avatar {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-top: 1rem;\n  height: 4.5rem;\n  position: relative;\n  z-index: 10;\n}\n.admin-avatar img {\n  border-radius: 50%;\n  width: 60%;\n}\n.status {\n  position: absolute;\n  left: 68%;\n  top: 71%;\n  transform: translate(-50%, -50%);\n  width: 0.7rem;\n  height: 0.7rem;\n  border-radius: 50%;\n  background: linear-gradient(to bottom, rgb(52, 238, 143), rgb(54, 221, 150));\n}\n.side-icon {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.icon-back.active svg {\n  fill: #007bff;\n}\n\n@media screen and (max-width: 600px) {\n  .options {\n    justify-content: space-evenly;\n  }\n  #sidebar {\n    width: 100%;\n    flex-direction: row;\n    flex-basis: 4rem;\n    background-color: #f5f4f9;\n  }\n  .admin-avatar {\n    display: none;\n  }\n  .options {\n    flex-direction: row;\n    width: 100%;\n  }\n  .up-half,\n  .down-half {\n    flex-basis: 50%;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-around;\n    align-items: center;\n  }\n}\n</style>\n","<template>\n  <ul :class=\"{ 'window-controls': true, fullscreen: fullScreen }\">\n    <li class=\"button\" @click=\"waiting()\">\n      <span class=\"window-min\">—</span>\n    </li>\n    <li v-if=\"fullScreen\" class=\"button\" @click=\"configFullScreen(false)\">\n      <span class=\"window-inmax\">\n        <i class=\"iconfont chuangkouhua\"></i>\n      </span>\n    </li>\n    <li v-else class=\"button\" @click=\"configFullScreen(true)\">\n      <span class=\"window-max\">▢</span>\n    </li>\n    <li id=\"close\" class=\"button\" @click=\"waiting()\">\n      <span class=\"window-close\">&times;</span>\n    </li>\n  </ul>\n</template>\n\n<script>\nexport default {\n  props: {\n    fullScreen: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\"set-screen\"],\n  methods: {\n    waiting() {\n      this.$message({ message: \"此功能尚未开放\", type: \"warning\" });\n    },\n    configFullScreen(fullScreen) {\n      this.$emit(\"set-screen\", fullScreen);\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"sass\">\n.window-controls\n    position: absolute\n    display: flex\n    width: 6rem\n    height: 2rem\n    z-index: 100\n    right: 0\n\n    &.fullscreen\n        position: fixed\n\n    .button\n        display: flex\n        justify-content: center\n        align-items: flex-start\n        flex-grow: 1\n        height: 100%\n        align-items: center\n        .window-min\n            font-size: .6rem\n            margin-top: .2rem\n        .window-max\n            font-size: .9rem\n        .window-close\n            margin-top: -.15rem\n        &:hover\n            background-color: rgb(231, 231, 231)\n        &#close:hover\n            background-color: rgb(255, 0, 0)\n            color: white\n</style>\n","<template>\n  <div\n    id=\"forward-msg-preview\"\n    :class=\"onPhone ? 'on-phone' : ''\"\n    @click=\"showBox = true\"\n  >\n    <div id=\"forward-msg-head\">转发的聊天消息</div>\n    <div id=\"forward-msg-body\">\n      <div\n        v-for=\"(message, index) in messages\"\n        id=\"forward-msg-summary\"\n        :key=\"index\"\n      >\n        {{ contactor.name }}: {{ contactor.getLastMessageSummary(message) }}\n      </div>\n    </div>\n    <div id=\"forward-msg-foot\">查看{{ messages.length }}条转发消息</div>\n  </div>\n  <div v-if=\"showBox\" id=\"forward-msg-box\" :class=\"onPhone ? 'on-phone' : ''\">\n    <div class=\"head\">\n      <span>转发消息</span>\n      <span class=\"close\" @click=\"showBox = false\">&times;</span>\n    </div>\n    <div class=\"body\">\n      <div\n        v-for=\"(message, index) of messages\"\n        :key=\"index\"\n        class=\"message-container\"\n      >\n        <div id=\"other\" class=\"message-body\">\n          <div class=\"avatar\">\n            <img :src=\"contactor.avatar\" :alt=\"contactor.name\" />\n          </div>\n          <div class=\"msg\">\n            <div class=\"wholename\">\n              <div class=\"title\">{{ contactor.title }}</div>\n              <div class=\"name\">{{ contactor.name }}</div>\n            </div>\n            <div class=\"content\">\n              <div>\n                <MdPreview\n                  v-if=\"message.type === 'text'\"\n                  preview-theme=\"github\"\n                  editor-id=\"preview-only\"\n                  :model-value=\"message.data.text\"\n                />\n                <el-image\n                  v-else-if=\"message.type === 'image'\"\n                  :key=\"index\"\n                  style=\"margin: 8px 0; max-width: 20rem; border-radius: 1rem\"\n                  :src=\"message.data.file\"\n                  :zoom-rate=\"1.2\"\n                  :preview-teleported=\"true\"\n                  :max-scale=\"7\"\n                  :min-scale=\"0.2\"\n                  :preview-src-list=\"[message.data.file]\"\n                  :initial-index=\"4\"\n                  fit=\"cover\"\n                />\n                <MdPreview\n                  v-else\n                  preview-theme=\"github\"\n                  editor-id=\"preview-only\"\n                  :model-value=\"`尚未支持的消息类型：${message.type}`\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { MdPreview } from \"md-editor-v3\";\nimport { client } from \"@/lib/runtime.js\";\n\nexport default {\n  components: {\n    MdPreview,\n  },\n  // ForwardMsg.vue\n  props: {\n    messages: {\n      type: Array,\n      default: () => [], // 对于数组，使用函数返回一个新的空数组\n    },\n    contactor: {\n      type: Object,\n      default: () => {}, // 对于字符串，使用空字符串\n    },\n  },\n  data() {\n    return {\n      showBox: false,\n      onPhone: false,\n    };\n  },\n  created() {\n    this.onPhone = window.innerWidth < 600;\n\n    client.on(\n      \"device-change\",\n      (type) => {\n        if (type == \"mobile\") {\n          this.onPhone = true;\n        } else {\n          this.onPhone = false;\n        }\n      },\n      false,\n    );\n  },\n};\n</script>\n\n<style>\n#forward-msg-preview {\n  width: 15rem;\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem;\n}\n\n#forward-msg-preview.on-phone {\n  transform: translateX(-0.35rem);\n}\n\n#forward-msg-body {\n  margin: 0.5rem 0;\n  width: 100%;\n  text-overflow: ellipsis;\n}\n\n#forward-msg-summary {\n  width: 100%;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  overflow: hidden;\n  font-size: 0.8rem;\n  font-weight: 300;\n}\n\n#forward-msg-foot {\n  border-top: 1px solid #ccc;\n  padding-top: 0.2rem;\n  width: 100%;\n  font-size: 0.7rem;\n  color: rgb(150, 150, 150);\n}\n\n#forward-msg-box {\n  border: 1px solid black;\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 24rem;\n  height: 30rem;\n  z-index: 9999;\n  background-color: rgb(241, 241, 241);\n  border-radius: 0.25rem;\n  overflow: hidden;\n}\n\n.message-body > .avatar {\n  flex-basis: 2.65rem;\n  min-width: 2.65rem;\n  height: 2.65rem;\n}\n\n.avatar > img {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n}\n\n#forward-msg-box.on-phone {\n  border: null;\n  border-radius: null;\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  z-index: 9999;\n  background-color: rgb(241, 241, 241);\n  overflow: hidden;\n}\n\n.head {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  height: 2rem;\n  padding-left: 1rem;\n  border-bottom: 1px solid #ccc;\n  color: black;\n}\n\n.close {\n  width: 1.5rem;\n  font-size: 1.5rem;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.close:hover {\n  color: aliceblue;\n  background-color: rgb(196, 43, 28);\n}\n\n.body {\n  height: auto;\n  max-height: calc(100% - 2rem);\n  overflow: auto;\n}\n</style>\n","<template>\n  <div class=\"input-bar\">\n    <div class=\"options\">\n      <div class=\"bu-emoji\">\n        <emoji-picker\n          v-show=\"showemoji\"\n          ref=\"emojiPicker\"\n          @emoji-click=\"getemoji\"\n        ></emoji-picker>\n        <p id=\"ho-emoji\">表情</p>\n        <i class=\"iconfont smile\" @click.prevent=\"ctrlEmojiPanel\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p id=\"ho-emoji\">滑到底部</p>\n        <i class=\"iconfont download\" @click=\"$emit('toButtom', 1)\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p id=\"ho-emoji\">重置人格</p>\n        <i class=\"iconfont reset\" @click=\"$emit('cleanHistory')\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p id=\"ho-emoji\">清除记录</p>\n        <i class=\"iconfont shanchu\" @click=\"$emit('cleanScreen')\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p id=\"ho-emoji\">上传</p>\n        <i class=\"iconfont upload\" @click=\"uploadFile\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p id=\"ho-emoji\">\n          {{ activeContactor.platform == \"openai\" ? \"模型选择\" : \"工具选择\" }}\n        </p>\n        <el-cascader\n          id=\"wraper-selector\"\n          v-model=\"selectedOptions\"\n          :options=\"extraOptions\"\n          @change=\"activeBotTools\"\n        />\n        <i class=\"iconfont robot\"></i>\n      </div>\n    </div>\n    <div class=\"input-box\">\n      <div class=\"input-content\">\n        <div\n          ref=\"textarea\"\n          class=\"input-area\"\n          :v-html=\"userInput\"\n          contenteditable=\"true\"\n          placeholder=\"按 Ctrl + Enter 以发送消息\"\n          @keydown=\"handleKeyDown\"\n          @input=\"handleInput\"\n          @click=\"updateCursorPosition\"\n        ></div>\n      </div>\n      <button\n        id=\"sendButton\"\n        :disabled=\"!userInput || !isValidInput(userInput)\"\n        @click.prevent=\"send\"\n      >\n        发送{{ getWraperName() ? ` | ${getWraperName()}` : \"\" }}\n      </button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { client, config } from \"@/lib/runtime.js\";\n\nexport default {\n  props: {\n    activeContactor: {\n      type: Object,\n      required: true,\n    },\n  },\n  emits: [\n    \"toButtom\",\n    \"cleanHistory\",\n    \"cleanScreen\",\n    \"setModel\",\n    \"stroge\",\n  ],\n  data() {\n    return {\n      userInput: \"\",\n      selectedWraper: null,\n      selectedModel: null,\n      selectedOptions: null,\n      cursorPosition: [],\n      showemoji: false,\n      openaiModels: null,\n      onebotPresets: null,\n      host: \"\",\n      uploaded: { files: [], images: [] }, // Keep original data structure\n      isPasting: false,\n    };\n  },\n  computed: {\n    extraOptions() {\n      if (this.activeContactor.platform == \"openai\") {\n        return this.openaiModels;\n      } else {\n        return this.onebotPresets;\n      }\n    },\n  },\n  watch: {\n    \"$route.params.id\"() {\n      this.loadSelectedArray();\n    },\n  },\n  created() {\n    this.initExtraOptions();\n  },\n  mounted() {\n    this.textareaRef = this.$refs.textarea;\n    this.textareaRef.addEventListener(\"input\", this.adjustTextareaHeight);\n    // 添加拖拽事件监听器\n    this.handleDragOver = (e) => {\n      e.preventDefault();\n      this.textareaRef.style.backgroundColor = \"#e0e0e0\";\n    };\n    this.handleDragLeave = (e) => {\n      e.preventDefault();\n      this.textareaRef.style.backgroundColor = \"#f1f1f1\";\n    };\n    this.handleDrop = (e) => {\n      e.preventDefault();\n      this.textareaRef.style.backgroundColor = \"#f1f1f1\";\n      const files = e.dataTransfer.files;\n      if (files.length > 0) {\n        this.handleDroppedFile(files[0]);\n      }\n    };\n    this.textareaRef.addEventListener(\"dragover\", this.handleDragOver);\n    this.textareaRef.addEventListener(\"dragleave\", this.handleDragLeave);\n    this.textareaRef.addEventListener(\"drop\", this.handleDrop);\n    // 将paste事件的处理函数定义为一个方法\n    this.handlePaste = (e) => {\n      e.preventDefault();\n      this.isPasting = true;\n      // 获取剪贴板的数据\n      var items = (e.clipboardData || window.clipboardData).items;\n      for (var i = 0; i < items.length; i++) {\n        // 检查是否为文件类型\n        if (items[i].type.indexOf(\"image\") !== -1) {\n          var blob = items[i].getAsFile();\n          this.handleUploadImage(blob);\n        } else if (items[i].type === \"text/plain\") {\n          var text = (e.originalEvent || e).clipboardData.getData(\"text/plain\");\n          document.execCommand(\"insertText\", false, text);\n          this.userInput = this.textareaRef.innerText;\n        }\n      }\n      this.isPasting = false;\n    };\n    // 添加paste事件监听器\n    this.textareaRef.addEventListener(\"paste\", this.handlePaste);\n    this.host = window.location.origin;\n  },\n  unmounted() {\n    this.textareaRef.removeEventListener(\"input\", this.adjustTextareaHeight);\n    this.textareaRef.removeEventListener(\"dragover\", this.handleDragOver);\n    this.textareaRef.removeEventListener(\"dragleave\", this.handleDragLeave);\n    this.textareaRef.removeEventListener(\"drop\", this.handleDrop);\n    this.textareaRef.removeEventListener(\"paste\", this.handlePaste);\n    this.textareaRef = null;\n  },\n  methods: {\n    handleDroppedFile(file) {\n      if (file.type.startsWith(\"image/\")) {\n        this.handleUploadImage(file);\n      } else {\n        this.uploadFile(file);\n      }\n    },\n    ctrlEmojiPanel() {\n      this.showemoji = !this.showemoji;\n      const editor = this.textareaRef;\n      editor.focus();\n    },\n    uploadFile(file) {\n      if (file instanceof File) {\n        this.handleFileUpload(file);\n        return;\n      }\n      const availableImageFormats = [\"png\", \"jpg\", \"jpeg\", \"gif\", \"bmp\"];\n      const availableDocFormats = [\"docx\", \"pdf\", \"pptx\", \"xlsx\"];\n      const fileInput = document.createElement(\"input\");\n      fileInput.type = \"file\";\n      fileInput.accept = [...availableDocFormats, ...availableImageFormats]\n        .map((format) => `.${format}`)\n        .join(\",\");\n\n      const handleChange = async (e) => {\n        fileInput.removeEventListener(\"change\", handleChange);\n        const file = e.target.files[0];\n        if (!file) return;\n        this.handleFileUpload(file);\n      };\n      fileInput.addEventListener(\"change\", handleChange);\n      fileInput.click();\n    },\n    handleFileUpload(file) {\n      if (file.size > 50 * 1024 * 1024) {\n        this.$message.error(\"文件大小超过50MB，无法上传\");\n        return;\n      }\n      this.$message.info(\"文件上传中...\");\n      if (file.type.startsWith(\"image/\")) {\n        this.handleUploadImage(file);\n      } else {\n        this.uploadDocumentFile(file);\n      }\n    },\n    async uploadDocumentFile(file) {\n      try {\n        const upload = await client.uploadFile(file);\n        this.$message.success(\"文件上传成功\");\n        this.uploaded.files.push(\n          `${upload.data.url}?size=${file.size}&name=${file.name}`,\n        );\n      } catch (error) {\n        console.error(\"文件上传失败:\", error);\n        this.$message.error(\"文件上传失败，请稍后再试\");\n      }\n    },\n    handleUploadImage(file) {\n      const maxSizeMB = 5;\n      const maxSizeByte = maxSizeMB * 1024 * 1024;\n\n      const img = new Image();\n      const reader = new FileReader();\n      reader.onload = (event) => {\n        img.src = event.target.result;\n      };\n\n      img.onload = () => {\n        const fileType = file.type.toLowerCase();\n\n        // 处理 GIF 类型，上传原文件\n        if (fileType === \"image/gif\") {\n          // GIF 检查大小\n          if (file.size > maxSizeByte) {\n            this.$message.error(`图片大小不能超过 ${maxSizeMB}MB`);\n            return;\n          }\n          const formData = new FormData();\n          formData.append(\"image\", file, file.name);\n          client\n            .uploadImage(formData)\n            .then((upload) => {\n              const imageUrl = upload.data.url;\n              this.uploaded.images.push(imageUrl);\n              this.insertImageToTextarea(imageUrl, file.name);\n              this.$message.success(\"上传图片成功\");\n            })\n            .catch((error) => {\n              console.error(\"Error handling uploaded image:\", error);\n              this.$message.error(\"上传图片失败\");\n            });\n          return;\n        }\n\n        // 非GIF类型，使用Canvas处理\n        const canvas = document.createElement(\"canvas\");\n        const ctx = canvas.getContext(\"2d\");\n        canvas.width = img.width;\n        canvas.height = img.height;\n        ctx.drawImage(img, 0, 0);\n\n        // 根据文件类型确定mimeType和quality, for toBlob\n        let mimeType, quality;\n\n        if (fileType === \"image/png\") {\n          mimeType = \"image/png\";\n          quality = undefined; // PNG的质量参数无效\n        } else if (fileType === \"image/webp\") {\n          mimeType = \"image/webp\";\n          quality = 0.7;\n        } else {\n          // 默认为jpeg（处理jpg or其他类型）\n          mimeType = \"image/jpeg\";\n          quality = 0.7;\n        }\n\n        canvas.toBlob(\n          (blob) => {\n            if (blob.size > maxSizeByte) {\n              this.$message.error(\n                `图片压缩后仍然超过 ${maxSizeMB}MB，请选择更小的图片`,\n              );\n              return;\n            }\n\n            const formData = new FormData();\n            formData.append(\"image\", blob, file.name);\n            client\n              .uploadImage(formData)\n              .then((upload) => {\n                const imageUrl = upload.data.url;\n                this.uploaded.images.push(imageUrl);\n                this.insertImageToTextarea(imageUrl, file.name);\n                this.$message.success(\"上传图片成功\");\n              })\n              .catch((error) => {\n                console.error(\"上传图片失败\", error);\n                this.$message.error(\"上传图片失败\");\n              });\n          },\n          mimeType,\n          quality, // 对于不能使用quality参数的mime类型，此参数被忽略\n        );\n      };\n      reader.readAsDataURL(file);\n    },\n    // 插入图片到文本域的方法\n    insertImageToTextarea(imageUrl, imageName) {\n      const imageElement = document.createElement(\"img\");\n      imageElement.src = imageUrl;\n      imageElement.alt = imageName;\n      imageElement.style.maxWidth = \"10rem\";\n      imageElement.style.maxHeight = \"10rem\";\n\n      const range = document.createRange();\n      range.selectNodeContents(this.textareaRef);\n      range.collapse(false); // 将范围折叠到末尾\n\n      const selection = window.getSelection();\n      selection.removeAllRanges();\n      selection.addRange(range);\n\n      const fragment = range.createContextualFragment(\n        `<span>${imageElement.outerHTML}</span>`,\n      );\n      range.insertNode(fragment);\n\n      // 保持光标在插入的图片之后\n      setTimeout(() => {\n        const newRange = document.createRange();\n        newRange.selectNodeContents(this.textareaRef);\n        newRange.collapse(false); // 将范围折叠到末尾\n\n        const newSelection = window.getSelection();\n        newSelection.removeAllRanges();\n        newSelection.addRange(newRange);\n      }, 0);\n    },\n    setModel() {\n      this.selectedModel = [...this.selectedOptions];\n      this.$emit(\"setModel\", this.selectedModel[1]);\n    },\n    initExtraOptions() {\n      const models = client.config.getOpenaiModels();\n      this.openaiModels = models.map((modelGroup) => {\n        return {\n          value: modelGroup.owner,\n          label: modelGroup.owner,\n          children: modelGroup.models.map((model) => {\n            return {\n              value: model,\n              label: model,\n            };\n          }),\n        };\n      });\n      this.onebotPresets = config.onebotDefaultConfig.textwraper.options;\n      this.loadSelectedArray();\n    },\n    loadSelectedArray() {\n      if (this.activeContactor.platform == \"openai\") {\n        this.selectedModel = this.getOpenaiModelArray(\n          this.activeContactor.options.model,\n        );\n        this.selectedOptions = [...this.selectedModel];\n      } else {\n        this.selectedWraper = [\"\"];\n        this.selectedOptions = [...this.selectedWraper];\n      }\n    },\n    getOpenaiModelArray(model) {\n      const owner = client.config.getOpenaiModelOwner(model);\n      return [owner, model];\n    },\n    wrapText(rawText) {\n      if (!this.selectedWraper) return rawText;\n      const wraper = this.selectedWraper[this.selectedWraper.length - 1];\n      if (!wraper) return rawText;\n      const testText = \"{xxx}\";\n      const childrens = this.onebotPresets.find(\n        (item) => item.value == this.selectedWraper[0],\n      ).children;\n      const preset = childrens.find(\n        (child) => child.value == this.selectedWraper[1],\n      ).preset;\n      const result = preset.replace(testText, rawText);\n      return result;\n    },\n    adjustTextareaHeight() {\n      const textarea = this.textareaRef;\n      textarea.style.height = \"auto\";\n      textarea.style.height = textarea.scrollHeight + \"px\";\n    },\n    getWraperName() {\n      if (this.activeContactor.platform === \"onebot\") {\n        if (!this.selectedWraper) return \"\";\n        const wraper = this.selectedWraper[this.selectedWraper.length - 1];\n        if (!wraper) return \"\";\n        const childrens = this.onebotPresets.find(\n          (item) => item.value == this.selectedWraper[0],\n        ).children;\n        const preset = childrens.find(\n          (child) => child.value == this.selectedWraper[1],\n        ).preset;\n        const name = preset.replace(\"#\", \"\").replace(\"{xxx}\", \"\");\n        return name;\n      } else {\n        return \"\";\n      }\n    },\n    waiting() {\n      this.$message({ message: \"此功能尚未开放\", type: \"warning\" });\n    },\n    getemoji(e) {\n      const inputer = this.textareaRef;\n      inputer.focus();\n      const range = document.createRange();\n      const sel = window.getSelection();\n      if (!sel) return;\n      const unicode = e.detail.unicode;\n      const startPos = this.cursorPosition[0];\n      const endPos = this.cursorPosition[1];\n      const textBeforeCursor = this.userInput.substring(0, startPos);\n      const textAfterCursor = this.userInput.substring(endPos);\n      this.userInput = textBeforeCursor + unicode + textAfterCursor;\n      inputer.innerHTML = this.userInput;\n      // 移动光标位置到表情符号之后\n      setTimeout(() => {\n        range.setStart(inputer.firstChild, startPos + unicode.length);\n        range.setEnd(inputer.firstChild, startPos + unicode.length);\n        sel.removeAllRanges();\n        sel.addRange(range);\n      }, 0);\n      this.ctrlEmojiPanel();\n    },\n    updateCursorPosition() {\n      const selection = window.getSelection();\n      if (!selection) return;\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        this.cursorPosition[0] = range.startOffset;\n        this.cursorPosition[1] = range.endOffset;\n      }\n    },\n    presend() {\n      this.textareaRef.focus();\n      // 获取textarea中的所有img元素\n      const images = this.textareaRef.querySelectorAll(\"img\");\n      const ImageSrcs = Array.from(images).map((img) => img.src);\n      // let msg = this.getSafeText(this.textareaRef.innerText);  // Use innerText, not userInput\n      let msg = this.getSafeText(this.userInput);\n      const wrappedMessage =\n        this.activeContactor.platform === \"onebot\" ? this.wrapText(msg) : msg;\n      this.userInput = this.textareaRef.innerHTML = \"\"; // Clear the textarea\n      this.adjustTextareaHeight();\n\n      const container = {\n        role: \"user\",\n        time: new Date().getTime(),\n        status: \"completed\",\n        content: [\n          {\n            type: \"text\",\n            data: {\n              text: wrappedMessage,\n            },\n          },\n        ],\n      };\n\n      ImageSrcs.forEach((imgUrl) => {\n        container.content.push({\n          type: \"image\",\n          data: {\n            file: imgUrl,\n          },\n        });\n      });\n      this.uploaded.files.forEach((file) => {\n        container.content.push({\n          type: \"file\",\n          data: {\n            file: this.host + file,\n          },\n        });\n      });\n\n      if (this.repliedMessageId) {\n        const replyData = {\n          type: \"reply\",\n          data: {\n            id: this.repliedMessageId,\n          },\n        };\n        container.content.push(replyData);\n      }\n      return container;\n    },\n    async send() {\n      this.$emit(\"toButtom\");\n      const container = this.presend();\n      // this.userInput = \"\";  // Already cleared in presend\n      const message_id = await this.activeContactor.webSend(container); //发送消息\n      this.activeContactor.emit(\"updateMessageSummary\");\n      container.id = message_id;\n      this.$emit(\"stroge\");\n      this.uploaded.images = [];\n      this.uploaded.files = [];\n    },\n    getSafeText(text) {\n      // return text.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n      return text;\n    },\n    cleanScreen() {\n      this.$emit(\"cleanScreen\");\n    },\n    async activeBotTools() {\n      this.selectedWraper = [...this.selectedOptions];\n      if (this.activeContactor.platform === \"onebot\") {\n        const testMessage = \"text\";\n        const testMessage2 = \"test\";\n        const wrappedMessage = this.wrapText(testMessage);\n        const wrappedMessage2 = this.wrapText(testMessage2);\n        if (wrappedMessage2 === wrappedMessage) {\n          this.userInput = this.textareaRef.value = wrappedMessage;\n          await this.send();\n        }\n      } else {\n        this.setModel();\n        this.$message({\n          message: \"已切换到 \" + this.selectedModel[1] + \" 模型\",\n          type: \"success\",\n        });\n      }\n    },\n    isValidInput(input) {\n      return input.trim().length > 0;\n    },\n    handleKeyDown(event) {\n      if (event.key === \"Enter\") {\n        if (event.ctrlKey) {\n          // Send only if there's text OR files.\n          if (this.userInput && this.isValidInput(this.userInput)) {\n            this.send();\n          } else {\n            this.$message({ message: \"不能发送空消息\", type: \"warning\" });\n          }\n        } else {\n          this.userInput += \"\\n\";\n        }\n      }\n      setTimeout(() => {\n        this.updateCursorPosition();\n      }, 0);\n    },\n    handleInput() {\n      if (!this.isPasting) this.userInput = this.textareaRef.innerText;\n    },\n  },\n};\n</script>\n\n<style lang=\"sass\" scoped>\n$mobile: 600px\n$icon-hover: #09f\n\ni:hover\n  color: $icon-hover\n\n.input-bar\n  flex-shrink: 0\n  display: flex\n  flex-direction: column\n  border: 0 solid rgba(161, 154, 154, 0.626)\n  flex-basis: 11rem\n  @media (max-width: $mobile)\n    flex-basis: 7rem\n  .options\n    display: flex\n    border-top: 0.0625rem solid rgba(128, 128, 128, 0.502)\n    padding: 0.25rem 0.5rem\n\n.bu-emoji\n  position: relative\n  &:hover p#ho-emoji\n    display: block\n\nemoji-picker\n  position: absolute\n  top: -25.75rem\n  right: -20rem\n\np#ho-emoji\n    text-wrap: nowrap\n    display: none\n    font-size: .75rem\n    padding: .125rem .25rem\n    background-color: #fff\n    border: none\n    box-shadow: 0 .125rem .25rem #0003\n    position: absolute\n    top: 80%\n    left: 50%\n    transform: translate(-60%)\ni\n  display: block\n  padding: 0.25rem 0.5rem 0 0\n  font-size: 1.25rem\n  width: 1.5rem\n  height: 1.5rem\n\n.input-box\n    flex-grow: 1\n    padding: 0 .5rem\n    display: flex\n    flex-direction: column\n    align-items: end\n    border: 0 solid black\n\n    button\n        white-space: nowrap\n        color: #f0f8ff\n        border-radius: .3125rem\n        border: 0\n        background-color: $icon-hover\n        padding: .25rem 1rem\n        margin-bottom: .8rem\n        margin-right: .5rem\n        cursor: pointer  /* Add cursor pointer */\n\n.input-content\n  flex-wrap: wrap\n  display: flex\n  background-color: #f1f1f1\n  border: 0\n  flex-grow: 1\n  width: 100%\n  .input-area\n    overflow-y: auto\n    max-height: 20rem\n    resize: none\n    font-size: 1rem\n    background-color: #f1f1f1\n    border: 0\n    flex-grow: 1\n    width: 100%\n    moz-user-select: -moz-none\n    -moz-user-select: none\n    -o-user-select: none\n    -khtml-user-select: none\n    -webkit-user-select: none\n    -ms-user-select: none\n    user-select: none\n    &:focus\n      border: 0\n      outline: none\n</style>\n","<template>\n  <div class=\"file-block\">\n    <div class=\"file-block-icon\">\n      <div class=\"file-icon\" :class=\"iconClass\">\n        <!-- Dynamic class binding -->\n        <span v-if=\"file_type\"> {{ file_type.toUpperCase() }}</span>\n      </div>\n    </div>\n    <div class=\"file-block-text\">\n      <div class=\"file-name\" :title=\"file_name\">{{ file_name }}</div>\n      <div class=\"file-info\">\n        {{ file_type.toUpperCase() }}, {{ formated_file_size }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    fileUrl: {\n      // 修改为 camelCase\n      type: String,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      file_name: \"\",\n      file_type: \"\",\n      formated_file_size: \"\",\n    };\n  },\n  computed: {\n    iconClass() {\n      //Use lower case for comparison, easier to manage\n      const type = this.file_type.toLowerCase();\n\n      if (type === \"pdf\") {\n        return \"file-icon-pdf\";\n      } else if ([\"xls\", \"xlsx\", \"csv\"].includes(type)) {\n        // Spreadsheet (Excel, CSV)\n        return \"file-icon-spreadsheet\";\n      } else if ([\"doc\", \"docx\"].includes(type)) {\n        // Word\n        return \"file-icon-word\";\n      } else if ([\"ppt\", \"pptx\"].includes(type)) {\n        // PowerPoint\n        return \"file-icon-ppt\";\n      } else {\n        return \"file-icon-other\"; // Default (gray)\n      }\n    },\n  },\n  created() {\n    // 从查询参数中获取文件大小\n    const url = this.fileUrl.split(\"?\");\n    const params = new URLSearchParams(url[1]);\n    const bits = params.get(\"size\");\n    this.file_name = params.get(\"name\");\n    this.formated_file_size = this.formatFileSize(bits);\n    // 从url中获取文件类型\n    const file_type = url[0].split(\".\");\n    this.file_type = file_type[file_type.length - 1];\n  },\n  methods: {\n    formatFileSize(bits) {\n      const units = [\"B\", \"KB\", \"MB\"];\n      let unitIndex = 0;\n      while (bits >= 1024) {\n        bits /= 1024;\n        unitIndex++;\n      }\n      return bits.toFixed(2) + \" \" + units[unitIndex];\n    },\n  },\n};\n</script>\n\n<style scoped>\n.file-block {\n  display: flex;\n  align-items: center;\n  padding: 8px;\n  border-radius: 5px;\n  background-color: #f5f5f5;\n  margin-bottom: 8px;\n  width: 12rem;\n  position: relative;\n}\n\n.file-block-icon {\n  width: 40px;\n  height: 40px;\n  margin-right: 8px;\n}\n\n.file-icon {\n  width: 40px;\n  height: 40px;\n  /*  Remove default background  */\n  /* background-color: #4285f4; */\n  color: #fff;\n  border-radius: 5px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 14px;\n}\n/* Add specific styles for each file type */\n.file-icon-pdf {\n  background-color: #e70012;\n}\n\n.file-icon-spreadsheet {\n  background-color: #138147;\n}\n\n.file-icon-word {\n  background-color: #144eb3;\n}\n.file-icon-ppt {\n  background-color: #ca4b27;\n}\n\n.file-icon-other {\n  background-color: gray;\n}\n\n.file-block-text {\n  flex: 1;\n  overflow: hidden;\n}\n\n.file-name {\n  font-weight: bold;\n  font-size: 12px;\n  color: #333;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.file-info {\n  font-size: 10px;\n  color: #777;\n}\n</style>\n","<template>\n  <div class=\"tool-call-bar\">\n    <div class=\"status-icon\">\n      <span v-if=\"tool_call_success\" class=\"call-success-icon\">\n        <div class=\"checkmark-container\">\n          <svg\n            class=\"checkmark\"\n            viewBox=\"0 0 52 36\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n          >\n            <polyline points=\"1 20 15 36 51 1\" />\n          </svg>\n        </div>\n      </span>\n      <span v-else-if=\"tool_call_fail\" class=\"call-fail-icon\">❌</span>\n      <span v-else class=\"call-pend-icon\"></span>\n    </div>\n    <div class=\"tool-info\">\n      <div>\n        <span class=\"tool-name\">{{ tool_call.name }}</span>\n      </div>\n      <div class=\"tool-status\">\n        {{ call_status }}\n      </div>\n    </div>\n    <div class=\"extra-info\">\n      <button\n        ref=\"show-extra-info\"\n        :class=\"{ active: showExtraInfo, 'extra-info-button': true }\"\n        @click=\"showExtraInfo = !showExtraInfo\"\n      >\n        <svg\n          t=\"1731677922196\"\n          class=\"icon\"\n          viewBox=\"0 0 1024 1024\"\n          version=\"1.1\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          p-id=\"5948\"\n          width=\"16\"\n          height=\"16\"\n        >\n          <path\n            d=\"M778.965749 128.759549l-383.064442 383.063419 388.097062 388.096039-0.070608 0.033769c12.709463 13.137205 20.529569 31.024597 20.529569 50.731428 0 40.376593-32.736589 73.112158-73.115228 73.112158-19.705807 0-37.591153-7.819083-50.730405-20.528546l-0.034792 0.035816L241.890654 564.622498l0.035816-0.035816c-13.779841-13.281491-22.3838-31.915897-22.3838-52.585659 0-0.071631 0-0.106424 0-0.178055 0-0.072655 0-0.10847 0-0.144286 0-20.669762 8.603959-39.341007 22.3838-52.622498l-0.035816-0.034792L680.573835 20.337187l0.180102 0.179079c13.139252-12.5662 30.950919-20.313651 50.587142-20.313651 40.378639 0 73.115228 32.736589 73.115228 73.114205C804.455283 95.485725 794.567076 115.334795 778.965749 128.759549z\"\n            p-id=\"5949\"\n          ></path>\n        </svg>\n      </button>\n    </div>\n    <div :class=\"{ active: showExtraInfo, 'extra-info-bar': true }\">\n      <div class=\"extra-detail\">\n        <div class=\"detail-params\">\n          <div class=\"detail-title\">参数</div>\n          <div class=\"detail-content\">\n            {{ tool_call.params }}\n          </div>\n        </div>\n\n        <div class=\"detail-result\">\n          <div class=\"detail-title\">返回值</div>\n          <div class=\"detail-content\">\n            {{ tool_call.result }}\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    tool_call: {\n      type: Object,\n    },\n  },\n  data() {\n    return {\n      showExtraInfo: false,\n    };\n  },\n  computed: {\n    tool_call_success() {\n      return (\n        this.tool_call.action === \"finished\" &&\n        this.tool_call?.result?.error === null\n      );\n    },\n    tool_call_fail() {\n      return (\n        this.tool_call.action === \"finished\" &&\n        !this.tool_call?.result?.error !== null\n      );\n    },\n    call_status() {\n      if (this.tool_call.action == \"started\") return \"开始运行\";\n      if (this.tool_call.action == \"pending\") return \"函数构建中\";\n      if (this.tool_call.action == \"running\") return \"函数运行中\";\n      if (this.tool_call_success) return \"函数运行成功\";\n      if (this.tool_call_fail) return \"函数运行失败\";\n      else return \"未知状态\";\n    },\n  },\n  mounted() {},\n};\n</script>\n<style scoped>\n.extra-detail {\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 20rem;\n  max-height: 25rem;\n  flex-grow: 1;\n  padding-bottom: 1rem;\n}\n\n.detail-params,\n.detail-result {\n  margin-top: 1rem;\n  width: calc(100% - 2rem);\n  background-color: #fff;\n  border-radius: 0.5rem;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  flex-grow: 1;\n}\n\n.detail-title {\n  padding-top: 0.5rem;\n  flex-basis: 2rem;\n  width: 90%;\n  border-bottom: 1px solid #5c5c5c;\n}\n\n.detail-content {\n  user-select: text;\n  margin: 0.5rem 0rem;\n  font-size: 0.8rem;\n  color: #5c5c5c;\n  width: 90%;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 8rem;\n  flex-grow: 1;\n}\n\n.extra-info-bar {\n  position: absolute;\n  overflow: hidden;\n  z-index: 2;\n  max-height: 0px;\n  transition: 0.3s;\n  top: 4rem;\n  position: absolute;\n  background-color: #f5f5f5;\n  border-radius: 0.5rem;\n  box-shadow: 0px 0px 5px 0px rgba(0, 0, 0, 0.2);\n  display: flex;\n  flex-direction: column;\n}\n\n.extra-info-bar.active {\n  max-height: 50rem;\n}\n\n.tool-info {\n  flex-grow: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-evenly;\n}\n\n.extra-info {\n  flex-basis: 2.5rem;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\nbutton.extra-info-button {\n  transition: transform 0.3s ease;\n  transform: rotate(90deg);\n}\n\nbutton.extra-info-button.active {\n  transform: rotate(-90deg);\n}\n\nbutton.extra-info-button:hover svg {\n  transition: transform 0.3s ease;\n  transform: scale(1.2);\n}\n\n.tool-name {\n  font-weight: bolder;\n}\n\n.tool-call-bar {\n  margin-top: 0.5rem;\n  margin-bottom: 0.5rem;\n  width: 15rem;\n  height: 4rem;\n  background-color: #f5f5f5;\n  border-radius: 5px;\n  display: flex;\n  position: relative;\n}\n\n.status-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-basis: 4rem;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #f5f5f5;\n}\n\n.call-pend-icon {\n  transform: rotateZ(45deg);\n  perspective: 1000px;\n  border-radius: 50%;\n  width: 48px;\n  height: 48px;\n  color: #fff;\n}\n\n.call-pend-icon:before,\n.call-pend-icon:after {\n  content: \"\";\n  display: block;\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: inherit;\n  height: inherit;\n  border-radius: 50%;\n  transform: rotateX(70deg);\n  animation: 1s spin linear infinite;\n}\n\n.call-pend-icon:after {\n  color: #ff3d00;\n  transform: rotateY(70deg);\n  animation-delay: 0.4s;\n}\n\n@keyframes rotate {\n  0% {\n    transform: translate(-50%, -50%) rotateZ(0deg);\n  }\n\n  100% {\n    transform: translate(-50%, -50%) rotateZ(360deg);\n  }\n}\n\n@keyframes rotateccw {\n  0% {\n    transform: translate(-50%, -50%) rotate(0deg);\n  }\n\n  100% {\n    transform: translate(-50%, -50%) rotate(-360deg);\n  }\n}\n\n@keyframes spin {\n  0%,\n  100% {\n    box-shadow: 0.2em 0px 0 0px currentcolor;\n  }\n\n  12% {\n    box-shadow: 0.2em 0.2em 0 0 currentcolor;\n  }\n\n  25% {\n    box-shadow: 0 0.2em 0 0px currentcolor;\n  }\n\n  37% {\n    box-shadow: -0.2em 0.2em 0 0 currentcolor;\n  }\n\n  50% {\n    box-shadow: -0.2em 0 0 0 currentcolor;\n  }\n\n  62% {\n    box-shadow: -0.2em -0.2em 0 0 currentcolor;\n  }\n\n  75% {\n    box-shadow: 0px -0.2em 0 0 currentcolor;\n  }\n\n  87% {\n    box-shadow: 0.2em -0.2em 0 0 currentcolor;\n  }\n}\n\n.checkmark-container {\n  width: 2.25rem;\n  height: 2rem;\n}\n\n.checkmark {\n  width: 100%;\n  height: 100%;\n}\n\n.checkmark polyline {\n  fill: none;\n  stroke: green;\n  /* 设置颜色为绿色 */\n  stroke-width: 10;\n  /* 设置线条的粗细 */\n  stroke-dasharray: 60;\n  /* 总长度 */\n  stroke-dashoffset: 60;\n  /* 起始偏移量 */\n  animation: draw 1s forwards;\n  /* 动画定义 */\n}\n\n@keyframes draw {\n  to {\n    stroke-dashoffset: 0;\n    /* 结束时偏移量为0，显示完整的对勾 */\n  }\n}\n</style>\n","<template>\n  <div class=\"reason-block\">\n    <div class=\"head-bar\">\n      <div class=\"reason-info\">{{ getReasonInfo }}</div>\n      <button\n        :class=\"{ active: show, 'extra-info-button': true }\"\n        @click=\"toggleShow\"\n      >\n        <i class=\"iconfont icon-return\" />\n      </button>\n    </div>\n    <div\n      ref=\"reasonContent\"\n      class=\"reason-content\"\n      :style=\"{ 'max-height': maxHeight }\"\n    >\n      {{ content }}\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    content: {\n      required: true,\n      type: String,\n      default: \"\",\n    },\n    startTime: {\n      required: true,\n      type: Number,\n    },\n    endTime: {\n      required: false,\n      type: Number,\n      default: 0,\n    },\n  },\n  data() {\n    return {\n      show: true,\n      maxHeight: \"auto\", // 初始值\n    };\n  },\n  computed: {\n    getReasonInfo() {\n      if (this.endTime) {\n        const timeDiff = this.endTime - this.startTime;\n        return `已深度思考（耗时 ${(timeDiff / 1000).toFixed(2)} 秒）`;\n      } else {\n        return `正在深度思考......`;\n      }\n    },\n  },\n  mounted() {\n    this.updateMaxHeight(); //初始展开\n  },\n  updated() {\n    this.updateMaxHeight(); //防止内容更新,导致高度计算错误\n  },\n  methods: {\n    toggleShow() {\n      this.show = !this.show;\n      this.updateMaxHeight();\n    },\n    updateMaxHeight() {\n      if (this.show) {\n        // 展开时，设置为内容实际高度 + 一些额外空间 (如 padding)\n        this.maxHeight = this.$refs.reasonContent.scrollHeight + 20 + \"px\";\n      } else {\n        // 收起时，设置为 0\n        this.maxHeight = \"0px\";\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.reason-block {\n  margin-bottom: 10px;\n  display: flex;\n  flex-direction: column;\n}\n\n.reason-info {\n  margin: 0.5rem 0;\n  font-size: 0.8rem;\n  min-width: 8rem;\n  flex-basis: 10rem;\n  text-wrap: nowrap;\n}\n\n.head-bar {\n  flex-basis: 1rem;\n  margin: 0.5rem 0;\n  display: flex;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n  width: fit-content;\n  background-color: #f5f5f5;\n  border-radius: 10px;\n  padding: 0px 0.5rem;\n}\n\n.head-bar:hover {\n  background-color: #ededed;\n}\n\n.head-bar button {\n  flex-basis: 1rem;\n  margin-left: 0.5rem;\n  background-color: transparent;\n  border: none;\n  cursor: pointer;\n  transition: transform 0.3s ease-in-out;\n  /* 使用 ease-in-out */\n  display: flex;\n  align-items: center;\n  gap: 2px;\n}\n\n.head-bar button i {\n  font-size: 0.8rem;\n}\n\n.head-bar button.active {\n  transform: rotate(-90deg);\n}\n\n.reason-content {\n  max-width: 100%;\n  /* max-height 在 JavaScript 中动态控制 */\n  overflow: hidden;\n  /* 隐藏超出部分 */\n  user-select: text;\n  font-size: 0.8rem;\n  color: #6f6f6f;\n  white-space: pre-line;\n  border-left: 2px solid #ccc;\n  transition: max-height 0.3s ease-in-out;\n  /* 对 max-height 应用过渡 */\n  padding-left: 1rem;\n}\n</style>\n","<template>\n    <div id=\"message-menu\">\n      <div v-if=\"seletedText\" @click.stop=\"copySeletedText\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>复制选中</span>\n      </div>\n      <div @click.stop=\"copyText\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>复制消息</span>\n      </div>\n      <div v-if=\"seletedImage\" @click.stop=\"copySeletedImage\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>复制图片</span>\n      </div>\n      <div v-if=\"seletedImage\" @click.stop=\"saveSeletedImage\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>保存图片</span>\n      </div>\n      <div @click.stop=\"retryMessage\">\n        <i class=\"iconfont reset\"></i>\n        <span>重试消息</span>\n      </div>\n      <div @click.stop=\"replyMessage\">\n        <i class=\"iconfont yinyong\"></i>\n        <span>引用消息</span>\n      </div>\n      <div @click.stop=\"deleteMessage\">\n        <i class=\"iconfont shanchu\"></i>\n        <span>删除消息</span>\n      </div>\n    </div>\n  </template>\n<script>\nexport default {\n  name: \"MessageMenu\", // 建议添加组件 name，方便调试\n  props: {\n    type: {\n      type: String,\n      default: \"message\",\n    },\n    message: {\n      type: Object,\n      default: () => ({}),\n    },\n    seletedText: {\n      type: String,\n      default: \"\",\n    },\n    seletedImage: {\n      type: String,\n      default: \"\",\n    },\n  },\n  emits: ['close','message-option'],//显式声明emit的事件\n  methods: {\n    async copySeletedImage() {\n        this.$emit('close');\n        try {\n             await this.copyImageToClipboard(this.seletedImage);\n        } catch (error) {\n            console.error(\"复制选择图片失败：\", error);\n        }\n    },\n    async saveSeletedImage() {\n      this.$emit('close');\n      try {\n         await this.downloadImage(this.seletedImage);\n      } catch (error) {\n          console.error('保存选择图片失败：', error)\n      }\n    },\n\n    copyText() {\n        let text = \"\";\n        this.message.content.forEach((element) => {\n            if (element.type === \"text\") {\n                text += element.data.text;\n            } else if (element.type === \"image\") {\n                text += `\\n![图片](${element.data.file})`;\n            }\n        });\n        this.copyTextToClipboard(text);\n        this.$emit('close');\n    },\n\n    copySeletedText() {\n        this.copyTextToClipboard(this.seletedText);\n        this.$emit('close');\n    },\n\n    retryMessage() {\n        this.$emit('message-option', 'retry'); \n        this.$emit('close');\n    },\n\n    replyMessage() {\n        this.$emit('message-option','reply'); \n        this.$emit('close');\n    },\n\n    deleteMessage() {\n        this.$emit('message-option','delete');\n        this.$emit('close');\n    },\n\n    // 封装复制文本到剪贴板的函数\n    async copyTextToClipboard(text) {\n      let textarea;\n      try {\n        textarea = document.createElement(\"textarea\");\n        textarea.style.position = \"absolute\";\n        textarea.style.left = \"-9999px\";\n        textarea.value = text;\n        document.body.appendChild(textarea);\n        textarea.select();\n        textarea.setSelectionRange(0, 99999); // For mobile devices\n        await document.execCommand(\"copy\");\n        this.$message({ message: \"复制成功\", type: \"success\" });\n      } catch (err) {\n        console.error(\"复制失败:\", err);\n        this.$message({ message: \"复制失败\", type: \"error\" });\n      } finally {\n        document.body.removeChild(textarea);\n      }\n    },\n    // 封装复制图片到剪贴板的函数\n    async copyImageToClipboard(imgSrc) {\n      try {\n        const response = await fetch(imgSrc);\n        if (!response.ok) {\n          throw new Error(\"网络错误，无法获取图片\");\n        }\n        const blob = await response.blob();\n        const img = new Image();\n        const url = URL.createObjectURL(blob);\n\n        img.onload = async () => {\n          const canvas = document.createElement(\"canvas\");\n          canvas.width = img.width;\n          canvas.height = img.height;\n          const ctx = canvas.getContext(\"2d\");\n          ctx.drawImage(img, 0, 0);\n\n          // 使用 Promise 包装 toBlob\n          const pngBlob = await new Promise((resolve) => {\n              canvas.toBlob(resolve, \"image/png\");\n          });\n\n          if (pngBlob) {\n            const item = new ClipboardItem({ \"image/png\": pngBlob });\n            await navigator.clipboard.write([item]); // 使用 await\n            this.$message({\n              message: \"图片已复制到剪贴板\",\n              type: \"success\",\n            });\n          } else {\n            this.$message({\n              message: \"转换为 PNG 失败\",\n              type: \"error\",\n            });\n          }\n          URL.revokeObjectURL(url);\n        };\n        img.onerror = () => {\n            this.$message({ message: \"加载图片失败\", type: \"error\" });\n             URL.revokeObjectURL(url); // 确保在错误时也释放 URL\n        };\n        img.src = url;\n      } catch (err) {\n        console.error(\"复制图片失败:\", err);\n        this.$message({ message: \"复制图片失败\", type: \"error\" });\n      }\n    },\n    // 封装下载图片的函数\n    async downloadImage(imgSrc) {\n        try {\n             const link = document.createElement(\"a\");\n            link.href = imgSrc;\n            link.download = \"image.png\";\n            link.click();\n        } catch (err) {\n            console.error('保存图片失败：', err)\n            this.$message({ message: \"保存图片失败\", type: \"error\" });\n        }\n\n    },\n  },\n};\n</script>\n\n<style lang=\"sass\" scoped>\n#message-menu\n    position: fixed\n    display: flex\n    flex-direction: column\n    justify-content: center\n    background-color: hsla(0, 0%, 100%, .78)\n    backdrop-filter: blur(0.5rem)\n    border-radius: 0.5rem\n    padding: .5rem \n    z-index: 9999\n\n    @keyframes pop-up\n        0%\n            transform: scale(1)\n        50%\n            transform: scale(1.2)\n        100%\n            transform: scale(1)\n\n    & div\n        margin: 0.4rem 0\n        padding: .2rem .4rem\n        border-radius: .2rem\n        display: flex\n        justify-content: space-between\n        align-items: center\n        cursor: pointer\n\n    & div:hover\n        background-color: hsla(0, 0%, 90%, .88)\n\n    & div:hover > i\n        animation: pop-up 0.5s ease-in-out 1 forwards\n\n    & i \n        position: absolute\n        display: flex\n        justify-content: center\n        align-items: center\n        transform-origin: center\n\n\n    & span\n        font-size: 0.8rem\n        color: rgb(120, 124, 127)\n        margin-left: 1.8rem\n</style>","<template>\n  <div class=\"add-contactor\">\n    <div class=\"head\">\n      <div class=\"title\">添加机器人</div>\n      <div class=\"close-icon\" @click=\"close\">✕</div>\n    </div>\n    <div class=\"body\">\n      <div class=\"search\">\n        <i class=\"iconfont sousuo listicon\" />\n        <input\n          v-model=\"keyWord\"\n          type=\"text\"\n          placeholder=\"输入搜索关键词\"\n          @input=\"loadSerachPresets\"\n        />\n      </div>\n      <div class=\"info\">\n        <header class=\"presets-types\">\n          <nav\n            v-for=\"(type, index) in avaliablePresetTypes\"\n            :key=\"index\"\n            :class=\"activeTypeIndex === index ? 'active' : ''\"\n            @click=\"changeShownType(index)\"\n          >\n            {{ type }}\n          </nav>\n        </header>\n        <div :style=\"{ left: buttonTranslate }\" class=\"slide-button\"></div>\n        <div\n          v-if=\"shownPrestsList.length > 0 || [0, 3].includes(activeTypeIndex)\"\n          class=\"presets-list\"\n        >\n          <div\n            v-for=\"(preset, index) in shownPrestsList\"\n            :key=\"index\"\n            class=\"presets-item\"\n          >\n            <div v-if=\"preset.avatar\" class=\"preset-avatar custom\">\n              <img :src=\"preset.avatar\" />\n            </div>\n            <div v-else-if=\"preset.model\" class=\"preset-avatar model\">\n              <img :src=\"Contactor.getAvatarByModel(preset.model)\" />\n            </div>\n            <div v-else=\"!preset.model\" class=\"preset-avatar\">\n              {{ preset.name.slice(0, 2) }}\n            </div>\n            <div class=\"preset-info\">\n              <div class=\"preset-name\">{{ preset.name }}</div>\n              <div :title=\"preset.opening\" class=\"preset-description\">\n                {{ preset.opening }}\n              </div>\n            </div>\n            <el-button @click=\"addBot(preset)\">添加</el-button>\n          </div>\n          <div v-show=\"showPresetsLoader\" ref=\"loader\" class=\"loading\">\n            <div></div>\n            <div></div>\n            <div></div>\n            <div></div>\n            <div></div>\n          </div>\n        </div>\n        <div v-else class=\"empty-list\">\n          <el-empty :image-size=\"200\" />\n        </div>\n      </div>\n      <div class=\"options\"></div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Contactor from \"../lib/contactor\";\nexport default {\n  emits: [\"addBot\", \"close\"],\n  data() {\n    const avaliablePresetTypes = [\"推荐\", \"最近\", \"本地\", \"系统\"];\n    return {\n      show: false,\n      presetsList: [],\n      recommendPresets: [],\n      recentPresets: [],\n      localPresets: [],\n      systemPresets: [],\n      searchPresets: [],\n      systemShownNum: 0,\n      recommendShownNum: 0,\n      keyWord: \"\",\n      activeTypeIndex: 0,\n      buttonTranslate: 0,\n      avaliablePresetTypes,\n      moreSystemPresets: true,\n      moreRecommendPresets: true,\n      observer: null, // Store the observer instance\n      Contactor,\n    };\n  },\n  computed: {\n    showPresetsLoader() {\n      return this.activeTypeIndex == 3\n        ? this.moreSystemPresets\n        : this.activeTypeIndex == 0\n          ? this.moreRecommendPresets\n          : false;\n    },\n    shownPrestsList() {\n      // 如果 keyWord 不为空，返回 searchPresets\n      if (this.keyWord) {\n        return this.searchPresets;\n      }\n      return this.activeTypeIndex === 2\n        ? this.localPresets\n        : this.activeTypeIndex === 1\n          ? this.recentPresets\n          : this.activeTypeIndex === 0\n            ? this.recommendPresets\n            : this.activeTypeIndex === 3\n              ? this.systemPresets\n              : null; // 或者返回默认值\n    },\n  },\n  mounted() {\n    this.getAddHistory();\n\n    if (\"IntersectionObserver\" in window) {\n      const callback = (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            this.loadMoreData();\n          }\n        });\n      };\n\n      this.observer = new IntersectionObserver(callback);\n      const presetsLoader = this.$refs.loader;\n      if (presetsLoader) {\n        this.observer.observe(presetsLoader);\n      }\n    } else {\n      // Fallback for browsers that do not support IntersectionObserver\n      // Use scroll event to detect when the loader is visible.\n      window.addEventListener(\"scroll\", this.handleScroll);\n    }\n  },\n  beforeUnmount() {\n    if (this.observer) {\n      this.observer.disconnect();\n    } else {\n      window.removeEventListener(\"scroll\", this.handleScroll);\n    }\n  },\n  methods: {\n    async addBot(preset) {\n      this.strogeAddHistory(preset);\n      this.$emit(\"addBot\", preset);\n    },\n    strogeAddHistory(preset) {\n      // 先检查现有列表中是否有重复项\n      const existingItem = this.recentPresets.find(\n        (item) => item.name === preset.name,\n      );\n      if (existingItem) {\n        // 如果有重复项，将其从数组中移除\n        this.recentPresets.splice(this.recentPresets.indexOf(existingItem), 1);\n      }\n      // 添加新项目到数组的最前面\n      this.recentPresets.unshift(preset);\n      // 检查数组长度并保持在小于或等于6\n      if (this.recentPresets.length > 6) {\n        this.recentPresets.pop(); // 移除最后一个元素，即最旧的元素\n      }\n      // 更新到 localStorage\n      localStorage.setItem(\"addHistory\", JSON.stringify(this.recentPresets));\n    },\n    getAddHistory() {\n      const data = localStorage.getItem(\"addHistory\");\n      if (data) {\n        this.recentPresets = JSON.parse(data);\n      }\n    },\n    async changeShownType(index) {\n      this.activeTypeIndex = index;\n      this.buttonTranslate = `${49.6 * index}px`;\n      await this.loadSpecificType();\n    },\n    close() {\n      this.$emit(\"close\");\n    },\n    async loadSpecificType() {\n      const type = this.avaliablePresetTypes[this.activeTypeIndex];\n      this.presetsList = await this.getPresetList(type);\n    },\n    async getPresetList(type) {\n      if (type === \"系统\") {\n        return await this.loadSystemPresets();\n      } else if (type === \"推荐\") {\n        return await this.loadRecommendedPresets();\n      } else if (type === \"最近\") {\n        return this.recentPresets;\n      } else if (type === \"本地\") {\n        return this.localPresets;\n      }\n    },\n    async loadRecommendedPresets() {\n      const res = await fetch(\n        `/api/openai/presets?type=recommended&start=${this.recommendShownNum}`,\n      ).then((res) => res.json());\n      for (let i = 0; i < res.data.length; i++) {\n        this.recommendPresets.push(res.data[i]);\n      }\n      this.recommendShownNum += res.data.length;\n      if (res.data.length < 9) {\n        this.moreRecommendPresets = false;\n      }\n      return this.recommendPresets;\n    },\n    async loadSystemPresets() {\n      const res = await fetch(\n        `/api/openai/presets?type=system&start=${this.systemShownNum}`,\n      ).then((res) => res.json());\n      for (let i = 0; i < res.data.length; i++) {\n        this.systemPresets.push(res.data[i]);\n      }\n      this.systemShownNum += res.data.length;\n      if (res.data.length < 9) {\n        this.moreSystemPresets = false;\n      }\n      return this.systemPresets;\n    },\n    async loadSerachPresets() {\n      const load = async () => {\n        const res = await fetch(\n          `/api/openai/presets?type=search&keyword=${this.keyWord}`,\n        ).then((res) => res.json());\n        this.searchPresets = res.data;\n      };\n      // 添加节流逻辑\n      if (this.searchTimer) {\n        clearTimeout(this.searchTimer);\n      }\n      this.searchTimer = setTimeout(() => {\n        load();\n      }, 500);\n    },\n    loadMoreData() {\n      if (this.showPresetsLoader && this.activeTypeIndex === 3) {\n        this.loadSystemPresets();\n      } else if (this.showPresetsLoader && this.activeTypeIndex === 0) {\n        this.loadRecommendedPresets();\n      }\n    },\n    handleScroll() {\n      const loader = this.$refs.loader;\n      if (!loader) return;\n\n      const rect = loader.getBoundingClientRect();\n      const isVisible =\n        rect.top >= 0 &&\n        rect.left >= 0 &&\n        rect.bottom <=\n          (window.innerHeight || document.documentElement.clientHeight) &&\n        rect.right <=\n          (window.innerWidth || document.documentElement.clientWidth);\n\n      if (isVisible) {\n        this.loadMoreData();\n      }\n    },\n  },\n};\n</script>\n<style scoped>\n.empty-list {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n}\n\n.presets-list {\n  position: relative;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-top: 1rem;\n  height: calc(100% - 3rem);\n  overflow-y: auto;\n}\n\n.preset-description {\n  white-space: nowrap;\n  /* 不换行 */\n  overflow: hidden;\n  /* 内容超出隐藏 */\n  text-overflow: ellipsis;\n  /* 使用省略号 */\n  font-size: 0.8rem;\n  color: #888;\n  width: 100%;\n}\n\n.presets-item button {\n  flex-basis: 60px;\n}\n\n.presets-loader {\n  width: 100%;\n  height: 1rem;\n}\n\n.presets-item {\n  position: relative;\n  margin-top: 0.5rem;\n  width: 100%;\n  max-width: 100%;\n  display: flex;\n  flex-basis: 3rem;\n  justify-content: space-around;\n}\n\n.preset-avatar {\n  min-width: 2.8rem;\n  max-width: 2.8rem;\n  height: 2.8rem;\n  background-color: #0099ff;\n  color: #fff;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.preset-avatar.model {\n  background-color: #ffffff;\n  border-radius: 50%;\n}\n\n.preset-avatar.custom img {\n  width: 100%;\n  border-radius: 50%;\n}\n\n.preset-avatar.model img {\n  width: 90%;\n}\n\n.preset-info {\n  position: relative;\n  margin-left: 0.5rem;\n  width: calc(100% - 7.5rem);\n}\n\n.slide-button {\n  width: 2rem;\n  border-top: #0099ff 2px solid;\n  margin-left: 0.3rem;\n  position: relative;\n  left: 0;\n  transition: left 0.3s;\n}\n\n.body {\n  margin-top: 0.5rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding-left: 1rem;\n  padding-right: 1rem;\n  overflow: hidden;\n  position: relative;\n  height: calc(100% - 2.5rem);\n}\n\n.info {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  position: relative;\n  height: calc(100% - 2.5rem);\n}\n\n.presets-types {\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-start;\n  width: 100%;\n  margin-top: 1rem;\n  position: relative;\n}\n\n.presets-types nav {\n  cursor: pointer;\n  padding: 0.2rem 0.5rem;\n  margin-right: 0.5rem;\n  border-radius: 0.5rem;\n  font-size: 0.8rem;\n}\n\n.presets-types nav.active {\n  color: #0099ff;\n}\n\n.search {\n  position: relative;\n  box-sizing: border-box;\n  border-bottom: 1px solid #f1f1f1;\n  width: 100%;\n  height: 2em;\n  background-color: #f1f1f1;\n  border-radius: 0.5rem;\n  display: flex;\n  align-items: center;\n  padding-left: 0.5rem;\n}\n\n.search:has(input:focus) {\n  border: #0099ff 1px solid;\n}\n\n.search input {\n  position: absolute;\n  width: calc(100% - 2rem);\n  height: 1.5rem;\n  background-color: #f1f1f1;\n  border: none;\n  outline: none;\n  margin-left: 1rem;\n}\n\n.search i {\n  position: absolute;\n  font-size: 0.8rem;\n  color: #888;\n}\n\n.add-contactor {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 400px;\n  height: 500px;\n  background-color: #fff;\n  border-radius: 10px;\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n  z-index: 100;\n  overflow: hidden;\n}\n\n.head {\n  height: 2rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-bottom: 1px solid #f1f1f1;\n  font-size: 0.8rem;\n}\n\n.close-icon {\n  width: 1.5rem;\n  font-size: 0.8rem;\n  height: 100%;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.close-icon:hover {\n  color: aliceblue;\n  background-color: rgb(196, 43, 28);\n}\n\n@media (max-width: 600px) {\n  .add-contactor {\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    transform: none;\n    border-radius: 0;\n  }\n}\n</style>\n<style>\n.loading,\n.loading > div {\n  position: relative;\n  box-sizing: border-box;\n}\n\n.loading {\n  display: block;\n  font-size: 0;\n  color: #000;\n}\n\n.loading.la-dark {\n  color: #333;\n}\n\n.loading > div {\n  display: inline-block;\n  float: none;\n  background-color: currentColor;\n  border: 0 solid currentColor;\n}\n\n.loading {\n  margin-top: 1rem;\n  width: 16px;\n  min-height: 1rem;\n}\n\n.loading > div {\n  position: absolute;\n  top: 0;\n  left: -100%;\n  display: block;\n  width: 16px;\n  width: 100%;\n  height: 16px;\n  height: 100%;\n  border-radius: 100%;\n  opacity: 0.5;\n  animation:\n    ball-circus-position 2.5s infinite cubic-bezier(0.25, 0, 0.75, 1),\n    ball-circus-size 2.5s infinite cubic-bezier(0.25, 0, 0.75, 1);\n}\n\n.loading > div:nth-child(1) {\n  animation-delay:\n    0s,\n    -0.5s;\n}\n\n.loading > div:nth-child(2) {\n  animation-delay:\n    -0.5s,\n    -1s;\n}\n\n.loading > div:nth-child(3) {\n  animation-delay:\n    -1s,\n    -1.5s;\n}\n\n.loading > div:nth-child(4) {\n  animation-delay:\n    -1.5s,\n    -2s;\n}\n\n.loading > div:nth-child(5) {\n  animation-delay:\n    -2s,\n    -2.5s;\n}\n\n@keyframes ball-circus-position {\n  50% {\n    left: 100%;\n  }\n}\n\n@keyframes ball-circus-size {\n  50% {\n    transform: scale(0.3, 0.3);\n  }\n}\n</style>\n","<script>\nimport { client, config } from \"@/lib/runtime.js\";\nimport AddContactor from \"@/components/AddContactor.vue\";\n\nexport default {\n  components: {\n    AddContactor,\n  },\n  data() {\n    let list = client.getContactors();\n    const onPhone = window.innerWidth < 600;\n\n    return {\n      onPhone,\n      contactorList: list,\n      showAddOptions: false,\n      showAddWindow: false,\n    };\n  },\n  computed: {\n    sortedList() {\n      return [...this.contactorList].sort((a, b) =>\n        b.priority - a.priority == -1 ? 1 : b.lastUpdate - a.lastUpdate,\n      );\n    },\n  },\n  mounted() {\n    this.addReactiveListener();\n  },\n  beforeCreate() {\n    if (client.getContactors().length == 0) {\n      client.on(\n        \"loaded\",\n        () => {\n          this.contactorList = client.getContactors();\n        },\n        false,\n      );\n    }\n  },\n  methods: {\n    genBotByPreset() {\n      this.showAddOptions = false;\n      this.showAddWindow = true;\n    },\n    showChat(id) {\n      // 如果当前路径 name 是 blank 或者 chat_view ，跳转到 /chat/:id\n      if (this.$route.name == \"blank\" || this.$route.name == \"chat_view\") {\n        this.$router.push({ name: \"chat_view\", params: { id: id } });\n      } else if (\n        this.$route.name == \"contactors\" ||\n        this.$route.name == \"profile_view\"\n      ) {\n        this.$router.push({ name: \"profile_view\", params: { id: id } });\n      } else {\n        // 否则，直接跳转到 /chat/:id\n        this.$router.replace({ name: \"chat_view\", params: { id: id } });\n      }\n    },\n    getId(item) {\n      // 获取当前页面的id\n      let currentId = this.$route.params.id;\n      // 获取当前页面的contactorId\n      let contactorId = item.id;\n      // 如果当前页面的id和contactorId相同，则返回active\n      if (currentId == contactorId) {\n        return \"active\";\n      } else {\n        return item.priority == 0 ? \"important\" : \"\";\n      }\n    },\n    async genBlankBot() {\n      const options = {\n        ...config.openaiDefaultConfig,\n      };\n      const openaiDefaultConfig = {\n        id: this.genFakeId(),\n        title: options.default_model,\n        avatarPolicy: 0,\n        namePolicy: 2,\n        priority: 1,\n        options: options,\n      };\n\n      this.showAddOptions = false;\n      await client.addConcator(\"openai\", openaiDefaultConfig);\n      this.addReactiveListener();\n    },\n    startResize(event) {\n      this.isResizing = true;\n      this.startX = event.clientX;\n      this.startWidth = this.$refs.friendlists.offsetWidth;\n      document.addEventListener(\"mousemove\", this.resize);\n      document.addEventListener(\"mouseup\", this.stopResize);\n    },\n    resize(event) {\n      if (this.isResizing) {\n        let newWidth = this.startWidth + (event.clientX - this.startX);\n        const maxWidth = 500;\n        const minWidth = 176;\n        newWidth =\n          newWidth > maxWidth\n            ? maxWidth\n            : newWidth < minWidth\n              ? minWidth\n              : newWidth;\n        this.$refs.friendlists.style.flexBasis = newWidth + \"px\";\n      }\n    },\n    stopResize() {\n      this.isResizing = false;\n      document.removeEventListener(\"mousemove\", this.resize);\n      document.removeEventListener(\"mouseup\", this.stopResize);\n    },\n    genFakeId() {\n      // 生成5位随机数\n      const randomNum = Math.floor(1000 + Math.random() * 9000);\n      // 将随机数转换为字符串\n      const randomNumStr = `1${randomNum}`;\n      if (!this.id) {\n        // 将拼接后的字符串转换为数字并返回\n        return parseInt(randomNumStr);\n      } else {\n        // 生成5位随机数\n        const subRandomNum = Math.floor(1000 + Math.random() * 9000);\n        // 将随机数转换为字符串\n        const randomNumStr = `${this.id}${subRandomNum}`;\n        return parseInt(randomNumStr);\n      }\n    },\n    mergeOptions(options) {\n      let result = {};\n      const defaultOptions = config.openaiDefaultConfig;\n      for(const key in defaultOptions){\n        if(options[key] === undefined){\n          result[key] = defaultOptions[key];\n        }else{\n          result[key] = options[key];\n        }\n      }\n      return result;\n    },\n    addPresetContactor(preset) {\n      const contactor = {\n        id: this.genFakeId(),\n        namePolicy: 1,\n        avatarPolicy: preset.avatar ? 1 : 0,\n        avatar: preset.avatar ? preset.avatar : undefined,\n        name: preset.name,\n        title: preset.title,\n        priority: 1,\n        options: this.mergeOptions(preset),\n      };\n      client.addConcator(\"openai\", contactor);\n      this.addReactiveListener();\n    },\n    addReactiveListener() {\n      this.contactorList.map((contactor) => {\n        contactor.on(\"updateMessageSummary\", () => {\n          contactor.lastMessageSummary = contactor.getLastMessageSummary();\n        });\n      });\n    },\n  },\n};\n</script>\n\n<template>\n  <div id=\"friendlists\" ref=\"friendlists\" :class=\"onPhone ? 'mobile' : ''\">\n    <div id=\"friends\" class=\"upsidebar\">\n      <div class=\"search\">\n        <i class=\"iconfont sousuo listicon\"></i>\n        <input id=\"tosearch\" type=\"text\" placeholder=\"搜索\" />\n      </div>\n      <div class=\"bu-add\">\n        <button id=\"addcont\" @click=\"showAddOptions = !showAddOptions\">\n          +\n        </button>\n        <div\n          v-show=\"showAddOptions\"\n          id=\"add-options\"\n          :style=\"{ left: onPhone ? '-6rem' : '0px' }\"\n        >\n          <ul>\n            <li>\n              <button @click=\"genBlankBot\">新建空白Bot</button>\n            </li>\n            <li>\n              <button @click=\"genBotByPreset\">从预设新建Bot</button>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n    <div class=\"people\">\n      <div\n        v-for=\"(item, index) of sortedList\"\n        :id=\"getId(item)\"\n        :key=\"index\"\n        class=\"lists\"\n        @click=\"showChat(item.id)\"\n      >\n        <div\n          class=\"avatar\"\n          :class=\"item.avatarPolicy == 1 ? 'custom' : 'model'\"\n        >\n          <img :src=\"item.avatar\" :alt=\"item.name\" />\n        </div>\n        <div class=\"info\">\n          <div class=\"name\">{{ item.name }}</div>\n          <div id=\"time\" class=\"msginfo\">{{ item.getLastTime() }}</div>\n          <div id=\"msgctt\" class=\"msginfo\">{{ item.lastMessageSummary }}</div>\n        </div>\n      </div>\n    </div>\n    <div class=\"resizer\" @mousedown=\"startResize\"></div>\n    <AddContactor\n      v-if=\"showAddWindow\"\n      @close=\"showAddWindow = false\"\n      @add-bot=\"addPresetContactor\"\n    ></AddContactor>\n  </div>\n</template>\n\n<style scoped>\n#add-options {\n  position: absolute;\n  top: 2.5rem;\n  background-color: white;\n  width: 8rem;\n  height: 3rem;\n  border: 0.0625rem solid rgba(161, 154, 154, 0.626);\n  border-radius: 0.3125rem;\n  z-index: 2;\n}\n#add-options li {\n  display: flex;\n  flex-direction: row-reverse;\n  margin-left: 0.5rem;\n  margin-right: 0.5rem;\n}\n#add-options ul {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-around;\n  height: 100%;\n  box-shadow: 0 0 0.5rem rgba(0, 0, 0, 0.1);\n}\n#add-options button {\n  background-color: transparent;\n}\n#friendlists {\n  height: 100%;\n  display: flex;\n  min-width: 14rem;\n  max-width: 14rem;\n  flex-direction: column;\n  position: relative;\n}\n\n.resizer {\n  width: 5px;\n  cursor: ew-resize;\n  background-color: transparent; /* 可视化的样式，你可以根据需求进行调整 */\n  position: absolute;\n  right: 0;\n  top: 0;\n  height: 100%;\n}\n#friendlists.mobile {\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  max-width: none;\n}\n\n.upsidebar {\n  justify-content: space-between;\n  display: flex;\n  flex-direction: row;\n  background-color: rgb(255, 255, 255);\n  flex: 0 0 3rem;\n  padding: 0.375rem 0.5em 0.5rem 0.5rem;\n  align-items: flex-end;\n}\n\ninput#tosearch {\n  width: calc(100% - 1.125rem);\n  margin-top: 0.1875rem;\n  padding-left: 0.3125rem;\n  height: 1.125rem;\n  background-color: transparent;\n  border: 0rem;\n}\n\ninput#tosearch:focus {\n  outline: none;\n  border: 0rem;\n}\n\nbutton#searchButton {\n  width: 1rem;\n  border: 0rem;\n  border-radius: 0.3125rem;\n  margin-left: 0.5rem;\n  text-wrap: nowrap;\n}\n\n.search {\n  flex-grow: 1;\n  border-radius: 0.3125rem;\n  background-color: rgb(245 245, 245);\n  height: 1.5625rem;\n  display: flex;\n  padding: 0.125rem 0.25rem;\n  align-items: center;\n}\n\n.bu-add {\n  width: 1.8125rem;\n  height: 1.8125rem;\n  margin-left: 0.5rem;\n  position: relative;\n}\n\n.listicon {\n  padding-top: 0.0625rem;\n  width: 1rem;\n  height: 1rem;\n}\n\nbutton#addcont {\n  border-radius: 0.3125rem;\n  width: 100%;\n  height: 100%;\n  border: none;\n}\n\n.lists {\n  align-items: center;\n  min-width: 10rem;\n  display: flex;\n  padding: 0.25rem 0.5rem;\n  height: 3.75rem;\n  max-height: 3.75rem;\n  min-height: 3.75rem;\n  /* border: .0625rem solid pink; */\n}\n\n.lists#important {\n  background-color: rgb(240, 240, 240);\n}\n\n.lists:hover {\n  background-color: rgb(240, 240, 240);\n  /* border: .0625rem solid pink; */\n}\n\n.lists#important:hover {\n  background-color: rgb(231, 231, 231);\n  /* border: .0625rem solid pink; */\n}\n\n.lists#active {\n  background-color: rgb(0, 153, 255);\n}\n\n.lists > .avatar {\n  flex-basis: 2.65rem;\n  min-width: 2.65rem;\n  height: 2.65rem;\n  border-radius: 50%;\n  overflow: hidden;\n  background-color: white;\n}\n\n.avatar > img {\n  width: 100%;\n  height: 100%;\n}\n\n.avatar.model > img {\n  scale: 0.9;\n}\n\n.info {\n  height: 100%;\n  display: flex;\n  align-items: baseline;\n  justify-content: space-between;\n  flex: 0 0 calc(100% - 2.65rem);\n  max-width: calc(100% - 2.65rem);\n  flex-wrap: wrap;\n}\n\n.lists#active * {\n  color: #f0f8ff;\n}\n\n.lists .name {\n  flex-basis: 4rem;\n  flex-grow: 1;\n  margin-top: 0.75rem;\n  font-size: 0.875rem;\n  margin-left: 0.5rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.info #time {\n  font-size: 0.625rem;\n  flex-grow: 1;\n  text-align: right;\n}\n\n.info #msgctt {\n  flex-basis: 100%;\n  padding-right: 1rem;\n  font-size: 0.625rem;\n  margin-left: 0.5rem;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.people {\n  overflow-y: auto;\n}\n</style>\n","<template>\n  <div class=\"presets-list\">\n    <div\n      v-for=\"(message, index) of presetMessages\"\n      :key=\"index\"\n      class=\"preset-message\"\n    >\n      <div class=\"preset-message-block\">\n        <div\n          class=\"message-avatar\"\n          @mouseover=\"hoveredIndex = index\"\n          @mouseleave=\"hoveredIndex = null\"\n        >\n          <div v-if=\"hoveredIndex != index\" class=\"avatar-emoji\">\n            {{ getMessageAvatar(message.role) }}\n          </div>\n          <div\n            v-else\n            title=\"删除消息\"\n            class=\"avatar-emoji hovered\"\n            @click=\"delPresetMessage\"\n          >\n            🗑️\n          </div>\n        </div>\n        <div\n          :ref=\"`message-${index}`\"\n          class=\"message-content\"\n          contenteditable=\"true\"\n          @blur=\"handleMessageUpdate(index)\"\n        >\n          {{ presetMessages[index].content }}\n        </div>\n      </div>\n    </div>\n    <div class=\"messages-buttons\">\n      <el-button title=\"添加系统消息\" plain @click=\"addPresetMessage('system')\"\n        >➕ ⚙️</el-button\n      >\n      <el-button\n        title=\"添加助手消息\"\n        plain\n        @click=\"addPresetMessage('assistant')\"\n        >➕ 🤖</el-button\n      >\n      <el-button title=\"添加用户消息\" plain @click=\"addPresetMessage('user')\"\n        >➕ 👤</el-button\n      >\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    presetsHistory: {\n      type: Array,\n      default: () => [],\n    },\n  },\n  emits: ['updatePresets'],\n  data() {\n    const presetMessages = [...this.presetsHistory];\n    return {\n      presetMessages,\n      hoveredIndex: undefined,\n    };\n  },\n  watch: {\n    presetsHistory(newVal) {\n      this.presetMessages = [...newVal];\n    },\n  },\n  methods: {\n    delPresetMessage() {\n      this.presetMessages.splice(this.hoveredIndex, 1);\n      this.$emit('updatePresets', this.presetMessages);\n    },\n    addPresetMessage(role) {\n      if (role == 'system' && this.presetMessages.length > 0) {\n        this.$message.warning('系统消息必须是第一条消息');\n        return;\n      }\n      this.presetMessages.push({\n        role,\n        content: '',\n      });\n      this.$emit('updatePresets', this.presetMessages);\n    },\n    getMessageAvatar(role) {\n      return role == 'assistant' ? '🤖' : role == 'system' ? '⚙️' : '👤';\n    },\n    handleMessageUpdate(index) {\n      this.presetMessages[index].content =\n        this.$refs[`message-${index}`][0].innerText;\n      this.$emit('updatePresets', this.presetMessages);\n    },\n  },\n};\n</script>\n<style scoped>\n.presets-list {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 100%;\n}\n\n.messages-buttons {\n  width: 100%;\n  display: flex;\n  justify-content: space-evenly;\n  align-items: center;\n  margin: 0.5rem;\n}\n\n.preset-message {\n  width: 100%;\n}\n\n.preset-message-block {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  margin: 0.5rem;\n  justify-content: space-between;\n  align-items: flex-start;\n}\n\n.preset-message-block .message-avatar {\n  flex-basis: 2rem;\n  font-size: 2rem;\n  border: 1px solid #ccc;\n  border-radius: 10%;\n}\n\n.message-avatar .hovered {\n  cursor: pointer;\n  box-shadow: inset 0px 0px 10px rgba(0, 0, 0, 0.493); /* 内阴影 */\n}\n\n.preset-message-block .message-content {\n  margin-left: 0.5rem;\n  font-size: 0.8rem;\n  border: 1px solid #5a9cf8;\n  border-radius: 0.5rem;\n  flex-grow: 1;\n  max-height: 10rem;\n  overflow-y: auto;\n  padding: 0.5rem;\n  min-height: 2rem;\n}\n\n.message-content input {\n  width: 100%;\n  border: none;\n  outline: none;\n}\n</style>\n"],"names":["EventEmitter","constructor","this","events","on","eventName","listener","refresh","off","push","emit","data","forEach","Socket","id","code","available","url","getURL","socket","requests","heartBeat","delay","URL","window","location","href","host","protocol","connect","params","fullUrl","URLSearchParams","toString","WebSocket","onopen","setInterval","async","readyState","OPEN","res","fetch","timestamp","Date","now","serverRevTime","revTime","cuurentTime","delayTo","delayBack","onclose","disconnect","setTimeout","onerror","error","onmessage","event","messageHandler","close","clearInterval","send","message","e","JSON","parse","request_id","type","sendObject","stringify","genRequestID","crypto","getRandomValues","Uint32Array","substring","Promise","resolve","reject","pathArray","split","filter","Boolean","request","timeOut","response","splice","indexOf","race","then","catch","err","streamCompletions","promise","r","j","done","chunk","Adapter","client","Onebot","convertMessage","element","index","base64Data","file","replace","messages","node","rplMessage","midMessage","length","role","time","getTime","content","message_id","status","Openai","config","settings","Math","random","substr","getMessagesSummary","messageChain","query","model","openaiDefaultConfig","enable_tool_call","tools","validSettingKeys","Object","fromEntries","entries","key","includes","chunkDataHandlers","reasoning_content","tool_call","chunkMessageHandlers","completed","failed","updateSettings","AVATAR_BASE_PATH","AVATAR_MAP","OpenAI","Cohere","Anthropic","Google","DeepSeek","avatarPolicy","namePolicy","Contactor","EventEmmiter","platform","options","title","name","avatar","priority","firstMessageIndex","active","lastUpdate","createTime","lastMessageSummary","getLastMessageSummary","kernel","enableOpenaiListener","rawMessage","lastMsgElm","isFirstElement","msgElm","text","concat","startTime","endTime","continuousCall","action","updateLastUpdate","messageIndex","_getFilePrompt","fileElms","join","_getValidOpenaiMessage","start","end","max_messages_num","mergedMessages","slice","msg","map","fileList","subArray","elm","formatedMsg","_content_type","tool_calls","function","arguments","result","tool_call_id","textElm","finalMessages","imageElm","fileElm","filePrompt","image_url","history","webSend","revMessage","replyIndex","floor","padStart","retryMessage","webMessage","delMessage","i","acting","makeSystemMessage","container","getLastTime","last","currentTime","lastTime","timeDiff","toinit","getHours","getMinutes","getDay","getFullYear","getMonth","getDate","getShownTime","weekdays","weekday","hours","minutes","getMessageText","updateFirstMessage","loadAvatar","getAvatarByModel","loadName","modelOwner","getOpenaiModelOwner","keys","localforage","localPresets","stream","temperature","top_p","frequency_penalty","presence_penalty","opening","openaiTools","onebotDefaultConfig","displayConfig","loadOpenaiTools","_loadStrogeConfig","setDisplayConfig","localStorage","setItem","setOpenaiModels","models","openaiModels","_saveStrogeConfig","getOpenaiModels","group","find","modelGroup","owner","updateDisplayConfig","patch","getDisplayConfig","getItem","updateOpenaiDefaultConfig","json","values","loadOnebotDefaultConfig","onebotOptionsData","onebotOptionsJson","assign","everLogin","isConnected","contactList","qq","botqq","onPhone","displaySettings","beforeInit","setDisplayInfo","localConfig","getLocalStorage","loadLocalStorage","genFakeId","genDefaultConctor","Infinity","addConcator","default_model","tool","bot","reactive","setLocalStorage","rmContactor","list","findIndex","item","reset","clear","reload","init","login","getContactors","subRandomNum","parseInt","randomNum","info","admin_qq","bot_qq","addMsgListener","contactor","getContactor","onebotContactors","onebotContactor","logout","innerWidth","addEventListener","getDisplaySettings","getLoginHistory","uploadFile","fileOrImage","isImage","onProgress","startsWith","uploadImage","chunkSize","md5Hash","uploadChunk","totalChunks","formData","FormData","append","xhr","XMLHttpRequest","open","upload","onprogress","lengthComputable","chunkProgress","loaded","total","overallProgress","round","onload","statusText","uploadFileChunks","ceil","size","currentChunk","min","method","headers","body","md5","filename","ok","Error","finalizeUpload","worker","UploadWorker","postMessage","hash","terminate","_convertBlobToBase64","blob","reader","FileReader","onloadend","readAsDataURL","PageStatus","_hoisted_1","_hoisted_2","class","_hoisted_3","_hoisted_5","_hoisted_6","defaultAvatar","processedImage","activePage","adminAvatar","computed","isChatActive","isProfileActive","watch","$route","handler","newRoute","getPageStatusFromRoute","immediate","mounted","adminId","methods","imageUrl","canvas","document","createElement","ctx","getContext","img","Image","crossOrigin","src","width","height","drawImage","centerX","centerY","radius","beginPath","arc","PI","clip","clearRect","toBlob","createObjectURL","toChat","$router","toProfile","toConfig","processImage","route","path","_openBlock","_createElementBlock","_createElementVNode","$data","alt","_hoisted_4","_normalizeClass","$options","onClick","args","t","viewBox","version","xmlns","d","target","props","fullScreen","default","emits","waiting","$message","configFullScreen","$emit","$props","$event","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","components","MdPreview","Array","showBox","created","_Fragment","_cache","_renderList","_toDisplayString","_createBlock","_component_MdPreview","_component_el_image","style","margin","fit","_createCommentVNode","_hoisted_13","activeContactor","required","userInput","selectedWraper","selectedModel","selectedOptions","cursorPosition","showemoji","onebotPresets","uploaded","files","images","isPasting","extraOptions","loadSelectedArray","initExtraOptions","textareaRef","$refs","textarea","adjustTextareaHeight","handleDragOver","preventDefault","backgroundColor","handleDragLeave","handleDrop","dataTransfer","handleDroppedFile","handlePaste","items","clipboardData","getAsFile","handleUploadImage","originalEvent","getData","execCommand","innerText","origin","unmounted","removeEventListener","ctrlEmojiPanel","focus","File","handleFileUpload","fileInput","accept","format","handleChange","click","uploadDocumentFile","success","maxSizeByte","maxSizeMB","fileType","toLowerCase","insertImageToTextarea","mimeType","quality","imageName","imageElement","maxWidth","maxHeight","range","createRange","selectNodeContents","collapse","selection","getSelection","removeAllRanges","addRange","fragment","createContextualFragment","outerHTML","insertNode","newRange","newSelection","setModel","value","label","children","textwraper","getOpenaiModelArray","wrapText","rawText","child","preset","scrollHeight","getWraperName","getemoji","inputer","sel","unicode","detail","startPos","endPos","textBeforeCursor","textAfterCursor","innerHTML","setStart","firstChild","setEnd","updateCursorPosition","rangeCount","getRangeAt","startOffset","endOffset","presend","querySelectorAll","ImageSrcs","from","getSafeText","wrappedMessage","imgUrl","repliedMessageId","replyData","cleanScreen","activeBotTools","testMessage","testMessage2","isValidInput","input","trim","handleKeyDown","ctrlKey","handleInput","ref","onEmojiClick","_withModifiers","_ctx","_createVNode","_component_el_cascader","modelValue","onChange","contenteditable","placeholder","onKeydown","onInput","disabled","fileUrl","String","file_name","file_type","formated_file_size","iconClass","bits","get","formatFileSize","unitIndex","toFixed","toUpperCase","_hoisted_14","showExtraInfo","tool_call_success","tool_call_fail","call_status","points","Number","show","getReasonInfo","updateMaxHeight","updated","toggleShow","reasonContent","_normalizeStyle","seletedText","seletedImage","copySeletedImage","copyImageToClipboard","saveSeletedImage","downloadImage","copyText","copyTextToClipboard","copySeletedText","replyMessage","deleteMessage","position","left","appendChild","select","setSelectionRange","removeChild","imgSrc","pngBlob","ClipboardItem","navigator","clipboard","write","revokeObjectURL","link","download","_hoisted_15","_hoisted_16","AddContactor","presetsList","recommendPresets","recentPresets","systemPresets","searchPresets","systemShownNum","recommendShownNum","keyWord","activeTypeIndex","buttonTranslate","avaliablePresetTypes","moreSystemPresets","moreRecommendPresets","observer","showPresetsLoader","shownPrestsList","getAddHistory","callback","entry","isIntersecting","loadMoreData","IntersectionObserver","presetsLoader","loader","observe","handleScroll","beforeUnmount","addBot","strogeAddHistory","existingItem","unshift","pop","changeShownType","loadSpecificType","getPresetList","loadSystemPresets","loadRecommendedPresets","loadSerachPresets","load","searchTimer","clearTimeout","rect","getBoundingClientRect","top","bottom","innerHeight","documentElement","clientHeight","right","clientWidth","_component_el_button","_withCtx","_createTextVNode","_","_withDirectives","_hoisted_17","_hoisted_18","_component_el_empty","contactorList","showAddOptions","showAddWindow","sortedList","sort","a","b","addReactiveListener","beforeCreate","genBotByPreset","showChat","getId","genBlankBot","startResize","isResizing","startX","clientX","startWidth","friendlists","offsetWidth","resize","stopResize","newWidth","minWidth","flexBasis","randomNumStr","mergeOptions","defaultOptions","addPresetContactor","onMousedown","_component_AddContactor","onClose","onAddBot","presetsHistory","presetMessages","hoveredIndex","newVal","delPresetMessage","addPresetMessage","warning","getMessageAvatar","handleMessageUpdate","onMouseover","onMouseleave","ref_for","onBlur","plain"],"mappings":"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"}