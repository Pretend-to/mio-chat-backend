import{R as t,c as e,a,e as s,t as o,n as i,b as n,w as l,j as c,v as r,f as d,F as h,d as u,u as m,q as p,H as v,_ as g,m as y,o as C,g as f,l as w,i as b,p as k,s as S,x as M,k as I,y as x,E as P,z as T,A as L}from"./vue-vendor-DLU2xQc2.js";import{_ as $,R as V,F as R,T as _,I as D,a as B,C as O,c as U,f as W,b as E,d as H}from"./components-B63yNbLR.js";import"./emoji-C7BQ2utN.js";import{h as j}from"./vendor-BYPgAAK_.js";const A={id:"chat-window"},F={class:"upside-bar"},q={class:"contactor-name"},N={class:"delay-num"},J={class:"options"},z={key:0,class:"message-time"},G=["id"],X={key:0,class:"avatar"},Y=["src","alt"],K=["src","alt"],Q={key:1,class:"msg"},Z={class:"wholename"},tt={key:0,class:"title"},et={class:"name"},at=["onContextmenu"],st={key:5},ot={key:7,class:"blank-message",style:{width:"10rem",height:"28.8px",position:"relative"}},it={key:2,class:"system-message"},nt={class:"system-message-content"},lt={class:"system-message-button"},ct=["onClick"];const rt=$({components:{MdRenderer:t,ContextMenu:O,ForwardMsg:B,InputEditor:D,ToolCallBar:_,FileBlock:R,ReasonBlock:V},data(){let t,e,a=!1,s=!0;const o=window.location.href,i=new URL(o).searchParams;i.has("preview")&&"true"===i.get("preview")&&(a=!0),i.has("shareId")&&(t=i.get("shareId")),i.has("scroll")&&(s=i.get("scroll")||"true");const n=parseInt(this.$route.params.id);try{if(e=U.getContactor(n),!e)throw new Error("找不到联系人")}catch(l){const s=U.contactList[0].id;this.$router.push({path:`/chat/${s}`,query:{preview:a,shareId:t}}),e=U.getContactor(s)}return{scroll:s,preview:a,shareId:t,activeContactor:e,showwindow:!0,showemoji:!1,userInput:"",client:U,extraOptions:[],wraperPresets:{},selectedOption:null,currentDelay:0,toupdate:!1,seletedText:"",seletedImage:"",retryList:[],showMenu:!1,menuTop:0,menuLeft:0,validMessageIndex:-1,repliedMessageId:-1,autoScroll:!1,fullScreen:!1,chatWindowRef:null,prevScrollTop:0,showRollDown:!1,inputBarTop:0,clearMessageTip:"以上的对话记录已清除",loadingIcon:"<span id='message-loading-icon'></span>",katexPlugin:y,mioPlugins:[{plugin:m},{plugin:p},{plugin:v,options:{shape:"circle"}},{plugin:g}]}},computed:{getMenuStyle(){if(window.innerWidth<768){const t=160;return this.menuTop-t<0?{top:t+"px"}:{bottom:window.innerHeight-this.menuTop+16+"px"}}return this.menuLeft+110>window.innerWidth?{top:this.menuTop+"px",left:this.menuLeft-110+"px"}:{top:this.menuTop+"px",left:this.menuLeft+"px"}},getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},activeMessageChain(){return this.activeContactor.options.presetSettings?.opening?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain}},watch:{"$route.params.id"(t,e){const a=parseInt(t),s=U.getContactor(a);if(this.activeContactor=s,this.initContactor(this.activeContactor),this.chatWindowRef&&this.toButtom(),e){const t=parseInt(e),a=U.getContactor(t);this.disableContactor(a)}}},async mounted(){document.addEventListener("click",()=>{this.showMenu=!1,this.seletedText="",this.seletedImage=""}),this.chatWindowRef=this.$refs.chatWindow,this.chatWindowRef.addEventListener("scroll",this.scrollHandler),!this.preview&&this.scroll&&this.toButtom(),this.scroll=!0,this.initContactor(this.activeContactor),this.fullScreen=this.client.fullScreen;const t=document.querySelector(".input-bar");if(t){const e=window.innerHeight;this.inputBarTop=e-t.offsetTop}if(this.shareId){await U.loadOriginalContactors(this.shareId)?this.$router.push({path:"/chat/"+this.shareId,query:{preview:this.preview,scroll:!1}}):this.$message({message:"分享链接已失效",type:"error"})}},updated(){this.toupdate&&this.autoScroll&&0===this.retryList.length&&(this.toButtom(),this.toupdate=!1)},beforeUnmount(){this.disableContactor(this.activeContactor),this.chatWindowRef.removeEventListener("scroll",this.scrollHandler)},methods:{handleMouseUp(){const t=window.getSelection().toString();t&&(this.seletedText=t)},toButtom(t){setTimeout(()=>{(()=>{const e=this.chatWindowRef||document.getElementById("main-messages-window");e&&e.scrollTo({top:e.scrollHeight,behavior:t?"smooth":"instant"})})()},1)},cleanScreen(){this.activeContactor.messageChain=[],this.activeContactor.updateFirstMessage(),U.setLocalStorage(),this.activeContactor.emit("updateMessageSummary"),this.toupdate=!0,this.$message({message:"已清除会话记录",type:"success"})},cleanHistory(){this.activeContactor.updateFirstMessage(),this.$message({message:"上下文信息已清除，之后的请求将不再记录上文记录",type:"success"});for(let t=this.activeContactor.messageChain.length-1;t>=0;t--){const e=this.activeContactor.messageChain[t];"mio_system"===e.role&&"text"===e.content[0].type&&e.content[0].data.text===this.clearMessageTip&&this.activeContactor.messageChain.splice(t,1)}this.activeContactor.makeSystemMessage(this.clearMessageTip),U.setLocalStorage()},delSystemMessage(t){const e=this.activeContactor.messageChain[t];"text"===e.content[0].type&&e.content[0].data.text===this.clearMessageTip&&(this.activeContactor.firstMessageIndex=0),this.activeContactor.messageChain.splice(t,1),U.setLocalStorage()},isValidInput:t=>!/^[ \n]+$/.test(t),waiting(){this.$message({message:"此功能尚未开放",type:"warning"})},tolist(){this.$router.push({name:"home"})},async setModel(t){const e=t[0],a=t[2];this.activeContactor.options.provider=e,this.activeContactor.options.base.model=a,this.activeContactor.loadAvatar(),await U.setLocalStorage()},toimg(){const t=this.chatWindowRef.getBoundingClientRect();t.height=this.chatWindowRef.scrollHeight,j(this.chatWindowRef,{windowHeight:1.2*t.height,width:t.width}).then(t=>{const e=t.toDataURL("image/png"),a=document.createElement("a");a.download="chat.png",a.href=e,a.click()})},async share(){await U.shareContactor(this.activeContactor.id)?this.$message({message:"分享链接已复制",type:"success"}):this.$message({message:"分享失败",type:"error"})},hasOpening(){return!!this.activeContactor.options.presetSettings?.opening},getFullMessages(){return this.hasOpening()?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain},showTime(t){const e=this.getFullMessages(),a=e[t].time;if(0===t)return{show:!0,time:this.activeContactor.getShownTime(a)};return a-e[t-1].time>6e5?{show:!0,time:this.activeContactor.getShownTime(a)}:{show:!1,time:""}},separateTextAndImages(t){const e=/!\[([^\]]*)\]\((.*)\)/g;let a,s=[],o=0;for(;null!==(a=e.exec(t));){if(a.index>o){const e=t.slice(o,a.index).trim();e&&s.push({type:"text",data:{text:e}})}s.push({type:"image",data:{file:a[2]}}),o=e.lastIndex}if(o<t.length){const e=t.slice(o).trim();e&&s.push({type:"text",data:{text:e}})}return s},getChatwindowScrollheight(){var t=this.chatWindowRef.scrollTop,e=this.chatWindowRef.clientHeight,a=this.chatWindowRef.scrollHeight;return a-t/(a-e)*a},initContactor(t){t.active=!0,t.on("revMessage",t=>{this.activeContactor.messageChain.push(t),this.toupdate=!0}),t.on("delMessage",t=>{this.activeContactor.messageChain.splice(t,1),this.toupdate=!0}),t.on("updateMessage",()=>{this.$forceUpdate(),this.toupdate=!0,U.setLocalStorage()}),t.on("completeMessage",async t=>{const e=t.messageId,a=this.activeContactor.getMessageById(e);this.retryList.includes(e)&&(this.retryList=this.retryList.filter(t=>t!==e)),a.content.forEach((t,e)=>{if("text"===t.type&&"onebot"===this.activeContactor.platform){const s=this.separateTextAndImages(t.data.text);a.content.splice(e,1,...s)}}),this.toupdate=!0,this.$forceUpdate(),this.activeContactor.loadName(),U.setLocalStorage()})},disableContactor(t){t&&(t.active=!1,t.off("updateMessage"),t.off("revMessage"),t.off("delMessage"),t.off("completeMessage"))},getReplyText(t){let e="";const a=this.activeContactor.messageChain.find(e=>e.id===t);if(a)return a.content.forEach(t=>{"text"===t.type?e+=t.data.text:"image"===t.type&&(e+="[图片]")}),e.length>20?`> ${e.substr(0,20)}...`:`> ${e}`},imageLoaded(){this.scroll&&this.toButtom()},showMessageMenu(t,e){if("img"===t.target.tagName.toLowerCase()){const e=t.target.src;this.seletedImage=e}this.validMessageIndex="openai"===this.activeContactor.platform&&this.hasOpening()?e-1:e,t.preventDefault(),this.showMenu=!0,this.menuTop=t.clientY,this.menuLeft=t.clientX;const a=window.getSelection().toString();this.seletedText=a||""},toProfile(){this.$router.push({name:"profile_view",params:{id:this.activeContactor.id}})},scrollHandler(){const t=this.chatWindowRef.scrollTop,e=t>this.prevScrollTop,a=t<this.prevScrollTop;this.prevScrollTop=t,this.showMenu=!1,this.showemoji&&(this.showemoji=!1);const s=this.getChatwindowScrollheight();this.autoScroll=!(s>100);const o=s<=199;!e||this.autoScroll||o?(a||this.autoScroll||o)&&(this.showRollDown=!1):this.showRollDown=!0},getseletedMessage(){return this.activeContactor.messageChain[this.validMessageIndex]},handleMessageOption(t){const e=this.getseletedMessage();switch(t){case"retry":if("onebot"===this.activeContactor.platform)"user"===e.role?this.activeContactor.webSend(e):this.activeContactor.webSend({...e,role:"user"}),this.$message({message:"消息已重新发送",type:"success"});else{const t="user"===e.role?this.validMessageIndex+1:this.validMessageIndex;let a=this.activeContactor.messageChain[t];if(!a||"other"!==a.role){const e=this.activeContactor.getBaseUserContainer();e.role="other",this.activeContactor.insertMessage(e,t),a=e}if("retrying"===a.status)return void this.$message({message:"该消息正在重试中",type:"warning"});this.activeContactor.retryMessage(a.id),a.status="retrying",this.retryList.push(a.id)}this.toButtom();break;case"reply":"onebot"===this.activeContactor.platform?(this.repliedMessageId=e.id,this.$message({message:"已引用该消息",type:"success"})):this.userInput+=this.getReplyText(this.activeContactor.messageChain[this.validMessageIndex].id)+"\n\n";break;case"delete":this.activeContactor.messageChain.splice(this.validMessageIndex,1),U.setLocalStorage()}}}},[["render",function(t,m,p,v,g,y){const w=d("ContextMenu"),b=d("MdRenderer"),k=d("el-image"),S=d("ForwardMsg"),M=d("FileBlock"),I=d("ReasonBlock"),x=d("ToolCallBar"),P=d("InputEditor");return C(),e("div",A,[a("div",F,[a("div",{class:"return",onClick:m[0]||(m[0]=t=>y.tolist())},m[8]||(m[8]=[a("i",{class:"iconfont icon-return"},null,-1)])),a("div",{class:"name-area",onClick:m[1]||(m[1]=(...t)=>y.toProfile&&y.toProfile(...t))},[a("div",q,o(g.activeContactor.name),1),a("span",{class:i("delay-status "+y.getDelayStatus)},null,2),a("span",N,"当前延迟: "+o(g.currentDelay)+" ms",1)]),a("ul",J,[a("li",{class:"share",onClick:m[2]||(m[2]=t=>y.share())},m[9]||(m[9]=[a("i",{class:"iconfont icon-share"},null,-1)]))])]),a("div",{id:"main-messages-window",ref:"chatWindow",class:i({"message-window":!0,preview:g.preview})},[g.showRollDown?(C(),e("div",{key:0,id:"roll-buttom-button",style:c({bottom:g.inputBarTop+24+"px"}),onClick:m[3]||(m[3]=t=>y.toButtom(!0))},m[10]||(m[10]=[a("i",{class:"iconfont down1"},null,-1)]),4)):n("",!0),l(s(w,{type:"message",message:y.getseletedMessage(),"seleted-text":g.seletedText,"seleted-image":g.seletedImage,style:c(y.getMenuStyle),onMessageOption:y.handleMessageOption,onClose:m[4]||(m[4]=t=>g.showMenu=!1)},null,8,["message","seleted-text","seleted-image","style","onMessageOption"]),[[r,g.showMenu]]),(C(!0),e(h,null,u(y.activeMessageChain,(t,s)=>(C(),e("div",{key:`${g.activeContactor.id}-${t.id}`,ref_for:!0,ref:"message",class:"message-container"},[y.showTime(s).show?(C(),e("div",z,o(y.showTime(s).time),1)):n("",!0),a("div",{id:t.role,class:"message-body"},["mio_system"!==t.role?(C(),e("div",X,["other"===t.role?(C(),e("img",{key:0,src:g.activeContactor.avatar,alt:g.activeContactor.name,onClick:m[5]||(m[5]=(...t)=>y.toProfile&&y.toProfile(...t))},null,8,Y)):(C(),e("img",{key:1,src:g.client.avatar,alt:g.client.name},null,8,K))])):n("",!0),"mio_system"!==t.role?(C(),e("div",Q,[a("div",Z,[("other"===t.role?g.activeContactor.title:g.client.title)?(C(),e("div",tt,o("other"===t.role?g.activeContactor.title:g.client.title),1)):n("",!0),a("div",et,o("other"===t.role?g.activeContactor.name:g.client.name),1)]),a("div",{class:i(["content",t.status]),onMouseup:m[6]||(m[6]=(...t)=>y.handleMouseUp&&y.handleMouseUp(...t)),onContextmenu:t=>y.showMessageMenu(t,s)},[(C(!0),e(h,null,u(t.content,(o,i)=>(C(),e("div",{key:i,class:"inner-content"},["text"===o.type?(C(),f(b,{key:0,md:o.data.text,theme:"github",isStreaming:["pending","retrying"].includes(t.status)&&t.content.length-1===i,"custom-plugins":g.mioPlugins,"markdown-it-plugins":[{plugin:g.katexPlugin}]},null,8,["md","isStreaming","custom-plugins","markdown-it-plugins"])):"image"===o.type?(C(),f(k,{key:`${g.activeContactor.id}-${s}-${i}-${o.data.file}`,src:o.data.file,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[o.data.file],"initial-index":4,onLoad:y.imageLoaded,loading:"lazy",fit:"contain"},null,8,["src","preview-src-list","onLoad"])):"reply"===o.type?(C(),f(b,{key:2,md:y.getReplyText(o.data.id)},null,8,["md"])):"nodes"===o.type?(C(),f(S,{key:3,contactor:g.activeContactor,messages:o.data.messages},null,8,["contactor","messages"])):"file"===o.type?(C(),f(M,{key:4,"file-url":o.data.file},null,8,["file-url"])):"at"===o.type?(C(),e("span",st)):"reason"===o.type?(C(),f(I,{key:6,"end-time":o.data.endTime,"start-time":o.data.startTime,content:o.data.text},null,8,["end-time","start-time","content"])):"blank"===o.type?(C(),e("div",ot,m[11]||(m[11]=[a("span",{class:"blank-loader"},null,-1)]))):"tool_call"===o.type?(C(),f(x,{key:8,"tool-call":o.data},null,8,["tool-call"])):n("",!0)]))),128))],42,at)])):(C(),e("div",it,[a("div",nt,o(t.content[0].data.text),1),a("div",lt,[a("i",{class:"iconfont close",onClick:t=>y.delSystemMessage(s)},null,8,ct)])]))],8,G)]))),128))],2),s(P,{ref:"inputEditor","active-contactor":g.activeContactor,"replied-message-id":g.repliedMessageId,onStroge:m[7]||(m[7]=t=>g.client.setLocalStorage()),onSetModel:y.setModel,onCleanScreen:y.cleanScreen,onCleanHistory:y.cleanHistory,onToButtom:y.toButtom},null,8,["active-contactor","replied-message-id","onSetModel","onCleanScreen","onCleanHistory","onToButtom"])])}],["__scopeId","data-v-62487ba1"]]),dt={class:"blank-view"};const ht=$({name:"BlankView",data:()=>({fullScreen:!1,client:U}),watch:{},created(){this.fullScreen=U.fullScreen},methods:{waiting(){this.$message({message:"此功能尚未开放",type:"warning"})}}},[["render",function(t,s,o,i,n,l){return C(),e("div",dt,s[0]||(s[0]=[a("div",{class:"upside-bar"},[a("div",{class:"options"})],-1)]))}],["__scopeId","data-v-29ea73df"]]),ut={key:0,id:"main"},mt={key:1,id:"main-mobile"},pt={key:2,id:"main-mobile",class:"mobile-chat"};const vt=$({components:{friendlist:W,blankView:ht},data(){return{onPhone:window.innerWidth<600,pagePath:this.$route.path,loaded:!1}},watch:{$route:function(t){this.pagePath=t.path}},mounted(){U.inited?this.loaded=!0:U.on("loaded",()=>{this.loaded=!0},!1)}},[["render",function(t,a,o,i,n,l){const c=d("friendlist"),r=d("router-view"),h=d("blankView");return n.onPhone?"/"===n.pagePath?(C(),e("div",mt,[n.loaded?(C(),f(c,{key:0})):(C(),f(h,{key:1}))])):(C(),e("div",pt,[n.loaded?(C(),f(r,{key:0})):(C(),f(h,{key:1}))])):(C(),e("div",ut,[s(c),n.loaded?(C(),f(r,{key:0})):(C(),f(h,{key:1}))]))}]]),gt={class:"profile-body"},yt={id:"profile"},Ct={class:"profile-container"},ft={class:"base-info"},wt={class:"base-info-avatar"},bt={class:"base-info-content"},kt={class:"name"},St={class:"id"},Mt={class:"status"},It={class:"info-blocks"},xt={class:"settings-block"},Pt={class:"block-content"},Tt={class:"block-content-item"},Lt={class:"item-content"},$t={class:"block-content-item"},Vt={class:"item-content"},Rt={key:0,class:"block-content-item"},_t={class:"item-content"},Dt={key:1,class:"block-content-item"},Bt={class:"item-content"},Ot={class:"block-content-item"},Ut={class:"item-content"},Wt={class:"info-blocks"},Et={class:"action-bar"},Ht={class:"dialog-footer"};const jt=$({components:{ContactorSettings:E},data(){const t=parseInt(this.$route.params.id),e=U.getContactor(t),a=H.getToolCallModes(),s=H.getLLMProviders(),o=H.getSafetySettingsParams(),i=Object.keys(o).map(t=>({value:t,label:t})),n=[];for(const l in H.llmTools){const t=H.llmTools[l],e=Object.keys(t).map(e=>({enabled:!1,...t[e]}));n.push({name:l,tools:e,collapsed:!0})}return{activeContactor:e,options:null,currentDelay:0,centerDialogVisible:!1,avatarPolicyList:[{value:0,label:"跟随模型"},{value:1,label:"自定义"}],namePolicyList:[{value:0,label:"跟随模型"},{value:1,label:"自定义"},{value:2,label:"对话摘要"}],isOnebot:"onebot"===e.platform,llmProviders:s,toolCallModes:a,safetyParams:o,safetySimpleValue:i,allLLMTools:n,basicInfo:null}},computed:{getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},getAvatarPolicyValue(){return 1===this.basicInfo.avatarPolicy?"自定义":"跟随模型"}},watch:{"$route.params.id"(t){const e=parseInt(t);this.activeContactor=U.getContactor(e),this.activeContactor&&(this.isOnebot="onebot"===this.activeContactor.platform),this.initContactor()},options:{handler(t){t&&this.activeContactor&&(this.activeContactor.options=JSON.parse(JSON.stringify(t)),U.setLocalStorage())},deep:!0},basicInfo:{handler(t){t&&this.activeContactor&&(this.activeContactor.name=t.name,this.activeContactor.avatar=t.avatar,this.activeContactor.namePolicy=t.namePolicy,this.activeContactor.avatarPolicy=t.avatarPolicy,this.activeContactor.priority=t.priority?0:1,U.setLocalStorage())},deep:!0}},created(){this.initContactor()},mounted(){this.delayInterval=setInterval(()=>{this.currentDelay=U.socket.delay},3e3)},beforeUnmount(){this.delayInterval&&clearInterval(this.delayInterval)},methods:{initContactor(){this.options=JSON.parse(JSON.stringify(this.activeContactor.options));const{name:t,avatar:e,namePolicy:a,avatarPolicy:s,priority:o}=this.activeContactor;this.basicInfo={name:t,avatar:e,namePolicy:a,avatarPolicy:s,priority:1!==o},"onebot"===this.activeContactor.platform&&this.options.toolCallSettings&&(this.options.toolCallSettings.mode="none",this.options.toolCallSettings.tools=[])},handleUpdateOpenaiPresets(t){this.options&&this.options.presetSettings&&(this.options.presetSettings.history=t,this.$message({message:"预设历史记录已更新",type:"success"}))},async delContactor(){this.centerDialogVisible=!1,await U.rmContactor(this.activeContactor.id),this.$router.push("/")},handleProviderSwitched(t){this.activeContactor.loadAvatar()},getBaseInfoShownValue(t){},updateContactorName(){0===this.basicInfo.namePolicy&&(this.basicInfo.name=this.activeContactor.options.base.model)},updateContactorAvatar(){const{avatarPolicy:t}=this.basicInfo;this.activeContactor.avatarPolicy=t,this.basicInfo.avatar=this.activeContactor.loadAvatar()}}},[["render",function(t,l,c,r,m,p){const v=d("el-image"),g=d("el-input"),y=d("el-option"),k=d("el-select"),S=d("el-switch"),M=d("ContactorSettings"),I=d("el-button"),x=d("el-dialog");return C(),e("div",gt,[a("div",yt,[a("div",Ct,[a("div",ft,[a("div",wt,[s(v,{src:m.activeContactor.avatar,"preview-src-list":[m.activeContactor.avatar]},null,8,["src","preview-src-list"])]),a("div",bt,[a("div",kt,o(m.activeContactor.name),1),a("div",St,"ID "+o(m.activeContactor.id),1),a("div",Mt,[a("span",{class:i("delay-status "+p.getDelayStatus)},null,2),l[10]||(l[10]=w(" 在线 "))])])]),a("div",It,[a("div",xt,[l[16]||(l[16]=a("div",{class:"block-title"},"Bot 基本配置",-1)),a("div",Pt,[a("div",Tt,[l[11]||(l[11]=a("div",{class:"item-title"},"昵称",-1)),a("div",Lt,[s(g,{modelValue:m.basicInfo.name,"onUpdate:modelValue":l[0]||(l[0]=t=>m.basicInfo.name=t),disabled:1!==m.basicInfo.namePolicy},null,8,["modelValue","disabled"])])]),a("div",$t,[l[12]||(l[12]=a("div",{class:"item-title"},"头像",-1)),a("div",Vt,[1!==m.basicInfo.avatarPolicy?(C(),f(g,{key:0,value:"跟随模型",disabled:!0})):(C(),f(g,{key:1,modelValue:m.basicInfo.avatar,"onUpdate:modelValue":l[1]||(l[1]=t=>m.basicInfo.avatar=t),disabled:m.isOnebot},null,8,["modelValue","disabled"]))])]),m.isOnebot?n("",!0):(C(),e("div",Rt,[l[13]||(l[13]=a("div",{class:"item-title"},"头像策略",-1)),a("div",_t,[s(k,{modelValue:m.basicInfo.avatarPolicy,"onUpdate:modelValue":l[2]||(l[2]=t=>m.basicInfo.avatarPolicy=t),onChange:p.updateContactorAvatar},{default:b(()=>[(C(!0),e(h,null,u(m.avatarPolicyList,t=>(C(),f(y,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])])),m.isOnebot?n("",!0):(C(),e("div",Dt,[l[14]||(l[14]=a("div",{class:"item-title"},"昵称策略",-1)),a("div",Bt,[s(k,{modelValue:m.basicInfo.namePolicy,"onUpdate:modelValue":l[3]||(l[3]=t=>m.basicInfo.namePolicy=t),onChange:p.updateContactorName},{default:b(()=>[(C(!0),e(h,null,u(m.namePolicyList,t=>(C(),f(y,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])])),a("div",Ot,[l[15]||(l[15]=a("div",{class:"item-title"},"会话置顶",-1)),a("div",Ut,[s(S,{modelValue:m.basicInfo.priority,"onUpdate:modelValue":l[4]||(l[4]=t=>m.basicInfo.priority=t)},null,8,["modelValue"])])])])])]),a("div",Wt,[m.isOnebot?n("",!0):(C(),f(M,{key:0,"model-value":m.options,"onUpdate:modelValue":l[5]||(l[5]=t=>m.options=t),"active-contactor-platform":m.activeContactor.platform,"llm-providers-list":m.llmProviders,"tool-call-modes-list":m.toolCallModes,"all-llm-tools-data":m.allLLMTools,"safety-settings-params":m.safetyParams,"safety-simple-value-options":m.safetySimpleValue,"presets-history-data":m.options.presetSettings?.history,onProviderChanged:p.handleProviderSwitched,onUpdatePresets:p.handleUpdateOpenaiPresets},null,8,["model-value","active-contactor-platform","llm-providers-list","tool-call-modes-list","all-llm-tools-data","safety-settings-params","safety-simple-value-options","presets-history-data","onProviderChanged","onUpdatePresets"]))])])]),a("div",Et,[s(I,{plain:"",onClick:l[6]||(l[6]=e=>t.$router.push(`/chat/${m.activeContactor.id}`))},{default:b(()=>l[17]||(l[17]=[w(" 发送消息 ")])),_:1}),s(I,{type:"danger",plain:"",onClick:l[7]||(l[7]=t=>m.centerDialogVisible=!0)},{default:b(()=>l[18]||(l[18]=[w(" 删除好友 ")])),_:1}),s(x,{modelValue:m.centerDialogVisible,"onUpdate:modelValue":l[9]||(l[9]=t=>m.centerDialogVisible=t),title:"警告",width:"300",center:""},{footer:b(()=>[a("div",Ht,[s(I,{onClick:l[8]||(l[8]=t=>m.centerDialogVisible=!1)},{default:b(()=>l[19]||(l[19]=[w("取消")])),_:1}),s(I,{type:"primary",onClick:p.delContactor},{default:b(()=>l[20]||(l[20]=[w(" 确认 ")])),_:1},8,["onClick"])])]),default:b(()=>[l[21]||(l[21]=a("span",null," 确认要删除此好友吗？该操作不可逆。 ",-1))]),_:1},8,["modelValue"])])])}],["__scopeId","data-v-2ffdcad2"]]),At={id:"settings-view"};const Ft=$({name:"SettingsView",data:()=>({}),methods:{async reset(){await U.reset()&&(this.$message.success("重置成功"),setTimeout(()=>{window.location.reload()},500))},async resetCache(){await U.resetCache(),this.$message.success("清理缓存成功"),setTimeout(()=>{window.location.reload()},500)}}},[["render",function(t,a,o,i,n,l){const c=d("el-button");return C(),e("div",At,[s(c,{type:"info",plain:"",onClick:a[0]||(a[0]=t=>l.reset())},{default:b(()=>a[2]||(a[2]=[w("重置全部")])),_:1}),s(c,{type:"info",plain:"",onClick:a[1]||(a[1]=t=>l.resetCache())},{default:b(()=>a[3]||(a[3]=[w("清理缓存")])),_:1})])}],["__scopeId","data-v-330c2ae1"]]),qt={class:"auth-view"},Nt={class:"container"},Jt={class:"controls"},zt=$({__name:"AuthView",setup(t){const s=k(),o=k(!1),i=k(),n=async t=>{if(await x(()=>i.value.classList.add("active")),!o.value){o.value=!0;try{const e=await U.login(t);e&&(P.success(`成功以${e.is_admin?"管理员身份":"游客身份"}登录，欢迎使用!`),Gt.currentRoute.value.query.redirect?Gt.push(Gt.currentRoute.value.query.redirect):Gt.push("/"))}catch(e){P.error(e)}finally{await x(()=>i.value.classList.remove("active")),o.value=!1}}};function c(t){"Enter"===t.key&&n(s.value)}return S(()=>{removeEventListener("keydown",c)}),M(()=>{addEventListener("keydown",c),Gt.currentRoute.value.query.key&&n(Gt.currentRoute.value.query.key)}),(t,o)=>(C(),e("div",qt,[a("div",Nt,[a("div",{ref_key:"iconContainer",ref:i,class:"icon-container"},o[3]||(o[3]=[a("i",{class:"iconfont ChatGPT"},null,-1)]),512),o[4]||(o[4]=a("h1",{class:"title"},"登录验证",-1)),o[5]||(o[5]=a("p",{class:"hint"},"管理员开启了密码验证，请在下方填入访问码",-1)),l(a("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>s.value=t),type:"password",placeholder:"在此处填写访问码"},null,512),[[I,s.value]]),a("div",Jt,[a("button",{class:"later",onClick:o[1]||(o[1]=t=>n())},"游客登录"),a("button",{class:"login",onClick:o[2]||(o[2]=t=>n(s.value))},"登录")])])]))}},[["__scopeId","data-v-02fd5e8c"]]),Gt=T({history:L("/"),routes:[{path:"/",name:"home",component:vt,children:[{path:"/",name:"blank",component:ht},{path:"/contactors",name:"contactors",component:ht},{path:"/chat/:id",name:"chat_view",component:rt},{path:"/profile/:id",name:"profile_view",component:jt}]},{path:"/auth",name:"auth",component:zt},{path:"/settings",name:"settings",component:Ft}]});Gt.beforeEach(async t=>{if(!U.everLogin()&&"auth"!==t.name){P.warning("请先登录");return{name:"auth",query:"/settings"===t.path?null:{redirect:t.fullPath}}}});export{Gt as r};
//# sourceMappingURL=views-QLd7gYVd.js.map
