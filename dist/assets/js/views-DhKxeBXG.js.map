{"version":3,"mappings":"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","names":["_hoisted_1","id","_hoisted_2","class","_hoisted_3","_hoisted_4","_hoisted_5","key","_hoisted_7","_hoisted_9","_hoisted_10","_hoisted_12","_hoisted_14","_hoisted_15","style","width","height","position","_hoisted_19","_hoisted_20","_hoisted_21","components","MdPreview","ContextMenu","ForwardMsg","InputEditor","ToolCallBar","FileBlock","ReasonBlock","data","shareId","contactor","preview","scroll","currentUrl","window","location","href","params","URL","searchParams","has","get","currentId","parseInt","this","$route","client","getContactor","Error","e","defaultId","contactList","$router","push","path","query","activeContactor","showwindow","showemoji","userInput","extraOptions","wraperPresets","selectedOption","currentDelay","toupdate","seletedText","seletedImage","retryList","showMenu","menuTop","menuLeft","validMessageIndex","repliedMessageId","autoScroll","fullScreen","chatWindowRef","clearMessageTip","loadingIcon","computed","getMenuStyle","innerWidth","top","left","getDelayStatus","activeMessageChain","options","presetSettings","opening","role","content","type","text","time","createTime","messageChain","watch","newVal","oldVal","initContactor","toButtom","oldId","oldContactor","disableContactor","mounted","document","addEventListener","$refs","chatWindow","scrollHandler","loadOriginalContactors","$message","message","updated","length","beforeUnmount","removeEventListener","methods","handleMouseUp","selectedText","getSelection","toString","clicked","setTimeout","scrollTop","scrollHeight","elm","getElementById","cleanScreen","updateFirstMessage","setLocalStorage","emit","cleanHistory","i","splice","makeSystemMessage","delSystemMessage","index","firstMessageIndex","isValidInput","input","test","waiting","tolist","name","setModel","base","model","loadAvatar","toimg","rect","getBoundingClientRect","html2canvas","windowHeight","then","canvas","img","toDataURL","link","createElement","download","click","share","shareContactor","hasOpening","getFullMessages","showTime","list","thisTime","show","getShownTime","separateTextAndImages","markdownText","regex","matches","result","lastIndex","exec","textContent","slice","trim","file","getChatwindowScrollheight","clientHeight","active","on","$forceUpdate","async","messageId","rawMessage","getMessageById","status","filter","item","error","forEach","element","platform","formatedMessage","loadName","off","getReplyText","find","substr","showMessageMenu","event","messageIndex","target","tagName","toLowerCase","imgSrc","src","preventDefault","clientY","clientX","currentSelectedText","toProfile","getseletedMessage","handleMessageOption","option","webSend","targetIndex","validMessage","retryMessage","_openBlock","_createElementBlock","_createElementVNode","onClick","$event","$options","args","_toDisplayString","$data","_normalizeClass","ref","_createVNode","_component_ContextMenu","_normalizeStyle","onMessageOption","onClose","_Fragment","_renderList","ref_for","_hoisted_6","_createCommentVNode","_hoisted_8","avatar","alt","_hoisted_11","title","_hoisted_13","onMouseup","onContextmenu","elmIndex","_createBlock","_component_MdPreview","includes","_component_el_image","loading","fit","_component_ForwardMsg","messages","_component_FileBlock","_hoisted_16","_component_ReasonBlock","endTime","startTime","_hoisted_17","_cache","_component_ToolCallBar","_hoisted_18","_component_InputEditor","onStroge","onSetModel","onCleanScreen","onCleanHistory","onToButtom","created","friendlist","blankView","onPhone","pagePath","loaded","inited","_component_friendlist","_component_blankView","_component_router_view","overflow","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","PresetsList","JSON","parse","stringify","toolCallModes","config","getToolCallModes","providers","getLLMProviders","safetyParams","getSafetySettingsParams","safetySimpleValue","Object","keys","map","value","label","allLLMTools","llmTools","toolsObject","toolsList","toolKey","enabled","tools","collapsed","geminiSafetySettings","llmProviders","llmProvider","provider","llmBaseSettings","llmChatParams","chatParams","llmToolCallMode","toolCallSettings","mode","llmToolCallList","sliderTypeARange","sliderTypeBRange","sliderTypeCRange","showSafetySettings","showPresetsDetail","showToolsDetail","presetHistory","history","llmGeneralKeys","centerDialogVisible","handler","setGeneralSettings","deep","beforeMount","loadToolsList","loadGeneralSettings","setInterval","socket","delay","safeSimplify","raw","simplifyMethod","Map","table","set","stream","max_messages_num","temperature","top_p","frequency_penalty","presence_penalty","switchSafetySettings","simplifiedValue","originalValue","safetySettings","handleToolConfig","adcivedTools","plugin","some","tool","flat","enabledTools","updateOpenaiPresets","presets","getShownKey","HARM_CATEGORY_HARASSMENT","HARM_CATEGORY_HATE_SPEECH","HARM_CATEGORY_SEXUALLY_EXPLICIT","HARM_CATEGORY_DANGEROUS_CONTENT","HARM_CATEGORY_CIVIC_INTEGRITY","delContactor","rmContactor","switchToolCallMode","switchLLMProvider","getDefaultModel","_createTextVNode","_component_el_select","modelValue","onChange","default","_withCtx","_component_el_option","_","_component_el_input","_component_el_switch","_component_el_slider","step","min","max","_Transition","_withDirectives","_component_PresetsList","onUpdatePresets","placeholder","toolIndex","description","_vShow","_hoisted_33","_hoisted_37","_component_el_button","plain","_ctx","_component_el_dialog","center","footer","reset","success","reload","resetCache","accessCode","requesting","iconContainer","login","code","nextTick","classList","add","ElMessage","is_admin","router","currentRoute","redirect","remove","handleEnter","onUnmounted","onMounted","createRouter","createWebHistory","routes","component","HomeView","children","__vitePreload","Promise","resolve","BlankView","ChatView","ProfileView","AuthView","SettingsView","beforeEach","to","everLogin","warning","fullPath"],"ignoreList":[],"sources":["../../../src/views/ChatView.vue","../../../src/views/BlankView.vue","../../../src/views/HomeView.vue","../../../src/views/ProfileView.vue","../../../src/views/SettingsView.vue","../../../src/views/AuthView.vue","../../../src/router/index.js"],"sourcesContent":["<script>\nimport { MdPreview } from \"md-editor-v3\";\nimport ForwardMsg from \"@/components/ForwardMsg.vue\";\nimport InputEditor from \"@/components/InputEditor.vue\";\nimport FileBlock from \"@/components/FileBlock.vue\";\nimport ToolCallBar from \"@/components/ToolCallBar.vue\";\nimport ReasonBlock from \"@/components/ReasonBlock.vue\";\nimport ContextMenu from \"@/components/ContextMenu.vue\";\nimport \"emoji-picker-element\";\nimport html2canvas from \"html2canvas\";\nimport { client } from \"@/lib/runtime.js\";\n\nexport default {\n  components: {\n    MdPreview,\n    ContextMenu,\n    ForwardMsg,\n    InputEditor,\n    ToolCallBar,\n    FileBlock,\n    ReasonBlock,\n  },\n  data() {\n    let preview = false;\n    let shareId = undefined;\n    let contactor = undefined;\n    let scroll = true;\n\n    // 获取当前页面的URL\n    const currentUrl = window.location.href;\n    // 创建一个URL对象\n    const url = new URL(currentUrl);\n    // 获取URL参数\n    const params = url.searchParams;\n    // 检查URL参数是否有preview参数\n    if (params.has(\"preview\")) {\n      if (params.get(\"preview\") === \"true\") {\n        preview = true;\n      }\n    }\n    // 检查URL参数是否有shareId参数\n    if (params.has(\"shareId\")) {\n      shareId = params.get(\"shareId\");\n    }\n    if (params.has(\"scroll\")) {\n      scroll = params.get(\"scroll\") === \"true\";\n    }\n\n    const currentId = parseInt(this.$route.params.id);\n    try {\n      contactor = client.getContactor(currentId);\n      if (!contactor) {\n        throw new Error(\"找不到联系人\");\n      }\n    } catch (e) {\n      const defaultId = client.contactList[0].id;\n      this.$router.push({\n        path: `/chat/${defaultId}`,\n        query: {\n          preview,\n          shareId,\n        },\n      });\n      contactor = client.getContactor(defaultId);\n    }\n\n    return {\n      scroll,\n      preview,\n      shareId,\n      activeContactor: contactor,\n      showwindow: true,\n      showemoji: false,\n      userInput: \"\",\n      client: client,\n      extraOptions: [],\n      wraperPresets: {},\n      selectedOption: null,\n      currentDelay: 0,\n      toupdate: false,\n      seletedText: \"\",\n      seletedImage: \"\",\n      retryList: [],\n      showMenu: false,\n      menuTop: 0,\n      menuLeft: 0,\n      validMessageIndex: -1,\n      repliedMessageId: -1,\n      autoScroll: false,\n      fullScreen: false,\n      chatWindowRef: null,\n      clearMessageTip: \"以上的对话记录已清除\",\n      loadingIcon: \"<span id='message-loading-icon'></span>\",\n    };\n  },\n  computed: {\n    getMenuStyle() {\n      // return { top: this.menuTop + \"px\", left: this.menuLeft + \"px\" };\n      // 长度超出屏幕宽度，就向左移动\n      console.log(this.menuLeft);\n      if (this.menuLeft + 110 > window.innerWidth) {\n        return {\n          top: this.menuTop + \"px\",\n          left: this.menuLeft - 110 + \"px\",\n        };\n      } else {\n        return {\n          top: this.menuTop + \"px\",\n          left: this.menuLeft + \"px\",\n        };\n      }\n    },\n    getDelayStatus() {\n      return this.currentDelay > 1000\n        ? \"high\"\n        : this.currentDelay > 500\n          ? \"mid\"\n          : this.currentDelay > 100\n            ? \"low\"\n            : \"ultra\";\n    },\n    activeMessageChain() {\n      return this.activeContactor.options.presetSettings?.opening\n        ? [\n            {\n              role: \"other\",\n              content: [\n                {\n                  type: \"text\",\n                  data: {\n                    text: this.activeContactor.options.presetSettings.opening,\n                  },\n                },\n              ],\n              time: this.activeContactor.createTime,\n            },\n            ...this.activeContactor.messageChain,\n          ]\n        : this.activeContactor.messageChain;\n    },\n  },\n  watch: {\n    [\"$route.params.id\"](newVal, oldVal) {\n      const currentId = parseInt(newVal);\n      const contactor = client.getContactor(currentId);\n      this.activeContactor = contactor;\n      this.initContactor(this.activeContactor);\n      if (this.chatWindowRef) this.toButtom();\n      if (oldVal) {\n        const oldId = parseInt(oldVal);\n        const oldContactor = client.getContactor(oldId);\n        this.disableContactor(oldContactor);\n      }\n    },\n  },\n  async mounted() {\n    document.addEventListener(\"click\", () => {\n      this.showMenu = false;\n      this.seletedText = \"\";\n      this.seletedImage = \"\";\n      // if( this.showemoji) this.showemoji = false;\n    });\n    this.chatWindowRef = this.$refs.chatWindow;\n    this.chatWindowRef.addEventListener(\"scroll\", this.scrollHandler);\n    if (!this.preview && this.scroll) this.toButtom();\n    this.scroll = true;\n    this.initContactor(this.activeContactor);\n    this.fullScreen = this.client.fullScreen;\n    // setInterval(() => {\n    //   this.currentDelay = this.client.socket.delay;\n    // }, 3000);\n\n    if (this.shareId) {\n      const loadAble = await client.loadOriginalContactors(this.shareId);\n      if (loadAble) {\n        this.$router.push({\n          path: \"/chat/\" + this.shareId,\n          query: {\n            preview: this.preview,\n            scroll: false,\n          },\n        });\n      } else {\n        this.$message({\n          message: \"分享链接已失效\",\n          type: \"error\",\n        });\n      }\n    }\n  },\n  updated() {\n    if (this.toupdate && this.autoScroll && this.retryList.length === 0) {\n      this.toButtom();\n      this.toupdate = false;\n    }\n  },\n  beforeUnmount() {\n    // 移除事件监听\n    this.disableContactor(this.activeContactor);\n    this.chatWindowRef.removeEventListener(\"scroll\", this.scrollHandler);\n  },\n  methods: {\n    handleMouseUp() {\n      const selectedText = window.getSelection().toString();\n      if (selectedText) {\n        this.seletedText = selectedText;\n        console.log(\"选中的文本：\" + selectedText);\n      }\n    },\n    toButtom(clicked) {\n      setTimeout(() => {\n        if (this.chatWindowRef) {\n          this.chatWindowRef.scrollTop = this.chatWindowRef.scrollHeight;\n        } else {\n          const elm = document.getElementById(\"main-messages-window\");\n          elm.scrollTop = elm.scrollHeight;\n        }\n        if (clicked) this.$message(\"已滑至底部\");\n      }, 1);\n    },\n    cleanScreen() {\n      this.activeContactor.messageChain = [];\n      this.activeContactor.updateFirstMessage();\n      client.setLocalStorage(); //持久化存储\n      this.activeContactor.emit(\"updateMessageSummary\");\n\n      this.toupdate = true;\n      this.$message({ message: \"已清除会话记录\", type: \"success\" });\n    },\n    cleanHistory() {\n      this.activeContactor.updateFirstMessage();\n      this.$message({\n        message: \"上下文信息已清除，之后的请求将不再记录上文记录\",\n        type: \"success\",\n      });\n      // 先看看之前有没有清除提示\n      for (let i = this.activeContactor.messageChain.length - 1; i >= 0; i--) {\n        const message = this.activeContactor.messageChain[i];\n        // role 为 \"mio_system\"\n        if (\n          message.role === \"mio_system\" &&\n          message.content[0].type === \"text\" &&\n          message.content[0].data.text === this.clearMessageTip\n        ) {\n          this.activeContactor.messageChain.splice(i, 1);\n        }\n      }\n      this.activeContactor.makeSystemMessage(this.clearMessageTip);\n      // 持久化\n      client.setLocalStorage();\n    },\n\n    delSystemMessage(index) {\n      const message = this.activeContactor.messageChain[index];\n      // 判断是否是清除提示\n      if (\n        message.content[0].type === \"text\" &&\n        message.content[0].data.text === this.clearMessageTip\n      ) {\n        this.activeContactor.firstMessageIndex = 0;\n      }\n      this.activeContactor.messageChain.splice(index, 1);\n      // 持久化\n      client.setLocalStorage();\n    },\n\n    isValidInput(input) {\n      // 使用正则表达式检查用户输入是否只包含换行符和空格\n      const regex = /^[ \\n]+$/;\n      const result = !regex.test(input);\n      return result;\n    },\n    waiting() {\n      this.$message({ message: \"此功能尚未开放\", type: \"warning\" });\n    },\n\n    tolist() {\n      this.$router.push({ name: \"home\" });\n    },\n\n    async setModel(name) {\n      this.activeContactor.options.base.model = name;\n      this.activeContactor.loadAvatar();\n      await client.setLocalStorage(); //持久化存储\n    },\n    toimg() {\n      // 使用html2canvas把 this.chatWindowRef 渲染为图片\n      const rect = this.chatWindowRef.getBoundingClientRect();\n      rect.height = this.chatWindowRef.scrollHeight;\n\n      html2canvas(this.chatWindowRef, {\n        windowHeight: rect.height * 1.2,\n        width: rect.width,\n        // 例如: allowTaint: true, backgroundColor: null\n      }).then((canvas) => {\n        // 将canvas转换为图片\n        const img = canvas.toDataURL(\"image/png\");\n        // 创建一个a标签，并设置下载属性和下载链接\n        const link = document.createElement(\"a\");\n        link.download = \"chat.png\";\n        link.href = img;\n        // 模拟点击下载\n        link.click();\n      });\n    },\n    async share() {\n      const shareResult = await client.shareContactor(this.activeContactor.id);\n      if (shareResult) {\n        this.$message({\n          message: \"分享链接已复制\",\n          type: \"success\",\n        });\n      } else {\n        this.$message({\n          message: \"分享失败\",\n          type: \"error\",\n        });\n      }\n    },\n    hasOpening() {\n      return this.activeContactor.options.presetSettings?.opening\n        ? true\n        : false;\n    },\n    getFullMessages() {\n      return this.hasOpening()\n        ? [\n            {\n              role: \"other\",\n              content: [\n                {\n                  type: \"text\",\n                  data: {\n                    text: this.activeContactor.options.presetSettings.opening,\n                  },\n                },\n              ],\n              time: this.activeContactor.createTime,\n            },\n            ...this.activeContactor.messageChain,\n          ]\n        : this.activeContactor.messageChain;\n    },\n    showTime(index) {\n      const list = this.getFullMessages();\n      const thisTime = list[index].time;\n      if (index === 0) {\n        return {\n          show: true,\n          time: this.activeContactor.getShownTime(thisTime),\n        };\n      } else {\n        const earlyTime = list[index - 1].time;\n        if (thisTime - earlyTime > 600000) {\n          return {\n            show: true,\n            time: this.activeContactor.getShownTime(thisTime),\n          };\n        } else {\n          return {\n            show: false,\n            time: \"\",\n          };\n        }\n      }\n    },\n    separateTextAndImages(markdownText) {\n      // 使用正则表达式匹配Markdown图片格式\n      const regex = /!\\[([^\\]]*)\\]\\((.*)\\)/g;\n      let result = [];\n      let lastIndex = 0;\n\n      // 查找所有匹配的图片\n      let matches;\n      while ((matches = regex.exec(markdownText)) !== null) {\n        // 处理匹配到的文本部分\n        if (matches.index > lastIndex) {\n          const textContent = markdownText\n            .slice(lastIndex, matches.index)\n            .trim();\n          if (textContent) {\n            result.push({\n              type: \"text\",\n              data: {\n                text: textContent,\n              },\n            });\n          }\n        }\n\n        // 处理匹配到的图片部分\n        result.push({\n          type: \"image\",\n          data: {\n            // file: matches[2].length > 200 ? matches[2] : `/api/proxy?url=${matches[2]}`,\n            file: matches[2],\n          },\n        });\n\n        // 更新lastIndex到当前匹配结束的位置\n        lastIndex = regex.lastIndex;\n      }\n\n      // 处理最后一部分文本（如果有的话）\n      if (lastIndex < markdownText.length) {\n        const textContent = markdownText.slice(lastIndex).trim();\n        if (textContent) {\n          result.push({\n            type: \"text\",\n            data: {\n              text: textContent,\n            },\n          });\n        }\n      }\n\n      return result;\n    },\n\n    getChatwindowScrollheight() {\n      var scrollTop = this.chatWindowRef.scrollTop; // 当前滚动条的垂直位置\n      var clientHeight = this.chatWindowRef.clientHeight; // 可视区域高度\n      var scrollHeight = this.chatWindowRef.scrollHeight; // 内容总高度\n\n      // 计算滚动位置的实际像素长度\n      var scrollPercentage = scrollTop / (scrollHeight - clientHeight);\n      var height = scrollPercentage * scrollHeight;\n\n      return scrollHeight - height;\n    },\n\n    initContactor(contactor) {\n      contactor.active = true;\n\n      contactor.on(\"revMessage\", (message) => {\n        this.activeContactor.messageChain.push(message);\n        this.toupdate = true;\n      });\n      contactor.on(\"delMessage\", (index) => {\n        console.log(`删除消息${index}`);\n        // 从消息链中删除消息\n        this.activeContactor.messageChain.splice(index, 1);\n        this.toupdate = true;\n      });\n\n      contactor.on(\"updateMessage\", () => {\n        this.$forceUpdate();\n        this.toupdate = true;\n        client.setLocalStorage(); //持久化存储\n      });\n\n      contactor.on(`completeMessage`, async (e) => {\n        const messageId = e.messageId;\n        const rawMessage = this.activeContactor.getMessageById(messageId);\n        if (rawMessage.status === \"retrying\") {\n          this.retryList = this.retryList.filter((item) => item !== messageId);\n        }\n        rawMessage.status = \"completed\";\n\n        if (!e.error) {\n          rawMessage.content.forEach((element, index) => {\n            if (\n              element.type === \"text\" &&\n              this.activeContactor.platform === \"onebot\"\n            ) {\n              const formatedMessage = this.separateTextAndImages(\n                element.data.text,\n              );\n              // 把 formatedMessage 里的元素展开到 index 这个位置\n              rawMessage.content.splice(index, 1, ...formatedMessage);\n            }\n          });\n        } else {\n          rawMessage.content = [\n            {\n              type: \"text\",\n              data: {\n                text: e.text,\n              },\n            },\n          ];\n        }\n\n        this.toupdate = true;\n        this.activeContactor.loadName();\n        client.setLocalStorage(); //持久化存储\n        console.log(e);\n      });\n    },\n    disableContactor(contactor) {\n      if (contactor) {\n        contactor.active = false;\n        contactor.off(`updateMessage`);\n        contactor.off(`revMessage`);\n        contactor.off(`delMessage`);\n        contactor.off(`completeMessage`);\n      }\n    },\n    getReplyText(id) {\n      let content = \"\";\n      const message = this.activeContactor.messageChain.find(\n        (item) => item.id === id,\n      );\n      if (message) {\n        message.content.forEach((element) => {\n          if (element.type === \"text\") {\n            content += element.data.text;\n          } else if (element.type === \"image\") {\n            content += \"[图片]\";\n          }\n        });\n        if (content.length > 20) {\n          return `> ${content.substr(0, 20)}...`;\n        } else {\n          return `> ${content}`;\n        }\n      }\n    },\n    showMessageMenu(event, messageIndex) {\n      // 确定右击的元素类型\n      if (event.target.tagName.toLowerCase() === \"img\") {\n        const imgElement = event.target;\n        const imgSrc = imgElement.src;\n        this.seletedImage = imgSrc;\n      } else {\n        console.log(\"用户右击了非图片元素\");\n      }\n      this.validMessageIndex =\n        this.activeContactor.platform === \"openai\" && this.hasOpening()\n          ? messageIndex - 1\n          : messageIndex;\n      event.preventDefault();\n      this.showMenu = true;\n      this.menuTop = event.clientY;\n      this.menuLeft = event.clientX;\n\n      const currentSelectedText = window.getSelection().toString();\n      if (currentSelectedText) {\n        this.seletedText = currentSelectedText;\n      } else {\n        this.seletedText = \"\";\n      }\n    },\n    toProfile() {\n      this.$router.push({\n        name: \"profile_view\",\n        params: {\n          id: this.activeContactor.id,\n        },\n      });\n      // 弹出维护提示\n      // this.$message({\n      //   message: \"此功能正在维护中\",\n      //   type: \"warning\",\n      // });\n    },\n    scrollHandler() {\n      this.showMenu = false;\n      if (this.showemoji) this.showemoji = false;\n\n      const scrollHeight = this.getChatwindowScrollheight();\n\n      this.autoScroll = scrollHeight > 300 ? false : true;\n    },\n    getseletedMessage() {\n      return this.activeContactor.messageChain[this.validMessageIndex];\n    },\n    handleMessageOption(option) {\n      const message = this.getseletedMessage();\n      switch (option) {\n        case \"retry\":\n          if (this.activeContactor.platform === \"onebot\") {\n            // 重新发送一样的消息\n            if (message.role === \"user\") {\n              this.activeContactor.webSend(message);\n            } else {\n              this.activeContactor.webSend({\n                ...message,\n                role: \"user\",\n              });\n            }\n            this.$message({ message: \"消息已重新发送\", type: \"success\" });\n          } else {\n            const targetIndex =\n              message.role === \"user\"\n                ? this.validMessageIndex + 1\n                : this.validMessageIndex;\n\n            const validMessage = this.activeContactor.messageChain[targetIndex];\n            // if (message.role === \"user\") {\n            //   this.activeContactor.retryMessage(message.id);\n            // } else {\n            //   this.activeContactor.retryMessage(message.id);\n            // }\n            this.activeContactor.retryMessage(validMessage.id);\n            validMessage.status = \"retrying\";\n            this.retryList.push(validMessage.id);\n          }\n          this.toButtom();\n          break;\n        case \"reply\":\n          if (this.activeContactor.platform === \"onebot\") {\n            this.repliedMessageId = message.id;\n            this.$message({ message: \"已引用该消息\", type: \"success\" });\n          } else {\n            this.userInput +=\n              this.getReplyText(\n                this.activeContactor.messageChain[this.validMessageIndex].id,\n              ) + \"\\n\\n\";\n          }\n          break;\n        case \"delete\":\n          this.activeContactor.messageChain.splice(this.validMessageIndex, 1);\n          client.setLocalStorage();\n          break;\n        default:\n          break;\n      }\n    },\n  },\n};\n</script>\n\n<template>\n  <div id=\"chat-window\">\n    <div class=\"upside-bar\">\n      <div class=\"return\" @click=\"tolist()\">\n        <i class=\"iconfont icon-return\"></i>\n      </div>\n      <div class=\"name-area\" @click=\"toProfile\">\n        <div class=\"contactor-name\">{{ activeContactor.name }}</div>\n        <span :class=\"'delay-status ' + getDelayStatus\"></span>\n        <span class=\"delay-num\">当前延迟: {{ currentDelay }} ms</span>\n      </div>\n      <ul class=\"options\">\n        <li class=\"share\" @click=\"share()\">\n          <i class=\"iconfont icon-share\"></i>\n        </li>\n      </ul>\n    </div>\n    <div\n      id=\"main-messages-window\"\n      ref=\"chatWindow\"\n      :class=\"{\n        'message-window': true,\n        preview: preview,\n      }\"\n    >\n      <ContextMenu\n        v-show=\"showMenu\"\n        type=\"message\"\n        :message=\"getseletedMessage()\"\n        :seleted-text\n        :seleted-image\n        :style=\"getMenuStyle\"\n        @message-option=\"handleMessageOption\"\n        @close=\"showMenu = false\"\n      />\n      <div\n        v-for=\"(item, index) of activeMessageChain\"\n        :key=\"`${activeContactor.id}-${item.id}`\"\n        ref=\"message\"\n        class=\"message-container\"\n      >\n        <div v-if=\"showTime(index).show\" class=\"message-time\">\n          {{ showTime(index).time }}\n        </div>\n        <div :id=\"item.role\" class=\"message-body\">\n          <div v-if=\"item.role !== 'mio_system'\" class=\"avatar\">\n            <img\n              v-if=\"item.role === 'other'\"\n              :src=\"activeContactor.avatar\"\n              :alt=\"activeContactor.name\"\n              @click=\"toProfile\"\n            />\n            <img v-else :src=\"client.avatar\" :alt=\"client.name\" />\n          </div>\n          <div v-if=\"item.role !== 'mio_system'\" class=\"msg\">\n            <div class=\"wholename\">\n              <div\n                v-if=\"\n                  item.role === 'other' ? activeContactor.title : client.title\n                \"\n                class=\"title\"\n              >\n                {{\n                  item.role === \"other\" ? activeContactor.title : client.title\n                }}\n              </div>\n              <div class=\"name\">\n                {{ item.role === \"other\" ? activeContactor.name : client.name }}\n              </div>\n            </div>\n            <div\n              class=\"content\"\n              @mouseup=\"handleMouseUp\"\n              @contextmenu=\"showMessageMenu($event, index)\"\n            >\n              <div\n                v-for=\"(element, elmIndex) of item.content\"\n                :key=\"elmIndex\"\n                class=\"inner-content\"\n              >\n                <MdPreview\n                  v-if=\"element.type === 'text'\"\n                  :no-img-zoom-in=\"false\"\n                  preview-theme=\"github\"\n                  :code-foldable=\"false\"\n                  :model-value=\"\n                    ['pending', 'retrying'].includes(item.status) &&\n                    item.content.length - 1 === elmIndex\n                      ? element.data.text + loadingIcon\n                      : element.data.text\n                  \"\n                />\n                <el-image\n                  v-else-if=\"element.type === 'image'\"\n                  :key=\"`${activeContactor.id}-${index}-${elmIndex}-${element.data.file}`\"\n                  :src=\"element.data.file\"\n                  :zoom-rate=\"1.2\"\n                  :max-scale=\"7\"\n                  :min-scale=\"0.2\"\n                  :preview-src-list=\"[element.data.file]\"\n                  :initial-index=\"4\"\n                  loading=\"lazy\"\n                  fit=\"contain\"\n                />\n                <MdPreview\n                  v-else-if=\"element.type === 'reply'\"\n                  preview-theme=\"github\"\n                  :model-value=\"getReplyText(element.data.id)\"\n                />\n                <ForwardMsg\n                  v-else-if=\"element.type === 'nodes'\"\n                  :contactor=\"activeContactor\"\n                  :messages=\"element.data.messages\"\n                />\n                <FileBlock\n                  v-else-if=\"element.type === 'file'\"\n                  :file-url=\"element.data.file\"\n                />\n                <span v-else-if=\"element.type === 'at'\" />\n                <ReasonBlock\n                  v-else-if=\"element.type === 'reason'\"\n                  :end-time=\"element.data.endTime\"\n                  :start-time=\"element.data.startTime\"\n                  :content=\"element.data.text\"\n                />\n                <div\n                  v-else-if=\"element.type === 'blank'\"\n                  class=\"blank-message\"\n                  style=\"width: 10rem; height: 28.8px; position: relative\"\n                >\n                  <span class=\"blank-loader\"></span>\n                </div>\n                <ToolCallBar\n                  v-else-if=\"element.type === 'tool_call'\"\n                  :tool-call=\"element.data\"\n                />\n                <!-- <MdPreview\n                  v-else\n                  preview-theme=\"github\"\n                  :model-value=\"\n                    '未知的消息类型：\\n```\\n' +\n                    JSON.stringify(element, null, 2) +\n                    '\\n```'\n                  \"\n                /> -->\n              </div>\n            </div>\n          </div>\n          <div v-else class=\"system-message\">\n            <div class=\"system-message-content\">\n              {{ item.content[0].data.text }}\n            </div>\n            <div class=\"system-message-button\">\n              <i class=\"iconfont close\" @click=\"delSystemMessage(index)\"></i>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <InputEditor\n      ref=\"inputEditor\"\n      :active-contactor\n      :replied-message-id\n      @stroge=\"client.setLocalStorage()\"\n      @set-model=\"setModel\"\n      @clean-screen=\"cleanScreen\"\n      @clean-history=\"cleanHistory\"\n      @to-buttom=\"toButtom\"\n    />\n  </div>\n</template>\n\n<style lang=\"sass\" scoped>\n$mobile: 600px\n$icon-hover: #09f\n\n.preview\n    position: fixed\n    top: 0\n    left: 0\n    width: 100vw\n    height: 100vh\n    z-index: 10000\n\n#chat-window\n    z-index: 1\n    min-width: 0.0625rem\n    position: relative\n    display: flex\n    flex-grow: 1\n    background-color: #f2f2f2\n    flex-direction: column\n\n    @media (max-width: $mobile)\n        height: 100%\n\n.upside-bar\n    flex-basis: 4rem\n    flex-shrink: 0\n    width: 100%\n    display: flex\n    align-items: flex-end\n    justify-content: flex-start\n    border-bottom: 0.0625rem solid #ebebeb\n\n    @media (max-width: $mobile)\n      position: fixed\n      height: 4rem\n      z-index: 1000\n      background-color: hsla(0, 0%, 100%, 0.8)\n      backdrop-filter: blur(0.5rem)\n\n    .return\n        display: none\n\n        &:hover\n            color: $icon-hover\n\n        @media (max-width: $mobile)\n            display: block\n            margin-left: 1rem\n            margin-bottom: .8rem\n\n    .name-area\n        cursor: pointer\n        position: relative\n        display: flex\n        align-items: center\n        flex-basis: 10rem\n        flex-grow: 1\n        justify-content: flex-start\n        margin: 0 0 .5rem 1rem\n\n        .contactor-name\n            text-overflow: ellipsis\n            white-space: nowrap\n            overflow: hidden\n            max-width: 10rem\n\n        .delay-status\n            width: .8rem\n            height: .8rem\n            border-radius: 50%\n            margin-left: .5rem\n            position: relative\n            top: .2rem\n\n            @media screen and (max-width: $mobile)\n              display: none\n\n\n            &:hover + .delay-num\n                display: inline-block\n\n            &.ultra\n                background-color: rgb(53, 233, 146)\n\n            &.low\n                background-color: rgb(255, 204, 0)\n\n            &.mid\n                background-color: rgb(255, 102, 102)\n\n            &.high\n                background-color: #ccc\n\n        .delay-num\n            display: none\n            position: absolute\n            font-size: 0.8rem\n            bottom: 0rem\n            background-color: #fff\n            border: 1px dashed #000\n            border-radius: 0.25rem\n            padding: 0.125rem 0.25rem\n            margin-left: 1rem\n            white-space: nowrap\n\n    .options\n        flex-basis: 10rem\n        display: flex\n        height: 2rem\n        flex-wrap: nowrap\n        flex-direction: row-reverse\n        align-items: flex-end\n        margin: 0 1rem .5rem 0\n\n        li\n            margin-left: 0.5rem\n            color: #000\n            font-weight: 580\n\n            &:hover\n              color: $icon-hover\n\n            i\n                font-size: 1.25rem\n\n\n.black-overlay\n    position: fixed\n    top: 0\n    left: 0\n    width: 100%\n    height: 100%\n    background-color: rgba(0, 0, 0, 0.4)\n    z-index: 1001\n/* z-index 属性设置元素的堆叠顺序。*/\n\n#theimg\n    position: fixed\n    top: 50%\n    left: 50%\n    transform: translate(-50%, -50%)\n    max-height: 75%\n    max-width: 50%\n.inner-content\n  display: flex\n\n.background img\n    position: absolute\n    top: 50%\n    left: 50%\n    transform: translate(-50%, -50%)\n\n.message-body > .avatar\n  cursor: pointer\n  flex-basis: 2.65rem\n  min-width: 2.65rem\n  height: 2.65rem\n\n\n.avatar > img\n  width: 100%\n  height: 100%\n  border-radius: 50%\n\n\n.window-controls\n    display: flex\n    flex-basis: 100%\n\n    @media (max-width: $mobile)\n        display: none\n\n    .button\n        display: flex\n        justify-content: center\n        padding-top: 0.5rem\n        flex: 0 0 2rem\n\n        &:hover\n            background-color: rgb(231, 231, 231)\n\n        &#close:hover\n            background-color: rgb(255, 0, 0)\n            color: white\n\n\n.button#close:hover svg path\n    fill: #fff\n\n\n.voice-box\n    display: flex\n    width: 11.25rem\n    height: 1.5rem\n    margin: 0.25rem 0\n\n    .icon\n        flex-basis: 1.5rem\n        background-color: rgb(0, 0, 0)\n        display: flex\n        justify-content: center\n        align-items: center\n        border-radius: 50%\n\n    .wave\n        display: flex\n        justify-content: center\n        align-items: center\n        flex-grow: 1\n\n.wave svg\n    height: 1.25rem\n    width: 80%\n\n.loader\n    width: 0.625rem\n    padding: 0.25rem\n    aspect-ratio: 1\n    border-radius: 50%\n    background: rgb(0, 153, 255)\n    --_m: conic-gradient(#0000 10%, #000), linear-gradient(#000 0 0) content-box\n    -webkit-mask: var(--_m)\n    mask: var(--_m)\n    -webkit-mask-composite: source-out\n    mask-composite: subtract\n    animation: l3 1s infinite linear\n    position: absolute\n\n@keyframes move\n    0%\n        left: -20% // 开始位置\n    100%\n        left: 120% // 结束位置\n\n.blank-loader\n    width: 10%\n    height: 200%\n    position: absolute\n    background: linear-gradient(to right, rgb(255, 255, 255), rgb(0, 0, 0) 50%, transparent 50%, transparent)\n    top: -50%\n    transform: rotate(30deg)\n    filter: blur(5px)\n    animation: move 1s linear infinite // 每1s循环\n\n@keyframes l\n    to\n        transform: rotate(1turn)\n\n@media (max-width: 600px)\n    #chatwindow\n        height: 100%\n\n    .upsidebar\n        white-space: nowrap\n        max-width: 7rem\n        text-overflow: ellipsis\n        overflow: hidden\n        background: #00a8ff linear-gradient(to right, #00d2f8, #00a8ff)\n\n    .upsidebar *\n        color: white\n        fill: white\n\n    .delay-num\n        color: black\n\n    .window-controls\n        display: none\n\n    .name-area\n        padding-bottom: 0.25rem\n\n    .input-area\n        overflow-y: auto\n\n    .inputbar\n        flex-basis: 4rem\n\n    .delay-status\n        position: relative\n        top: -.2rem\n</style>\n","<template>\n  <div class=\"blank-view\">\n    <div class=\"upside-bar\">\n      <div class=\"options\"></div>\n    </div>\n  </div>\n</template>\n<script>\nimport { client } from \"@/lib/runtime.js\";\n\nexport default {\n  name: \"BlankView\",\n  data() {\n    return {\n      fullScreen: false,\n      client: client,\n    };\n  },\n  watch: {},\n  created() {\n    this.fullScreen = client.fullScreen;\n  },\n  methods: {\n    waiting() {\n      this.$message({ message: \"此功能尚未开放\", type: \"warning\" });\n    },\n  },\n};\n</script>\n<style lang=\"sass\" scoped>\n.blank-view\n  background-color: #f2f2f2\n  flex-grow: 1\n\n.upside-bar\n    flex-basis: 3.75rem\n    flex-shrink: 0\n    height: 3.75rem\n    width: 100%\n    display: flex\n    align-items: flex-end\n    flex-direction: row-reverse\n    justify-content: space-between\n\n    .options\n        flex-basis: 6rem\n        display: flex\n        height: 100%\n        width: 100%\n        flex-wrap: wrap\n        flex-direction: row-reverse\n</style>\n","<template>\n  <div v-if=\"!onPhone\" id=\"main\">\n    <friendlist></friendlist>\n    <router-view v-if=\"loaded\"></router-view>\n    <blankView v-else></blankView>\n  </div>\n  <div v-else-if=\"pagePath === '/'\" id=\"main-mobile\">\n    <friendlist v-if=\"loaded\"></friendlist>\n    <blankView v-else></blankView>\n  </div>\n  <div v-else id=\"main-mobile\" class=\"mobile-chat\">\n    <router-view v-if=\"loaded\"></router-view>\n    <blankView v-else></blankView>\n  </div>\n</template>\n\n<script>\nimport friendlist from \"@/components/FriendList.vue\";\nimport { client } from \"@/lib/runtime.js\";\nimport blankView from \"@/views/BlankView.vue\";\n\nexport default {\n  components: {\n    friendlist,\n    blankView,\n  },\n  data() {\n    const onPhone = window.innerWidth < 600;\n    return {\n      onPhone,\n      pagePath: this.$route.path,\n      loaded: false,\n    };\n  },\n  watch: {\n    $route: function (newVal) {\n      this.pagePath = newVal.path;\n    },\n  },\n  mounted() {\n    if (client.inited) {\n      this.loaded = true;\n    } else {\n      client.on(\n        \"loaded\",\n        () => {\n          this.loaded = true;\n        },\n        false,\n      );\n    }\n  },\n};\n</script>\n\n<style>\n#main {\n  background-color: rgb(255, 255, 255);\n  flex-grow: 1;\n  display: flex;\n  width: calc(100% - 4.5rem);\n  background-color: #f2f2f2;\n}\n\n#main > .profile-body {\n  margin-top: 4rem;\n}\n\n#main-mobile {\n  width: 100%;\n  max-height: calc(100vh - 4rem);\n  background-color: rgb(255, 255, 255);\n  flex-grow: 1;\n  display: flex;\n}\n\n.mobile-chat#main-mobile {\n  max-height: 100%;\n}\n</style>\n","<template>\n  <div class=\"profile-body\">\n    <div id=\"profile\">\n      <div class=\"profile-container\">\n        <div class=\"base-info\">\n          <div class=\"base-info-avatar\">\n            <el-image\n              :src=\"activeContactor.avatar\"\n              :preview-src-list=\"[activeContactor.avatar]\"\n            />\n          </div>\n          <div class=\"base-info-content\">\n            <div class=\"name\">{{ activeContactor.name }}</div>\n            <div class=\"id\">ID {{ activeContactor.id }}</div>\n            <div class=\"status\">\n              <span :class=\"'delay-status ' + getDelayStatus\"></span>\n              在线\n            </div>\n          </div>\n          <div\n            v-if=\"activeContactor.platform === 'openai'\"\n            class=\"base-info-provider\"\n          >\n            <el-select\n              v-model=\"llmProvider\"\n              style=\"width: 10rem\"\n              @change=\"switchLLMProvider\"\n            >\n              <el-option\n                v-for=\"item in llmProviders\"\n                :key=\"item.value\"\n                :label=\"item.label\"\n                :value=\"item.value\"\n              />\n            </el-select>\n          </div>\n        </div>\n        <div class=\"info-blocks\">\n          <div\n            v-if=\"activeContactor.platform == 'openai'\"\n            class=\"openai-settings\"\n          >\n            <div class=\"settings-block\">\n              <div class=\"block-title\">LLM 基本配置</div>\n              <div class=\"block-content\">\n                <div\n                  v-for=\"(_, key) in llmGeneralKeys\"\n                  :key=\"key\"\n                  class=\"block-content-item\"\n                >\n                  <div class=\"item-title\">{{ getShownKey(key) }}</div>\n                  <div class=\"item-content\">\n                    <el-input\n                      v-if=\"['model', 'max_messages_num'].includes(key)\"\n                      v-model=\"llmGeneralKeys[key]\"\n                    ></el-input>\n                    <el-switch\n                      v-else-if=\"['stream'].includes(key)\"\n                      v-model=\"llmGeneralKeys[key]\"\n                    ></el-switch>\n                    <el-slider\n                      v-else-if=\"['temperature'].includes(key)\"\n                      v-model=\"llmGeneralKeys[key]\"\n                      :step=\"sliderTypeARange[2]\"\n                      :min=\"sliderTypeARange[0]\"\n                      :max=\"sliderTypeARange[1]\"\n                    />\n                    <el-slider\n                      v-else-if=\"['top_p'].includes(key)\"\n                      v-model=\"llmGeneralKeys[key]\"\n                      :step=\"sliderTypeBRange[2]\"\n                      :min=\"sliderTypeBRange[0]\"\n                      :max=\"sliderTypeBRange[1]\"\n                    />\n                    <el-slider\n                      v-else-if=\"\n                        ['frequency_penalty', 'presence_penalty'].includes(key)\n                      \"\n                      v-model=\"llmGeneralKeys[key]\"\n                      :step=\"sliderTypeCRange[2]\"\n                      :min=\"sliderTypeCRange[0]\"\n                      :max=\"sliderTypeCRange[1]\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"settings-block\">\n              <div class=\"block-title\">LLM 预设配置</div>\n              <div class=\"block-content\">\n                <div class=\"block-content-item\">\n                  <div class=\"item-title\">预设历史记录</div>\n                  <div class=\"item-content\">\n                    <button\n                      :class=\"{\n                        active: showPresetsDetail,\n                        'extra-info-button': true,\n                      }\"\n                      @click=\"showPresetsDetail = !showPresetsDetail\"\n                    >\n                      <i class=\"iconfont icon-return\"></i>\n                    </button>\n                  </div>\n                </div>\n                <transition name=\"expand-slide\">\n                  <div\n                    v-show=\"showPresetsDetail\"\n                    class=\"block-content-item\"\n                    style=\"overflow: hidden\"\n                  >\n                    <PresetsList\n                      :presets-history=\"presetHistory\"\n                      @update-presets=\"updateOpenaiPresets\"\n                    />\n                  </div>\n                </transition>\n              </div>\n            </div>\n\n            <div class=\"settings-block\">\n              <div class=\"block-title\">LLM 工具调用配置</div>\n              <div class=\"block-content\">\n                <div class=\"block-content-item\">\n                  <div class=\"item-title\">工具调用模式</div>\n                  <div class=\"item-content\">\n                    <el-select\n                      v-model=\"llmToolCallMode\"\n                      placeholder=\"AUTO\"\n                      style=\"width: 10rem\"\n                      @change=\"switchToolCallMode\"\n                    >\n                      <el-option\n                        v-for=\"item in toolCallModes\"\n                        :key=\"item.value\"\n                        :label=\"item.label\"\n                        :value=\"item.value\"\n                      />\n                    </el-select>\n                  </div>\n                </div>\n                <div\n                  v-for=\"(plugin, index) in allLLMTools\"\n                  :key=\"index\"\n                  class=\"block-content-item parent-item\"\n                >\n                  <div class=\"item-title\">{{ plugin.name }}</div>\n                  <div class=\"item-content\">\n                    <button\n                      :class=\"{\n                        active: !plugin.collapsed,\n                        'extra-info-button': true,\n                      }\"\n                      @click=\"plugin.collapsed = !plugin.collapsed\"\n                    >\n                      <i class=\"iconfont icon-return\"></i>\n                    </button>\n                  </div>\n                  <transition name=\"expand-slide\">\n                    <div\n                      v-show=\"!plugin.collapsed\"\n                      class=\"item-hidden-content plugin-tools-container\"\n                    >\n                      <div\n                        v-for=\"(tool, toolIndex) in plugin.tools\"\n                        :key=\"toolIndex\"\n                        class=\"block-content-item child-item\"\n                        :title=\"tool.description\"\n                      >\n                        <div class=\"item-title\">{{ tool.name }}</div>\n                        <div class=\"item-content\">\n                          <el-switch\n                            v-model=\"tool.enabled\"\n                            @change=\"handleToolConfig\"\n                          ></el-switch>\n                        </div>\n                      </div>\n                    </div>\n                  </transition>\n                </div>\n              </div>\n            </div>\n\n            <div v-if=\"llmProvider == 'gemini'\" class=\"settings-block\">\n              <div class=\"block-title\">Gimini 额外设置</div>\n              <div class=\"block-content\">\n                <div class=\"block-content-item\">\n                  <div class=\"item-title\">过滤等级设置</div>\n                  <div class=\"item-content\">\n                    <button\n                      :class=\"{\n                        active: showSafetySettings,\n                        'extra-info-button': true,\n                      }\"\n                      @click=\"showSafetySettings = !showSafetySettings\"\n                    >\n                      <i class=\"iconfont icon-return\"></i>\n                    </button>\n                  </div>\n                </div>\n                <div\n                  :class=\"{\n                    hidden: !showSafetySettings,\n                    'block-content-item': true,\n                  }\"\n                >\n                  <ul id=\"safety-settings\" class=\"sub-items\">\n                    <li\n                      v-for=\"(value, key) of geminiSafetySettings\"\n                      :key=\"key\"\n                      class=\"block-content-item\"\n                    >\n                      <div class=\"item-title\">{{ getShownKey(key) }}</div>\n                      <div class=\"item-content\">\n                        <el-select\n                          v-model=\"geminiSafetySettings[key]\"\n                          style=\"width: 10rem\"\n                          @change=\"switchSafetySettings(key)\"\n                        >\n                          <el-option\n                            v-for=\"item in safetySimpleValue\"\n                            :key=\"item.value\"\n                            :label=\"item.label\"\n                            :value=\"item.value\"\n                          />\n                        </el-select>\n                      </div>\n                    </li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"action-bar\">\n      <el-button plain @click=\"$router.push(`/chat/${activeContactor.id}`)\"\n        >发送消息</el-button\n      >\n      <el-button type=\"danger\" plain @click=\"centerDialogVisible = true\"\n        >删除好友</el-button\n      >\n      <el-dialog v-model=\"centerDialogVisible\" title=\"警告\" width=\"300\" center>\n        <span> 确认要删除此好友吗？该操作不可逆。 </span>\n        <template #footer>\n          <div class=\"dialog-footer\">\n            <el-button @click=\"centerDialogVisible = false\">取消</el-button>\n            <el-button type=\"primary\" @click=\"delContactor\"> 确认 </el-button>\n          </div>\n        </template>\n      </el-dialog>\n    </div>\n  </div>\n</template>\n<script>\nimport { client, config } from \"@/lib/runtime.js\";\nimport PresetsList from \"@/components/PresetsList.vue\";\n\nexport default {\n  components: {\n    PresetsList,\n  },\n  data() {\n    const currentId = parseInt(this.$route.params.id);\n    const contactor = client.getContactor(currentId);\n    const options = JSON.parse(JSON.stringify(contactor.options));\n    const toolCallModes = config.getToolCallModes();\n    const providers = config.getLLMProviders();\n    const safetyParams = config.getSafetySettingsParams();\n\n    const safetySimpleValue = Object.keys(safetyParams).map((key) => ({\n      value: key,\n      label: key,\n    }));\n\n    const allLLMTools = [];\n    for (const key in config.llmTools) {\n      const toolsObject = config.llmTools[key];\n      const toolsList = Object.keys(toolsObject).map((toolKey) => ({\n        enabled: false,\n        ...toolsObject[toolKey],\n      }));\n      allLLMTools.push({\n        name: key,\n        tools: toolsList,\n        collapsed: true,\n      });\n    }\n\n    return {\n      safetyParams,\n      geminiSafetySettings: {},\n      safetySimpleValue: safetySimpleValue,\n      llmProviders: providers,\n      toolCallModes: toolCallModes,\n      currentDelay: 0,\n      activeContactor: contactor,\n      options: options,\n      llmProvider: options.provider,\n      llmBaseSettings: options.base,\n      llmChatParams: options.chatParams,\n      llmToolCallMode: options.toolCallSettings?.mode,\n      llmToolCallList: options.toolCallSettings?.tools,\n      sliderTypeARange: [0, 2, 0.1],\n      sliderTypeBRange: [0, 1, 0.1],\n      sliderTypeCRange: [-2, 2, 0.1],\n      showSafetySettings: false,\n      showPresetsDetail: false,\n      showToolsDetail: false,\n      presetHistory: options.presetSettings?.history,\n      allLLMTools: allLLMTools,\n      llmGeneralKeys: {},\n      centerDialogVisible: false,\n    };\n  },\n  computed: {\n    getDelayStatus() {\n      return this.currentDelay > 1000\n        ? \"high\"\n        : this.currentDelay > 500\n          ? \"mid\"\n          : this.currentDelay > 100\n            ? \"low\"\n            : \"ultra\";\n    },\n  },\n  watch: {\n    \"$route.params.id\"(newVal) {\n      this.activeContactor = client.getContactor(newVal);\n      this.initContactor();\n    },\n    llmGeneralKeys: {\n      handler() {\n        console.log(\"update\");\n        this.setGeneralSettings();\n      },\n      deep: true,\n    },\n  },\n  beforeMount() {\n    this.loadToolsList();\n    this.loadGeneralSettings();\n  },\n  mounted() {\n    this.initContactor();\n\n    setInterval(() => {\n      this.currentDelay = client.socket.delay;\n    }, 3000);\n  },\n  methods: {\n    loadGeneralSettings() {\n      this.llmGeneralKeys = {\n        ...this.llmBaseSettings,\n        ...this.llmChatParams,\n      };\n    },\n    safeSimplify(raw) {\n      const result = {};\n      const simplifyMethod = new Map();\n      const table = config.getSafetySettingsParams();\n      Object.keys(table).forEach((key) => {\n        simplifyMethod.set(table[key], key);\n      });\n\n      Object.keys(raw).forEach((key) => {\n        result[key] = simplifyMethod.get(raw[key]);\n      });\n\n      return result;\n    },\n    setGeneralSettings() {\n      const {\n        model,\n        stream,\n        max_messages_num,\n        temperature,\n        top_p,\n        frequency_penalty,\n        presence_penalty,\n      } = this.llmGeneralKeys;\n      this.activeContactor.options.base = {\n        model,\n        stream,\n        max_messages_num,\n      };\n      this.activeContactor.options.chatParams = {\n        temperature,\n        top_p,\n        frequency_penalty,\n        presence_penalty,\n      };\n      // 持久化\n      client.setLocalStorage();\n    },\n    switchSafetySettings(key) {\n      const simplifiedValue = this.geminiSafetySettings[key];\n      const originalValue = this.safetyParams[simplifiedValue];\n      this.activeContactor.options.safetySettings[key] = originalValue;\n      client.setLocalStorage(); //持久化存储\n    },\n    handleToolConfig() {\n      const adcivedTools = this.allLLMTools\n        .filter((plugin) => plugin.tools.some((tool) => tool.enabled))\n        .map((plugin) =>\n          plugin.tools.filter((tool) => tool.enabled).map((tool) => tool.name),\n        )\n        .flat();\n      this.activeContactor.options.toolCallSettings.tools = adcivedTools;\n      client.setLocalStorage(); //持久化存储\n    },\n    initContactor() {\n      // 更新所有配置，不仅仅是openai平台\n      this.options = JSON.parse(JSON.stringify(this.activeContactor.options));\n      this.llmProvider = this.options.provider;\n      this.llmBaseSettings = this.options.base;\n      this.llmChatParams = this.options.chatParams;\n      this.llmToolCallMode = this.options.toolCallSettings?.mode;\n      this.llmToolCallList = this.options.toolCallSettings?.tools;\n      this.presetHistory = this.options.presetSettings?.history;\n\n      if (this.options.provider === \"gemini\") {\n        this.geminiSafetySettings = this.safeSimplify(\n          this.options.safetySettings,\n        );\n      }\n      if (this.activeContactor.platform === \"openai\") {\n        this.loadGeneralSettings();\n        this.loadToolsList();\n      }\n    },\n    loadToolsList() {\n      const enabledTools = this.llmToolCallList;\n      this.allLLMTools = this.allLLMTools.map((plugin) => {\n        plugin.tools = plugin.tools.map((tool) => {\n          tool.enabled = enabledTools.includes(tool.name);\n          return tool;\n        });\n        return plugin;\n      });\n    },\n    updateOpenaiPresets(presets) {\n      this.activeContactor.options.presetSettings.history = presets;\n      this.$message({\n        message: \"预设历史记录已更新\",\n        type: \"success\",\n      });\n      client.setLocalStorage(); //持久化存储\n    },\n    getShownKey(key) {\n      const shownNameMap = {\n        mode: \"工具调用\",\n        model: \"模型\",\n        max_messages_num: \"最大历史消息数\",\n        stream: \"流式响应\",\n        temperature: \"温度\",\n        top_p: \"核采样\",\n        frequency_penalty: \"重复惩罚度\",\n        presence_penalty: \"话题新鲜度\",\n        HARM_CATEGORY_HARASSMENT: \"骚扰\",\n        HARM_CATEGORY_HATE_SPEECH: \"仇恨言论\",\n        HARM_CATEGORY_SEXUALLY_EXPLICIT: \"色情\",\n        HARM_CATEGORY_DANGEROUS_CONTENT: \"危险内容\",\n        HARM_CATEGORY_CIVIC_INTEGRITY: \"公民诚信\",\n      };\n      return shownNameMap[key];\n    },\n    async delContactor() {\n      this.centerDialogVisible = false;\n      await client.rmContactor(this.activeContactor.id);\n      this.$router.push(\"/\");\n    },\n    switchToolCallMode() {\n      this.activeContactor.options.toolCallSettings.mode = this.llmToolCallMode;\n      client.setLocalStorage(); //持久化存储\n    },\n    switchLLMProvider() {\n      const model = config.getDefaultModel(this.llmProvider);\n      this.llmGeneralKeys.model = model;\n\n      this.activeContactor.options.provider = this.llmProvider;\n\n      this.setGeneralSettings();\n\n      this.activeContactor.loadAvatar();\n    },\n  },\n};\n</script>\n\n<style scoped>\n#profile {\n  position: relative;\n  flex-grow: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n}\n.sub-items {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n}\n.base-info-provider {\n  flex-grow: 1;\n  display: flex;\n  justify-content: flex-end;\n  align-items: center;\n  padding-right: 2rem;\n}\n.block-content-item.hidden {\n  min-height: 0px;\n  max-height: 0px;\n}\n.extra-info-button.active {\n  transform: rotate(-90deg);\n}\n.item-content button {\n  background-color: transparent;\n  transition: transform 0.3s ease;\n}\n.profile-container {\n  overflow-y: auto;\n  margin: 2rem 0rem 0rem 0rem;\n  width: calc(100% - 8rem);\n  min-width: 20rem;\n  max-width: 40rem;\n  display: flex;\n  flex-direction: column;\n}\n.base-info {\n  background-color: #fff;\n  border-radius: 0.5rem;\n  display: flex;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid #88888888;\n  flex-wrap: wrap;\n  margin-bottom: 2rem;\n}\n.base-info-avatar {\n  margin-top: 1rem;\n  margin-left: 1rem;\n  flex-basis: 5.5rem;\n  height: 5.5rem;\n}\n.base-info-avatar .el-image {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n}\n.block-title {\n  font-size: 0.8rem;\n}\n.block-content {\n  margin-top: 0.5rem;\n  margin-bottom: 1rem;\n  width: 100%;\n  display: flex;\n  background-color: #fff;\n  min-height: 1rem;\n  border-radius: 0.5rem;\n  flex-direction: column;\n}\n.block-content:last-child {\n  margin-bottom: 2rem;\n}\n.block-content-item {\n  max-height: 50rem;\n  overflow-y: auto;\n  transition: max-height 0.5s ease;\n  position: relative;\n  display: flex;\n  width: 100%;\n  justify-content: space-between;\n  min-height: 2.5rem;\n  flex-wrap: nowrap;\n}\n.block-content-item.parent-item {\n  flex-wrap: wrap;\n}\n.child-item {\n  width: calc(100% - 1rem);\n  padding-left: 1rem;\n}\n.item-hidden-content {\n  width: 100%;\n}\n.plugin-tools-container {\n  max-height: 20rem; /* 限制最大高度，具体值可调 */\n  overflow-y: auto; /* 超出时显示垂直滚动条 */\n  -webkit-overflow-scrolling: touch; /* iOS 滚动优化 */\n}\n.block-content-item::after {\n  content: \"\";\n  position: absolute;\n  bottom: 0;\n  left: 5%;\n  width: 90%;\n  height: 1px;\n  background-color: rgba(145, 145, 145, 0.155);\n}\n.item-title {\n  font-size: 0.8rem;\n  margin-left: 1rem;\n  height: 2.5rem;\n  display: flex;\n  flex-grow: 1;\n  align-items: center;\n  justify-content: flex-start;\n}\n.item-content {\n  transform: scale(0.9);\n  flex-basis: 10rem;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  margin-right: 1.5rem;\n}\n.base-info-content {\n  margin-left: 1.5rem;\n  margin-top: 1rem;\n  display: flex;\n  flex-direction: column;\n}\n.base-info-content .name {\n  font-size: 1.25rem;\n}\n.base-info-content .id {\n  margin-top: 0.25rem;\n  font-size: 0.75rem;\n  color: dimgrey;\n}\n.base-info-content .status {\n  margin-top: 0.25rem;\n}\n.info-blocks {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n.action-bar {\n  position: relative;\n  background-color: #f2f2f2;\n  bottom: 0px;\n  left: 0px;\n  display: flex;\n  justify-content: space-around;\n  align-items: center;\n  height: 6rem;\n  width: 100%;\n  z-index: 2;\n}\n.profile-body {\n  position: relative;\n  overflow-y: auto;\n  flex-grow: 1;\n  background-color: #f2f2f2;\n}\n\n/* 自定义动画 */\n.expand-slide-enter-active,\n.expand-slide-leave-active {\n  transition:\n    max-height 0.4s cubic-bezier(0.78, 0.14, 0.15, 0.86),\n    opacity 0.4s;\n}\n.expand-slide-enter-from,\n.expand-slide-leave-to {\n  max-height: 0;\n  opacity: 0;\n}\n.expand-slide-enter-to,\n.expand-slide-leave-from {\n  max-height: 20rem;\n  opacity: 1;\n}\n</style>\n<style scoped lang=\"sass\">\n.delay-status\n  display: inline-block\n  width: 1rem\n  height: 1rem\n  border-radius: 50%\n  transform: translateY(.25rem)\n  margin-right: .25rem\n  &:hover + .delay-num\n    display: inline-block\n  &.ultra\n    background-color: rgb(53, 233, 146)\n  &.low\n    background-color: rgb(255, 204, 0)\n  &.mid\n    background-color: rgb(255, 102, 102)\n  &.high\n    background-color: #ccc\n</style>\n","<template>\n  <div id=\"settings-view\">\n    <el-button type=\"info\" plain @click=\"reset()\">重置全部</el-button>\n    <el-button type=\"info\" plain @click=\"resetCache()\">清理缓存</el-button>\n  </div>\n</template>\n\n<script>\nimport { client } from \"@/lib/runtime.js\";\n\nexport default {\n  name: \"SettingsView\",\n  data() {\n    return {};\n  },\n  methods: {\n    async reset() {\n      const result = await client.reset();\n      if (result) {\n        this.$message.success(\"重置成功\");\n        setTimeout(() => {\n          window.location.reload();\n        }, 500);\n      }\n    },\n    async resetCache() {\n      await client.resetCache();\n      this.$message.success(\"清理缓存成功\");\n      setTimeout(() => {\n        window.location.reload();\n      }, 500);\n    },\n  },\n};\n</script>\n\n<style scoped>\n#settings-view {\n  flex-grow: 1;\n  height: 100%;\n  background-color: #f2f2f2;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n</style>\n","<template>\n  <div class=\"auth-view\">\n    <div class=\"container\">\n      <div ref=\"iconContainer\" class=\"icon-container\">\n        <i class=\"iconfont ChatGPT\"></i>\n      </div>\n      <h1 class=\"title\">登录验证</h1>\n      <p class=\"hint\">管理员开启了密码验证，请在下方填入访问码</p>\n      <input\n        v-model=\"accessCode\"\n        type=\"password\"\n        placeholder=\"在此处填写访问码\"\n      />\n      <div class=\"controls\">\n        <button class=\"later\" @click=\"login()\">游客登录</button>\n        <button class=\"login\" @click=\"login(accessCode)\">登录</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { nextTick, onUnmounted, onMounted, ref } from \"vue\";\nimport router from \"@/router\";\nimport { client } from \"@/lib/runtime.js\";\nimport { ElMessage } from \"element-plus\";\n\nconst accessCode = ref();\nconst requesting = ref(false);\nconst iconContainer = ref();\n\nconst login = async (code) => {\n  console.log(\"触发login了\");\n\n  // 激活图标\n  await nextTick(() => iconContainer.value.classList.add(\"active\"));\n\n  if (requesting.value) {\n    return;\n  } else {\n    requesting.value = true;\n    try {\n      const result = await client.login(code);\n      if (result) {\n        ElMessage.success(\n          `成功以${result.is_admin ? \"管理员身份\" : \"游客身份\"}登录，欢迎使用!`,\n        );\n        // 先看看url里有没有query\n        if (router.currentRoute.value.query.redirect) {\n          router.push(router.currentRoute.value.query.redirect);\n        } else {\n          router.push(\"/\");\n        }\n\n        // 删除回车触发login的监听\n      }\n    } catch (error) {\n      ElMessage.error(error);\n    } finally {\n      // 移除激活图标\n      await nextTick(() => iconContainer.value.classList.remove(\"active\"));\n      requesting.value = false;\n    }\n  }\n};\n\n// 定义一个命名函数供事件监听和移除使用\nfunction handleEnter(e) {\n  if (e.key === \"Enter\") {\n    login(accessCode.value);\n  }\n}\n\n// 在unmounted时移除监听\nonUnmounted(() => {\n  console.log(\"unmounted\");\n  removeEventListener(\"keydown\", handleEnter); // 使用相同的函数引用进行移除\n});\n\nonMounted(() => {\n  addEventListener(\"keydown\", handleEnter);\n  // 看看query里有没有key\n  if (router.currentRoute.value.query.key) {\n    login(router.currentRoute.value.query.key);\n  }\n});\n</script>\n\n<style lang=\"sass\" scoped>\n$baseColor: #1d93ab\n\n.auth-view\n    background-color: white\n    flex-grow: 1\n    display: grid\n    place-items: center\n\n    .container\n        display: flex\n        flex-direction: column\n        align-items: center\n        width: 50%\n        margin: 0 auto\n        text-align: center\n        animation: fly-into 1s\n\n        @keyframes fly-into\n            from\n                transform: translateX(-150px)\n                opacity: 0\n            to\n                transform: translateX(0)\n                opacity: 1\n\n        .icon-container\n            transition: 1s linear\n\n            .iconfont.ChatGPT\n                font-size: 46px\n                border-radius: 10px\n\n            &.active\n                transform: rotate(180deg)\n                color: $baseColor\n\n        .title\n            white-space: nowrap\n            font-size: 50px\n            letter-spacing: 5px\n            color: black\n            margin: 25px\n\n        .hint\n            font-size: 15px\n            font-weight: 300\n\n        input\n            margin-top: 30px\n            border: 2px solid $baseColor\n            border-radius: 12px\n            width: 250px\n            height: 40px\n            padding: 0 10px\n            text-align: center\n            letter-spacing: 1px\n\n            &:focus\n                outline: 1px solid $baseColor\n\n                &::placeholder\n                    color: transparent\n\n            &::placeholder\n                text-align: center\n\n        .controls\n            display: flex\n            flex-direction: column\n            align-items: center\n\n            button\n                width: 10rem\n                margin-top: 20px\n                padding: 10px 15px\n                border-radius: 8px\n\n                &:hover\n                    box-shadow: 0 0 2px black\n\n            .later\n                background: transparent\n\n            .login\n                color: white\n                background: $baseColor\n</style>\n","import { createRouter, createWebHistory } from \"vue-router\";\nimport { client } from \"@/lib/runtime.js\";\nimport { ElMessage } from \"element-plus\";\nimport ChatView from \"../views/ChatView.vue\";\nimport HomeView from \"../views/HomeView.vue\";\nimport ProfileView from \"../views/ProfileView.vue\";\nimport SettingsView from \"../views/SettingsView.vue\";\nimport AuthView from \"../views/AuthView.vue\";\n\nconst router = createRouter({\n  history: createWebHistory(import.meta.env.BASE_URL),\n  routes: [\n    {\n      path: \"/\",\n      name: \"home\",\n      component: HomeView,\n      children: [\n        {\n          path: \"/\",\n          name: \"blank\",\n          component: () => import(\"../views/BlankView.vue\"),\n        },\n        {\n          path: \"/contactors\",\n          name: \"contactors\",\n          component: () => import(\"../views/BlankView.vue\"),\n        },\n        {\n          path: \"/chat/:id\",\n          name: \"chat_view\",\n          component: ChatView,\n        },\n        {\n          path: \"/profile/:id\",\n          name: \"profile_view\",\n          component: ProfileView,\n        },\n      ],\n    },\n    {\n      path: \"/auth\",\n      name: \"auth\",\n      component: AuthView,\n    },\n    {\n      path: \"/settings\",\n      name: \"settings\",\n      component: SettingsView,\n    },\n  ],\n});\n\nrouter.beforeEach(async (to) => {\n  const everLogin = client.everLogin();\n  if (\n    // 检查用户是否已登录\n    !everLogin &&\n    // ❗️ 避免无限重定向\n    to.name !== \"auth\"\n  ) {\n    console.log(\n      `everLogin: ${everLogin} to.name!== auth: ${to.name !== \"auth\"}`,\n    );\n    ElMessage.warning(\"请先登录\");\n    // 把原本要去的地址 完整的传递给 login?redirect=\n    const query = to.path === \"/settings\" ? null : { redirect: to.fullPath };\n    return { name: \"auth\", query };\n  }\n});\n\nexport default router;\n"],"file":"assets/js/views-DhKxeBXG.js"}