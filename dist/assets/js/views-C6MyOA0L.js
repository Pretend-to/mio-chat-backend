import{D as t,c as e,a,e as s,t as o,n as i,b as n,w as l,j as c,v as r,f as d,F as h,d as u,J as m,L as p,B as v,I as g,o as y,g as C,l as f,i as w,m as b,p as k,q as S,k as M,s as I,E as x,u as P,x as T}from"./vue-vendor-CRLzxj0N.js";import{_ as L,R as $,F as V,T as R,I as _,a as D,C as B,c as O,f as U,b as W,d as E}from"./components-BFBm5nfM.js";import"./emoji-C7BQ2utN.js";import{h as H}from"./vendor-DjrJ1W-E.js";const j={id:"chat-window"},F={class:"upside-bar"},q={class:"contactor-name"},A={class:"delay-num"},N={class:"options"},J={key:0,class:"message-time"},z=["id"],G={key:0,class:"avatar"},X=["src","alt"],Y=["src","alt"],K={key:1,class:"msg"},Q={class:"wholename"},Z={key:0,class:"title"},tt={class:"name"},et=["onContextmenu"],at={key:5},st={key:7,class:"blank-message",style:{width:"10rem",height:"28.8px",position:"relative"}},ot={key:2,class:"system-message"},it={class:"system-message-content"},nt={class:"system-message-button"},lt=["onClick"];const ct=L({components:{MdRenderer:t,ContextMenu:B,ForwardMsg:D,InputEditor:_,ToolCallBar:R,FileBlock:V,ReasonBlock:$},data(){let t,e,a=!1,s=!0;const o=window.location.href,i=new URL(o).searchParams;i.has("preview")&&"true"===i.get("preview")&&(a=!0),i.has("shareId")&&(t=i.get("shareId")),i.has("scroll")&&(s=i.get("scroll")||"true");const n=parseInt(this.$route.params.id);try{if(e=O.getContactor(n),!e)throw new Error("找不到联系人")}catch(l){const s=O.contactList[0].id;this.$router.push({path:`/chat/${s}`,query:{preview:a,shareId:t}}),e=O.getContactor(s)}return{scroll:s,preview:a,shareId:t,activeContactor:e,showwindow:!0,showemoji:!1,userInput:"",client:O,extraOptions:[],wraperPresets:{},selectedOption:null,currentDelay:0,toupdate:!1,seletedText:"",seletedImage:"",retryList:[],showMenu:!1,menuTop:0,menuLeft:0,validMessageIndex:-1,repliedMessageId:-1,autoScroll:!1,fullScreen:!1,chatWindowRef:null,prevScrollTop:0,showRollDown:!1,inputBarTop:0,clearMessageTip:"以上的对话记录已清除",loadingIcon:"<span id='message-loading-icon'></span>",katexPlugin:g,mioPlugins:[{plugin:m},{plugin:p},{plugin:v,options:{shape:"circle"}}]}},computed:{getMenuStyle(){if(window.innerWidth<768){const t=160;return this.menuTop-t<0?{top:t+"px"}:{bottom:window.innerHeight-this.menuTop+16+"px"}}return this.menuLeft+110>window.innerWidth?{top:this.menuTop+"px",left:this.menuLeft-110+"px"}:{top:this.menuTop+"px",left:this.menuLeft+"px"}},getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},activeMessageChain(){return this.activeContactor.options.presetSettings?.opening?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain}},watch:{"$route.params.id"(t,e){const a=parseInt(t),s=O.getContactor(a);if(this.activeContactor=s,this.initContactor(this.activeContactor),this.chatWindowRef&&this.toButtom(),e){const t=parseInt(e),a=O.getContactor(t);this.disableContactor(a)}}},async mounted(){document.addEventListener("click",()=>{this.showMenu=!1,this.seletedText="",this.seletedImage=""}),this.chatWindowRef=this.$refs.chatWindow,this.chatWindowRef.addEventListener("scroll",this.scrollHandler),!this.preview&&this.scroll&&this.toButtom(),this.scroll=!0,this.initContactor(this.activeContactor),this.fullScreen=this.client.fullScreen;const t=document.querySelector(".input-bar");if(t){const e=window.innerHeight;this.inputBarTop=e-t.offsetTop}if(this.shareId){await O.loadOriginalContactors(this.shareId)?this.$router.push({path:"/chat/"+this.shareId,query:{preview:this.preview,scroll:!1}}):this.$message({message:"分享链接已失效",type:"error"})}},updated(){this.toupdate&&this.autoScroll&&0===this.retryList.length&&(this.toButtom(),this.toupdate=!1)},beforeUnmount(){this.disableContactor(this.activeContactor),this.chatWindowRef.removeEventListener("scroll",this.scrollHandler)},methods:{handleMouseUp(){const t=window.getSelection().toString();t&&(this.seletedText=t)},toButtom(t){setTimeout(()=>{(()=>{const e=this.chatWindowRef||document.getElementById("main-messages-window");e&&e.scrollTo({top:e.scrollHeight,behavior:t?"smooth":"instant"})})()},1)},cleanScreen(){this.activeContactor.messageChain=[],this.activeContactor.updateFirstMessage(),O.setLocalStorage(),this.activeContactor.emit("updateMessageSummary"),this.toupdate=!0,this.$message({message:"已清除会话记录",type:"success"})},cleanHistory(){this.activeContactor.updateFirstMessage(),this.$message({message:"上下文信息已清除，之后的请求将不再记录上文记录",type:"success"});for(let t=this.activeContactor.messageChain.length-1;t>=0;t--){const e=this.activeContactor.messageChain[t];"mio_system"===e.role&&"text"===e.content[0].type&&e.content[0].data.text===this.clearMessageTip&&this.activeContactor.messageChain.splice(t,1)}this.activeContactor.makeSystemMessage(this.clearMessageTip),O.setLocalStorage()},delSystemMessage(t){const e=this.activeContactor.messageChain[t];"text"===e.content[0].type&&e.content[0].data.text===this.clearMessageTip&&(this.activeContactor.firstMessageIndex=0),this.activeContactor.messageChain.splice(t,1),O.setLocalStorage()},isValidInput:t=>!/^[ \n]+$/.test(t),waiting(){this.$message({message:"此功能尚未开放",type:"warning"})},tolist(){this.$router.push({name:"home"})},async setModel(t){const e=t[0],a=t[2];this.activeContactor.options.provider=e,this.activeContactor.options.base.model=a,this.activeContactor.loadAvatar(),await O.setLocalStorage()},toimg(){const t=this.chatWindowRef.getBoundingClientRect();t.height=this.chatWindowRef.scrollHeight,H(this.chatWindowRef,{windowHeight:1.2*t.height,width:t.width}).then(t=>{const e=t.toDataURL("image/png"),a=document.createElement("a");a.download="chat.png",a.href=e,a.click()})},async share(){await O.shareContactor(this.activeContactor.id)?this.$message({message:"分享链接已复制",type:"success"}):this.$message({message:"分享失败",type:"error"})},hasOpening(){return!!this.activeContactor.options.presetSettings?.opening},getFullMessages(){return this.hasOpening()?[{role:"other",content:[{type:"text",data:{text:this.activeContactor.options.presetSettings.opening}}],time:this.activeContactor.createTime},...this.activeContactor.messageChain]:this.activeContactor.messageChain},showTime(t){const e=this.getFullMessages(),a=e[t].time;if(0===t)return{show:!0,time:this.activeContactor.getShownTime(a)};return a-e[t-1].time>6e5?{show:!0,time:this.activeContactor.getShownTime(a)}:{show:!1,time:""}},separateTextAndImages(t){const e=/!\[([^\]]*)\]\((.*)\)/g;let a,s=[],o=0;for(;null!==(a=e.exec(t));){if(a.index>o){const e=t.slice(o,a.index).trim();e&&s.push({type:"text",data:{text:e}})}s.push({type:"image",data:{file:a[2]}}),o=e.lastIndex}if(o<t.length){const e=t.slice(o).trim();e&&s.push({type:"text",data:{text:e}})}return s},getChatwindowScrollheight(){var t=this.chatWindowRef.scrollTop,e=this.chatWindowRef.clientHeight,a=this.chatWindowRef.scrollHeight;return a-t/(a-e)*a},initContactor(t){t.active=!0,t.on("revMessage",t=>{this.activeContactor.messageChain.push(t),this.toupdate=!0}),t.on("delMessage",t=>{this.activeContactor.messageChain.splice(t,1),this.toupdate=!0}),t.on("updateMessage",()=>{this.$forceUpdate(),this.toupdate=!0,O.setLocalStorage()}),t.on("completeMessage",async t=>{const e=t.messageId,a=this.activeContactor.getMessageById(e);this.retryList.includes(e)&&(this.retryList=this.retryList.filter(t=>t!==e)),a.content.forEach((t,e)=>{if("text"===t.type&&"onebot"===this.activeContactor.platform){const s=this.separateTextAndImages(t.data.text);a.content.splice(e,1,...s)}}),this.toupdate=!0,this.$forceUpdate(),this.activeContactor.loadName(),O.setLocalStorage()})},disableContactor(t){t&&(t.active=!1,t.off("updateMessage"),t.off("revMessage"),t.off("delMessage"),t.off("completeMessage"))},getReplyText(t){let e="";const a=this.activeContactor.messageChain.find(e=>e.id===t);if(a)return a.content.forEach(t=>{"text"===t.type?e+=t.data.text:"image"===t.type&&(e+="[图片]")}),e.length>20?`> ${e.substr(0,20)}...`:`> ${e}`},imageLoaded(){this.scroll&&this.toButtom()},showMessageMenu(t,e){if("img"===t.target.tagName.toLowerCase()){const e=t.target.src;this.seletedImage=e}this.validMessageIndex="openai"===this.activeContactor.platform&&this.hasOpening()?e-1:e,t.preventDefault(),this.showMenu=!0,this.menuTop=t.clientY,this.menuLeft=t.clientX;const a=window.getSelection().toString();this.seletedText=a||""},toProfile(){this.$router.push({name:"profile_view",params:{id:this.activeContactor.id}})},scrollHandler(){const t=this.chatWindowRef.scrollTop,e=t>this.prevScrollTop,a=t<this.prevScrollTop;this.prevScrollTop=t,this.showMenu=!1,this.showemoji&&(this.showemoji=!1);const s=this.getChatwindowScrollheight();this.autoScroll=!(s>100);const o=s<=199;!e||this.autoScroll||o?(a||this.autoScroll||o)&&(this.showRollDown=!1):this.showRollDown=!0},getseletedMessage(){return this.activeContactor.messageChain[this.validMessageIndex]},handleMessageOption(t){const e=this.getseletedMessage();switch(t){case"retry":if("onebot"===this.activeContactor.platform)"user"===e.role?this.activeContactor.webSend(e):this.activeContactor.webSend({...e,role:"user"}),this.$message({message:"消息已重新发送",type:"success"});else{const t="user"===e.role?this.validMessageIndex+1:this.validMessageIndex;let a=this.activeContactor.messageChain[t];if(!a||"other"!==a.role){const e=this.activeContactor.getBaseUserContainer();e.role="other",this.activeContactor.insertMessage(e,t),a=e}if("retrying"===a.status)return void this.$message({message:"该消息正在重试中",type:"warning"});this.activeContactor.retryMessage(a.id),a.status="retrying",this.retryList.push(a.id)}this.toButtom();break;case"reply":"onebot"===this.activeContactor.platform?(this.repliedMessageId=e.id,this.$message({message:"已引用该消息",type:"success"})):this.userInput+=this.getReplyText(this.activeContactor.messageChain[this.validMessageIndex].id)+"\n\n";break;case"delete":this.activeContactor.messageChain.splice(this.validMessageIndex,1),O.setLocalStorage()}}}},[["render",function(t,m,p,v,g,f){const w=d("ContextMenu"),b=d("MdRenderer"),k=d("el-image"),S=d("ForwardMsg"),M=d("FileBlock"),I=d("ReasonBlock"),x=d("ToolCallBar"),P=d("InputEditor");return y(),e("div",j,[a("div",F,[a("div",{class:"return",onClick:m[0]||(m[0]=t=>f.tolist())},m[8]||(m[8]=[a("i",{class:"iconfont icon-return"},null,-1)])),a("div",{class:"name-area",onClick:m[1]||(m[1]=(...t)=>f.toProfile&&f.toProfile(...t))},[a("div",q,o(g.activeContactor.name),1),a("span",{class:i("delay-status "+f.getDelayStatus)},null,2),a("span",A,"当前延迟: "+o(g.currentDelay)+" ms",1)]),a("ul",N,[a("li",{class:"share",onClick:m[2]||(m[2]=t=>f.share())},m[9]||(m[9]=[a("i",{class:"iconfont icon-share"},null,-1)]))])]),a("div",{id:"main-messages-window",ref:"chatWindow",class:i({"message-window":!0,preview:g.preview})},[g.showRollDown?(y(),e("div",{key:0,id:"roll-buttom-button",style:c({bottom:g.inputBarTop+24+"px"}),onClick:m[3]||(m[3]=t=>f.toButtom(!0))},m[10]||(m[10]=[a("i",{class:"iconfont down1"},null,-1)]),4)):n("",!0),l(s(w,{type:"message",message:f.getseletedMessage(),"seleted-text":g.seletedText,"seleted-image":g.seletedImage,style:c(f.getMenuStyle),onMessageOption:f.handleMessageOption,onClose:m[4]||(m[4]=t=>g.showMenu=!1)},null,8,["message","seleted-text","seleted-image","style","onMessageOption"]),[[r,g.showMenu]]),(y(!0),e(h,null,u(f.activeMessageChain,(t,s)=>(y(),e("div",{key:`${g.activeContactor.id}-${t.id}`,ref_for:!0,ref:"message",class:"message-container"},[f.showTime(s).show?(y(),e("div",J,o(f.showTime(s).time),1)):n("",!0),a("div",{id:t.role,class:"message-body"},["mio_system"!==t.role?(y(),e("div",G,["other"===t.role?(y(),e("img",{key:0,src:g.activeContactor.avatar,alt:g.activeContactor.name,onClick:m[5]||(m[5]=(...t)=>f.toProfile&&f.toProfile(...t))},null,8,X)):(y(),e("img",{key:1,src:g.client.avatar,alt:g.client.name},null,8,Y))])):n("",!0),"mio_system"!==t.role?(y(),e("div",K,[a("div",Q,[("other"===t.role?g.activeContactor.title:g.client.title)?(y(),e("div",Z,o("other"===t.role?g.activeContactor.title:g.client.title),1)):n("",!0),a("div",tt,o("other"===t.role?g.activeContactor.name:g.client.name),1)]),a("div",{class:i(["content",t.status]),onMouseup:m[6]||(m[6]=(...t)=>f.handleMouseUp&&f.handleMouseUp(...t)),onContextmenu:t=>f.showMessageMenu(t,s)},[(y(!0),e(h,null,u(t.content,(o,i)=>(y(),e("div",{key:i,class:"inner-content"},["text"===o.type?(y(),C(b,{key:0,md:o.data.text,isStreaming:["pending","retrying"].includes(t.status)&&t.content.length-1===i,"custom-plugins":g.mioPlugins,"markdown-it-plugins":[{plugin:g.katexPlugin}]},null,8,["md","isStreaming","custom-plugins","markdown-it-plugins"])):"image"===o.type?(y(),C(k,{key:`${g.activeContactor.id}-${s}-${i}-${o.data.file}`,src:o.data.file,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[o.data.file],"initial-index":4,onLoad:f.imageLoaded,loading:"lazy",fit:"contain"},null,8,["src","preview-src-list","onLoad"])):"reply"===o.type?(y(),C(b,{key:2,md:f.getReplyText(o.data.id)},null,8,["md"])):"nodes"===o.type?(y(),C(S,{key:3,contactor:g.activeContactor,messages:o.data.messages},null,8,["contactor","messages"])):"file"===o.type?(y(),C(M,{key:4,"file-url":o.data.file},null,8,["file-url"])):"at"===o.type?(y(),e("span",at)):"reason"===o.type?(y(),C(I,{key:6,"end-time":o.data.endTime,"start-time":o.data.startTime,content:o.data.text},null,8,["end-time","start-time","content"])):"blank"===o.type?(y(),e("div",st,m[11]||(m[11]=[a("span",{class:"blank-loader"},null,-1)]))):"tool_call"===o.type?(y(),C(x,{key:8,"tool-call":o.data},null,8,["tool-call"])):n("",!0)]))),128))],42,et)])):(y(),e("div",ot,[a("div",it,o(t.content[0].data.text),1),a("div",nt,[a("i",{class:"iconfont close",onClick:t=>f.delSystemMessage(s)},null,8,lt)])]))],8,z)]))),128))],2),s(P,{ref:"inputEditor","active-contactor":g.activeContactor,"replied-message-id":g.repliedMessageId,onStroge:m[7]||(m[7]=t=>g.client.setLocalStorage()),onSetModel:f.setModel,onCleanScreen:f.cleanScreen,onCleanHistory:f.cleanHistory,onToButtom:f.toButtom},null,8,["active-contactor","replied-message-id","onSetModel","onCleanScreen","onCleanHistory","onToButtom"])])}],["__scopeId","data-v-65da11c2"]]),rt={class:"blank-view"};const dt=L({name:"BlankView",data:()=>({fullScreen:!1,client:O}),watch:{},created(){this.fullScreen=O.fullScreen},methods:{waiting(){this.$message({message:"此功能尚未开放",type:"warning"})}}},[["render",function(t,s,o,i,n,l){return y(),e("div",rt,s[0]||(s[0]=[a("div",{class:"upside-bar"},[a("div",{class:"options"})],-1)]))}],["__scopeId","data-v-29ea73df"]]),ht={key:0,id:"main"},ut={key:1,id:"main-mobile"},mt={key:2,id:"main-mobile",class:"mobile-chat"};const pt=L({components:{friendlist:U,blankView:dt},data(){return{onPhone:window.innerWidth<600,pagePath:this.$route.path,loaded:!1}},watch:{$route:function(t){this.pagePath=t.path}},mounted(){O.inited?this.loaded=!0:O.on("loaded",()=>{this.loaded=!0},!1)}},[["render",function(t,a,o,i,n,l){const c=d("friendlist"),r=d("router-view"),h=d("blankView");return n.onPhone?"/"===n.pagePath?(y(),e("div",ut,[n.loaded?(y(),C(c,{key:0})):(y(),C(h,{key:1}))])):(y(),e("div",mt,[n.loaded?(y(),C(r,{key:0})):(y(),C(h,{key:1}))])):(y(),e("div",ht,[s(c),n.loaded?(y(),C(r,{key:0})):(y(),C(h,{key:1}))]))}]]),vt={class:"profile-body"},gt={id:"profile"},yt={class:"profile-container"},Ct={class:"base-info"},ft={class:"base-info-avatar"},wt={class:"base-info-content"},bt={class:"name"},kt={class:"id"},St={class:"status"},Mt={class:"info-blocks"},It={class:"settings-block"},xt={class:"block-content"},Pt={class:"block-content-item"},Tt={class:"item-content"},Lt={class:"block-content-item"},$t={class:"item-content"},Vt={key:0,class:"block-content-item"},Rt={class:"item-content"},_t={key:1,class:"block-content-item"},Dt={class:"item-content"},Bt={class:"block-content-item"},Ot={class:"item-content"},Ut={class:"info-blocks"},Wt={class:"action-bar"},Et={class:"dialog-footer"};const Ht=L({components:{ContactorSettings:W},data(){const t=parseInt(this.$route.params.id),e=O.getContactor(t),a=E.getToolCallModes(),s=E.getLLMProviders(),o=E.getSafetySettingsParams(),i=Object.keys(o).map(t=>({value:t,label:t})),n=[];for(const l in E.llmTools){const t=E.llmTools[l],e=Object.keys(t).map(e=>({enabled:!1,...t[e]}));n.push({name:l,tools:e,collapsed:!0})}return{activeContactor:e,options:null,currentDelay:0,centerDialogVisible:!1,avatarPolicyList:[{value:0,label:"跟随模型"},{value:1,label:"自定义"}],namePolicyList:[{value:0,label:"跟随模型"},{value:1,label:"自定义"},{value:2,label:"对话摘要"}],isOnebot:"onebot"===e.platform,llmProviders:s,toolCallModes:a,safetyParams:o,safetySimpleValue:i,allLLMTools:n,basicInfo:null}},computed:{getDelayStatus(){return this.currentDelay>1e3?"high":this.currentDelay>500?"mid":this.currentDelay>100?"low":"ultra"},getAvatarPolicyValue(){return 1===this.basicInfo.avatarPolicy?"自定义":"跟随模型"}},watch:{"$route.params.id"(t){const e=parseInt(t);this.activeContactor=O.getContactor(e),this.activeContactor&&(this.isOnebot="onebot"===this.activeContactor.platform),this.initContactor()},options:{handler(t){t&&this.activeContactor&&(this.activeContactor.options=JSON.parse(JSON.stringify(t)),O.setLocalStorage())},deep:!0},basicInfo:{handler(t){t&&this.activeContactor&&(this.activeContactor.name=t.name,this.activeContactor.avatar=t.avatar,this.activeContactor.namePolicy=t.namePolicy,this.activeContactor.avatarPolicy=t.avatarPolicy,this.activeContactor.priority=t.priority?0:1,O.setLocalStorage())},deep:!0}},created(){this.initContactor()},mounted(){this.delayInterval=setInterval(()=>{this.currentDelay=O.socket.delay},3e3)},beforeUnmount(){this.delayInterval&&clearInterval(this.delayInterval)},methods:{initContactor(){this.options=JSON.parse(JSON.stringify(this.activeContactor.options));const{name:t,avatar:e,namePolicy:a,avatarPolicy:s,priority:o}=this.activeContactor;this.basicInfo={name:t,avatar:e,namePolicy:a,avatarPolicy:s,priority:1!==o},"onebot"===this.activeContactor.platform&&this.options.toolCallSettings&&(this.options.toolCallSettings.mode="none",this.options.toolCallSettings.tools=[])},handleUpdateOpenaiPresets(t){this.options&&this.options.presetSettings&&(this.options.presetSettings.history=t,this.$message({message:"预设历史记录已更新",type:"success"}))},async delContactor(){this.centerDialogVisible=!1,await O.rmContactor(this.activeContactor.id),this.$router.push("/")},handleProviderSwitched(t){this.activeContactor.loadAvatar()},getBaseInfoShownValue(t){},updateContactorName(){0===this.basicInfo.namePolicy&&(this.basicInfo.name=this.activeContactor.options.base.model)},updateContactorAvatar(){const{avatarPolicy:t}=this.basicInfo;this.activeContactor.avatarPolicy=t,this.basicInfo.avatar=this.activeContactor.loadAvatar()}}},[["render",function(t,l,c,r,m,p){const v=d("el-image"),g=d("el-input"),b=d("el-option"),k=d("el-select"),S=d("el-switch"),M=d("ContactorSettings"),I=d("el-button"),x=d("el-dialog");return y(),e("div",vt,[a("div",gt,[a("div",yt,[a("div",Ct,[a("div",ft,[s(v,{src:m.activeContactor.avatar,"preview-src-list":[m.activeContactor.avatar]},null,8,["src","preview-src-list"])]),a("div",wt,[a("div",bt,o(m.activeContactor.name),1),a("div",kt,"ID "+o(m.activeContactor.id),1),a("div",St,[a("span",{class:i("delay-status "+p.getDelayStatus)},null,2),l[10]||(l[10]=f(" 在线 "))])])]),a("div",Mt,[a("div",It,[l[16]||(l[16]=a("div",{class:"block-title"},"Bot 基本配置",-1)),a("div",xt,[a("div",Pt,[l[11]||(l[11]=a("div",{class:"item-title"},"昵称",-1)),a("div",Tt,[s(g,{modelValue:m.basicInfo.name,"onUpdate:modelValue":l[0]||(l[0]=t=>m.basicInfo.name=t),disabled:1!==m.basicInfo.namePolicy},null,8,["modelValue","disabled"])])]),a("div",Lt,[l[12]||(l[12]=a("div",{class:"item-title"},"头像",-1)),a("div",$t,[1!==m.basicInfo.avatarPolicy?(y(),C(g,{key:0,value:"跟随模型",disabled:!0})):(y(),C(g,{key:1,modelValue:m.basicInfo.avatar,"onUpdate:modelValue":l[1]||(l[1]=t=>m.basicInfo.avatar=t),disabled:m.isOnebot},null,8,["modelValue","disabled"]))])]),m.isOnebot?n("",!0):(y(),e("div",Vt,[l[13]||(l[13]=a("div",{class:"item-title"},"头像策略",-1)),a("div",Rt,[s(k,{modelValue:m.basicInfo.avatarPolicy,"onUpdate:modelValue":l[2]||(l[2]=t=>m.basicInfo.avatarPolicy=t),onChange:p.updateContactorAvatar},{default:w(()=>[(y(!0),e(h,null,u(m.avatarPolicyList,t=>(y(),C(b,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])])),m.isOnebot?n("",!0):(y(),e("div",_t,[l[14]||(l[14]=a("div",{class:"item-title"},"昵称策略",-1)),a("div",Dt,[s(k,{modelValue:m.basicInfo.namePolicy,"onUpdate:modelValue":l[3]||(l[3]=t=>m.basicInfo.namePolicy=t),onChange:p.updateContactorName},{default:w(()=>[(y(!0),e(h,null,u(m.namePolicyList,t=>(y(),C(b,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])])),a("div",Bt,[l[15]||(l[15]=a("div",{class:"item-title"},"会话置顶",-1)),a("div",Ot,[s(S,{modelValue:m.basicInfo.priority,"onUpdate:modelValue":l[4]||(l[4]=t=>m.basicInfo.priority=t)},null,8,["modelValue"])])])])])]),a("div",Ut,[m.isOnebot?n("",!0):(y(),C(M,{key:0,"model-value":m.options,"onUpdate:modelValue":l[5]||(l[5]=t=>m.options=t),"active-contactor-platform":m.activeContactor.platform,"llm-providers-list":m.llmProviders,"tool-call-modes-list":m.toolCallModes,"all-llm-tools-data":m.allLLMTools,"safety-settings-params":m.safetyParams,"safety-simple-value-options":m.safetySimpleValue,"presets-history-data":m.options.presetSettings?.history,onProviderChanged:p.handleProviderSwitched,onUpdatePresets:p.handleUpdateOpenaiPresets},null,8,["model-value","active-contactor-platform","llm-providers-list","tool-call-modes-list","all-llm-tools-data","safety-settings-params","safety-simple-value-options","presets-history-data","onProviderChanged","onUpdatePresets"]))])])]),a("div",Wt,[s(I,{plain:"",onClick:l[6]||(l[6]=e=>t.$router.push(`/chat/${m.activeContactor.id}`))},{default:w(()=>l[17]||(l[17]=[f(" 发送消息 ")])),_:1}),s(I,{type:"danger",plain:"",onClick:l[7]||(l[7]=t=>m.centerDialogVisible=!0)},{default:w(()=>l[18]||(l[18]=[f(" 删除好友 ")])),_:1}),s(x,{modelValue:m.centerDialogVisible,"onUpdate:modelValue":l[9]||(l[9]=t=>m.centerDialogVisible=t),title:"警告",width:"300",center:""},{footer:w(()=>[a("div",Et,[s(I,{onClick:l[8]||(l[8]=t=>m.centerDialogVisible=!1)},{default:w(()=>l[19]||(l[19]=[f("取消")])),_:1}),s(I,{type:"primary",onClick:p.delContactor},{default:w(()=>l[20]||(l[20]=[f(" 确认 ")])),_:1},8,["onClick"])])]),default:w(()=>[l[21]||(l[21]=a("span",null," 确认要删除此好友吗？该操作不可逆。 ",-1))]),_:1},8,["modelValue"])])])}],["__scopeId","data-v-2ffdcad2"]]),jt={id:"settings-view"};const Ft=L({name:"SettingsView",data:()=>({}),methods:{async reset(){await O.reset()&&(this.$message.success("重置成功"),setTimeout(()=>{window.location.reload()},500))},async resetCache(){await O.resetCache(),this.$message.success("清理缓存成功"),setTimeout(()=>{window.location.reload()},500)}}},[["render",function(t,a,o,i,n,l){const c=d("el-button");return y(),e("div",jt,[s(c,{type:"info",plain:"",onClick:a[0]||(a[0]=t=>l.reset())},{default:w(()=>a[2]||(a[2]=[f("重置全部")])),_:1}),s(c,{type:"info",plain:"",onClick:a[1]||(a[1]=t=>l.resetCache())},{default:w(()=>a[3]||(a[3]=[f("清理缓存")])),_:1})])}],["__scopeId","data-v-330c2ae1"]]),qt={class:"auth-view"},At={class:"container"},Nt={class:"controls"},Jt=L({__name:"AuthView",setup(t){const s=b(),o=b(!1),i=b(),n=async t=>{if(await I(()=>i.value.classList.add("active")),!o.value){o.value=!0;try{const e=await O.login(t);e&&(x.success(`成功以${e.is_admin?"管理员身份":"游客身份"}登录，欢迎使用!`),zt.currentRoute.value.query.redirect?zt.push(zt.currentRoute.value.query.redirect):zt.push("/"))}catch(e){x.error(e)}finally{await I(()=>i.value.classList.remove("active")),o.value=!1}}};function c(t){"Enter"===t.key&&n(s.value)}return k(()=>{removeEventListener("keydown",c)}),S(()=>{addEventListener("keydown",c),zt.currentRoute.value.query.key&&n(zt.currentRoute.value.query.key)}),(t,o)=>(y(),e("div",qt,[a("div",At,[a("div",{ref_key:"iconContainer",ref:i,class:"icon-container"},o[3]||(o[3]=[a("i",{class:"iconfont ChatGPT"},null,-1)]),512),o[4]||(o[4]=a("h1",{class:"title"},"登录验证",-1)),o[5]||(o[5]=a("p",{class:"hint"},"管理员开启了密码验证，请在下方填入访问码",-1)),l(a("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>s.value=t),type:"password",placeholder:"在此处填写访问码"},null,512),[[M,s.value]]),a("div",Nt,[a("button",{class:"later",onClick:o[1]||(o[1]=t=>n())},"游客登录"),a("button",{class:"login",onClick:o[2]||(o[2]=t=>n(s.value))},"登录")])])]))}},[["__scopeId","data-v-02fd5e8c"]]),zt=P({history:T("/"),routes:[{path:"/",name:"home",component:pt,children:[{path:"/",name:"blank",component:dt},{path:"/contactors",name:"contactors",component:dt},{path:"/chat/:id",name:"chat_view",component:ct},{path:"/profile/:id",name:"profile_view",component:Ht}]},{path:"/auth",name:"auth",component:Jt},{path:"/settings",name:"settings",component:Ft}]});zt.beforeEach(async t=>{if(!O.everLogin()&&"auth"!==t.name){x.warning("请先登录");return{name:"auth",query:"/settings"===t.path?null:{redirect:t.fullPath}}}});export{zt as r};
//# sourceMappingURL=views-C6MyOA0L.js.map
