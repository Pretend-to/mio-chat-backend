{"version":3,"mappings":"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","names":["BlankView","__vitePreload","Promise","resolve","then","__VITE_PRELOAD__","router","createRouter","history","createWebHistory","routes","path","name","component","HomeView$1","children","ChatView$1","ProfileView$1","AuthView$1","SettingsView$1","beforeEach","async","to","client","everLogin","ElMessage","warning","query","redirect","fullPath","_hoisted_1","id","_hoisted_2","class","_hoisted_3","_hoisted_4","_hoisted_5","key","_hoisted_7","_hoisted_9","_hoisted_10","_hoisted_12","_hoisted_14","_hoisted_15","style","width","height","position","_hoisted_20","_hoisted_21","_hoisted_22","components","MdRenderer","ContextMenu","ForwardMsg","InputEditor","ToolCallBar","FileBlock","ReasonBlock","data","shareId","contactor","preview","scroll","currentUrl","window","location","href","params","URL","searchParams","has","get","currentId","parseInt","this","$route","getContactor","Error","e","defaultId","contactList","$router","push","activeContactor","showwindow","showemoji","userInput","extraOptions","wraperPresets","selectedOption","currentDelay","toupdate","seletedText","seletedImage","retryList","showMenu","menuTop","menuLeft","validMessageIndex","repliedMessageId","autoScroll","fullScreen","chatWindowRef","prevScrollTop","showRollDown","inputBarTop","clearMessageTip","loadingIcon","katexPlugin","mioPlugins","plugin","codeBlockPlugin","mermaidPlugin","cursorPlugin","options","shape","imageViewerPlugin","computed","getMenuStyle","innerWidth","basicHeight","top","bottom","innerHeight","left","getDelayStatus","activeMessageChain","presetSettings","opening","role","content","type","text","time","createTime","messageChain","watch","newVal","oldVal","initContactor","toButtom","oldId","oldContactor","disableContactor","mounted","document","addEventListener","$refs","chatWindow","scrollHandler","element","querySelector","pageHeight","offsetTop","loadOriginalContactors","$message","message","updated","length","beforeUnmount","removeEventListener","methods","handleMouseUp","selectedText","getSelection","toString","clicked","setTimeout","elm","getElementById","scrollTo","scrollHeight","behavior","scrollToBottom","cleanScreen","updateFirstMessage","setLocalStorage","emit","cleanHistory","i","splice","makeSystemMessage","delSystemMessage","index","firstMessageIndex","isValidInput","input","test","waiting","tolist","setModel","list","provider","model","base","loadAvatar","toimg","rect","getBoundingClientRect","html2canvas","windowHeight","canvas","img","toDataURL","link","createElement","download","click","share","shareContactor","hasOpening","getFullMessages","showTime","thisTime","show","getShownTime","separateTextAndImages","markdownText","regex","matches","result","lastIndex","exec","textContent","slice","trim","file","getChatwindowScrollheight","scrollTop","clientHeight","active","on","$forceUpdate","messageId","rawMessage","getMessageById","includes","filter","item","forEach","platform","formatedMessage","loadName","off","getReplyText","find","String","imageLoaded","showMessageMenu","event","messageIndex","target","tagName","toLowerCase","imgSrc","src","preventDefault","clientY","clientX","currentSelectedText","toProfile","currentScrollTop","isScrollingDown","isScrollingUp","isAtBottom","getseletedMessage","handleMessageOption","option","webSend","targetIndex","validMessage","baseContainer","getBaseUserContainer","insertMessage","status","retryMessage","_openBlock","_createElementBlock","_createElementVNode","onClick","$options","args","_toDisplayString","$data","_normalizeClass","ref","_normalizeStyle","_createCommentVNode","_createVNode","_component_ContextMenu","onMessageOption","onClose","_Fragment","_renderList","ref_for","_hoisted_6","_hoisted_8","avatar","alt","_hoisted_11","title","_hoisted_13","onMouseup","onContextmenu","$event","elmIndex","_createBlock","_component_MdRenderer","md","theme","isStreaming","breaks","_hoisted_16","_component_ForwardMsg","messages","_component_FileBlock","_hoisted_17","_component_ReasonBlock","endTime","startTime","_hoisted_18","_cache","_component_ToolCallBar","_hoisted_19","_component_InputEditor","onStroge","onSetModel","onCleanScreen","onCleanHistory","onToButtom","created","friendlist","blankView","onPhone","pagePath","loaded","inited","_component_friendlist","_component_blankView","_component_router_view","_hoisted_23","_hoisted_24","_hoisted_25","ContactorSettings","toolCallModes","config","getToolCallModes","providers","getLLMProviders","safetyParams","getSafetySettingsParams","safetySimpleValue","Object","keys","map","value","label","allLLMTools","llmTools","toolsObject","toolsList","toolKey","enabled","tools","collapsed","centerDialogVisible","avatarPolicyList","namePolicyList","isOnebot","llmProviders","basicInfo","getAvatarPolicyValue","avatarPolicy","newId","handler","newOptions","JSON","parse","stringify","deep","newInfo","namePolicy","priority","delayInterval","setInterval","socket","delay","clearInterval","toolCallSettings","mode","handleUpdateOpenaiPresets","presets","delContactor","rmContactor","handleProviderSwitched","newProvider","getBaseInfoShownValue","updateContactorName","updateContactorAvatar","_component_el_image","_createTextVNode","_component_el_input","modelValue","disabled","_component_el_select","onChange","default","_withCtx","_component_el_option","_","_component_el_switch","_component_ContactorSettings","onProviderChanged","onUpdatePresets","_component_el_button","plain","_ctx","_component_el_dialog","center","footer","reset","success","reload","resetCache","accessCode","requesting","iconContainer","login","code","nextTick","classList","add","is_admin","currentRoute","error","remove","handleEnter","onUnmounted","onMounted"],"ignoreList":[],"sources":["../../../src/router/index.js","../../../src/views/ChatView.vue","../../../src/views/BlankView.vue","../../../src/views/HomeView.vue","../../../src/views/ProfileView.vue","../../../src/views/SettingsView.vue","../../../src/views/AuthView.vue"],"sourcesContent":["import { createRouter, createWebHistory } from \"vue-router\";\nimport { client } from \"@/lib/runtime.js\";\nimport { ElMessage } from \"element-plus\";\nconst ChatView = () => import(\"../views/ChatView.vue\");\nconst HomeView = () => import(\"../views/HomeView.vue\");\nconst ProfileView = () => import(\"../views/ProfileView.vue\");\nconst SettingsView = () => import(\"../views/SettingsView.vue\");\nconst AuthView = () => import(\"../views/AuthView.vue\");\nconst BlankView = () => import(\"../views/BlankView.vue\");\n\nconst router = createRouter({\n  history: createWebHistory(import.meta.env.BASE_URL),\n  routes: [\n    {\n      path: \"/\",\n      name: \"home\",\n      component: HomeView,\n      children: [\n        {\n          path: \"/\",\n          name: \"blank\",\n          component: BlankView,\n        },\n        {\n          path: \"/contactors\",\n          name: \"contactors\",\n          component: BlankView,\n        },\n        {\n          path: \"/chat/:id\",\n          name: \"chat_view\",\n          component: ChatView,\n        },\n        {\n          path: \"/profile/:id\",\n          name: \"profile_view\",\n          component: ProfileView,\n        },\n      ],\n    },\n    {\n      path: \"/auth\",\n      name: \"auth\",\n      component: AuthView,\n    },\n    {\n      path: \"/settings\",\n      name: \"settings\",\n      component: SettingsView,\n    },\n  ],\n});\n\nrouter.beforeEach(async (to) => {\n  const everLogin = client.everLogin();\n  if (\n    // 检查用户是否已登录\n    !everLogin &&\n    // ❗️ 避免无限重定向\n    to.name !== \"auth\"\n  ) {\n    console.log(\n      `everLogin: ${everLogin} to.name!== auth: ${to.name !== \"auth\"}`,\n    );\n    ElMessage.warning(\"请先登录\");\n    // 把原本要去的地址 完整的传递给 login?redirect=\n    const query = to.path === \"/settings\" ? null : { redirect: to.fullPath };\n    return { name: \"auth\", query };\n  }\n});\n\nexport default router;\n","<script>\nimport ForwardMsg from \"@/components/ForwardMsg.vue\";\nimport InputEditor from \"@/components/InputEditor.vue\";\nimport FileBlock from \"@/components/FileBlock.vue\";\nimport ToolCallBar from \"@/components/ToolCallBar.vue\";\nimport ReasonBlock from \"@/components/ReasonBlock.vue\";\nimport ContextMenu from \"@/components/ContextMenu.vue\";\nimport MdRenderer from \"mio-previewer\";\nimport { mermaidPlugin, codeBlockPlugin, cursorPlugin, imageViewerPlugin } from 'mio-previewer/plugins/custom';\nimport { katexPlugin } from 'mio-previewer/plugins/markdown-it';\nimport \"emoji-picker-element\";\nimport html2canvas from \"html2canvas\";\nimport { client } from \"@/lib/runtime.js\";\n\nexport default {\n  components: {\n    MdRenderer,\n    ContextMenu,\n    ForwardMsg,\n    InputEditor,\n    ToolCallBar,\n    FileBlock,\n    ReasonBlock,\n  },\n  data() {\n    let preview = false;\n    let shareId = undefined;\n    let contactor = undefined;\n    let scroll = true;\n\n    // 获取当前页面的URL\n    const currentUrl = window.location.href;\n    // 创建一个URL对象\n    const url = new URL(currentUrl);\n    // 获取URL参数\n    const params = url.searchParams;\n    // 检查URL参数是否有preview参数\n    if (params.has(\"preview\")) {\n      if (params.get(\"preview\") === \"true\") {\n        preview = true;\n      }\n    }\n    // 检查URL参数是否有shareId参数\n    if (params.has(\"shareId\")) {\n      shareId = params.get(\"shareId\");\n    }\n    if (params.has(\"scroll\")) {\n      scroll = params.get(\"scroll\") || \"true\";\n    }\n\n    const currentId = parseInt(this.$route.params.id);\n    try {\n      contactor = client.getContactor(currentId);\n      if (!contactor) {\n        throw new Error(\"找不到联系人\");\n      }\n    } catch (e) {\n      const defaultId = client.contactList[0].id;\n      this.$router.push({\n        path: `/chat/${defaultId}`,\n        query: {\n          preview,\n          shareId,\n        },\n      });\n      contactor = client.getContactor(defaultId);\n    }\n    const mioPlugins = [{\n      plugin: codeBlockPlugin,\n    },\n    {\n      plugin: mermaidPlugin,\n    },\n    {\n      plugin: cursorPlugin,\n      options: {\n        shape: 'circle'\n      }\n    },\n    {\n      plugin: imageViewerPlugin,\n    }\n  ]\n\n    return {\n      scroll,\n      preview,\n      shareId,\n      activeContactor: contactor,\n      showwindow: true,\n      showemoji: false,\n      userInput: \"\",\n      client: client,\n      extraOptions: [],\n      wraperPresets: {},\n      selectedOption: null,\n      currentDelay: 0,\n      toupdate: false,\n      seletedText: \"\",\n      seletedImage: \"\",\n      retryList: [],\n      showMenu: false,\n      menuTop: 0,\n      menuLeft: 0,\n      validMessageIndex: -1,\n      repliedMessageId: -1,\n      autoScroll: false,\n      fullScreen: false,\n      chatWindowRef: null,\n      prevScrollTop: 0,\n      showRollDown: false,\n      inputBarTop: 0,\n      clearMessageTip: \"以上的对话记录已清除\",\n      loadingIcon: \"<span id='message-loading-icon'></span>\",\n      katexPlugin,\n      mioPlugins\n    };\n  },\n  computed: {\n    getMenuStyle() {\n      // 判断屏幕宽度是否小于768px\n      if (window.innerWidth < 768) {\n        const basicHeight = 160;\n        // 检查向上是否超出屏幕高度\n        if (this.menuTop - basicHeight < 0) {\n          return {\n            top: basicHeight + \"px\",\n          };\n        }\n        return {\n          bottom: window.innerHeight - this.menuTop + 16 + \"px\",\n        };\n      } else {\n        // 长度超出屏幕宽度，就向左移动\n        if (this.menuLeft + 110 > window.innerWidth) {\n          return {\n            top: this.menuTop + \"px\",\n            left: this.menuLeft - 110 + \"px\",\n          };\n        } else {\n          return {\n            top: this.menuTop + \"px\",\n            left: this.menuLeft + \"px\",\n          };\n        }\n      }\n    },\n    getDelayStatus() {\n      return this.currentDelay > 1000\n        ? \"high\"\n        : this.currentDelay > 500\n          ? \"mid\"\n          : this.currentDelay > 100\n            ? \"low\"\n            : \"ultra\";\n    },\n    activeMessageChain() {\n      return this.activeContactor.options.presetSettings?.opening\n        ? [\n            {\n              role: \"other\",\n              content: [\n                {\n                  type: \"text\",\n                  data: {\n                    text: this.activeContactor.options.presetSettings.opening,\n                  },\n                },\n              ],\n              time: this.activeContactor.createTime,\n            },\n            ...this.activeContactor.messageChain,\n          ]\n        : this.activeContactor.messageChain;\n    },\n  },\n  watch: {\n    [\"$route.params.id\"](newVal, oldVal) {\n      const currentId = parseInt(newVal);\n      const contactor = client.getContactor(currentId);\n      this.activeContactor = contactor;\n      this.initContactor(this.activeContactor);\n      if (this.chatWindowRef) this.toButtom();\n      if (oldVal) {\n        const oldId = parseInt(oldVal);\n        const oldContactor = client.getContactor(oldId);\n        this.disableContactor(oldContactor);\n      }\n    },\n  },\n  async mounted() {\n    document.addEventListener(\"click\", () => {\n      this.showMenu = false;\n      this.seletedText = \"\";\n      this.seletedImage = \"\";\n      // if( this.showemoji) this.showemoji = false;\n    });\n    this.chatWindowRef = this.$refs.chatWindow;\n    this.chatWindowRef.addEventListener(\"scroll\", this.scrollHandler);\n    if (!this.preview && this.scroll) this.toButtom();\n    this.scroll = true;\n    this.initContactor(this.activeContactor);\n    this.fullScreen = this.client.fullScreen;\n    // setInterval(() => {\n    //   this.currentDelay = this.client.socket.delay;\n    // }, 3000);\n    // 获取.input-bar在页面中的高度，给inputBarTop赋值\n    const element = document.querySelector(\".input-bar\");\n    if (element) {\n      // 获取页面高度\n      const pageHeight = window.innerHeight;\n      this.inputBarTop = pageHeight - element.offsetTop;\n      console.log(this.inputBarTop);\n    }\n\n\n    if (this.shareId) {\n      const loadAble = await client.loadOriginalContactors(this.shareId);\n      if (loadAble) {\n        this.$router.push({\n          path: \"/chat/\" + this.shareId,\n          query: {\n            preview: this.preview,\n            scroll: false,\n          },\n        });\n      } else {\n        this.$message({\n          message: \"分享链接已失效\",\n          type: \"error\",\n        });\n      }\n    }\n  },\n  updated() {\n    if (this.toupdate && this.autoScroll && this.retryList.length === 0) {\n      this.toButtom();\n      this.toupdate = false;\n    }\n  },\n  beforeUnmount() {\n    // 移除事件监听\n    this.disableContactor(this.activeContactor);\n    this.chatWindowRef.removeEventListener(\"scroll\", this.scrollHandler);\n  },\n  methods: {\n    handleMouseUp() {\n      const selectedText = window.getSelection().toString();\n      if (selectedText) {\n        this.seletedText = selectedText;\n        console.log(\"选中的文本：\" + selectedText);\n      }\n    },\n    toButtom(clicked) {\n      setTimeout(() => {\n        const scrollToBottom = () => {\n          const elm =\n            this.chatWindowRef ||\n            document.getElementById(\"main-messages-window\");\n          if (!elm) return;\n\n          // 使用平滑滚动 or 立即滚动\n          elm.scrollTo({\n            top: elm.scrollHeight,\n            behavior: clicked ? \"smooth\" : \"instant\",\n          });\n        };\n        scrollToBottom();\n      }, 1);\n    },\n    cleanScreen() {\n      this.activeContactor.messageChain = [];\n      this.activeContactor.updateFirstMessage();\n      client.setLocalStorage(); //持久化存储\n      this.activeContactor.emit(\"updateMessageSummary\");\n\n      this.toupdate = true;\n      this.$message({ message: \"已清除会话记录\", type: \"success\" });\n    },\n    cleanHistory() {\n      this.activeContactor.updateFirstMessage();\n      this.$message({\n        message: \"上下文信息已清除，之后的请求将不再记录上文记录\",\n        type: \"success\",\n      });\n      // 先看看之前有没有清除提示\n      for (let i = this.activeContactor.messageChain.length - 1; i >= 0; i--) {\n        const message = this.activeContactor.messageChain[i];\n        // role 为 \"mio_system\"\n        if (\n          message.role === \"mio_system\" &&\n          message.content[0].type === \"text\" &&\n          message.content[0].data.text === this.clearMessageTip\n        ) {\n          this.activeContactor.messageChain.splice(i, 1);\n        }\n      }\n      this.activeContactor.makeSystemMessage(this.clearMessageTip);\n      // 持久化\n      client.setLocalStorage();\n    },\n\n    delSystemMessage(index) {\n      const message = this.activeContactor.messageChain[index];\n      // 判断是否是清除提示\n      if (\n        message.content[0].type === \"text\" &&\n        message.content[0].data.text === this.clearMessageTip\n      ) {\n        this.activeContactor.firstMessageIndex = 0;\n      }\n      this.activeContactor.messageChain.splice(index, 1);\n      // 持久化\n      client.setLocalStorage();\n    },\n\n    isValidInput(input) {\n      // 使用正则表达式检查用户输入是否只包含换行符和空格\n      const regex = /^[ \\n]+$/;\n      const result = !regex.test(input);\n      return result;\n    },\n    waiting() {\n      this.$message({ message: \"此功能尚未开放\", type: \"warning\" });\n    },\n\n    tolist() {\n      this.$router.push({ name: \"home\" });\n    },\n\n    async setModel(list) {\n      const provider = list[0];\n      const model = list[2];\n      this.activeContactor.options.provider = provider;\n      this.activeContactor.options.base.model = model;\n      this.activeContactor.loadAvatar();\n      await client.setLocalStorage(); //持久化存储\n    },\n    toimg() {\n      // 使用html2canvas把 this.chatWindowRef 渲染为图片\n      const rect = this.chatWindowRef.getBoundingClientRect();\n      rect.height = this.chatWindowRef.scrollHeight;\n\n      html2canvas(this.chatWindowRef, {\n        windowHeight: rect.height * 1.2,\n        width: rect.width,\n        // 例如: allowTaint: true, backgroundColor: null\n      }).then((canvas) => {\n        // 将canvas转换为图片\n        const img = canvas.toDataURL(\"image/png\");\n        // 创建一个a标签，并设置下载属性和下载链接\n        const link = document.createElement(\"a\");\n        link.download = \"chat.png\";\n        link.href = img;\n        // 模拟点击下载\n        link.click();\n      });\n    },\n    async share() {\n      const shareResult = await client.shareContactor(this.activeContactor.id);\n      if (shareResult) {\n        this.$message({\n          message: \"分享链接已复制\",\n          type: \"success\",\n        });\n      } else {\n        this.$message({\n          message: \"分享失败\",\n          type: \"error\",\n        });\n      }\n    },\n    hasOpening() {\n      return this.activeContactor.options.presetSettings?.opening\n        ? true\n        : false;\n    },\n    getFullMessages() {\n      return this.hasOpening()\n        ? [\n            {\n              role: \"other\",\n              content: [\n                {\n                  type: \"text\",\n                  data: {\n                    text: this.activeContactor.options.presetSettings.opening,\n                  },\n                },\n              ],\n              time: this.activeContactor.createTime,\n            },\n            ...this.activeContactor.messageChain,\n          ]\n        : this.activeContactor.messageChain;\n    },\n    showTime(index) {\n      const list = this.getFullMessages();\n      const thisTime = list[index].time;\n      if (index === 0) {\n        return {\n          show: true,\n          time: this.activeContactor.getShownTime(thisTime),\n        };\n      } else {\n        const earlyTime = list[index - 1].time;\n        if (thisTime - earlyTime > 600000) {\n          return {\n            show: true,\n            time: this.activeContactor.getShownTime(thisTime),\n          };\n        } else {\n          return {\n            show: false,\n            time: \"\",\n          };\n        }\n      }\n    },\n    separateTextAndImages(markdownText) {\n      // 使用正则表达式匹配Markdown图片格式\n      const regex = /!\\[([^\\]]*)\\]\\((.*)\\)/g;\n      let result = [];\n      let lastIndex = 0;\n\n      // 查找所有匹配的图片\n      let matches;\n      while ((matches = regex.exec(markdownText)) !== null) {\n        // 处理匹配到的文本部分\n        if (matches.index > lastIndex) {\n          const textContent = markdownText\n            .slice(lastIndex, matches.index)\n            .trim();\n          if (textContent) {\n            result.push({\n              type: \"text\",\n              data: {\n                text: textContent,\n              },\n            });\n          }\n        }\n\n        // 处理匹配到的图片部分\n        result.push({\n          type: \"image\",\n          data: {\n            // file: matches[2].length > 200 ? matches[2] : `/api/proxy?url=${matches[2]}`,\n            file: matches[2],\n          },\n        });\n\n        // 更新lastIndex到当前匹配结束的位置\n        lastIndex = regex.lastIndex;\n      }\n\n      // 处理最后一部分文本（如果有的话）\n      if (lastIndex < markdownText.length) {\n        const textContent = markdownText.slice(lastIndex).trim();\n        if (textContent) {\n          result.push({\n            type: \"text\",\n            data: {\n              text: textContent,\n            },\n          });\n        }\n      }\n\n      return result;\n    },\n\n    getChatwindowScrollheight() {\n      var scrollTop = this.chatWindowRef.scrollTop; // 当前滚动条的垂直位置\n      var clientHeight = this.chatWindowRef.clientHeight; // 可视区域高度\n      var scrollHeight = this.chatWindowRef.scrollHeight; // 内容总高度\n\n      // 计算滚动位置的实际像素长度\n      var scrollPercentage = scrollTop / (scrollHeight - clientHeight);\n      var height = scrollPercentage * scrollHeight;\n\n      return scrollHeight - height;\n    },\n\n    initContactor(contactor) {\n      contactor.active = true;\n\n      contactor.on(\"revMessage\", (message) => {\n        this.activeContactor.messageChain.push(message);\n        this.toupdate = true;\n      });\n      contactor.on(\"delMessage\", (index) => {\n        console.log(`删除消息${index}`);\n        // 从消息链中删除消息\n        this.activeContactor.messageChain.splice(index, 1);\n        this.toupdate = true;\n      });\n\n      contactor.on(\"updateMessage\", () => {\n        this.$forceUpdate();\n        this.toupdate = true;\n        client.setLocalStorage(); //持久化存储\n      });\n\n      contactor.on(`completeMessage`, async (e) => {\n        const messageId = e.messageId;\n        const rawMessage = this.activeContactor.getMessageById(messageId);\n\n        if (this.retryList.includes(messageId)) {\n          this.retryList = this.retryList.filter((item) => item !== messageId);\n        }\n\n        rawMessage.content.forEach((element, index) => {\n          if (\n            element.type === \"text\" &&\n            this.activeContactor.platform === \"onebot\"\n          ) {\n            const formatedMessage = this.separateTextAndImages(\n              element.data.text,\n            );\n            // 把 formatedMessage 里的元素展开到 index 这个位置\n            rawMessage.content.splice(index, 1, ...formatedMessage);\n          }\n        });\n\n        this.toupdate = true;\n        this.$forceUpdate();\n        this.activeContactor.loadName();\n        client.setLocalStorage(); //持久化存储\n        console.log(e);\n      });\n    },\n    disableContactor(contactor) {\n      if (contactor) {\n        contactor.active = false;\n        contactor.off(`updateMessage`);\n        contactor.off(`revMessage`);\n        contactor.off(`delMessage`);\n        contactor.off(`completeMessage`);\n      }\n    },\n    getReplyText(id) {\n      let content = \"\";\n      const message = this.activeContactor.messageChain.find(\n        (item) => item.id === id || String(item.id) === String(id),\n      );\n      if (message) {\n        message.content.forEach((element) => {\n          if (element.type === \"text\") {\n            content += element.data.text;\n          } else if (element.type === \"image\") {\n            content += \"[图片]\";\n          }\n        });\n        // if (content.length > 20) {\n        //   return `${content.substr(0, 20)}...`;\n        // } else {\n        //   return `${content}`;\n        // }\n        return content.trim().slice(0, 20);\n      } else {\n        console.log(\"用户引用的消息不存在\");\n        // 打印消息列表和索引的id\n        console.log(this.activeContactor.messageChain);\n        console.log(\"引用的消息id：\" + id);\n        return \"[消息已删除] \";\n      }\n    },\n    imageLoaded() {\n      this.scroll && this.toButtom();\n    },\n    showMessageMenu(event, messageIndex) {\n      // 确定右击的元素类型\n      if (event.target.tagName.toLowerCase() === \"img\") {\n        const imgElement = event.target;\n        const imgSrc = imgElement.src;\n        this.seletedImage = imgSrc;\n      } else {\n        console.log(\"用户右击了非图片元素\");\n      }\n      this.validMessageIndex =\n        this.activeContactor.platform === \"openai\" && this.hasOpening()\n          ? messageIndex - 1\n          : messageIndex;\n      event.preventDefault();\n      this.showMenu = true;\n      this.menuTop = event.clientY;\n      this.menuLeft = event.clientX;\n\n      const currentSelectedText = window.getSelection().toString();\n      if (currentSelectedText) {\n        this.seletedText = currentSelectedText;\n      } else {\n        this.seletedText = \"\";\n      }\n    },\n    toProfile() {\n      this.$router.push({\n        name: \"profile_view\",\n        params: {\n          id: this.activeContactor.id,\n        },\n      });\n      // 弹出维护提示\n      // this.$message({\n      //   message: \"此功能正在维护中\",\n      //   type: \"warning\",\n      // });\n    },\n    scrollHandler() {\n      // 获取当前的 scrollTop\n      const currentScrollTop = this.chatWindowRef.scrollTop;\n\n      // 判断滚动方向\n      // 如果当前 scrollTop 大于上一次的 scrollTop，说明是向下滑动\n      const isScrollingDown = currentScrollTop > this.prevScrollTop;\n      // 如果当前 scrollTop 小于上一次的 scrollTop，说明是向上滑动\n      const isScrollingUp = currentScrollTop < this.prevScrollTop;\n      // 如果相等，通常意味着没有实际的滚动位移，或者是一些内部事件\n\n      // 更新上一次的 scrollTop 为当前值，为下一次滚动做准备\n      this.prevScrollTop = currentScrollTop;\n\n      // --- 你原有的逻辑 (现在你可以根据需要使用 isScrollingDown 或 isScrollingUp) ---\n      this.showMenu = false; // 隐藏菜单\n      if (this.showemoji) this.showemoji = false; // 隐藏表情\n\n      const scrollHeight = this.getChatwindowScrollheight(); // 获取总滚动高度\n\n      this.autoScroll = scrollHeight > 100 ? false : true;\n\n      const isAtBottom = scrollHeight <= 200 - 1; // 留一个小的容差，避免浮点数问题\n\n      if (isScrollingDown && !this.autoScroll && !isAtBottom) {\n        this.showRollDown = true;\n      } else if (isScrollingUp || this.autoScroll || isAtBottom) {\n        this.showRollDown = false;\n      }\n    },\n    getseletedMessage() {\n      return this.activeContactor.messageChain[this.validMessageIndex];\n    },\n    handleMessageOption(option) {\n      const message = this.getseletedMessage();\n      switch (option) {\n        case \"retry\":\n          if (this.activeContactor.platform === \"onebot\") {\n            // 重新发送一样的消息\n            if (message.role === \"user\") {\n              this.activeContactor.webSend(message);\n            } else {\n              this.activeContactor.webSend({\n                ...message,\n                role: \"user\",\n              });\n            }\n            this.$message({ message: \"消息已重新发送\", type: \"success\" });\n          } else {\n            const targetIndex =\n              message.role === \"user\"\n                ? this.validMessageIndex + 1\n                : this.validMessageIndex;\n\n            let validMessage = this.activeContactor.messageChain[targetIndex];\n            if (!validMessage || validMessage.role !== \"other\") {\n              // 是用户发送且下一条消息被删除,先插入一条空消息\n              const baseContainer = this.activeContactor.getBaseUserContainer();\n              baseContainer.role = \"other\";\n              this.activeContactor.insertMessage(baseContainer, targetIndex);\n              validMessage = baseContainer;\n            }\n            if (validMessage.status === \"retrying\") {\n              this.$message({\n                message: \"该消息正在重试中\",\n                type: \"warning\",\n              });\n              return;\n            }\n            this.activeContactor.retryMessage(validMessage.id);\n            validMessage.status = \"retrying\";\n            this.retryList.push(validMessage.id);\n          }\n          this.toButtom();\n          break;\n        case \"reply\":\n          if (this.activeContactor.platform === \"onebot\") {\n            this.repliedMessageId = message.id;\n            this.$message({ message: \"已引用该消息\", type: \"success\" });\n          } else {\n            this.userInput +=\n              this.getReplyText(\n                this.activeContactor.messageChain[this.validMessageIndex].id,\n              ) + \"\\n\\n\";\n          }\n          break;\n        case \"delete\":\n          this.activeContactor.messageChain.splice(this.validMessageIndex, 1);\n          client.setLocalStorage();\n          break;\n        default:\n          break;\n      }\n    },\n  },\n};\n</script>\n\n<template>\n  <div id=\"chat-window\">\n    <div class=\"upside-bar\">\n      <div class=\"return\" @click=\"tolist()\">\n        <i class=\"iconfont icon-return\"></i>\n      </div>\n      <div class=\"name-area\" @click=\"toProfile\">\n        <div class=\"contactor-name\">{{ activeContactor.name }}</div>\n        <span :class=\"'delay-status ' + getDelayStatus\"></span>\n        <span class=\"delay-num\">当前延迟: {{ currentDelay }} ms</span>\n      </div>\n      <ul class=\"options\">\n        <li class=\"share\" @click=\"share()\">\n          <i class=\"iconfont icon-share\"></i>\n        </li>\n      </ul>\n    </div>\n    <div\n      id=\"main-messages-window\"\n      ref=\"chatWindow\"\n      :class=\"{\n        'message-window': true,\n        preview: preview,\n      }\"\n    >\n      <div\n        v-if=\"showRollDown\"\n        id=\"roll-buttom-button\"\n        :style=\"{ bottom: inputBarTop + 24 + 'px' }\"\n        @click=\"toButtom(true)\"\n      >\n        <i class=\"iconfont down1\"></i>\n      </div>\n      <ContextMenu\n        v-show=\"showMenu\"\n        type=\"message\"\n        :message=\"getseletedMessage()\"\n        :seleted-text\n        :seleted-image\n        :style=\"getMenuStyle\"\n        @message-option=\"handleMessageOption\"\n        @close=\"showMenu = false\"\n      />\n      <div\n        v-for=\"(item, index) of activeMessageChain\"\n        :key=\"`${activeContactor.id}-${item.id}`\"\n        ref=\"message\"\n        class=\"message-container\"\n      >\n        <div v-if=\"showTime(index).show\" class=\"message-time\">\n          {{ showTime(index).time }}\n        </div>\n        <div :id=\"item.role\" class=\"message-body\">\n          <div v-if=\"item.role !== 'mio_system'\" class=\"avatar\">\n            <img\n              v-if=\"item.role === 'other'\"\n              :src=\"activeContactor.avatar\"\n              :alt=\"activeContactor.name\"\n              @click=\"toProfile\"\n            />\n            <img v-else :src=\"client.avatar\" :alt=\"client.name\" />\n          </div>\n          <div v-if=\"item.role !== 'mio_system'\" class=\"msg\">\n            <div class=\"wholename\">\n              <div\n                v-if=\"\n                  item.role === 'other' ? activeContactor.title : client.title\n                \"\n                class=\"title\"\n              >\n                {{\n                  item.role === \"other\" ? activeContactor.title : client.title\n                }}\n              </div>\n              <div class=\"name\">\n                {{ item.role === \"other\" ? activeContactor.name : client.name }}\n              </div>\n            </div>\n            <div\n              :class=\"['content', item.status]\"\n              @mouseup=\"handleMouseUp\"\n              @contextmenu=\"showMessageMenu($event, index)\"\n            >\n              <div\n                v-for=\"(element, elmIndex) of item.content\"\n                :key=\"elmIndex\"\n                class=\"inner-content\"\n              >\n                <MdRenderer\n                  v-if=\"element.type === 'text'\"\n                  :md=\"element.data.text\"\n                  :theme=\"'github'\"\n                  :isStreaming=\"\n                    ['pending', 'retrying'].includes(item.status) &&\n                    item.content.length - 1 === elmIndex\n                  \"\n                  :custom-plugins=\"mioPlugins\"\n                  :markdown-it-plugins=\"[{plugin: katexPlugin}]\"\n                  :markdown-it-options=\"{breaks: activeContactor.platform === 'onebot'}\"\n                />\n                <MdRenderer\n                  v-if=\"element.type === 'image'\"\n                  :md=\"`![image](${element.data.file})`\"\n                  :custom-plugins=\"mioPlugins\"\n                  :theme=\"'github'\"\n                  :key=\"element.data.file\"\n                />\n                <div\n                  v-else-if=\"element.type === 'reply'\"\n                  class=\"reply-block\"\n                >\n                  {{ getReplyText(element.data.id) }}\n                </div>\n                <ForwardMsg\n                  v-else-if=\"element.type === 'nodes'\"\n                  :contactor=\"activeContactor\"\n                  :messages=\"element.data.messages\"\n                />\n                <FileBlock\n                  v-else-if=\"element.type === 'file'\"\n                  :file-url=\"element.data.file\"\n                />\n                <span v-else-if=\"element.type === 'at'\" />\n                <ReasonBlock\n                  v-else-if=\"element.type === 'reason'\"\n                  :end-time=\"element.data.endTime\"\n                  :start-time=\"element.data.startTime\"\n                  :content=\"element.data.text\"\n                />\n                <div\n                  v-else-if=\"element.type === 'blank'\"\n                  class=\"blank-message\"\n                  style=\"width: 10rem; height: 28.8px; position: relative\"\n                >\n                  <span class=\"blank-loader\"></span>\n                </div>\n                <ToolCallBar\n                  v-else-if=\"element.type === 'tool_call'\"\n                  :tool-call=\"element.data\"\n                />\n              </div>\n            </div>\n          </div>\n          <div v-else class=\"system-message\">\n            <div class=\"system-message-content\">\n              {{ item.content[0].data.text }}\n            </div>\n            <div class=\"system-message-button\">\n              <i class=\"iconfont close\" @click=\"delSystemMessage(index)\"></i>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <InputEditor\n      ref=\"inputEditor\"\n      :active-contactor\n      :replied-message-id\n      @stroge=\"client.setLocalStorage()\"\n      @set-model=\"setModel\"\n      @clean-screen=\"cleanScreen\"\n      @clean-history=\"cleanHistory\"\n      @to-buttom=\"toButtom\"\n    />\n  </div>\n</template>\n\n<style lang=\"sass\" scoped>\n$mobile: 600px\n$icon-hover: #09f\n\n.preview\n    position: fixed\n    top: 0\n    left: 0\n    width: 100vw\n    height: 100vh\n    z-index: 10000\n\n#chat-window\n    z-index: 1\n    min-width: 0.0625rem\n    position: relative\n    display: flex\n    flex-grow: 1\n    background-color: #f2f2f2\n    flex-direction: column\n\n    @media (max-width: $mobile)\n        height: 100%\n\n.upside-bar\n    flex-basis: 4rem\n    flex-shrink: 0\n    width: 100%\n    display: flex\n    align-items: flex-end\n    justify-content: flex-start\n    border-bottom: 0.0625rem solid #ebebeb\n    -webkit-app-region: drag\n\n    @media (max-width: $mobile)\n      position: fixed\n      height: 4rem\n      z-index: 1000\n      background-color: hsla(0, 0%, 100%, 0.8)\n      backdrop-filter: blur(0.5rem)\n\n    .return\n        display: none\n\n        &:hover\n            color: $icon-hover\n\n        @media (max-width: $mobile)\n            display: block\n            margin-left: 1rem\n            margin-bottom: .8rem\n\n    .name-area\n        cursor: pointer\n        position: relative\n        display: flex\n        align-items: center\n        flex-basis: 10rem\n        flex-grow: 1\n        justify-content: flex-start\n        margin: 0 0 .5rem 1rem\n\n        .contactor-name\n            text-overflow: ellipsis\n            white-space: nowrap\n            overflow: hidden\n            max-width: 10rem\n\n        .delay-status\n            width: .8rem\n            height: .8rem\n            border-radius: 50%\n            margin-left: .5rem\n            position: relative\n            top: .2rem\n\n            @media screen and (max-width: $mobile)\n              display: none\n\n\n            &:hover + .delay-num\n                display: inline-block\n\n            &.ultra\n                background-color: rgb(53, 233, 146)\n\n            &.low\n                background-color: rgb(255, 204, 0)\n\n            &.mid\n                background-color: rgb(255, 102, 102)\n\n            &.high\n                background-color: #ccc\n\n        .delay-num\n            display: none\n            position: absolute\n            font-size: 0.8rem\n            bottom: 0rem\n            background-color: #fff\n            border: 1px dashed #000\n            border-radius: 0.25rem\n            padding: 0.125rem 0.25rem\n            margin-left: 1rem\n            white-space: nowrap\n\n    .options\n        flex-basis: 10rem\n        display: flex\n        height: 2rem\n        flex-wrap: nowrap\n        flex-direction: row-reverse\n        align-items: flex-end\n        margin: 0 1rem .5rem 0\n\n        li\n            margin-left: 0.5rem\n            color: #000\n            font-weight: 580\n\n            &:hover\n              color: $icon-hover\n\n            i\n                font-size: 1.25rem\n\n\n.black-overlay\n    position: fixed\n    top: 0\n    left: 0\n    width: 100%\n    height: 100%\n    background-color: rgba(0, 0, 0, 0.4)\n    z-index: 1001\n/* z-index 属性设置元素的堆叠顺序。*/\n\n#roll-buttom-button\n    position: fixed\n    right: 0.5rem\n    cursor: pointer\n    display: flex\n    z-index: 1000\n    background-color: #fff\n    width: 4rem\n    height: 1.5rem\n    border-radius: 0.75rem\n    align-items: center\n    justify-content: center\n    box-shadow: 0 0 0.25rem rgba(0, 0, 0, 0.2)\n    transition: background-color 0.3s ease, transform 0.3s ease\n    &:hover\n        background-color: #f0f0f0\n        transform: scale(1.1)\n\n    &:hover\n        color: $icon-hover\n    i\n        font-size: 1rem\n\n#theimg\n    position: fixed\n    top: 50%\n    left: 50%\n    transform: translate(-50%, -50%)\n    max-height: 75%\n    max-width: 50%\n.inner-content\n  display: flex\n\n.background img\n    position: absolute\n    top: 50%\n    left: 50%\n    transform: translate(-50%, -50%)\n\n.message-body > .avatar\n  cursor: pointer\n  flex-basis: 2.65rem\n  min-width: 2.65rem\n  height: 2.65rem\n\n\n.avatar > img\n  width: 100%\n  height: 100%\n  border-radius: 50%\n\n\n.window-controls\n    display: flex\n    flex-basis: 100%\n\n    @media (max-width: $mobile)\n        display: none\n\n    .button\n        display: flex\n        justify-content: center\n        padding-top: 0.5rem\n        flex: 0 0 2rem\n\n        &:hover\n            background-color: rgb(231, 231, 231)\n\n        &#close:hover\n            background-color: rgb(255, 0, 0)\n            color: white\n\n\n.button#close:hover svg path\n    fill: #fff\n\n\n.voice-box\n    display: flex\n    width: 11.25rem\n    height: 1.5rem\n    margin: 0.25rem 0\n\n    .icon\n        flex-basis: 1.5rem\n        background-color: rgb(0, 0, 0)\n        display: flex\n        justify-content: center\n        align-items: center\n        border-radius: 50%\n\n    .wave\n        display: flex\n        justify-content: center\n        align-items: center\n        flex-grow: 1\n\n.wave svg\n    height: 1.25rem\n    width: 80%\n\n.loader\n    width: 0.625rem\n    padding: 0.25rem\n    aspect-ratio: 1\n    border-radius: 50%\n    background: rgb(0, 153, 255)\n    --_m: conic-gradient(#0000 10%, #000), linear-gradient(#000 0 0) content-box\n    -webkit-mask: var(--_m)\n    mask: var(--_m)\n    -webkit-mask-composite: source-out\n    mask-composite: subtract\n    animation: l3 1s infinite linear\n    position: absolute\n\n@keyframes move\n    0%\n        left: -20% // 开始位置\n    100%\n        left: 120% // 结束位置\n\n.blank-loader\n    width: 10%\n    height: 200%\n    position: absolute\n    background: linear-gradient(to right, rgb(255, 255, 255), rgb(0, 0, 0) 50%, transparent 50%, transparent)\n    top: -50%\n    transform: rotate(30deg)\n    filter: blur(5px)\n    animation: move 1s linear infinite // 每1s循环\n\n@keyframes l\n    to\n        transform: rotate(1turn)\n\n@media (max-width: 600px)\n    #chatwindow\n        height: 100%\n\n    .upsidebar\n        white-space: nowrap\n        max-width: 7rem\n        text-overflow: ellipsis\n        overflow: hidden\n        background: #00a8ff linear-gradient(to right, #00d2f8, #00a8ff)\n\n    .upsidebar *\n        color: white\n        fill: white\n\n    .delay-num\n        color: black\n\n    .window-controls\n        display: none\n\n    .name-area\n        padding-bottom: 0.25rem\n\n    .input-area\n        overflow-y: auto\n\n    .inputbar\n        flex-basis: 4rem\n\n    .delay-status\n        position: relative\n        top: -.2rem\n</style>\n","<template>\n  <div class=\"blank-view\">\n    <div class=\"upside-bar\">\n      <div class=\"options\"></div>\n    </div>\n  </div>\n</template>\n<script>\nimport { client } from \"@/lib/runtime.js\";\n\nexport default {\n  name: \"BlankView\",\n  data() {\n    return {\n      fullScreen: false,\n      client: client,\n    };\n  },\n  watch: {},\n  created() {\n    this.fullScreen = client.fullScreen;\n  },\n  methods: {\n    waiting() {\n      this.$message({ message: \"此功能尚未开放\", type: \"warning\" });\n    },\n  },\n};\n</script>\n<style lang=\"sass\" scoped>\n.blank-view\n  background-color: #f2f2f2\n  flex-grow: 1\n\n.upside-bar\n    flex-basis: 3.75rem\n    flex-shrink: 0\n    height: 3.75rem\n    width: 100%\n    display: flex\n    align-items: flex-end\n    flex-direction: row-reverse\n    justify-content: space-between\n\n    .options\n        flex-basis: 6rem\n        display: flex\n        height: 100%\n        width: 100%\n        flex-wrap: wrap\n        flex-direction: row-reverse\n</style>\n","<template>\n  <div v-if=\"!onPhone\" id=\"main\">\n    <friendlist></friendlist>\n    <router-view v-if=\"loaded\"></router-view>\n    <blankView v-else></blankView>\n  </div>\n  <div v-else-if=\"pagePath === '/'\" id=\"main-mobile\">\n    <friendlist v-if=\"loaded\"></friendlist>\n    <blankView v-else></blankView>\n  </div>\n  <div v-else id=\"main-mobile\" class=\"mobile-chat\">\n    <router-view v-if=\"loaded\"></router-view>\n    <blankView v-else></blankView>\n  </div>\n</template>\n\n<script>\nimport friendlist from \"@/components/FriendList.vue\";\nimport { client } from \"@/lib/runtime.js\";\nimport blankView from \"@/views/BlankView.vue\";\n\nexport default {\n  components: {\n    friendlist,\n    blankView,\n  },\n  data() {\n    const onPhone = window.innerWidth < 600;\n    return {\n      onPhone,\n      pagePath: this.$route.path,\n      loaded: false,\n    };\n  },\n  watch: {\n    $route: function (newVal) {\n      this.pagePath = newVal.path;\n    },\n  },\n  mounted() {\n    if (client.inited) {\n      this.loaded = true;\n    } else {\n      client.on(\n        \"loaded\",\n        () => {\n          this.loaded = true;\n        },\n        false,\n      );\n    }\n  },\n};\n</script>\n\n<style>\n#main {\n  background-color: rgb(255, 255, 255);\n  flex-grow: 1;\n  display: flex;\n  width: calc(100% - 4.5rem);\n  background-color: #f2f2f2;\n}\n\n#main > .profile-body {\n  margin-top: 4rem;\n}\n\n#main-mobile {\n  width: 100%;\n  max-height: calc(100vh - 4rem);\n  background-color: rgb(255, 255, 255);\n  flex-grow: 1;\n  display: flex;\n}\n\n.mobile-chat#main-mobile {\n  max-height: 100%;\n}\n</style>\n","<template>\n  <div class=\"profile-body\">\n    <div id=\"profile\">\n      <div class=\"profile-container\">\n        <div class=\"base-info\">\n          <div class=\"base-info-avatar\">\n            <el-image\n              :src=\"activeContactor.avatar\"\n              :preview-src-list=\"[activeContactor.avatar]\"\n            />\n          </div>\n          <div class=\"base-info-content\">\n            <div class=\"name\">{{ activeContactor.name }}</div>\n            <div class=\"id\">ID {{ activeContactor.id }}</div>\n            <div class=\"status\">\n              <span :class=\"'delay-status ' + getDelayStatus\"></span>\n              在线\n            </div>\n          </div>\n          <!-- LLM Provider select is now inside ContactorSettings -->\n        </div>\n\n        <div class=\"info-blocks\">\n          <div class=\"settings-block\">\n            <div class=\"block-title\">Bot 基本配置</div>\n            <div class=\"block-content\">\n              <div class=\"block-content-item\">\n                <div class=\"item-title\">昵称</div>\n                <div class=\"item-content\">\n                  <el-input\n                    v-model=\"basicInfo.name\"\n                    :disabled=\"basicInfo.namePolicy !== 1\"\n                  ></el-input>\n                </div>\n              </div>\n              <div class=\"block-content-item\">\n                <div class=\"item-title\">头像</div>\n                <div class=\"item-content\">\n                  <el-input \n                    v-if=\"basicInfo.avatarPolicy !== 1\"\n                    :value=\"'跟随模型'\"\n                    :disabled=\"true\"\n                  ></el-input>\n                  <el-input \n                    v-else\n                    v-model=\"basicInfo.avatar\"\n                    :disabled=\"isOnebot\"\n                  ></el-input>\n                </div>\n              </div>\n              <div v-if=\"!isOnebot\" class=\"block-content-item\">\n                <div class=\"item-title\">头像策略</div>\n                <div class=\"item-content\">\n                  <el-select v-model=\"basicInfo.avatarPolicy\"\n                  @change=\"updateContactorAvatar\"\n                  >\n                    <el-option\n                      v-for=\"item in avatarPolicyList\"\n                      :key=\"item.value\"\n                      :label=\"item.label\"\n                      :value=\"item.value\"\n                    />\n                  </el-select>\n                </div>\n              </div>\n              <div v-if=\"!isOnebot\" class=\"block-content-item\">\n                <div class=\"item-title\">昵称策略</div>\n                <div class=\"item-content\">\n                  <el-select\n                    v-model=\"basicInfo.namePolicy\"\n                    @change=\"updateContactorName\"\n                  >\n                    <el-option\n                      v-for=\"item in namePolicyList\"\n                      :key=\"item.value\"\n                      :label=\"item.label\"\n                      :value=\"item.value\"\n                    />\n                  </el-select>\n                </div>\n              </div>\n              <div class=\"block-content-item\">\n                <div class=\"item-title\">会话置顶</div>\n                <div class=\"item-content\">\n                  <el-switch v-model=\"basicInfo.priority\"> </el-switch>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"info-blocks\">\n          <ContactorSettings\n            v-if=\"!isOnebot\"\n            v-model:model-value=\"options\"\n            :active-contactor-platform=\"activeContactor.platform\"\n            :llm-providers-list=\"llmProviders\"\n            :tool-call-modes-list=\"toolCallModes\"\n            :all-llm-tools-data=\"allLLMTools\"\n            :safety-settings-params=\"safetyParams\"\n            :safety-simple-value-options=\"safetySimpleValue\"\n            :presets-history-data=\"options.presetSettings?.history\"\n            @provider-changed=\"handleProviderSwitched\"\n            @update-presets=\"handleUpdateOpenaiPresets\"\n          />\n        </div>\n      </div>\n    </div>\n    <div class=\"action-bar\">\n      <el-button plain @click=\"$router.push(`/chat/${activeContactor.id}`)\">\n        发送消息\n      </el-button>\n      <el-button type=\"danger\" plain @click=\"centerDialogVisible = true\">\n        删除好友\n      </el-button>\n      <el-dialog v-model=\"centerDialogVisible\" title=\"警告\" width=\"300\" center>\n        <span> 确认要删除此好友吗？该操作不可逆。 </span>\n        <template #footer>\n          <div class=\"dialog-footer\">\n            <el-button @click=\"centerDialogVisible = false\">取消</el-button>\n            <el-button type=\"primary\" @click=\"delContactor\"> 确认 </el-button>\n          </div>\n        </template>\n      </el-dialog>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { client, config } from \"@/lib/runtime.js\";\nimport ContactorSettings from \"@/components/ContactorSettings.vue\"; // Import the new component\n\nexport default {\n  components: {\n    ContactorSettings, // Register the new component\n  },\n  data() {\n    const currentId = parseInt(this.$route.params.id);\n    const contactor = client.getContactor(currentId);\n\n    const toolCallModes = config.getToolCallModes();\n    const providers = config.getLLMProviders();\n    const safetyParams = config.getSafetySettingsParams();\n    const safetySimpleValue = Object.keys(safetyParams).map((key) => ({\n      value: key,\n      label: key,\n    }));\n\n    // Initial construction of allLLMTools remains here as it depends on global config\n    const allLLMTools = [];\n    for (const key in config.llmTools) {\n      const toolsObject = config.llmTools[key];\n      const toolsList = Object.keys(toolsObject).map((toolKey) => ({\n        enabled: false, // Initial state, child component will sync with options\n        ...toolsObject[toolKey],\n      }));\n      allLLMTools.push({\n        name: key,\n        tools: toolsList,\n        collapsed: true,\n      });\n    }\n    const avatarPolicyList = [\n      { value: 0, label: \"跟随模型\" },\n      { value: 1, label: \"自定义\" },\n    ];\n    const namePolicyList = [\n      { value: 0, label: \"跟随模型\" },\n      { value: 1, label: \"自定义\" },\n      { value: 2, label: \"对话摘要\" },\n    ];\n\n    return {\n      activeContactor: contactor,\n      options: null, // Will be initialized in initContactor\n      currentDelay: 0,\n      centerDialogVisible: false,\n      avatarPolicyList: avatarPolicyList,\n      namePolicyList: namePolicyList,\n      isOnebot: contactor.platform === \"onebot\",\n\n      // Static config passed as props\n      llmProviders: providers,\n      toolCallModes: toolCallModes,\n      safetyParams: safetyParams,\n      safetySimpleValue: safetySimpleValue,\n      allLLMTools: allLLMTools, // This structure is passed to child\n      basicInfo: null,\n    };\n  },\n  computed: {\n    getDelayStatus() {\n      return this.currentDelay > 1000\n        ? \"high\"\n        : this.currentDelay > 500\n          ? \"mid\"\n          : this.currentDelay > 100\n            ? \"low\"\n            : \"ultra\";\n    },\n    getAvatarPolicyValue() {\n      return this.basicInfo.avatarPolicy === 1 ? \"自定义\" : \"跟随模型\";\n    },\n  },\n  watch: {\n    \"$route.params.id\"(newVal) {\n      const newId = parseInt(newVal);\n      this.activeContactor = client.getContactor(newId);\n      if (this.activeContactor) {\n        this.isOnebot = this.activeContactor.platform === \"onebot\";\n      }\n      this.initContactor();\n    },\n    options: {\n      handler(newOptions) {\n        if (newOptions && this.activeContactor) {\n          // Sync back to the source of truth\n          this.activeContactor.options = JSON.parse(JSON.stringify(newOptions));\n          client.setLocalStorage();\n        }\n      },\n      deep: true,\n    },\n    basicInfo: {\n      handler(newInfo) {\n        if (newInfo && this.activeContactor) {\n          // Sync back to the source of truth\n          this.activeContactor.name = newInfo.name;\n          this.activeContactor.avatar = newInfo.avatar;\n          this.activeContactor.namePolicy = newInfo.namePolicy;\n          this.activeContactor.avatarPolicy = newInfo.avatarPolicy;\n          this.activeContactor.priority = newInfo.priority ? 0 : 1;\n          client.setLocalStorage();\n        }\n      },\n      deep: true,\n    },\n  },\n  created() {\n    // Use created instead of beforeMount for data initialization\n    this.initContactor();\n  },\n  mounted() {\n    this.delayInterval = setInterval(() => {\n      this.currentDelay = client.socket.delay;\n    }, 3000);\n  },\n  beforeUnmount() {\n    if (this.delayInterval) {\n      clearInterval(this.delayInterval);\n    }\n  },\n  methods: {\n    initContactor() {\n      // Deep clone options to avoid direct mutation of contactor's options by child\n      // The watcher on `this.options` will handle persisting changes.\n      this.options = JSON.parse(JSON.stringify(this.activeContactor.options));\n\n      const { name, avatar, namePolicy, avatarPolicy, priority } =\n        this.activeContactor;\n      this.basicInfo = {\n        name,\n        avatar,\n        namePolicy,\n        avatarPolicy,\n        priority: priority === 1 ? false : true,\n      };\n\n      // If contactor platform is onebot, tool call related options might need to be forced\n      if (this.activeContactor.platform === \"onebot\") {\n        if (this.options.toolCallSettings) {\n          this.options.toolCallSettings.mode = \"none\";\n          this.options.toolCallSettings.tools = [];\n        }\n      }\n      // The child component `ContactorSettings` will use this.options\n      // to initialize its internal state.\n    },\n    handleUpdateOpenaiPresets(presets) {\n      if (this.options && this.options.presetSettings) {\n        this.options.presetSettings.history = presets;\n        // The watcher on `this.options` will trigger saving\n        this.$message({\n          message: \"预设历史记录已更新\",\n          type: \"success\",\n        });\n      }\n    },\n    async delContactor() {\n      this.centerDialogVisible = false;\n      await client.rmContactor(this.activeContactor.id);\n      this.$router.push(\"/\");\n    },\n    handleProviderSwitched(newProvider) {\n      // This event is specifically for actions parent needs to take,\n      // like reloading avatar, that are outside the 'options' object.\n      this.activeContactor.loadAvatar();\n      // The options object (including provider and default model)\n      // would have already been updated by the child component via v-model.\n    },\n    getBaseInfoShownValue(value) {\n      const table = {};\n    },\n    updateContactorName() {\n      if (this.basicInfo.namePolicy === 0) {\n        this.basicInfo.name = this.activeContactor.options.base.model;\n      }\n    },\n    updateContactorAvatar() {\n      const { avatarPolicy } = this.basicInfo;\n      this.activeContactor.avatarPolicy = avatarPolicy;\n      this.basicInfo.avatar = this.activeContactor.loadAvatar();\n    }\n  },\n};\n</script>\n\n<style>\n/* Copied from parent for .settings-block, .block-title etc. */\n.block-title {\n  font-size: 0.8rem;\n}\n.block-content {\n  margin-top: 0.5rem;\n  margin-bottom: 1rem;\n  width: 100%;\n  display: flex;\n  background-color: #fff;\n  min-height: 1rem;\n  border-radius: 0.5rem;\n  flex-direction: column;\n}\n.block-content:last-child {\n  margin-bottom: 2rem;\n}\n.block-content-item {\n  max-height: 50rem; /* Ensure this is sufficient for PresetsList */\n  overflow-y: auto;\n  transition: max-height 0.5s ease;\n  position: relative;\n  display: flex;\n  width: 100%;\n  justify-content: space-between;\n  flex-wrap: nowrap;\n}\n.block-content-item.parent-item {\n  flex-wrap: wrap;\n}\n.child-item {\n  width: calc(100% - 1rem);\n  padding-left: 1rem;\n}\n.item-hidden-content {\n  width: 100%;\n}\n/* Styles specific to settings can be moved here or kept in parent if generic enough */\n.settings-container {\n  width: 100%;\n}\n.base-info-provider {\n  /* Copied from parent, ensure it's styled correctly in context */\n  display: flex;\n  justify-content: flex-end;\n  align-items: center;\n  padding-right: 2rem;\n  margin-bottom: 1rem; /* Added margin for spacing */\n}\n\n.plugin-tools-container {\n  max-height: 20rem;\n  overflow-y: auto;\n  -webkit-overflow-scrolling: touch;\n}\n.block-content-item::after {\n  content: \"\";\n  position: absolute;\n  bottom: 0;\n  left: 5%;\n  width: 90%;\n  height: 1px;\n  background-color: rgba(145, 145, 145, 0.155);\n}\n.item-title {\n  font-size: 0.8rem;\n  margin-left: 1rem;\n  height: 2.5rem;\n  display: flex;\n  flex-grow: 1;\n  align-items: center;\n  justify-content: flex-start;\n  max-width: calc(100% - 5rem);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.item-content {\n  transform: scale(0.9);\n  flex-basis: 2rem;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  margin-right: 1.5rem;\n}\n.el-input-number,\n.el-input,\n.el-slider,\n.el-select {\n  width: 10rem;\n}\n.sub-items {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  padding-left: 0; /* Reset ul default padding */\n  list-style: none; /* Reset ul default list-style */\n}\n.extra-info-button.active {\n  transform: rotate(-90deg);\n}\n.item-content button {\n  background-color: transparent;\n  border: none; /* Ensure button is clean */\n  cursor: pointer; /* Add cursor pointer */\n  transition: transform 0.3s ease;\n}\n.block-content-item.hidden {\n  /* This style seems unused, but keeping for now */\n  min-height: 0px;\n  max-height: 0px;\n}\n/* 自定义动画 - Kept in parent as it's a general utility transition */\n.expand-slide-enter-active,\n.expand-slide-leave-active {\n  transition:\n    max-height 0.4s cubic-bezier(0.78, 0.14, 0.15, 0.86),\n    opacity 0.4s;\n}\n.expand-slide-enter-from,\n.expand-slide-leave-to {\n  max-height: 0;\n  opacity: 0;\n}\n.expand-slide-enter-to,\n.expand-slide-leave-from {\n  max-height: 20rem; /* Adjust if necessary for PresetsList or other content */\n  opacity: 1;\n}\n</style>\n\n<style scoped>\n/* Styles from original component that are general layout */\n#profile {\n  position: relative;\n  flex-grow: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n}\n/* .sub-items and other specific styles are now in ContactorSettings.vue or can be if specific to it */\n/* Keep .base-info-provider here if it's also used for other things, or move if only for provider select */\n/* Moved to child: .base-info-provider */\n\n.profile-container {\n  overflow-y: auto;\n  margin: 2rem 0rem 0rem 0rem;\n  width: calc(100% - 8rem);\n  min-width: 20rem;\n  max-width: 40rem;\n  display: flex;\n  flex-direction: column;\n}\n.base-info {\n  background-color: #fff;\n  border-radius: 0.5rem;\n  display: flex;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid #88888888;\n  flex-wrap: wrap;\n  margin-bottom: 2rem; /* This was on base-info, now applies before info-blocks */\n}\n.base-info-avatar {\n  margin-top: 1rem;\n  margin-left: 1rem;\n  flex-basis: 5.5rem;\n  height: 5.5rem;\n}\n.base-info-avatar .el-image {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n}\n.base-info-content {\n  margin-left: 1.5rem;\n  margin-top: 1rem;\n  display: flex;\n  flex-direction: column;\n}\n.base-info-content .name {\n  font-size: 1.25rem;\n}\n.base-info-content .id {\n  margin-top: 0.25rem;\n  font-size: 0.75rem;\n  color: dimgrey;\n}\n.base-info-content .status {\n  margin-top: 0.25rem;\n}\n.info-blocks {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n.action-bar {\n  position: sticky;\n  background-color: #f2f2f2;\n  bottom: 0px;\n  left: 0px;\n  display: flex;\n  justify-content: space-around;\n  align-items: center;\n  height: 6rem;\n  width: 100%;\n  z-index: 2;\n}\n.profile-body {\n  position: relative;\n  overflow-y: auto;\n  flex-grow: 1;\n  background-color: #f2f2f2;\n}\n</style>\n\n<style scoped lang=\"sass\">\n/* SASS styles remain in parent */\n.delay-status\n  display: inline-block\n  width: 1rem\n  height: 1rem\n  border-radius: 50%\n  transform: translateY(.25rem)\n  margin-right: .25rem\n  &:hover + .delay-num\n    display: inline-block\n  &.ultra\n    background-color: rgb(53, 233, 146)\n  &.low\n    background-color: rgb(255, 204, 0)\n  &.mid\n    background-color: rgb(255, 102, 102)\n  &.high\n    background-color: #ccc\n</style>\n","<template>\n  <div id=\"settings-view\">\n    <el-button type=\"info\" plain @click=\"reset()\">重置全部</el-button>\n    <el-button type=\"info\" plain @click=\"resetCache()\">清理缓存</el-button>\n  </div>\n</template>\n\n<script>\nimport { client } from \"@/lib/runtime.js\";\n\nexport default {\n  name: \"SettingsView\",\n  data() {\n    return {};\n  },\n  methods: {\n    async reset() {\n      const result = await client.reset();\n      if (result) {\n        this.$message.success(\"重置成功\");\n        setTimeout(() => {\n          window.location.reload();\n        }, 500);\n      }\n    },\n    async resetCache() {\n      await client.resetCache();\n      this.$message.success(\"清理缓存成功\");\n      setTimeout(() => {\n        window.location.reload();\n      }, 500);\n    },\n  },\n};\n</script>\n\n<style scoped>\n#settings-view {\n  flex-grow: 1;\n  height: 100%;\n  background-color: #f2f2f2;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n</style>\n","<template>\n  <div class=\"auth-view\">\n    <div class=\"container\">\n      <div ref=\"iconContainer\" class=\"icon-container\">\n        <i class=\"iconfont ChatGPT\"></i>\n      </div>\n      <h1 class=\"title\">登录验证</h1>\n      <p class=\"hint\">管理员开启了密码验证，请在下方填入访问码</p>\n      <input\n        v-model=\"accessCode\"\n        type=\"password\"\n        placeholder=\"在此处填写访问码\"\n      />\n      <div class=\"controls\">\n        <button class=\"later\" @click=\"login()\">游客登录</button>\n        <button class=\"login\" @click=\"login(accessCode)\">登录</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { nextTick, onUnmounted, onMounted, ref } from \"vue\";\nimport router from \"@/router\";\nimport { client } from \"@/lib/runtime.js\";\nimport { ElMessage } from \"element-plus\";\n\nconst accessCode = ref();\nconst requesting = ref(false);\nconst iconContainer = ref();\n\nconst login = async (code) => {\n  console.log(\"触发login了\");\n\n  // 激活图标\n  await nextTick(() => iconContainer.value.classList.add(\"active\"));\n\n  if (requesting.value) {\n    return;\n  } else {\n    requesting.value = true;\n    try {\n      const result = await client.login(code);\n      if (result) {\n        ElMessage.success(\n          `成功以${result.is_admin ? \"管理员身份\" : \"游客身份\"}登录，欢迎使用!`,\n        );\n        // 先看看url里有没有query\n        if (router.currentRoute.value.query.redirect) {\n          router.push(router.currentRoute.value.query.redirect);\n        } else {\n          router.push(\"/\");\n        }\n\n        // 删除回车触发login的监听\n      }\n    } catch (error) {\n      ElMessage.error(error);\n    } finally {\n      // 移除激活图标\n      await nextTick(() => iconContainer.value.classList.remove(\"active\"));\n      requesting.value = false;\n    }\n  }\n};\n\n// 定义一个命名函数供事件监听和移除使用\nfunction handleEnter(e) {\n  if (e.key === \"Enter\") {\n    login(accessCode.value);\n  }\n}\n\n// 在unmounted时移除监听\nonUnmounted(() => {\n  console.log(\"unmounted\");\n  removeEventListener(\"keydown\", handleEnter); // 使用相同的函数引用进行移除\n});\n\nonMounted(() => {\n  addEventListener(\"keydown\", handleEnter);\n  // 看看query里有没有key\n  if (router.currentRoute.value.query.key) {\n    login(router.currentRoute.value.query.key);\n  }\n});\n</script>\n\n<style lang=\"sass\" scoped>\n$baseColor: #1d93ab\n\n.auth-view\n    background-color: white\n    flex-grow: 1\n    display: grid\n    place-items: center\n\n    .container\n        display: flex\n        flex-direction: column\n        align-items: center\n        width: 50%\n        margin: 0 auto\n        text-align: center\n        animation: fly-into 1s\n\n        @keyframes fly-into\n            from\n                transform: translateX(-150px)\n                opacity: 0\n            to\n                transform: translateX(0)\n                opacity: 1\n\n        .icon-container\n            transition: 1s linear\n\n            .iconfont.ChatGPT\n                font-size: 46px\n                border-radius: 10px\n\n            &.active\n                transform: rotate(180deg)\n                color: $baseColor\n\n        .title\n            white-space: nowrap\n            font-size: 50px\n            letter-spacing: 5px\n            color: black\n            margin: 25px\n\n        .hint\n            font-size: 15px\n            font-weight: 300\n\n        input\n            margin-top: 30px\n            border: 2px solid $baseColor\n            border-radius: 12px\n            width: 250px\n            height: 40px\n            padding: 0 10px\n            text-align: center\n            letter-spacing: 1px\n\n            &:focus\n                outline: 1px solid $baseColor\n\n                &::placeholder\n                    color: transparent\n\n            &::placeholder\n                text-align: center\n\n        .controls\n            display: flex\n            flex-direction: column\n            align-items: center\n\n            button\n                width: 10rem\n                margin-top: 20px\n                padding: 10px 15px\n                border-radius: 8px\n\n                &:hover\n                    box-shadow: 0 0 2px black\n\n            .later\n                background: transparent\n\n            .login\n                color: white\n                background: $baseColor\n</style>\n"],"file":"views-C4ctlWJd.js"}