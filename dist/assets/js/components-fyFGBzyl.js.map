{"version":3,"file":"components-fyFGBzyl.js","sources":["../../../src/utils/tools.js","../../../src/utils/avatar.js","../../../src/utils/generate.js","../../../src/lib/event.js","../../../src/lib/adapter/adapter.js","../../../src/lib/adapter/onebot.js","../../../src/lib/adapter/openai.js","../../../src/lib/contactor.js","../../../src/lib/websocket.js","../../../src/lib/client.js","../../../src/lib/config.js","../../../src/lib/runtime.js","../../../src/components/SideBar.vue","../../../src/components/DisplayButtons.vue","../../../src/components/ForwardMsg.vue","../../../src/components/InputEditor.vue","../../../src/components/FileBlock.vue","../../../src/components/ToolCallBar.vue","../../../src/components/ReasonBlock.vue","../../../src/components/ContextMenu.vue","../../../src/components/AddContactor.vue","../../../src/components/FriendList.vue","../../../src/components/PresetsList.vue","../../../src/components/ContactorSettings.vue","../../../src/components/settings/ErrorBoundary.vue","../../../src/lib/configApi.js","../../../src/stores/configStore.js","../../../src/components/settings/ConfigCompare.vue","../../../src/components/settings/DynamicAdapterForm.vue","../../../src/components/settings/ModelSelector.vue","../../../src/components/settings/AdapterEditor.vue","../../../src/components/settings/PresetCard.vue","../../../src/components/settings/ImageCropper.vue","../../../src/components/settings/PresetEditor.vue"],"sourcesContent":["export function debounce(fn, delay) {\n  let timeoutId;\n  return function (...args) {\n    clearTimeout(timeoutId);\n    timeoutId = setTimeout(() => {\n      fn.apply(this, args);\n    }, delay);\n  };\n}\n\nexport function shareOrCopy(url) {\n  let result = false;\n  let message = \"\";\n  if (navigator.share) {\n    result = true;\n    message = \"分享成功\";\n\n    navigator\n      .share({\n        title: \"从Mio Chat分享\",\n        url: url,\n      })\n      .then(() => {\n        console.log(\"Successful share\");\n      })\n      .catch((error) =>{\n        console.error(\"Error sharing:\", error);\n        result = false;\n        message = \"分享失败\";\n      });\n  } else if (navigator.clipboard) {\n    result = true;\n    message = \"链接已复制到剪贴板\";\n    navigator.clipboard\n      .writeText(url)\n      .then(() => {\n        console.log(\"URL copied to clipboard\");\n      })\n      .catch((err) => {\n        console.error(\"Could not copy text: \", err);\n        result = false;\n        message = \"复制失败\";\n      });\n  } else {\n    console.warn(\"Share and Clipboard APIs are not supported in this browser.\");\n  }\n  return {\n    success: result,\n    message: message,\n  };\n}","const AVATAR_BASE_PATH =\n  \"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons\";\n\nconst AVATAR_MAP = {\n  OpenAI: \"openai.svg\",\n  Cohere: \"cohere-color.svg\",\n  Anthropic: \"claude-color.svg\",\n  Google: \"gemini-color.svg\",\n  \"X.AI\": \"grok.svg\",\n  DeepSeek: \"deepseek-color.svg\",\n  智谱清言: \"zhipu-color.svg\",\n  豆包: \"doubao-color.svg\",\n  \"月之暗面 (kimi)\": \"moonshot.svg\",\n  科大讯飞: \"spark-color.svg\",\n  通义千问: \"qwen-color.svg\",\n  腾讯混元: \"hunyuan-color.svg\",\n};\n\n/**\n * 根据模型所有者获取头像 URL\n * @param {string} modelOwner - 模型所有者名称\n * @returns {string} - 头像 URL\n */\nexport function getAvatarByOwner(modelOwner) {\n  if (Object.keys(AVATAR_MAP).includes(modelOwner)) {\n    return `${AVATAR_BASE_PATH}/${AVATAR_MAP[modelOwner]}`;\n  }\n  return `${AVATAR_BASE_PATH}/openai.svg`;\n}\n\n/**\n * 根据适配器类型获取对应的图标文件名\n * @param {string} adapterType - 适配器类型 (openai, gemini, vertex, onebot)\n * @returns {string} - 图标文件名\n */\nexport function getIconByAdapterType(adapterType) {\n  const iconMap = {\n    openai: \"openai.svg\",\n    gemini: \"gemini-color.svg\",\n    vertex: \"gemini-color.svg\", // Vertex AI 使用 Gemini 图标\n    onebot: \"openai.svg\", // OneBot 暂时使用 OpenAI 图标作为默认\n  };\n  return iconMap[adapterType] || \"openai.svg\";\n}\n\n/**\n * 根据适配器类型获取完整的头像 URL\n * @param {string} adapterType - 适配器类型\n * @returns {string} - 完整的头像 URL\n */\nexport function getAvatarByAdapterType(adapterType) {\n  const iconFile = getIconByAdapterType(adapterType);\n  return `${AVATAR_BASE_PATH}/${iconFile}`;\n}\n\nexport { AVATAR_BASE_PATH, AVATAR_MAP };\n","export function uuidString() {\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    var r = (Math.random() * 16) | 0,\n      v = c == \"x\" ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport function numberString(length) {\n  let result = \"\";\n  const characters = \"0123456789\";\n  const charactersLength = characters.length;\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\n\nexport function randomString(length) {\n  let result = \"\";\n  const characters =\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n  const charactersLength = characters.length;\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\n","export default class EventEmitter {\n  constructor() {\n    this.events = {};\n  }\n  on(eventName, listener, refresh = true) {\n    // 如果 refresh 为真，删除之前的回调函数\n    if (refresh) {\n      this.off(eventName);\n    }\n    // 如果事件名不存在，则初始化为一个空数组\n    if (!this.events[eventName]) {\n      this.events[eventName] = [];\n    }\n    // 添加新的回调函数到数组中\n    this.events[eventName].push(listener);\n  }\n  emit(eventName, data) {\n    if (this.events[eventName]) {\n      this.events[eventName].forEach((listener) => {\n        listener(data);\n      });\n    }\n  }\n  off(eventName) {\n    if (this.events[eventName]) {\n      delete this.events[eventName];\n    }\n  }\n}\n","/**\n * @author Mio-FCIP <1099834705@qq.com>\n * @lastEditor 彭志勇 <2457305628@qq.com>\n * @lastEditTime 2024-04-25 06:25:30\n */\n\nimport EventEmitter from \"../event.js\";\nimport { client } from \"@/lib/runtime.js\";\n\nexport default class Adapter extends EventEmitter {\n  constructor() {\n    super();\n  }\n\n  async fetch(url, data) {\n    return await client.socket.fetch(url, data);\n  }\n}\n","import Adapter from \"./adapter.js\";\n\nexport default class Onebot extends Adapter {\n  constructor() {\n    super();\n  }\n\n  convertMessage(data) {\n    console.log(data);\n    data.message.forEach((element, index) => {\n      if (element.type === \"image\") {\n        const base64Data = element.data.file.replace(\n          /^base64:\\/\\//,\n          \"data:image/jpeg;base64,\",\n        );\n        data.message[index].data.file = base64Data;\n        console.log(data.message[index]);\n      } else if (element.type === \"nodes\") {\n        element.data.messages.forEach((node) => {\n          if (node.type === \"image\") {\n            const base64Data = node.data.file.replace(\n              /^base64:\\/\\//,\n              \"data:image/jpeg;base64,\",\n            );\n            node.data.file = base64Data;\n          }\n        });\n      }\n    });\n\n    const rplMessage = data.message.filter(\n      (element) => element.type === \"reply\",\n    );\n    const midMessage = data.message.filter(\n      (element) => element.type !== \"reply\",\n    );\n    if (rplMessage.length > 0) {\n      midMessage.unshift(rplMessage[0]);\n    }\n\n    const webMessage = {\n      role: \"other\",\n      time: new Date().getTime(),\n      content: midMessage,\n      id: data.message_id,\n      status: \"completed\",\n    };\n    return webMessage;\n  }\n\n  /**\n   * Send message to server\n   * @param {id} string\n   * @param {WebMessage} message\n   * @returns {Promise<number>} message_id\n   */\n  async send(id, message) {\n    const response = await this.fetch(\n      \"/api/onebot/message\" + `/${id}`,\n      message,\n    );\n    return response.message_id;\n  }\n}\n","/**\n * @author Mio-FCIP <1099834705@qq.com>\n * @lastEditor 彭志勇 <2457305628@qq.com>\n * @lastEditTime 2024-04-25 06:25:30\n */\n\nimport Adapter from \"./adapter.js\";\nimport { client, config } from \"../runtime.js\";\nimport { numberString } from \"../../utils/generate.js\";\n\nexport default class Openai extends Adapter {\n  constructor(config) {\n    super();\n    this.id = config.id;\n  }\n\n  convertMessage(message) {\n    const webMessage = {\n      role: \"other\",\n      time: new Date().getTime(),\n      content: [{ type: \"blank\", data: {} }],\n      status: \"pending\",\n      id: numberString(16),\n    };\n    const mergedMessage = { ...webMessage, ...message };\n    return mergedMessage;\n  }\n\n  async getMessagesSummary(messageChain) {\n    const query = `请你根据以下对话的内容\\n${JSON.stringify(messageChain)}\\n，总结出一个简短的对话主题,你的回答必须只包含对话主题，不要包含任何其他内容，包括句号。`;\n    const settings = config.getLLMDefaultConfig();\n    settings.base.stream = false;\n    const messages = {\n      settings,\n      messages: [{ role: \"user\", content: query }],\n    };\n\n    const response = await this.fetch(`/api/llm/completions`, messages);\n    // debugger;\n    const { content } = response;\n    return content || \"未命名会话\";\n  }\n\n  handleMessageEvent(chunk) {\n    const data = chunk.data;\n\n    const messageId = data.metaData.messageId;\n\n    delete data.metaData;\n\n    const emitEvent = (eventName, detail) => {\n      this.emit(eventName, { ...detail, messageId });\n    };\n\n    console.log(\"Received chunk from LLM:\", chunk);\n    if (chunk.message === \"update\") {\n      const updateHandlers = {\n        reasoningContent: (content) =>\n          emitEvent(\"updateReasoning\", { reasoning_content: content }),\n        content: (content) => emitEvent(\"updateMessage\", { chunk: content }),\n        toolCall: (tool_call) => emitEvent(\"updateToolCall\", { tool_call }),\n      };\n\n      const data = chunk.data;\n      const handler = updateHandlers[data.type];\n      if (handler) {\n        handler(data.content);\n      }\n    } else if ([\"complete\", \"failed\"].includes(chunk.message)) {\n      const completionHandlers = {\n        complete: () => emitEvent(\"completeMessage\", {}),\n        failed: () => emitEvent(\"failedMessage\", { error: chunk.data }),\n      };\n\n      const handler = completionHandlers[chunk.message];\n      if (handler) {\n        handler();\n      }\n    }\n  }\n\n  async send(messages, messageId, settings) {\n    console.log(\"send message to openai\");\n\n    settings = config.getVerifiedLLMConfig(settings);\n\n    const metaData = {\n      contactorId: this.id,\n      messageId,\n    };\n    // Apply settings defaults\n    const data = {\n      settings, // Default to empty object\n      messages,\n    };\n\n    console.log(\"Data sent to LLM:\", data);\n\n    if (!client.socket) {\n      throw new Error(\"WebSocket connection not established.\");\n    }\n\n    client.socket.streamCompletions(data, metaData);\n  }\n}\n","import { config } from \"@/lib/runtime.js\";\nimport { getAvatarByOwner } from \"@/utils/avatar.js\";\nimport { numberString } from \"../utils/generate.js\";\nimport Onebot from \"./adapter/onebot.js\";\nimport Openai from \"./adapter/openai.js\";\nimport EventEmmiter from \"./event.js\";\n\nconst avatarPolicy = [\"MODEL\", \"CUSTOM\"];\n\nconst namePolicy = [\"MODEL\", \"CUSTOM\", \"SUMMARY\"];\n\nexport default class Contactor extends EventEmmiter {\n  /**\n   * Contactor 构造函数\n   * @param {string} platform - 平台 (e.g., \"onebot\", \"openai\")\n   * @param {object} config - 配置对象\n   * @param {string} config.id - ID\n   * @param {string} config.name - 名称\n   * @param {string} config.avatar - 头像 URL\n   * @param {string} config.title - 标题\n   * @param {object} config.options - 选项\n   * @param {number} config.priority - 优先级 (0 最高)\n   * @param {number} config.namePolicy - 名称策略 (默认 0)\n   * @param {number} config.avatarPolicy - 头像策略 (默认 0)\n   * @param {number} config.firstMessageIndex - 首条消息索引 (默认 0)\n   * @param {array} config.messageChain - 消息链 (默认 [])\n   * @param {number} config.lastUpdate - 最后更新时间 (默认当前时间)\n   * @param {number} config.createTime - 创建时间 (默认当前时间)\n   */\n  constructor(platform, config) {\n    super();\n    this.platform = platform;\n    this.id = config.id;\n    this.namePolicy = config.namePolicy || 0;\n    this.avatarPolicy = config.avatarPolicy || 0;\n    this.title = config.title;\n    this.name = config.name;\n    this.avatar = config.avatar;\n    this.priority = config.priority;\n    this.firstMessageIndex = config.firstMessageIndex || 0;\n    this.messageChain = config.messageChain || [];\n    this.active = false;\n    this.lastUpdate = config.lastUpdate || Date.now(); // 使用 Date.now()\n    this.createTime = config.createTime || Date.now(); // 使用 Date.now()\n    this.lastMessageSummary = this.getLastMessageSummary();\n    this.options = this.loadOptions(config.options);\n    this.kernel =\n      platform === \"onebot\" ? new Onebot(config) : new Openai(config); // 简化条件判断\n\n    if (platform === \"openai\") {\n      this.enableOpenaiListener();\n    }\n  }\n\n  /**\n   * 将 Contactor 对象转换为 JSON 格式\n   * @returns {object} - 包含 Contactor 属性的 JSON 对象\n   */\n  toJSON() {\n    return {\n      platform: this.platform,\n      id: this.id,\n      options: this.options,\n      namePolicy: this.namePolicy,\n      avatarPolicy: this.avatarPolicy,\n      title: this.title,\n      name: this.name,\n      avatar: this.avatar,\n      priority: this.priority,\n      messageChain: this.messageChain,\n      active: this.active,\n      lastUpdate: this.lastUpdate,\n      createTime: this.createTime,\n      lastMessageSummary: this.lastMessageSummary,\n      firstMessageIndex: this.firstMessageIndex,\n    };\n  }\n\n  enableOpenaiListener() {\n    this.kernel.on(\"updateReasoning\", (e) => {\n      const { reasoning_content, messageId } = e;\n      const rawMessage = this.getMessageById(messageId);\n      if (!rawMessage) return;\n\n      // 查找现有的 reason 块\n      const existingReasonIndex = rawMessage.content.findIndex(\n        (msgElm) => msgElm.type === \"reason\",\n      );\n\n      const msgElm = {\n        type: \"reason\",\n        data: {\n          text: reasoning_content,\n          startTime: new Date().getTime(),\n          endTime: 0,\n        },\n      };\n\n      if (existingReasonIndex !== -1) {\n        // 如果已存在 reason 块，更新其内容\n        msgElm.data.text =\n          rawMessage.content[existingReasonIndex].data.text + reasoning_content;\n        msgElm.data.startTime =\n          rawMessage.content[existingReasonIndex].data.startTime;\n        rawMessage.content[existingReasonIndex] = msgElm;\n      } else if (rawMessage.content[0].type === \"blank\") {\n        // 如果是 blank 状态，直接更新第一个元素\n        rawMessage.content[0] = msgElm;\n      } else {\n        // 其他情况，追加到末尾\n        rawMessage.content.push(msgElm);\n      }\n\n      this.emit(\"updateMessage\");\n      this.emit(\"updateMessageSummary\");\n    });\n\n    this.kernel.on(\"updateMessage\", (e) => {\n      const { chunk, messageId } = e;\n      const rawMessage = this.getMessageById(messageId);\n      if (!rawMessage) return;\n\n      rawMessage.content.forEach((msgElm) => {\n        if (msgElm.type == \"reason\" && !msgElm.data.endTime)\n          msgElm.data.endTime = new Date().getTime();\n      });\n\n      const lastMsgElm = rawMessage.content[rawMessage.content.length - 1];\n      const isFirstElement = [\"blank\", \"text\"].includes(lastMsgElm.type);\n\n      const msgElm = {\n        type: \"text\",\n        data: {\n          text: (lastMsgElm.type == \"text\" ? lastMsgElm.data.text : \"\").concat(\n            chunk,\n          ),\n        },\n      };\n\n      if (isFirstElement)\n        rawMessage.content[rawMessage.content.length - 1] = msgElm;\n      else rawMessage.content.push(msgElm);\n\n      this.emit(\"updateMessage\"); // 更新响应式数据\n      this.emit(\"updateMessageSummary\");\n    });\n\n    this.kernel.on(\"updateToolCall\", (e) => {\n      const { tool_call, messageId } = e;\n      console.log(tool_call);\n\n      const rawMessage = this.getMessageById(messageId);\n      if (!rawMessage) return;\n\n      const lastMsgElm = rawMessage.content[rawMessage.content.length - 1];\n      const msgElm = {\n        type: \"tool_call\",\n        data: tool_call,\n      };\n\n      if (lastMsgElm.type == \"blank\") {\n        // 这种情况一定是第一条空白消息，直接更新成 toolCall 消息\n        rawMessage.content[0] = msgElm;\n      } else {\n        const previousCall = rawMessage.content.find(\n          (msgElm) => msgElm.data.id == tool_call.id,\n        );\n        if (previousCall) {\n          const updatedCall = JSON.parse(JSON.stringify(previousCall));\n          updatedCall.data.action = tool_call.action;\n          updatedCall.data.result = tool_call.result;\n          if (tool_call.action == \"pending\") {\n            updatedCall.data.parameters += tool_call.parameters;\n          }\n          const index = rawMessage.content.indexOf(previousCall);\n          rawMessage.content[index] = updatedCall;\n        } else {\n          // 这种情况就是新增一条 toolCall 消息\n          rawMessage.content.push(msgElm);\n        }\n      }\n\n      this.emit(\"updateMessage\"); // 更新响应式数据\n      this.emit(\"updateMessageSummary\");\n    });\n\n    this.kernel.on(\"completeMessage\", (e) => {\n      this.updateLastUpdate();\n      const messageId = e.messageId;\n      const rawMessage = this.getMessageById(messageId);\n      if (rawMessage) {\n        rawMessage.status = \"completed\";\n\n        this.emit(\"updateMessageSummary\");\n\n        this.emit(\"completeMessage\", {\n          messageId,\n        });\n      }\n    });\n\n    this.kernel.on(\"failedMessage\", (e) => {\n      console.error(e);\n      // case 1: e.error.message 为json字符串，需要解析\n      if (typeof e.error === \"string\") {\n        try {\n          e.error.message = JSON.parse(e.error.message);\n        } catch (error) {\n          console.error(\"Failed to parse error message:\", error);\n        }\n      }\n      const error = JSON.stringify(e.error, null, 2);\n\n      this.updateLastUpdate();\n      const messageId = e.messageId;\n      const rawMessage = this.getMessageById(messageId);\n      if (rawMessage) {\n        const errorMessage =\n          \"Error : LLM 响应失败！\\n```json\\n \" + error + \"\\n```\";\n        const errElem = {\n          type: \"text\",\n          data: {\n            text: errorMessage,\n          },\n        };\n\n        const withBlank = rawMessage.content.some(\n          (elm) => elm.type === \"blank\",\n        );\n\n        if (withBlank) {\n          rawMessage.content[0] = errElem;\n        } else {\n          rawMessage.content.push(errElem);\n        }\n\n        rawMessage.status = \"completed\";\n\n        this.emit(\"updateMessageSummary\");\n\n        this.emit(\"completeMessage\", {\n          messageId,\n        });\n      }\n    });\n  }\n\n  handleLLMMessageEvent(e) {\n    this.kernel.handleMessageEvent(e);\n  }\n\n  loadOptions(options) {\n    if (this.platform === \"openai\") {\n      return config.getVerifiedLLMConfig(options);\n    } else {\n      return options || {};\n    }\n  }\n\n  /**\n   * Send message to contactor\n   * @param {OnebotMessage} message\n   */\n  async send(message) {\n    await this.kernel.send(message);\n  }\n\n  _getFilePrompt(fileElms) {\n    const start = \"\\n以下是用户上传的文件：\\n\";\n    return start + fileElms.join(\"\\n\");\n  }\n\n  _getImagePrompt(imageElms) {\n    const start = \"\\n以下是用户所上传的图片链接：\\n\";\n    const result =  start + imageElms.map((elm)=>elm.content).join(\"\\n\");\n    return result\n  }\n\n  _getValidOpenaiMessage(\n    start = this.firstMessageIndex,\n    end = this.messageChain.length,\n    length = this.options.base.max_messages_num,\n  ) {\n    const cuttedMessageList = this.messageChain\n      .slice(start, end)\n      .slice(-length);\n\n    const validMessageList = cuttedMessageList.filter(\n      (msg) => msg.role != \"mio_system\",\n    );\n\n    const mergedMessages = validMessageList.map((message) => {\n      const fileList = [];\n      const imageList = [];\n      const subArray = [];\n      message.content.forEach((elm) => {\n        const role =\n          elm.type == \"tool_call\"\n            ? \"tool\"\n            : message.role == \"user\"\n              ? \"user\"\n              : \"assistant\";\n        const formatedMsg = {\n          role: role,\n          content: \"none\",\n          _content_type: undefined,\n        };\n        if (role == \"tool\") {\n          formatedMsg.role = \"assistant\";\n          formatedMsg.content = null;\n          formatedMsg.tool_calls = [\n            {\n              id: elm.data.id,\n              function: {\n                name: elm.data.name,\n                arguments: elm.data.parameters,\n              },\n              type: \"function\",\n            },\n          ];\n          subArray.push({ ...formatedMsg });\n\n          delete formatedMsg.tool_calls;\n          formatedMsg.role = \"tool\";\n          formatedMsg.content = JSON.stringify(elm.data.result);\n          formatedMsg.tool_call_id = elm.data.id;\n          formatedMsg.name = elm.data.name;\n          subArray.push({ ...formatedMsg });\n\n          formatedMsg.role = role;\n        } else if (role == \"user\" || role == \"assistant\") {\n          if (elm.type == \"image\") {\n            formatedMsg.content = elm.data.file;\n            formatedMsg._content_type = \"image\";\n            subArray.push(formatedMsg);\n            imageList.push(elm.data.file.content);\n          } else if (elm.type == \"text\") {\n            formatedMsg.content = elm.data.text;\n            formatedMsg._content_type = \"text\";\n            subArray.push(formatedMsg);\n          } else if (elm.type == \"file\") {\n            fileList.push(elm.data.file);\n          }\n        }\n      });\n      if (fileList.length > 0) {\n        const textElm = subArray.filter((elm) => elm._content_type == \"text\");\n        // 没有就创建一个\n        if (textElm.length == 0) {\n          subArray.push({\n            role: \"user\",\n            content: this._getFilePrompt(fileList),\n            _content_type: \"text\",\n          });\n        }\n      }\n      return subArray;\n    });\n    let finalMessages = [];\n\n    mergedMessages.forEach((subArray) => {\n      const textElm = subArray.filter((elm) => elm._content_type == \"text\");\n      const imageElm = subArray.filter((elm) => elm._content_type == \"image\");\n      const fileElm = subArray.filter((elm) => elm._content_type == \"file\");\n      const filePrompt = fileElm.length > 0 ? this._getFilePrompt(fileElm) : \"\";\n      const imagePrompt = imageElm.length > 0 ? this._getImagePrompt(imageElm) : \"\";\n    \n      let message = null;\n      if (\n        textElm.length > 0 &&\n        imageElm.length > 0 &&\n        imageElm[0].role == \"user\"\n      ) {\n        message = {\n          role: \"user\",\n          content: [\n            ...imageElm.map((elm) => {\n              return {\n                type: \"image_url\",\n                image_url: {\n                  url: elm.content,\n                },\n              };\n            }),\n            ...textElm.map((elm) => {\n              return {\n                type: \"text\",\n                text: elm.content + filePrompt + imagePrompt,\n              };\n            }),\n          ],\n        };\n      }\n      if (message?.content.length == subArray.length) {\n        finalMessages.push(message);\n      } else {\n        subArray.forEach((elm) => {\n          delete elm._content_type;\n        });\n        finalMessages.push(...subArray);\n      }\n    });\n\n    const presetHistory = this.options.presetSettings.history;\n\n    if (presetHistory) {\n      finalMessages = presetHistory.concat(finalMessages);\n    }\n\n    return finalMessages;\n  }\n  updateMessageSummary() {\n    this.lastMessageSummary = this.getLastMessageSummary();\n  }\n\n  getBaseUserContainer() {\n    const userContainer = {\n      role: \"user\",\n      time: new Date().getTime(),\n      status: \"completed\",\n      id: numberString(16),\n      content: [],\n    };\n    return userContainer;\n  }\n\n  /**\n   * 从网页前端发来的消息\n   */\n  async webSend(message, toServer = true) {\n    this.updateLastUpdate();\n    this.messageChain.push(message);\n    this.updateMessageSummary();\n    if (!toServer) return;\n    try {\n      if (this.platform == \"onebot\") {\n        const messageId = await this.kernel.send(this.id, message.content);\n\n        return messageId;\n      } else {\n        // 截取从this.firstMessageIndex到结尾的消息\n        const finalMessages = this._getValidOpenaiMessage();\n        const messageId = numberString(16);\n        await this.kernel.send(finalMessages, messageId, this.options);\n\n        this.revMessage({\n          id: messageId,\n        });\n\n        return numberString(16);\n      }\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      throw error;\n    }\n  }\n\n  insertMessage(message, index) {\n    this.messageChain.splice(index, 0, message);\n    this.updateMessageSummary();\n  }\n\n  async retryMessage(id) {\n    const message = this.getMessageById(id);\n    if (message) {\n      message.content = [\n        {\n          type: \"blank\",\n        },\n      ];\n      this.updateLastUpdate();\n      const index = this.messageChain.indexOf(message);\n      const finalMessages = this._getValidOpenaiMessage(0, index);\n      this.kernel.send(finalMessages, id, this.options);\n      return true;\n    }\n  }\n\n  as;\n\n  /**\n   * 接收到消息\n   * @param {string} id - ID of the contactor\n   * @param {object} message - Message received from contactor\n   */\n  revMessage(message) {\n    this.updateLastUpdate();\n\n    const webMessage = this.kernel.convertMessage(message);\n\n    if (!this.active) this.messageChain.push(webMessage);\n    else this.emit(\"revMessage\", webMessage);\n\n    this.emit(\"updateMessageSummary\");\n    return webMessage;\n  }\n\n  /**\n   * 删除消息\n   * @param {string} message_id - ID of the message to be deleted\n   * @returns {boolean} - Whether the message is successfully deleted\n   */\n  delMessage(message_id) {\n    for (let i = 0; i < this.messageChain.length; i++) {\n      // 如果不是bot发的消息，跳过\n      if (this.messageChain[i].id === message_id && this.messageChain[i].role === 'other') {\n        if (this.active) this.emit(\"delMessage\", i);\n        else this.acting.messageChain.splice(i, 1);\n        this.makeSystemMessage(`${this.name}撤回了一条消息`);\n        return true; // 删除成功\n      }\n    }\n    return false; // 没有找到要删除的消息\n  }\n\n  makeSystemMessage(text) {\n    const container = {\n      role: \"mio_system\",\n      time: new Date().getTime(),\n      id: new Date().getTime(),\n      content: [\n        {\n          type: \"text\",\n          data: {\n            text: text,\n          },\n        },\n      ],\n    };\n    if (this.active) this.emit(\"revMessage\", container);\n    else this.messageChain.push(container);\n  }\n\n  getLastTime() {\n    const last = this.messageChain[this.messageChain.length - 1];\n    if (!last) {\n      return \"\";\n    }\n\n    const currentTime = new Date().getTime();\n    const lastTime = new Date(last.time);\n    const timeDiff = currentTime - lastTime.getTime();\n\n    if (timeDiff < 24 * 60 * 60 * 1000) {\n      this.toinit = false;\n      // 小于24小时，返回 xx:xx (小时:分钟)\n      const hours = lastTime.getHours().toString().padStart(2, \"0\");\n      const minutes = lastTime.getMinutes().toString().padStart(2, \"0\");\n      return `${hours}:${minutes}`;\n    } else if (timeDiff < 48 * 60 * 60 * 1000) {\n      // 小于48小时，显示昨天\n      return \"昨天\";\n    } else if (timeDiff < 7 * 24 * 60 * 60 * 1000) {\n      // 小于7天，返回星期x\n      const weekdays = [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\"];\n      const weekday = lastTime.getDay();\n      return `星期${weekdays[weekday]}`;\n    } else {\n      // 7天以上，返回xxxx/xx/xx（年/月/日）\n      const year = lastTime.getFullYear();\n      const month = (lastTime.getMonth() + 1).toString().padStart(2, \"0\");\n      const day = lastTime.getDate().toString().padStart(2, \"0\");\n      return `${year}/${month}/${day}`;\n    }\n  }\n\n  getShownTime(timestamp) {\n    const currentTime = new Date().getTime();\n    // 如果传入时间和当前时间差在24h以内，则显示时间\n\n    const timeDiff = currentTime - timestamp;\n    if (timeDiff < 24 * 60 * 60 * 1000) {\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `${hours}:${minutes}`;\n    } else if (timeDiff < 48 * 60 * 60 * 1000) {\n      // 小于48小时，显示昨天+时间\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `昨天${hours}:${minutes}`;\n    } else if (timeDiff < 7 * 24 * 60 * 60 * 1000) {\n      // 小于7天，返回星期x+时间\n      const weekdays = [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\"];\n      const weekday = new Date(timestamp).getDay();\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `星期${weekdays[weekday]}${hours}:${minutes}`;\n    } else {\n      // 7天以上，返回xxxx/xx/xx（年/月/日）+时间\n      const year = new Date(timestamp).getFullYear();\n      const month = (new Date(timestamp).getMonth() + 1)\n        .toString()\n        .padStart(2, \"0\");\n      const day = new Date(timestamp).getDate().toString().padStart(2, \"0\");\n      const hours = new Date(timestamp).getHours().toString().padStart(2, \"0\");\n      const minutes = new Date(timestamp)\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\");\n      return `${year}/${month}/${day} ${hours}:${minutes}`;\n    }\n  }\n\n  getLastMessageSummary(message) {\n    const getMessageText = (element) => {\n      switch (element.type) {\n        case \"text\":\n          return element.data.text;\n        case \"image\":\n          return \"[图片]\";\n        case \"record\":\n          return \"[语音]\";\n        case \"video\":\n          return \"[视频]\";\n        case \"file\":\n          return \"[文件]\";\n        case \"tool_call\":\n          return `[调用工具] ${element.data.name}`;\n        case \"reason\":\n          return element.data.text;\n        case \"blank\":\n          return \"正在思考中...\";\n        case \"reply\":\n          return \"\"; // 空字符串处理\n        case \"nodes\":\n          return \"[转发消息]\";\n        default:\n          return \"[未知消息类型] \" + element.type;\n      }\n    };\n\n    let msg = message || this.messageChain[this.messageChain.length - 1]\n    if (!msg) return \"\";\n    msg = JSON.parse(JSON.stringify(msg));\n    if (msg.type === \"node\") {\n      msg = msg.data\n    }\n\n    return getMessageText(msg.content ? msg.content[0] : msg);\n  }\n\n  updateFirstMessage() {\n    this.firstMessageIndex = this.messageChain.length;\n  }\n\n  updateLastUpdate() {\n    this.lastUpdate = new Date().getTime();\n  }\n\n  getMessageById(id) {\n    return this.messageChain.find((msg) => msg.id === id);\n  }\n\n  loadAvatar() {\n    let avatar = \"/static/icons/512*512.png\";\n    if (avatarPolicy[this.avatarPolicy] == \"MODEL\") {\n      const model = this.options.base.model;\n      avatar = Contactor.getAvatarByModel(model);\n    } else if (avatarPolicy[this.avatarPolicy] == \"CUSTOM\") {\n      avatar = this.avatar;\n    }\n\n    if (this.platform == \"openai\") {\n      this.title = this.options.base.model;\n    }\n\n    this.avatar = avatar;\n    return avatar;\n  }\n\n  async loadName() {\n    let name = this.name ?? \"未命名 Bot\";\n    if (namePolicy[this.namePolicy] == \"MODEL\") {\n      const model = this.options.model;\n      name = model;\n    } else if (namePolicy[this.namePolicy] == \"CUSTOM\") {\n      name = this.name;\n    } else if (namePolicy[this.namePolicy] == \"SUMMARY\") {\n      if (this.messageChain.length < 2) {\n        name = \"新建的 Bot\";\n      } else if (\n        this.messageChain.length == 2 ||\n        this.messageChain.length % 6 == 0\n      ) {\n        name = await this.getMessagesSummary();\n      }\n    }\n    this.name = name;\n    return name;\n  }\n\n  getMessagesSummary() {\n    if (this.platform == \"openai\") {\n      return this.kernel.getMessagesSummary(\n        this._getValidOpenaiMessage().slice(-4),\n      );\n    } else {\n      return \"仅支持 OpenAI Chat Bot\";\n    }\n  }\n\n  static getAvatarByModel(model) {\n    const modelOwner = config.getModelOwner(model);\n    return getAvatarByOwner(modelOwner);\n  }\n}\n","import EventEmitter from \"./event.js\";\nimport { randomString } from \"../utils/generate.js\";\nimport io from \"socket.io-client\";\n\n/**\n * WebSocket Connection Class\n * Handles WebSocket connection and message sending/receiving.\n */\nexport default class Socket extends EventEmitter {\n  /**\n   * Creates a Socket instance.\n   * @param {String} id - Robot QQ number\n   * @param {String} code - Login token\n   */\n  constructor(id, code) {\n    super();\n    this.available = null;\n    this.url = this.getURL();\n    this.socket = null;\n    this.code = code;\n    this.id = id;\n    this.requests = [];\n    this.pendingRequests = new Set(); // Track ongoing request_ids\n  }\n\n  /**\n   * Gets the WebSocket URL.\n   * @returns {String} WebSocket URL\n   */\n  getURL() {\n    const url = new URL(window.location.href);\n    // 保持原样，因为 io() 知道如何处理 host\n    return url.host;\n  }\n\n  /**\n   * Initializes WebSocket event listeners.\n   */\n  initEventListeners() {\n    if (!this.socket) return; // Safety check\n\n    // --- 清理旧监听器 (如果需要重新附加) ---\n    // 这对于确保在重新连接时不重复添加监听器很重要\n    // Socket.IO v3+ 的 off() 或 removeAllListeners()\n    this.socket.off(\"connect\");\n    this.socket.off(\"disconnect\");\n    this.socket.off(\"connect_error\");\n    this.socket.off(\"message\");\n    // --- 重新附加监听器 ---\n    this.socket.on(\"connect\", () => this.handleConnect());\n    this.socket.on(\"disconnect\", (reason) => this.handleDisconnect(reason)); // Pass reason\n    this.socket.on(\"connect_error\", (error) => this.handleConnectError(error));\n    this.socket.on(\"message\", (message) => this.messageHandler(message));\n  }\n\n  /**\n   * Handles the connect event.\n   */\n  handleConnect() {\n    this.available = true;\n    this.hasAttemptedPollingFallback = false; // Reset fallback flag on successful connect\n    this.isAttemptingWebSocket = false; // Reset attempt flag\n    const transport = this.socket.io?.engine?.transport?.name || \"unknown\";\n    console.log(`SocketIO connected successfully via: ${transport}`);\n  }\n\n  /**\n   * Handles the disconnect event.\n   * @param {String} reason - The reason for disconnection\n   */\n  handleDisconnect(reason) {\n    this.available = false;\n    console.error(`SocketIO disconnected. Reason: ${reason}`);\n    // 如果是 'io server disconnect' 或 'io client disconnect'，可能不需要自动重连或回退\n    // 如果是 'transport close' 或 'transport error'，Socket.IO 的 reconnection 机制会尝试处理\n    // 这里我们主要依赖 connect_error 来处理初始连接失败的回退\n  }\n\n  /**\n   * Handles the connect_error event.\n   * @param {Error} error - The error object\n   */\n  handleConnectError(error) {\n    this.emit(\"connect_error\", error);\n    // error 对象可能包含 transport 信息，例如 error.transport\n    console.log(\n      `Error occurred during ${this.isAttemptingWebSocket ? \"WebSocket\" : \"Polling\"} attempt.`,\n    );\n\n    // --- 手动回退逻辑 ---\n    // 1. 检查是否是 WebSocket 尝试失败\n    // 2. 检查是否 *已经* 尝试过回退到 Polling (防止无限循环)\n    if (this.isAttemptingWebSocket && !this.hasAttemptedPollingFallback) {\n      console.log(\n        \"WebSocket connection failed. Attempting fallback to Polling...\",\n      );\n      this.hasAttemptedPollingFallback = true; // Mark that we are now trying polling\n      this.isAttemptingWebSocket = false; // No longer attempting WebSocket initially\n\n      // 清理当前的 socket 实例\n      if (this.socket) {\n        this.socket.disconnect(); // 或 .close()\n        this.socket = null;\n      }\n\n      // 延迟一小段时间再尝试 Polling，避免立即重试可能遇到的瞬时问题\n      setTimeout(() => {\n        // 发起只使用 Polling 的新连接\n        this._connectWithTransport([\"polling\"]);\n      }, 500); // 延迟 500ms (可调整)\n    } else if (!this.isAttemptingWebSocket) {\n      // Polling 尝试也失败了\n      console.error(\"Polling connection attempt also failed.\");\n      this.available = false;\n      // 这里可以决定是否彻底放弃，或者依赖 Socket.IO 的 reconnection 机制（如果开启）\n      // 如果 Socket.IO 的 reconnection 开启，它会继续尝试用 polling 重连\n    } else {\n      // 如果 isAttemptingWebSocket 为 true 但 hasAttemptedPollingFallback 也为 true\n      // 理论上不应该发生，但作为保险\n      console.warn(\"Unexpected state in handleConnectError.\");\n      this.available = false;\n    }\n  }\n\n  /**\n   * Internal connect method allowing transport specification.\n   * @param {String[]} transports - Array of transports to use.\n   */\n  _connectWithTransport(transports) {\n    console.log(\n      `Attempting to connect using transports: ${transports.join(\", \")}...`,\n    );\n    // 确保清理可能存在的旧 socket\n    if (this.socket) {\n      this.socket.disconnect();\n    }\n\n    this.socket = io(this.url, {\n      path: \"/socket.io\",\n      transports: transports, // <-- 使用指定的 transports\n      auth: { id: this.id, token: this.code },\n      reconnection: true, // 保持开启，让 Socket.IO 处理后续的重连尝试\n      reconnectionAttempts: Infinity, // 可以为 polling 设置不同的重试次数\n      reconnectionDelay: 2000,\n      reconnectionDelayMax: 10000,\n      timeout: 15000, // 可以为 polling 调整超时\n      // 重要：强制新的连接尝试，而不是升级现有连接（如果适用）\n      // 对于 polling，这通常不是问题，但加上无妨\n      forceNew: true,\n    });\n\n    this.initEventListeners(); // 为新的 socket 实例初始化事件监听\n  }\n\n  /**\n   * Connects to the SocketIO server, starting with WebSocket.\n   */\n  async connect() {\n    if (this.socket && this.socket.connected) {\n      console.log(\"Already connected.\");\n      return;\n    }\n    this.isAttemptingWebSocket = true; // Mark that we are starting with WebSocket\n    this.hasAttemptedPollingFallback = false; // Reset fallback state\n    this._connectWithTransport([\"websocket\"]); // Start with WebSocket only\n  }\n\n  /**\n   * Disconnects from the WebSocket server.\n   */\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect(); // 使用 disconnect 更优雅\n      // socket 实例会在 disconnect 事件后由库内部清理或重用（如果重连）\n      // 我们可以在 handleDisconnect 中或这里设置 this.socket = null，取决于你的状态管理需求\n      // this.socket = null; // 如果希望彻底断开后清理引用\n      this.available = false;\n      console.log(\"Manual disconnection initiated.\");\n    }\n  }\n\n  /**\n   * Handles incoming messages.\n   * @param {String} message - The received message\n   */\n  messageHandler(message) {\n    console.log(\"WebSocket received message\", message);\n    try {\n      const e = JSON.parse(message);\n      if (e.protocol === \"llm\") {\n        this.emit(e.request_id, e);\n        this.emit(\"llm_message\", e);\n      }\n      if (e.protocol === \"onebot\") {\n        this.emit(\"onebot_message\", e);\n      } else if (e.protocol === \"system\") {\n        if (e.type === \"login\") this.emit(\"connect\", e.data);\n        this.emit(\"system_message\", e);\n      }\n      this.emit(e.request_id, e)\n      this.pendingRequests.delete(e.request_id); // Remove request_id\n    } catch (error) {\n      console.error(\"JSON parsing failed:\", error, \"Received:\", message); // Log received message on error\n    }\n  }\n\n  /**\n   * Sends a message.\n   * @param {Object} message - The message object to send\n   */\n  sendMessage(message) {\n    // 在发送前检查连接状态\n    // 注意：即使 available 为 true，socket 也可能在发送瞬间断开\n    // Socket.IO 客户端通常会缓存消息并在重连后发送，但要了解这个行为\n    if (!this.socket || !this.socket.connected) {\n      // 使用 socket.connected 更准确\n      console.warn(\"SocketIO not connected. Message sending skipped.\", message);\n      // 可以考虑将消息放入队列稍后重试，但这会增加复杂性\n      this.pendingRequests.delete(message.request_id); // 如果不发送，也应该移除 pending 状态\n      return Promise.reject(new Error(\"Socket not connected\")); // 让调用者知道失败了\n    }\n\n    // --- 原有的 pendingRequest 检查逻辑 ---\n    if (this.pendingRequests.has(message.request_id)) {\n      console.warn(\n        `Duplicate request_id: ${message.request_id}, request blocked`,\n      );\n      // 考虑是否应该 reject Promise 或返回特定错误\n      return Promise.reject(\n        new Error(`Duplicate request_id: ${message.request_id}`),\n      );\n    }\n    this.pendingRequests.add(message.request_id);\n    // --- 发送消息 ---\n    try {\n      this.socket.emit(\"message\", JSON.stringify(message));\n      console.log(\"WebSocket sending request\", message);\n      // 注意：emit 是异步的，但通常不返回 Promise\n      // 如果需要确认服务器收到，需要服务器发送回执\n      return Promise.resolve(); // 表示发送尝试已发出\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      this.pendingRequests.delete(message.request_id); // 发送失败，移除 pending 状态\n      return Promise.reject(error); // 传递错误\n    }\n  }\n\n  /**\n   * Sends a request and waits for a response.\n   * @param {String} url - API endpoint\n   * @param {Object} data - Request data\n   * @returns {Promise<any>} Response data\n   */\n  fetch(url, data) {\n    return new Promise((resolve, reject) => {\n      const pathArray = url.split(\"/\").filter(Boolean);\n      const request = {\n        request_id: randomString(16),\n        protocol: pathArray[1],\n        type: pathArray[2],\n        id: pathArray[3],\n        data: data,\n        metaData: {\n          contactorId: this.id,\n        },\n      };\n      const timeOut = new Promise((_, reject) => {\n        setTimeout(() => {\n          this.pendingRequests.delete(request.request_id); // Remove on timeout\n          reject(\"timeout\");\n        }, 60000);\n      });\n      const response = new Promise((resolve) => {\n        this.on(request.request_id, (res) => {\n          this.pendingRequests.delete(request.request_id); // Remove on response\n          resolve(res.data);\n        });\n      });\n      Promise.race([timeOut, response])\n        .then(resolve)\n        .catch(reject)\n        .finally(() => {\n          this.off(request.request_id);\n        });\n      this.sendMessage(request); // Use sendMessage to send the request\n      console.log(\"WebSocket sending request\", url, request);\n    });\n  }\n\n  /**\n   * Streams completion data.\n   * @param {Object} data - Completion request data\n   * @returns {AsyncGenerator<any>} - Completion data generator\n   */\n  streamCompletions(data, metaData) {\n    const request_id = randomString(16);\n    const request = {\n      request_id,\n      protocol: \"llm\",\n      type: \"completions\",\n      data: data,\n      metaData,\n    };\n    this.sendMessage(request);\n    console.log(\"WebSocket sending request\", request);\n  }\n}\n","import localforage from \"localforage\";\nimport { reactive } from \"vue\";\nimport { debounce } from \"../utils/tools.js\";\nimport UploadWorker from \"../worker/fileUpload.js?worker\";\nimport Contactor from \"./contactor.js\";\nimport EventEmitter from \"./event.js\";\nimport Socket from \"./websocket.js\";\n\n// Configure localforage\nlocalforage.config({\n  name: \"mio-chat\",\n});\n\nexport default class Client extends EventEmitter {\n  constructor(config) {\n    super();\n    this.inited = false;\n    this.id = null; // Loaded from storage\n    this.code = null; // Loaded from storage\n    this.isConnected = false; // Dynamic\n    this.contactList = []; // Loaded from storage\n    this.socket = null; // Dynamic\n    this.qq = null; // Web\n    this.bot_qq = null; // Web\n    this.avatar = null; // Web\n    this.onPhone = null; // Dynamic\n    this.title = \"Mio\"; // Fixed\n    this.name = \"user\"; // Fixed\n    this.config = config; // Parameter\n\n    this.setLocalStorage = debounce(this.setLocalStorage.bind(this), 500); // 防抖时间设置为 1000 毫秒 (1 秒)\n  }\n\n  /**\n   * Prepare initialization\n   * @returns {object} Initialization information\n   */\n  async preInit() {\n    const localBaseInfo = this.config.getBaseConfig();\n    if (Object.keys(localBaseInfo).length === 0) {\n      await this.loadOriginBaseInfo();\n    } else {\n      this.loadOriginBaseInfo();\n      this.loadBaseInfo(localBaseInfo);\n    }\n\n    const localStorage = await this.getLocalStorage();\n    if (localStorage) {\n      this.loadLocalStorage(localStorage);\n    }\n\n    this.inited = true;\n    this.emit(\"loaded\");\n  }\n\n  genDefaultConctor(info) {\n    if (info.onebot_enabled) {\n      // Create default OneBot contactor\n      const onebotConfig = {\n        id: this.genFakeId(),\n        name: \"OneBot\",\n        namePolicy: 1,\n        avatarPolicy: 1,\n        avatar: `/p/qava?q=${this.bot_qq ?? 1099834705}`,\n        title: \"云崽\",\n        priority: 0,\n        options: {},\n        lastUpdate: -Infinity,\n      };\n      this.addConcator(\"onebot\", onebotConfig);\n    }\n\n    const options = this.config.getLLMDefaultConfig();\n    // const allTools = Object.values(this.config.llmTools).map((tool) => (\n    //   ...Object.keys(tool)\n    // ));\n    const allTools = [];\n    for (const key in this.config.llmTools) {\n      allTools.push(...Object.keys(this.config.llmTools[key]));\n    }\n    options.toolCallSettings.tools = allTools;\n\n    const LLMDefaultConfig = {\n      id: this.genFakeId(),\n      name: \"MioBot\",\n      avatar: \"/static/icons/512x512.png\",\n      namePolicy: 1,\n      avatarPolicy: 1,\n      title: \"chat\",\n      priority: 0,\n      lastUpdate: -Infinity,\n      options,\n    };\n\n    this.addConcator(\"openai\", LLMDefaultConfig);\n  }\n\n  async addConcator(platform, config) {\n    const bot = new Contactor(platform, config);\n    bot.loadName();\n    bot.loadAvatar();\n\n    const list = reactive(this.contactList);\n    list.push(bot);\n    await this.setLocalStorage();\n    return bot;\n  }\n\n  rmContactor(id) {\n    const list = reactive(this.contactList);\n    const index = list.findIndex((item) => item.id == id);\n\n    if (index != -1) {\n      list.splice(index, 1);\n      this.setLocalStorage();\n    }\n  }\n\n  async loadOriginalContactors(shareId) {\n    const path = `/api/share?id=${shareId}`;\n    let contactor = null;\n    try {\n      const res = await fetch(path);\n      const data = await res.json();\n      if (data.code == 0) {\n        contactor = data.data.contactor;\n        // 检查是否已经存在\n        if (!this.getContactor(contactor.id)) {\n          this.addConcator(contactor.platform, contactor);\n        }\n        return true;\n      } else {\n        console.error(\"Failed to load original contactors:\", data.message);\n        return false;\n      }\n    } catch (error) {\n      console.error(\"Failed to load original contactors:\", error);\n      return false;\n    }\n  }\n\n  async shareContactor(id) {\n    const uploadResult = await this.setOriginalContactor(id);\n    if (uploadResult) {\n      return uploadResult;\n    } else {\n      return null;\n    }\n  }\n\n  async setOriginalContactor(id) {\n    const path = `/api/share/set`;\n    const body = {\n      contactor: this.getContactor(id),\n    };\n    try {\n      const res = await fetch(path, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(body),\n      });\n      const data = await res.json();\n      if (data.code == 0) {\n        return data.data;\n      }\n    } catch (error) {\n      console.error(\"Failed to set original contactor:\", error);\n      return null;\n    }\n  }\n\n  async reset() {\n    localforage.clear();\n    localStorage.clear();\n    try {\n      await this.resetCache();\n    } catch (error) {\n      console.error(\"Failed to reset cache:\", error);\n    }\n    return true;\n  }\n\n  async resetCache() {\n    try {\n      // 2. Send a message to the active Service Worker to clear its cache\n      if (navigator.serviceWorker.controller) {\n        console.log(\n          \"Sending message to active Service Worker to clear cache...\",\n        );\n        await new Promise((resolve, reject) => {\n          const messageChannel = new MessageChannel();\n          messageChannel.port1.onmessage = (event) => {\n            if (event.data.type === \"IDB_CACHE_CLEARED\") {\n              console.log(\"Service Worker cache cleared successfully.\");\n              resolve();\n            } else if (event.data.type === \"IDB_CACHE_CLEAR_FAILED\") {\n              console.error(\n                \"Service Worker cache clear failed:\",\n                event.data.error,\n              );\n              reject(event.data.error);\n            } else {\n              reject(new Error(\"Unknown message from Service Worker\"));\n            }\n          };\n          messageChannel.port1.onerror = (error) => {\n            console.error(\"Message port error:\", error);\n            reject(error);\n          };\n          navigator.serviceWorker.controller.postMessage(\n            { type: \"CLEAR_IDB_CACHE\" },\n            [messageChannel.port2],\n          );\n        });\n      } else {\n        console.log(\n          \"No active Service Worker found. Skipping cache clear message.\",\n        );\n      }\n\n      // 1. Unregister all service workers\n      const registrations = await navigator.serviceWorker.getRegistrations();\n      if (registrations && registrations.length > 0) {\n        console.log(\n          `Found ${registrations.length} registered Service Workers, unregistering...`,\n        );\n        for (const registration of registrations) {\n          // Use a for...of loop for cleaner async/await\n          try {\n            const unregistered = await registration.unregister();\n            if (unregistered) {\n              console.log(\n                `Service Worker ${registration.scope} unregistered successfully`,\n              );\n            } else {\n              console.warn(\n                `Service Worker ${registration.scope} unregistration failed`,\n              );\n            }\n          } catch (error) {\n            console.error(\n              `Failed to unregister Service Worker ${registration.scope}:`,\n              error,\n            );\n            // We don't reject here, to attempt to unregister other SWs. Log it, though.\n          }\n        }\n        console.log(\n          \"All Service Workers unregistration completed (with possible errors).\",\n        );\n      } else {\n        console.log(\"No registered Service Workers found.\");\n      }\n\n      return true; // Indicate success\n    } catch (error) {\n      console.error(\"Error during cache reset:\", error);\n      throw error; // Re-throw the error to be caught by the caller\n    }\n  }\n\n  everLogin() {\n    const stroge = localStorage.getItem(\"everLogin\");\n    if (stroge) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  setEverLogin() {\n    localStorage.setItem(\"everLogin\", true);\n  }\n\n  async init() {\n    await this.preInit();\n    if (this.everLogin()) {\n      console.log(\"Detected cache, attempting automatic reconnection\");\n      this.isConnected = false;\n      this.login(this.code);\n    } else {\n      console.log(\"Not logged in before, please login first\");\n    }\n  }\n\n  getContactors() {\n    return this.contactList;\n  }\n\n  getContactor(id, onebotId = null) {\n    if (onebotId) {\n      // TODO: 拓展 Onebot 协议功能，实现 IM\n      return this.contactList.find((item) => item.platform == \"onebot\");\n    } else {\n      return this.contactList.find((item) => item.id == id);\n    }\n  }\n\n  /**\n   * 生成一个保证唯一的10位纯数字ID\n   * 结合设备ID(this.id)、时间戳和随机数\n   * @returns {string} 10位纯数字ID\n   */\n  genFakeId() {\n    // 获取当前时间戳的后6位\n    const timestamp = Date.now().toString().slice(-6);\n    // 生成2位随机数\n    const randomNum = Math.floor(Math.random() * 100).toString().padStart(4, '1');\n\n    return randomNum + timestamp;\n  }\n\n  /**\n   * Get user information from localStorage\n   * @returns {object|false} User information or false if not found\n   */\n  async getLocalStorage() {\n    const client = await localforage.getItem(\"client\");\n    if (client) {\n      const localConfig = JSON.parse(client);\n      return localConfig;\n    } else {\n      // First-time user\n      this.id = this.genFakeId();\n      this.code = null;\n      return null;\n    }\n  }\n\n  /**\n   * Load user information from localStorage\n   * @param {object} client User information\n   */\n  loadLocalStorage(client) {\n    this.id = client.id;\n    this.code = client.code;\n\n    // If contact list exists, instantiate as contact objects\n    if (client.contactList && client.contactList.length != 0) {\n      this.contactList = client.contactList.map(\n        (item) => new Contactor(item.platform, item),\n      );\n    } else {\n      this.contactList = [];\n    }\n  }\n\n  /**\n   * Save user information to localStorage\n   */\n  async setLocalStorage() {\n    // await localforage.setItem(\"client\", JSON.stringify(this));\n    const client = {\n      id: this.id,\n      code: this.code,\n      contactList: this.contactList,\n    };\n    await localforage.setItem(\"client\", JSON.stringify(client));\n    console.log(\"Client saved\");\n  }\n\n  /**\n   * Login\n   * @param {string} code Access code\n   * @returns {Promise} Login result\n   */\n  async login(code) {\n    this.code = code;\n\n    return new Promise((resolve, reject) => {\n      const socket = new Socket(this.id, this.code);\n\n      socket.on(\"connect\", async (info) => {\n        console.log(\"Login successful\");\n        this.isConnected = true;\n        this.socket = socket;\n        this.config.setLlmModels(info.models);\n        this.addMsgListener();\n        if (this.contactList.length == 0) {\n          this.genDefaultConctor(info);\n        }\n        this.setEverLogin();\n        this.setLocalStorage();\n        resolve(info);\n      });\n\n      socket.on(\"connect_error\", (error) => {\n        console.log(\"Login failed\", error);\n        this.isConnected = false;\n        reject(error.message);\n      });\n\n      socket.connect();\n    });\n  }\n\n  addMsgListener() {\n    this.socket.on(\"onebot_message\", (e) => {\n      console.log(e);\n      const data = e.data;\n      const id = data.id;\n      const content = data.content;\n      const type = data.type;\n\n      if (type == \"message\") {\n        const contactor = this.getContactor(id, 10000);\n        if (contactor) {\n          contactor.revMessage(content);\n          this.setLocalStorage();\n        } else {\n          console.log(\"Contactor not found\");\n        }\n      } else if (type == \"del_msg\") {\n        const onebotContactors = this.contactList.filter(\n          (item) => item.platform == \"onebot\",\n        );\n        for (const onebotContactor of onebotContactors) {\n          const deleted = onebotContactor.delMessage(content.message_id);\n          if (deleted) {\n            this.setLocalStorage();\n            console.log(\"Message deleted successfully\");\n            break;\n          }\n        }\n      }\n    });\n\n    this.socket.on(\"llm_message\", (e) => {\n      const data = e.data;\n      const { metaData } = data;\n      if (metaData.contactorId) {\n        const contactor = this.getContactor(metaData.contactorId);\n        if (contactor) {\n          contactor.handleLLMMessageEvent(e);\n          // this.setLocalStorage();\n        }\n      }\n    });\n\n    this.socket.on(\"system_message\", (e) => {\n      try {\n        // 支持后端推送的 models/providers 更新\n        if (e && e.type === 'models_updated' && e.data) {\n          const { providers, models, default_model } = e.data;\n\n          // 更新 Config 中的 llmModels\n          if (models && this.config && typeof this.config.setLlmModels === 'function') {\n            this.config.setLlmModels(models);\n            console.log('LLM models updated from system message');\n          }\n\n          // 更新 baseConfig 中的 providers 列表 (llm_providers)\n          if (providers && this.config && typeof this.config.updateBaseConfig === 'function') {\n            try {\n              // 检查是否是新的 API 结构（providers 数组中包含 default_model）\n              const hasNewStructure = providers.some(p => p.default_model !== undefined);\n              \n              if (hasNewStructure) {\n                // 新结构：直接使用 providers 数组\n                this.config.updateBaseConfig({ llm_providers: providers });\n              } else {\n                // 旧结构：同时传递 providers 和 default_model\n                this.config.updateBaseConfig({ llm_providers: providers, default_model });\n              }\n              console.log('LLM providers updated from system message');\n            } catch (err) {\n              console.error('Failed to update baseConfig.llm_providers:', err);\n            }\n          }\n\n          // 广播事件给客户端监听者（比如 UI）\n          this.emit('models_updated', { providers, models });\n          return;\n        }\n\n        console.log(\"System message received:\", e);\n      } catch (err) {\n        console.error('Error handling system_message:', err, e);\n      }\n    });\n  }\n\n  /**\n   * Logout\n   */\n  async logout() {\n    this.isConnected = false;\n    this.socket.disconnect();\n    this.socket = null;\n    this.setLocalStorage();\n  }\n\n  /**\n   * Set base information\n   * @returns {Promise} Base information\n   */\n  async loadOriginBaseInfo() {\n    const res = await fetch(\"/api/base_info\");\n    const { data } = await res.json();\n    this.config.setBaseConfig(data);\n    this.loadBaseInfo(data);\n\n    return data;\n  }\n\n  loadBaseInfo(data) {\n    this.admin_qq = data.admin_qq;\n    this.bot_qq = data.bot_qq;\n\n    this.avatar = `/p/qava?q=${this.admin_qq}`;\n\n    const onebotContactor = this.getContactor(null, 10000);\n    if (onebotContactor) {\n      onebotContactor.avatar = `/p/qava?q=${this.bot_qq}`;\n    }\n  }\n\n  /**\n   * Upload file or image\n   * @param {File|Blob|string} fileOrImage - File object, Blob, or base64 string for images\n   * @param {Object} options - Upload options\n   * @param {boolean} options.isImage - Indicates if upload is an image\n   * @param {Function} options.onProgress - Progress callback (percent complete)\n   * @returns {Promise<Object>} Upload result\n   */\n  async uploadFile(fileOrImage, options = {}) {\n    const { isImage = false, onProgress = null } = options;\n\n    // Handle image upload (base64 string or blob)\n    if (\n      isImage ||\n      (typeof fileOrImage === \"string\" && fileOrImage.startsWith(\"data:\"))\n    ) {\n      return this.uploadImage(fileOrImage);\n    }\n\n    const file = fileOrImage;\n    return new Promise((resolve, reject) => {\n      const chunkSize = 1024 * 1024; // 1MB\n      let md5Hash = null;\n\n      const finalizeUpload = async (totalChunks) => {\n        try {\n          const response = await fetch(\"/api/upload/finalize\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              totalChunks,\n              md5: md5Hash,\n              filename: file.name,\n            }),\n          });\n\n          if (!response.ok) {\n            throw new Error(`HTTP error ${response.status}`);\n          }\n\n          const data = await response.json();\n          resolve(data);\n        } catch (error) {\n          reject({ error: `Finalization error: ${error.message}` });\n        }\n      };\n\n      const uploadChunk = async (chunk, index, totalChunks) => {\n        return new Promise((resolve, reject) => {\n          const formData = new FormData();\n          formData.append(\"file\", chunk);\n          formData.append(\"md5\", md5Hash);\n          formData.append(\"chunkIndex\", index);\n          formData.append(\"totalChunks\", totalChunks);\n          formData.append(\"filename\", file.name);\n\n          const xhr = new XMLHttpRequest();\n          xhr.open(\"POST\", \"/api/upload/chunk\", true);\n\n          // Track progress if callback provided\n          if (onProgress) {\n            xhr.upload.onprogress = (event) => {\n              if (event.lengthComputable) {\n                // Calculate overall progress based on chunks\n                const chunkProgress = event.loaded / event.total;\n                const overallProgress =\n                  (index / totalChunks + (1 / totalChunks) * chunkProgress) *\n                  100;\n                onProgress(Math.round(overallProgress));\n              }\n            };\n          }\n\n          xhr.onload = () => {\n            if (xhr.status >= 200 && xhr.status < 300) {\n              resolve(); // Successful upload\n            } else {\n              reject(xhr.statusText); // Failed upload\n            }\n          };\n\n          xhr.onerror = () => {\n            reject(\"Network Error\");\n          };\n\n          xhr.send(formData);\n        });\n      };\n\n      const uploadFileChunks = async () => {\n        if (!file || !md5Hash) {\n          return reject({ error: \"Invalid file or missing hash\" });\n        }\n\n        const totalChunks = Math.ceil(file.size / chunkSize);\n\n        try {\n          for (\n            let currentChunk = 0;\n            currentChunk < totalChunks;\n            currentChunk++\n          ) {\n            const start = currentChunk * chunkSize;\n            const end = Math.min(start + chunkSize, file.size);\n            const chunk = file.slice(start, end);\n\n            await uploadChunk(chunk, currentChunk, totalChunks);\n          }\n\n          // All chunks uploaded, finalize\n          await finalizeUpload(totalChunks);\n        } catch (error) {\n          reject({ error: `Upload error: ${error}` });\n        }\n      };\n\n      // Start worker to calculate MD5\n      const worker = new UploadWorker();\n      worker.postMessage({ file, chunkSize });\n\n      worker.onmessage = (e) => {\n        if (e.data.hash) {\n          md5Hash = e.data.hash;\n          console.log(\"MD5 calculated. Starting upload...\");\n          uploadFileChunks();\n        } else if (e.data.error) {\n          reject({ error: e.data.error });\n          worker.terminate();\n        }\n      };\n\n      worker.onerror = (error) => {\n        console.error(\"Worker error:\", error);\n        reject({ error: `Worker error: ${error.message}` });\n        worker.terminate();\n      };\n    });\n  }\n\n  /**\n   * Upload image (now integrated into uploadFile)\n   * @param {string|Blob} image - Base64 string or Blob\n   * @returns {Promise<Object>} Upload result\n   */\n  async uploadImage(formData) {\n    try {\n      const response = await fetch(\"/api/upload/image\", {\n        method: \"POST\",\n        body: formData,\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error(\"Error uploading image:\", error);\n      throw error; // Re-throw to be handled by caller\n    }\n  }\n\n  /**\n   * Convert Blob to base64 string\n   * @param {Blob} blob - Image blob\n   * @returns {Promise<string>} Base64 string\n   */\n  async _convertBlobToBase64(blob) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onloadend = () => resolve(reader.result);\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n}\n","// =============================================================\n// 常量定义\n// =============================================================\n\n// 工具调用模式\nconst TOOL_CALL_MODEDS = {\n  AUTO: \"AUTO\", // 自动模式，由模型决定是否调用工具\n  ANY: \"ANY\", // 任意模式，强制模型必须调用一个或多个工具\n  NONE: \"NONE\", // 无模式，强制模型不调用任何工具\n};\n\n// Gemini 安全设置 - 阻止阈值\nconst GEMINI_SAFETY_BLOCK_SETTINGS = {\n  NONE: \"BLOCK_NONE\", // 不阻止\n  LOW: \"BLOCK_ONLY_HIGH\", // 仅阻止高可能性内容\n  MEDIUM: \"BLOCK_MEDIUM_AND_ABOVE\", // 阻止中等及以上可能性内容\n  HIGH: \"BLOCK_LOW_AND_ABOVE\", // 阻止低等及以上可能性内容 (最严格)\n  DEFAULT: \"BLOCK_NONE\", // 默认设置为不阻止\n};\n\n// Gemini 安全设置 - 危害类别\nconst GEMINI_SAFETY_SETTINGS_TYPE = {\n  HARASSMENT: \"HARM_CATEGORY_HARASSMENT\", // 骚扰\n  HATE_SPEECH: \"HARM_CATEGORY_HATE_SPEECH\", // 仇恨言论\n  SEXUALLY_EXPLICIT: \"HARM_CATEGORY_SEXUALLY_EXPLICIT\", // 色情内容\n  DANGEROUS_CONTENT: \"HARM_CATEGORY_DANGEROUS_CONTENT\", // 危险内容\n  // CIVIC_INTEGRITY: \"HARM_CATEGORY_CIVIC_INTEGRITY\", // 如果需要，可以取消注释\n};\n\n// localStorage 中存储配置的主键\nconst CONFIG_KEY = \"app_config_v1\"; // 建议使用带版本号的键名\n\n// =============================================================\n// Config 类定义\n// =============================================================\n\nexport default class Config {\n  constructor() {\n    // --- 初始化实例属性 ---\n    this.localPresets = []; // 本地预设列表\n    this.toolsConfig = {}; // 工具特定配置 (如果需要)\n    this.llmTools = []; // 从后端加载的可用 LLM 工具列表/结构\n    this.onebotConfig = null; // OneBot 相关配置\n    this.llmModels = {}; // 按 provider 分类的可用 LLM 模型列表 { provider: [{ group, owner, models }], ... }\n    this.safetyConfig = {}; // 当前的安全设置状态 (可能用于UI显示或其他直接访问)\n    this.baseConfig = {}; // 基础配置，如 API Keys, providers 列表等\n    this.LLMDefaultConfig = {}; // 核心：存储合并后的默认 LLM 配置，会包含用户设置\n    this.baseConfigCallback = null; // baseConfig 变更时的回调函数\n\n    // --- 初始化流程 ---\n    // 1. 尝试从 localStorage 加载现有配置\n    this._loadStrogeConfig();\n\n    // 2. 初始化/验证安全设置状态 (简化版)\n    this.initSafetyConfig();\n\n    // 3. 初始化 LLM 默认配置 (核心：合并逻辑)\n    this.initLLMDefaultConfig();\n\n    // 4. 异步加载外部数据 (如可用工具、OneBot 插件等)\n    //    添加了错误捕获，防止加载失败影响主流程\n    this.loadllmTools().catch((error) =>\n      console.error(\"加载 LLM 工具失败:\", error)\n    );\n    this.loadonebotConfig().catch((error) =>\n      console.error(\"加载 OneBot 配置失败:\", error)\n    );\n\n    // 5. 如果是首次运行 (未从 localStorage 加载到配置), 则保存初始配置\n    if (!this._getLocalStorage(CONFIG_KEY)) {\n      console.log(\"未找到本地存储配置，保存初始默认配置。\");\n      this._saveStrogeConfig();\n    }\n  }\n\n  // --- 内部辅助方法：LocalStorage 操作 ---\n\n  /**\n   * 统一设置 localStorage\n   * @param {string} key - 存储键名\n   * @param {any} data - 需要存储的数据\n   */\n  _setLocalStorage(key, data) {\n    try {\n      localStorage.setItem(key, JSON.stringify(data));\n    } catch (error) {\n      console.error(`保存到 localStorage 时出错 (Key: ${key}):`, error);\n      // 可以考虑添加更复杂的错误处理，例如提示用户存储空间不足\n    }\n  }\n\n  /**\n   * 统一获取 localStorage\n   * @param {string} key - 读取键名\n   * @returns {any | null} - 解析后的数据，如果不存在或解析失败则返回 null\n   */\n  _getLocalStorage(key) {\n    try {\n      const storedValue = localStorage.getItem(key);\n      if (storedValue === null || storedValue === undefined) {\n        return null;\n      }\n      return JSON.parse(storedValue);\n    } catch (error) {\n      console.error(`从 localStorage 读取或解析时出错 (Key: ${key}):`, error);\n      // 清除可能已损坏的数据\n      localStorage.removeItem(key);\n      return null;\n    }\n  }\n\n  // --- 内部辅助方法：集中保存和加载配置 ---\n\n  /**\n   * 将当前实例的所有配置状态保存到 localStorage\n   */\n  _saveStrogeConfig() {\n    const configToSave = {\n      localPresets: this.localPresets,\n      toolsConfig: this.toolsConfig,\n      llmTools: this.llmTools, // 注意：频繁保存从API获取的数据可能不是最佳实践，取决于更新频率\n      onebotConfig: this.onebotConfig,\n      llmModels: this.llmModels,\n      baseConfig: this.baseConfig,\n      safetyConfig: this.safetyConfig, // 保存当前的安全设置状态\n      LLMDefaultConfig: this.LLMDefaultConfig, // 保存包含用户设置的默认配置\n    };\n    this._setLocalStorage(CONFIG_KEY, configToSave);\n    console.log(\"配置已保存到 localStorage。\");\n  }\n\n  /**\n   * 从 localStorage 加载配置并应用到当前实例\n   */\n  _loadStrogeConfig() {\n    const loadedConfig = this._getLocalStorage(CONFIG_KEY);\n    if (loadedConfig) {\n      console.log(\"从 localStorage 加载配置:\", loadedConfig);\n      // 使用 nullish coalescing (??) 为缺失的属性提供默认值\n      this.localPresets = loadedConfig.localPresets ?? [];\n      this.toolsConfig = loadedConfig.toolsConfig ?? {};\n      this.llmTools = loadedConfig.llmTools ?? [];\n      this.onebotConfig = loadedConfig.onebotConfig ?? null;\n      this.llmModels = loadedConfig.llmModels ?? {};\n      this.baseConfig = loadedConfig.baseConfig ?? {};\n      this.safetyConfig = loadedConfig.safetyConfig ?? {}; // 加载保存的安全状态\n      this.LLMDefaultConfig = loadedConfig.LLMDefaultConfig ?? {}; // 加载保存的LLM配置\n    } else {\n      console.log(\"未在 localStorage 中找到配置，将使用初始默认值。\");\n      // 初始默认值在构造函数和初始化方法中设置\n    }\n  }\n\n  // --- 内部辅助方法：递归合并默认配置 ---\n  /**\n   * 递归地将默认属性合并到目标对象中，并删除目标对象中不存在于默认对象的属性。\n   * 仅当目标对象缺少某个键时，才会从默认对象添加该键及其值。\n   * 不会覆盖目标对象中已存在的属性值。\n   * 能正确处理嵌套对象。\n   * 会删除目标对象中存在但默认对象中不存在的属性。\n   * @param {object} target - 需要合并默认值的目标对象 (例如 this.LLMDefaultConfig)\n   * @param {object} defaults - 包含默认值的源对象\n   * @returns {object} - 修改后的目标对象\n   */\n  _mergeDefaultsRecursive(target, defaults) {\n    if (\n      !target ||\n      typeof target !== \"object\" ||\n      !defaults ||\n      typeof defaults !== \"object\"\n    ) {\n      console.warn(\"递归合并需要有效的 target 和 defaults 对象。\");\n      return target; // 如果输入无效，返回原始 target\n    }\n\n    // 第一步：删除目标对象中存在但默认对象中不存在的属性\n    for (const key in target) {\n      if (Object.prototype.hasOwnProperty.call(target, key)) {\n        // 如果默认对象中不存在该键，则删除\n        if (!(key in defaults)) {\n          delete target[key];\n        }\n      }\n    }\n\n    // 第二步：按照原逻辑合并默认值\n    for (const key in defaults) {\n      // 确保 key 是 defaults 自身的属性，而不是继承来的\n      if (Object.prototype.hasOwnProperty.call(defaults, key)) {\n        const defaultValue = defaults[key];\n        const targetValue = target[key];\n\n        // 情况 1: 目标对象中不存在该键\n        if (!(key in target)) {\n          if (\n            typeof defaultValue === \"object\" &&\n            defaultValue !== null &&\n            !Array.isArray(defaultValue)\n          ) {\n            // 如果默认值是对象，进行深拷贝（通过递归创建新对象）\n            target[key] = this._mergeDefaultsRecursive({}, defaultValue);\n          } else if (Array.isArray(defaultValue)) {\n            // 如果默认值是数组，进行浅拷贝\n            target[key] = [...defaultValue];\n          } else {\n            // 如果默认值是原始类型，直接赋值\n            target[key] = defaultValue;\n          }\n        }\n        // 情况 2: 目标对象中存在该键，并且两者都是普通对象\n        else if (\n          typeof defaultValue === \"object\" &&\n          defaultValue !== null &&\n          !Array.isArray(defaultValue) &&\n          typeof targetValue === \"object\" &&\n          targetValue !== null &&\n          !Array.isArray(targetValue)\n        ) {\n          // 递归进入下一层进行合并（包括删除不存在的属性）\n          this._mergeDefaultsRecursive(targetValue, defaultValue);\n        }\n        // 情况 3: 目标对象中存在该键，但类型不匹配或不是普通对象\n        // 则保留目标对象中的现有值，不进行任何操作\n      }\n    }\n\n    return target; // 返回修改后的 target 对象\n  }\n\n  // --- 初始化方法 ---\n\n  /**\n   * 初始化或验证 this.safetyConfig (当前安全设置状态)。\n   * 主要确保它是一个包含所有必需安全类别的对象。\n   */\n  initSafetyConfig() {\n    const requiredCategories = Object.values(GEMINI_SAFETY_SETTINGS_TYPE);\n    let configChanged = false;\n\n    // 确保 this.safetyConfig 是一个对象\n    if (!this.safetyConfig || typeof this.safetyConfig !== \"object\") {\n      console.log(\"safetyConfig 未加载或格式无效，创建新的空对象。\");\n      this.safetyConfig = {};\n      configChanged = true; // 需要初始化\n    }\n\n    // 检查是否缺少必需的类别，如果缺少则添加默认值\n    for (const category of requiredCategories) {\n      if (!(category in this.safetyConfig)) {\n        console.warn(`为 safetyConfig 补充缺失的类别: ${category}`);\n        this.safetyConfig[category] = GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT;\n        configChanged = true;\n      }\n      // 可选：检查值的有效性，如果需要更严格的控制\n      // else if (!Object.values(GEMINI_SAFETY_BLOCK_SETTINGS).includes(this.safetyConfig[category])) {\n      //    console.warn(`safetyConfig 中类别 ${category} 的值无效 (${this.safetyConfig[category]})，重置为默认值。`);\n      //    this.safetyConfig[category] = GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT;\n      //    configChanged = true;\n      // }\n    }\n\n    // 可选：移除无效的键 (如果 safetyConfig 可能包含非预期的键)\n    // for (const loadedKey in this.safetyConfig) {\n    //   if (!requiredCategories.includes(loadedKey)) {\n    //     console.warn(`从 safetyConfig 移除未知类别: ${loadedKey}`);\n    //     delete this.safetyConfig[loadedKey];\n    //     configChanged = true;\n    //   }\n    // }\n\n    if (configChanged) {\n      console.log(\"初始化或修正后的 safetyConfig:\", this.safetyConfig);\n      // 注意：这里通常不需要保存，因为 `_saveStrogeConfig` 会在适当的时候保存整个配置。\n    } else {\n      console.log(\"使用已加载或验证通过的 safetyConfig:\", this.safetyConfig);\n    }\n  }\n\n  /**\n   * 初始化 LLM 默认配置 (this.LLMDefaultConfig)。\n   * 定义完整的默认结构，然后使用 _mergeDefaultsRecursive 将其合并到\n   * this.LLMDefaultConfig 中，确保用户设置被保留。\n   */\n  initLLMDefaultConfig() {\n    // 1. 确定动态值 (provider 和 model)，尝试从 baseConfig 获取，否则使用后备值\n    const firstProvider = this.baseConfig?.llm_providers?.[0];\n    const defaultProvider = firstProvider?.displayName ?? \"openai\"; // 默认使用第一个 provider 或 openai\n    const defaultModel = this.getDefaultModel(defaultProvider) ?? \"gpt-4o-mini\"; // 该 provider 的默认模型或 gpt-4o-mini\n\n    // 2. 定义完整的默认配置结构 (包括固定的 safetySettings 默认值)\n    const defaultConfigStructure = {\n      provider: defaultProvider, // 动态确定\n      base: {\n        model: defaultModel, // 动态确定\n        max_messages_num: 10,\n        stream: true,\n      },\n      chatParams: {\n        temperature: 1,\n        top_p: 1,\n        frequency_penalty: 0,\n        presence_penalty: 0,\n        reasoning_effort: -1,\n      },\n      toolCallSettings: {\n        mode: TOOL_CALL_MODEDS.AUTO,\n        tools: [], // 默认无激活工具\n      },\n      presetSettings: {\n        opening: \"\",\n        history: [],\n      },\n      extraSettings: {\n        gemini: {\n          imageGeneration: false,\n          // Gemini 特定示例\n          internalTools: {\n            google_search: false,\n            code_execution: false,\n            url_context: false,\n          },\n          safetySettings: {\n            // 使用固定的默认安全设置结构\n            [GEMINI_SAFETY_SETTINGS_TYPE.HARASSMENT]:\n              GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT,\n            [GEMINI_SAFETY_SETTINGS_TYPE.HATE_SPEECH]:\n              GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT,\n            [GEMINI_SAFETY_SETTINGS_TYPE.SEXUALLY_EXPLICIT]:\n              GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT,\n            [GEMINI_SAFETY_SETTINGS_TYPE.DANGEROUS_CONTENT]:\n              GEMINI_SAFETY_BLOCK_SETTINGS.DEFAULT,\n            // 如果有其他类别，也在这里添加\n          },\n        },\n      },\n    };\n\n    // 3. 确保 this.LLMDefaultConfig 是一个对象\n    if (!this.LLMDefaultConfig || typeof this.LLMDefaultConfig !== \"object\") {\n      console.log(\n        \"LLMDefaultConfig 未加载或格式无效，创建新的空对象用于合并。\"\n      );\n      this.LLMDefaultConfig = {};\n    }\n\n    // 4. 递归合并默认值到 this.LLMDefaultConfig\n    //    这个操作会保留 this.LLMDefaultConfig 中已有的用户设置，只添加缺失的部分\n    console.log(\n      \"合并 LLM 默认配置（之前）:\",\n      JSON.stringify(this.LLMDefaultConfig)\n    );\n    this.LLMDefaultConfig = this._mergeDefaultsRecursive(\n      this.LLMDefaultConfig,\n      defaultConfigStructure\n    );\n    console.log(\n      \"合并 LLM 默认配置（之后）:\",\n      JSON.stringify(this.LLMDefaultConfig)\n    );\n\n    // 注意：合并操作后，this.LLMDefaultConfig 可能已更新，保存操作会在适当时机触发。\n  }\n\n  // --- 公开方法：获取和设置配置 ---\n\n  /** 获取基础配置对象 */\n  getBaseConfig() {\n    return this.baseConfig;\n  }\n\n  /**\n   * 设置基础配置对象，并执行相关副作用（更新LLM默认值、触发回调）。\n   * @param {object} config - 新的基础配置对象\n   */\n  setBaseConfig(config) {\n    this.baseConfig = { ...config }; // 创建浅拷贝\n    console.log(\"设置基础配置:\", this.baseConfig);\n\n    // 副作用 1: 更新 LLMDefaultConfig 中的 provider 和 model (如果 baseConfig 中有定义)\n    const { llm_providers = [], default_model = {} } = this.baseConfig;\n    if (llm_providers.length > 0) {\n      const newDefaultProvider = llm_providers[0]?.displayName; // 使用第一个 provider 的 displayName 作为新的默认\n      this.updateLLMDefaultConfig(null, { provider: newDefaultProvider });\n      \n      // 检查是否是新的 API 结构（provider 对象中包含 default_model）\n      let defaultModelForProvider = llm_providers[0]?.default_model;\n      \n      // 如果新结构中没有找到，尝试旧结构\n      if (!defaultModelForProvider && default_model[newDefaultProvider]) {\n        defaultModelForProvider = default_model[newDefaultProvider];\n      }\n      \n      if (defaultModelForProvider) {\n        this.updateLLMDefaultConfig(\"base\", {\n          model: defaultModelForProvider,\n        });\n      } else {\n        console.warn(\n          `基础配置中未找到 Provider \"${newDefaultProvider}\" 的默认模型。`\n        );\n        // 可以考虑设置一个通用的后备模型\n      }\n    } else {\n      console.warn(\"基础配置中未定义 LLM providers。\");\n      // 可能需要重置 provider 和 model?\n    }\n\n    // 保存更新后的配置 (包括 baseConfig 和可能更新的 LLMDefaultConfig)\n    this._saveStrogeConfig(); // setBaseConfig 后立即保存\n\n    // 副作用 2: 调用注册的回调函数\n    if (this.baseConfigCallback) {\n      try {\n        this.baseConfigCallback(this.baseConfig);\n      } catch (error) {\n        console.error(\"执行 baseConfig 回调函数时出错:\", error);\n      }\n    }\n  }\n\n  /**\n   * 注册一个当 baseConfig 改变时被调用的回调函数\n   * @param {function | null} callback - 回调函数或 null\n   */\n  setBaseConfigCallback(callback) {\n    this.baseConfigCallback = callback;\n  }\n\n  /**\n   * 更新基础配置的一部分。\n   * @param {object} patch - 包含要更新的键值对的对象\n   */\n  updateBaseConfig(patch) {\n    console.log(\"准备使用 patch 更新 baseConfig:\", patch);\n    const newBaseConfig = {\n      ...this.baseConfig,\n      ...patch,\n    };\n    // 调用 setBaseConfig 来应用更改并触发副作用\n    this.setBaseConfig(newBaseConfig);\n  }\n\n  /** 获取可用的 LLM Providers 列表 (用于 UI 选择) */\n  getLLMProviders() {\n    const providers = this.baseConfig?.llm_providers ?? [];\n    return providers.map((provider) => ({\n      value: provider.displayName,\n      label: provider.displayName,\n      adapterType: provider.adapterType\n    }));\n  }\n\n  /** 获取指定 Provider 的适配器类型 */\n  getProviderAdapterType(providerName) {\n    const providers = this.baseConfig?.llm_providers ?? [];\n    const found = providers.find(p => p.displayName === providerName);\n    if (!found) return null; // 未找到则返回 null\n    return found.adapterType;\n  }\n\n  /** 获取指定 Provider 的默认模型名称 */\n  getDefaultModel(provider) {\n    // 首先尝试新的 API 结构：从 provider 对象中获取 default_model\n    const providers = this.baseConfig?.llm_providers || [];\n    const targetProvider = providers.find(p => p.displayName === provider);\n    if (targetProvider?.default_model) {\n      return targetProvider.default_model;\n    }\n    \n    // 如果新结构中没有找到，尝试旧结构：从 default_model 对象中获取\n    return this.baseConfig?.default_model?.[provider];\n  }\n\n  /** 获取工具调用模式列表 (用于 UI 选择) */\n  getToolCallModes() {\n    return Object.entries(TOOL_CALL_MODEDS).map(([key, value]) => ({\n      value: value,\n      label: key, // 使用 key 作为标签通常更易读\n    }));\n  }\n\n  /** 获取所有已加载的 LLM 模型信息 */\n  getLlmModels(provider) {\n    if (!provider) {\n      return this.llmModels ?? {};\n    }\n    return this.llmModels?.[provider] ?? [];\n  }\n\n  /** 设置 LLM 模型信息 (通常在从 API 加载后调用) */\n  setLlmModels(models) {\n    this.llmModels = models;\n    console.log(\"设置 LLM 模型列表:\", this.llmModels);\n    this._saveStrogeConfig();\n  }\n\n  /** 获取基础配置中定义的默认模型映射 { provider: model } */\n  getDefaultLLMModel() {\n    // 首先尝试新的 API 结构：从 llm_providers 数组中构建映射\n    const providers = this.baseConfig?.llm_providers || [];\n    const defaultModelMap = {};\n    \n    providers.forEach(provider => {\n      if (provider.displayName && provider.default_model) {\n        defaultModelMap[provider.displayName] = provider.default_model;\n      }\n    });\n    \n    // 如果新结构中没有找到任何默认模型，尝试旧结构\n    if (Object.keys(defaultModelMap).length === 0 && this.baseConfig?.default_model) {\n      return this.baseConfig.default_model;\n    }\n    \n    return defaultModelMap;\n  }\n\n  /** 检查指定模型是否在指定 Provider 的可用模型列表中 */\n  isModelAvailable(provider, model) {\n    const providerModels = this.llmModels?.[provider] ?? [];\n    return providerModels.some((modelGroup) =>\n      modelGroup.models.includes(model)\n    );\n  }\n\n  /** 根据模型名称查找其所有者 (owner) */\n  getModelOwner(model) {\n    for (const provider in this.llmModels) {\n      const providerModels = this.llmModels[provider] ?? [];\n      const group = providerModels.find((modelGroup) =>\n        modelGroup.models.includes(model)\n      );\n      if (group) return group.owner;\n    }\n    return undefined; // 或 null\n  }\n\n  /** 获取安全设置的可选参数 (用于 UI 选择) */\n  getSafetySettingsParams() {\n    // 返回格式 { NONE: \"BLOCK_NONE\", LOW: \"BLOCK_ONLY_HIGH\", ... }\n    return GEMINI_SAFETY_BLOCK_SETTINGS;\n  }\n\n  /** 获取当前的安全设置状态对象 */\n  getSafetyConfig() {\n    return this.safetyConfig;\n  }\n\n  /**\n   * 设置当前的安全设置状态，并同步更新 LLMDefaultConfig 中的对应部分。\n   * @param {object} newSafetyConfig - 新的安全设置对象\n   */\n  setSafetyConfig(newSafetyConfig) {\n    // 可以在这里添加验证逻辑，确保 newSafetyConfig 的格式和值有效\n    this.safetyConfig = { ...newSafetyConfig }; // 更新当前状态\n    console.log(\"设置当前 safetyConfig 状态:\", this.safetyConfig);\n\n    // 同步更新 LLMDefaultConfig 中的 safetySettings\n    // updateLLMDefaultConfig 会处理保存逻辑 (如果检测到变化)\n    this.updateLLMDefaultConfig(\"safetySettings\", { ...this.safetyConfig });\n  }\n\n  /**\n   * 更新 LLM 默认配置 (LLMDefaultConfig) 的一部分或顶层属性。\n   * @param {string | null} type - 要更新的顶层键名 (如 'base', 'chatParams')，如果为 null 则更新顶层属性。\n   * @param {object} patch - 包含要更新的键值对的对象。\n   */\n  updateLLMDefaultConfig(type, patch) {\n    let configChanged = false;\n\n    if (\n      type &&\n      this.LLMDefaultConfig[type] &&\n      typeof this.LLMDefaultConfig[type] === \"object\"\n    ) {\n      // 更新指定类型的嵌套对象\n      const originalSubConfigString = JSON.stringify(\n        this.LLMDefaultConfig[type]\n      );\n      this.LLMDefaultConfig[type] = {\n        ...this.LLMDefaultConfig[type],\n        ...patch,\n      };\n      // 检查子对象是否有实际变化\n      if (\n        JSON.stringify(this.LLMDefaultConfig[type]) !== originalSubConfigString\n      ) {\n        configChanged = true;\n      }\n    } else if (!type) {\n      // 更新顶层属性\n      const originalTopLevelConfig = { ...this.LLMDefaultConfig };\n      this.LLMDefaultConfig = {\n        ...this.LLMDefaultConfig,\n        ...patch,\n      };\n      // 检查顶层是否有变化 (简单比较)\n      if (\n        JSON.stringify(originalTopLevelConfig) !==\n        JSON.stringify(this.LLMDefaultConfig)\n      ) {\n        configChanged = true;\n      }\n    } else {\n      console.warn(\n        `无法更新 LLMDefaultConfig: 类型 \"${type}\" 不存在或不是对象。`\n      );\n      return; // 没有做任何更改\n    }\n\n    if (configChanged) {\n      console.log(\n        `更新 LLMDefaultConfig${type ? `[${type}]` : \"\"} 使用 patch:`,\n        patch\n      );\n      // 只有在检测到实际变化时才保存\n      this._saveStrogeConfig();\n    } else {\n      console.log(`LLMDefaultConfig 更新被跳过，patch 未引起变化:`, patch);\n    }\n  }\n\n  /**\n   * 获取 LLM 默认配置。可以指定 provider 来获取针对该 provider 调整后的配置副本。\n   * @param {string} [provider] - 可选。如果提供，会尝试将返回的配置副本调整为使用此 provider 及其默认模型。\n   * @returns {object} - LLM 配置的深拷贝副本。\n   */\n  getLLMDefaultConfig(provider) {\n    // 创建深拷贝，防止外部修改影响原始配置\n    if (!this.LLMDefaultConfig || typeof this.LLMDefaultConfig !== \"object\") {\n      console.error(\"LLMDefaultConfig 不是有效对象，无法获取。\");\n      return {}; // 返回空对象或抛出错误\n    }\n    let copiedConfig;\n    try {\n      copiedConfig = JSON.parse(JSON.stringify(this.LLMDefaultConfig));\n    } catch (e) {\n      console.error(\"深拷贝 LLMDefaultConfig 失败:\", e);\n      return {}; // 返回空对象或进行错误处理\n    }\n\n    // 如果请求了特定 provider 且与当前默认 provider 不同\n    if (provider && provider !== copiedConfig.provider) {\n      const defaultModelForProvider = this.getDefaultModel(provider);\n      if (defaultModelForProvider) {\n        console.log(\n          `为 Provider \"${provider}\" 调整 LLM 配置副本 (模型: ${defaultModelForProvider})。`\n        );\n        copiedConfig.provider = provider;\n        copiedConfig.base.model = defaultModelForProvider;\n      } else {\n        console.warn(\n          `请求了 Provider \"${provider}\"，但在 baseConfig 中未找到其默认模型。返回的配置将使用原始 Provider 和模型。`\n        );\n        // 保持 copiedConfig 不变或进行其他处理\n      }\n    }\n    return copiedConfig;\n  }\n\n  // --- 公开方法：工具验证 ---\n\n  /**\n   * 获取在当前可用工具列表 (this.llmTools) 中有效的工具名称。\n   * @param {string[]} selectedToolNames - 用户选择或配置中指定的工具名称列表。\n   * @returns {string[]} - 只包含有效的、实际可用的工具名称列表。\n   */\n  getValidTools(selectedToolNames) {\n    if (!selectedToolNames || !Array.isArray(selectedToolNames)) {\n      return [];\n    }\n\n    const availableToolNames = new Set();\n\n    if (typeof this.llmTools === \"object\" && this.llmTools !== null) {\n      Object.values(this.llmTools).forEach((pluginTools) => {\n        // 如果是对象 {plugin: toolsObj}\n        if (pluginTools && typeof pluginTools === \"object\") {\n          Object.keys(pluginTools).forEach(\n            (toolName) => availableToolNames.add(toolName) // 只取工具名部分\n          );\n        }\n      });\n    }\n    \n    const validToolNames = selectedToolNames.filter(toolName =>{\n      return availableToolNames.has(toolName);\n    })\n\n    if (validToolNames.length < selectedToolNames.length) {\n      const invalidTools = selectedToolNames.filter(\n        (toolName) => !availableToolNames.has(toolName)\n      );\n      console.warn(\"配置中指定的以下工具当前不可用或未加载:\", invalidTools);\n    }\n\n    return validToolNames;\n  }\n\n  /**\n   * 获取一个经过验证的 LLM 配置对象副本。\n   * 主要验证其中的工具列表是否有效。\n   * @param {object} config - 原始的 LLM 配置对象。\n   * @returns {object} - 经过验证和清理的配置对象深拷贝副本。\n   */\n  getVerifiedLLMConfig(config) {\n    if (!config || typeof config !== \"object\") {\n      console.warn(\"getVerifiedLLMConfig 接收到的输入无效，按原样返回。\");\n      return config;\n    }\n\n    // 创建深拷贝以避免修改原始对象\n    let verifiedConfig = JSON.parse(JSON.stringify(config));\n\n    this._mergeDefaultsRecursive(verifiedConfig, this.LLMDefaultConfig);\n\n    // 验证工具列表\n    if (\n      verifiedConfig.toolCallSettings &&\n      Array.isArray(verifiedConfig.toolCallSettings.tools)\n    ) {\n       verifiedConfig.toolCallSettings.tools = this.getValidTools(\n         verifiedConfig.toolCallSettings.tools\n       );\n    } else if (verifiedConfig.toolCallSettings) {\n      // 如果 toolCallSettings 存在但 tools 不存在或不是数组，则设置为空数组\n      verifiedConfig.toolCallSettings.tools = [];\n    }\n\n    return verifiedConfig;\n  }\n\n  // --- 公开方法：异步加载外部数据 ---\n\n  /**\n   * 从后端 API 加载可用的 LLM 工具列表。\n   */\n  async loadllmTools() {\n    try {\n      const response = await fetch(\"/api/openai/tools\");\n      if (!response.ok) {\n        throw new Error(\n          `请求 LLM 工具失败: ${response.status} ${response.statusText}`\n        );\n      }\n      const data = await response.json();\n\n      // 假设 API 返回的数据结构是 { data: { tools: ... } }\n      if (data && data.data && data.data.tools) {\n        this.llmTools = data.data.tools;\n        console.log(\"LLM 工具已加载:\", this.llmTools);\n        // 考虑是否需要在加载后立即保存。如果工具列表不常变动，可能不需要。\n        // this._saveStrogeConfig();\n      } else {\n        console.warn(\"从 API 收到的 LLM 工具数据格式不符合预期:\", data);\n        this.llmTools = []; // 或保持旧数据？\n      }\n    } catch (error) {\n      console.error(\"加载 LLM 工具时发生网络或解析错误:\", error);\n      // 可以考虑加载失败时的回退逻辑，比如使用缓存的旧列表\n      // this.llmTools = this._getLocalStorage('cached_llm_tools') ?? [];\n    }\n  }\n\n  /**\n   * 从后端 API 加载 OneBot 相关配置。\n   */\n  async loadonebotConfig() {\n    try {\n      const response = await fetch(`/api/onebot/plugins`);\n      if (!response.ok) {\n        throw new Error(\n          `请求 OneBot 插件配置失败: ${response.status} ${response.statusText}`\n        );\n      }\n      const data = await response.json();\n\n      // 根据 OneBot API 文档，返回的数据结构是 { success: true, data: { options: ... } }\n      if (data && data.success && data.data && data.data.options) {\n        this.onebotConfig = data.data.options;\n        console.log(\"OneBot 插件配置已加载:\", this.onebotConfig);\n        // 加载后立即保存\n        this._saveStrogeConfig();\n      } else {\n        console.warn(\"从 API 收到的 OneBot 插件配置数据格式不符合预期:\", data);\n        this.onebotConfig = null; // 或保持旧数据？\n      }\n    } catch (error) {\n      console.error(\"加载 OneBot 插件配置时发生网络或解析错误:\", error);\n      // 可以考虑加载失败时的回退逻辑\n    }\n  }\n}\n","/**\n * @author Mio-FCIP <1099834705@qq.com>\n * @lastEditor 彭志勇 <2457305628@qq.com>\n * @lastEditTime 2024-04-25 06:25:30\n */\n\nimport Client from \"./client.js\";\nimport Config from \"./config.js\";\n\nconst config = new Config();\nconst client = new Client(config);\n\nclient.init();\n\nexport { config, client };\n","<script>\nimport { client } from \"@/lib/runtime.js\";\n\nconst PageStatus = {\n  CHAT: \"chat\",\n  PROFILE: \"profile\",\n  SETTINGS: \"settings\",\n  NONE: \"none\",\n};\nexport default {\n  data() {\n    return {\n      processedImage: \"/p/qava?q=1099834705\",\n      activePage: PageStatus.NONE,\n    };\n  },\n  computed: {\n    isChatActive() {\n      return this.activePage === PageStatus.CHAT;\n    },\n    isProfileActive() {\n      return this.activePage === PageStatus.PROFILE;\n    },\n  },\n  watch: {\n    $route: {\n      handler(newRoute) {\n        this.activePage = this.getPageStatusFromRoute(newRoute);\n      },\n      immediate: true,\n    },\n  },\n  mounted() {\n    this.activePage = this.getPageStatusFromRoute();\n    const adminId = client.admin_qq;\n    if (adminId) {\n      this.loadAvatar(adminId);\n    } else {\n      client.on(\n        \"loaded\",\n        () => {\n          const adminId = client.admin_qq;\n          this.loadAvatar(adminId);\n        },\n        false,\n      );\n    }\n  },\n  methods: {\n    async processImage(imageUrl) {\n      return new Promise((resolve, reject) => {\n        const canvas = document.createElement(\"canvas\");\n        const ctx = canvas.getContext(\"2d\");\n        const img = new Image();\n        img.src = imageUrl;\n        img.onload = () => {\n          canvas.width = img.width;\n          canvas.height = img.height;\n          // 绘制原始图片\n          ctx.drawImage(img, 0, 0);\n          // 创建透明的缺口\n          let centerX = img.width * 0.8; // 圆心X坐标\n          let centerY = img.height * 0.86; // 圆心Y坐标\n          let radius = (5 / 24) * img.width; // 圆的半径\n          ctx.beginPath();\n          ctx.arc(centerX, centerY, radius, 0, Math.PI * 2, true);\n          ctx.clip();\n          ctx.clearRect(0, 0, img.width, img.height);\n          // 将处理后的图片转换为base64\n          canvas.toBlob((blob) => {\n            const url = URL.createObjectURL(blob);\n            resolve(url);\n          }, \"image/png\");\n        };\n        img.onerror = (error) => {\n          reject(error);\n        };\n      });\n    },\n    async toChat() {\n      this.activePage = PageStatus.CHAT;\n      this.$router.push({ name: \"blank\" });\n    },\n    async toProfile() {\n      this.activePage = PageStatus.PROFILE;\n      this.$router.push({ name: \"contactors\" });\n    },\n    async toConfig() {\n      this.activePage = PageStatus.SETTINGS;\n      this.$router.push({ name: \"settings\" });\n    },\n    async loadAvatar(adminId) {\n      const adminAvatar = `/p/qava?q=${adminId}`;\n      try {\n        this.processedImage = await this.processImage(adminAvatar);\n      } catch (error) {\n        console.error(\"Error loading avatar:\", error);\n      }\n    },\n    getPageStatusFromRoute(route = this.$route) {\n      if (route.path === \"/\" || route.path.includes(\"/chat/\")) {\n        return PageStatus.CHAT;\n      } else if (\n        route.path === \"/contactors\" ||\n        route.path.includes(\"/profile/\")\n      ) {\n        return PageStatus.PROFILE;\n      } else if (route.path === \"/settings\") {\n        return PageStatus.SETTINGS;\n      }\n      return PageStatus.NONE;\n    },\n  },\n};\n</script>\n<template>\n  <div id=\"sidebar\">\n    <div class=\"admin-avatar\">\n      <div class=\"status\"></div>\n      <img :src=\"processedImage\" alt=\"admin-avatar\" />\n    </div>\n    <div id=\"side\" class=\"options\">\n      <div class=\"up-half\">\n        <div class=\"icon-back\" :class=\"{ active: isChatActive }\">\n          <div id=\"chatting\" @click=\"toChat\">\n            <i class=\"iconfont chat\"></i>\n          </div>\n        </div>\n        <div class=\"icon-back\" :class=\"{ active: isProfileActive }\">\n          <div id=\"editing\" @click=\"toProfile\">\n            <i class=\"iconfont user\"></i>\n          </div>\n        </div>\n      </div>\n      <div class=\"down-half\">\n        <a\n          href=\"https://github.com/Pretend-to/mio-chat-backend\"\n          target=\"_blank\"\n          class=\"side-icon\"\n        >\n          <i class=\"iconfont github\"></i>\n        </a>\n        <div class=\"side-icon\" @click=\"toConfig\">\n          <i class=\"iconfont menu\"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<style scoped>\n#sidebar {\n  display: flex;\n  flex-basis: 3.8rem;\n  flex-shrink: 0;\n  flex-direction: column;\n  background-color: hsla(0, 0%, 100%, 0.8);\n  backdrop-filter: blur(10px);\n  -webkit-app-region: drag;\n}\n.options {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n  /* margin: 1.2rem 1.2rem; */\n}\n\n.logo img {\n  width: 2.5rem;\n}\n.up-half,\n.down-half {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  flex-basis: 8rem;\n  justify-content: center;\n}\n.icon-back {\n  height: 2.5rem;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: 0.5rem 0rem;\n  border-radius: 0.5rem;\n}\n.icon-back.active {\n  padding: 0 0.5rem;\n  background-color: rgba(113, 113, 113, 0.1);\n}\n\n.icon-back i,\n.down-half i {\n  margin: 0.5rem 0rem;\n  width: 1.8rem;\n  height: 1.8rem;\n  font-size: 1.6rem;\n  color: black;\n}\n.admin-avatar {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-top: 1rem;\n  height: 4.5rem;\n  position: relative;\n  z-index: 10;\n}\n.admin-avatar img {\n  border-radius: 50%;\n  width: 60%;\n}\n.status {\n  position: absolute;\n  left: 68%;\n  top: 71%;\n  transform: translate(-50%, -50%);\n  width: 0.7rem;\n  height: 0.7rem;\n  border-radius: 50%;\n  background: linear-gradient(to bottom, rgb(52, 238, 143), rgb(54, 221, 150));\n}\n.side-icon {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.icon-back.active i {\n  color: #007bff;\n}\n\n@media screen and (max-width: 600px) {\n  .options {\n    justify-content: space-evenly;\n  }\n  #sidebar {\n    width: 100%;\n    flex-direction: row;\n    flex-basis: 4rem;\n    background-color: #f5f4f9;\n  }\n  .admin-avatar {\n    display: none;\n  }\n  .options {\n    flex-direction: row;\n    width: 100%;\n  }\n  .up-half,\n  .down-half {\n    flex-basis: 50%;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-around;\n    align-items: center;\n  }\n  .icon-back.active {\n    background-color: transparent;\n  }\n}\n</style>\n","<template>\n  <ul\n    :class=\"{\n      'window-controls': true,\n      fullscreen: fullScreen,\n      preview: preview,\n    }\"\n    data-tauri-drag-region=\"true\"\n  >\n    <li class=\"button\" data-tauri-drag-region @click=\"minimizeWindow\">\n      <span class=\"window-min\">—</span>\n    </li>\n    <li\n      v-if=\"fullScreen\"\n      class=\"button\"\n      data-tauri-drag-region\n      @click=\"configFullScreen(false)\"\n    >\n      <span class=\"window-inmax\">\n        <i class=\"iconfont chuangkouhua\"></i>\n      </span>\n    </li>\n    <li\n      v-else\n      class=\"button\"\n      data-tauri-drag-region\n      @click=\"configFullScreen(true)\"\n    >\n      <span class=\"window-max\">▢</span>\n    </li>\n    <li id=\"close\" class=\"button\" data-tauri-drag-region @click=\"closeWindow\">\n      <span class=\"window-close\">&times;</span>\n    </li>\n  </ul>\n</template>\n\n<script>\nimport { Window } from \"@tauri-apps/api/window\";\n\nlet mainWindow = null;\n\nexport default {\n  props: {\n    fullScreen: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\"set-screen\",\"close\"],\n  data() {\n    return {\n      preview: false,\n      isTauri: !!(window.__TAURI__ || window.__TAURI_INTERNALS__), // 检查是否存在任一对象\n    };\n  },\n  created() {\n    const urlParams = new URLSearchParams(window.location.search);\n    const preview = urlParams.get(\"preview\");\n    if (preview === \"true\") {\n      this.preview = true;\n    }\n    if (this.isTauri) {\n      mainWindow = new Window(\"main\");\n    }\n  },\n  methods: {\n    waiting() {\n      if (this.$message) {\n        this.$message({ message: \"此功能尚未开放\", type: \"warning\" });\n      } else {\n        console.warn(\"此功能尚未开放 (Tauri 环境外)\");\n        alert(\"此功能尚未开放\");\n      }\n    },\n\n    async getMainWindow() {\n      try {\n        if (!mainWindow) {\n          console.error(\"Failed to get main window.\");\n          return null;\n        }\n        return mainWindow;\n      } catch (error) {\n        console.error(\"Error getting main window:\", error);\n        return null;\n      }\n    },\n\n    async minimizeWindow() {\n      if (this.isTauri) {\n        if (mainWindow) {\n          try {\n            await mainWindow.minimize();\n          } catch (e) {\n            console.error(\"Failed to minimize window:\", e);\n            this.waiting(); // 最小化失败则提示\n          }\n        } else {\n          this.waiting(); // 获取 mainWindow 失败则提示\n        }\n      } else {\n        // this.waiting(); // Web 环境\n        this.$emit(\"close\");\n      }\n    },\n\n    configFullScreen(fullScreen) {\n      if (this.isTauri) {\n        (async () => {\n          if (mainWindow) {\n            try {\n              if (fullScreen) {\n                await mainWindow.maximize();\n              } else {\n                await mainWindow.unmaximize();\n              }\n              this.$emit(\"set-screen\", fullScreen); // Tauri 环境也 emit 事件，和 web 一致\n            } catch (e) {\n              console.error(\"Failed to toggle maximize:\", e);\n              this.waiting(); // Tauri 出错也 waiting\n            }\n          } else {\n            this.waiting(); // 获取 mainWindow 失败则提示\n          }\n        })();\n      } else {\n        this.$emit(\"set-screen\", fullScreen); // Web 环境使用原有的 emit 逻辑\n      }\n    },\n\n    async closeWindow() {\n      if (this.isTauri) {\n        if (mainWindow) {\n          try {\n            await mainWindow.close();\n          } catch (e) {\n            console.error(\"Failed to close window:\", e);\n            this.waiting(); // 关闭失败则提示\n          }\n        } else {\n          this.waiting(); // 获取 mainWindow 失败则提示\n        }\n      } else {\n        // this.waiting(); // Web 环境\n        this.$emit(\"close\");\n      }\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"sass\">\n.window-controls\n    position: absolute\n    display: flex\n    height: 30px\n    z-index: 1000\n    right: 0\n    top: 0\n    background-color: transparent\n    -webkit-app-region: drag\n\n    &.preview\n        display: none\n\n    .button\n        display: flex\n        justify-content: center\n        align-items: center\n        width: 45px\n        height: 100%\n        padding: 0\n        border: none\n        background-color: transparent\n        cursor: pointer\n        color: #333\n        font-size: 16px\n        outline: none\n        -webkit-app-region: no-drag\n\n        span\n          display: flex\n          align-items: center\n          justify-content: center\n          line-height: 1\n\n        .window-min\n            font-weight: bold\n            position: relative\n            top: -2px\n\n        .window-max\n            font-size: 14px\n            font-weight: bold\n\n        .window-inmax\n            i.iconfont\n              font-size: 14px\n\n        .window-close\n            font-weight: bold\n            font-size: 20px\n            position: relative\n            top: -1px\n\n        &:hover\n            background-color: rgba(0, 0, 0, 0.1)\n\n        &#close:hover\n            background-color: #e81123\n            color: white\n</style>\n","<template>\n  <div\n    id=\"forward-msg-preview\"\n    :class=\"onPhone ? 'on-phone' : ''\"\n    @click=\"showBox = true\"\n  >\n    <div id=\"forward-msg-head\">转发的聊天消息</div>\n    <div id=\"forward-msg-body\">\n      <div\n        v-for=\"(message, index) in messages.slice(0, 2)\"\n        id=\"forward-msg-summary\"\n        :key=\"index\"\n      >\n        {{ contactor.name }}: {{ contactor.getLastMessageSummary(message) }}\n      </div>\n    </div>\n    <div id=\"forward-msg-foot\">查看{{ messages.length }}条转发消息</div>\n  </div>\n  <div v-if=\"showBox\" id=\"forward-msg-box\" :class=\"onPhone ? 'on-phone' : ''\">\n    <div class=\"forward-msg-head\">\n      <div class=\"forward-msg-title\">转发的聊天消息</div>\n      <displayButtons class=\"cfg-btns\" @close=\"showBox = false\" />\n      <!-- <span class=\"close\" @click=\"showBox = false\">&times;</span> -->\n    </div>\n    <div class=\"body\">\n      <div\n        v-for=\"(message, index) of messages\"\n        :key=\"index\"\n        class=\"message-container\"\n      >\n        <div v-if=\"message.type === 'node'\" id=\"other\" class=\"message-body\">\n          <div class=\"avatar\">\n            <img :src=\"`/p/qava/?q=${message.data.uin}`\" :alt=\"message.data.name\" />\n          </div>\n          <div class=\"msg\">\n            <div class=\"wholename\">\n              <div class=\"title\">{{ contactor.title }}</div>\n              <div class=\"name\">{{ message.data.name }}</div>\n            </div>\n            <div\n              v-for=\"(elm,index) of message.data.content\" \n              :key=\"index\"\n              class=\"content\"\n            >\n              <div>\n                <MdRenderer\n                  v-if=\"elm.type === 'text'\"\n                  :md=\"elm.data.text\"\n                  :theme=\"'github'\"\n                  :markdown-it-options=\"{breaks: true}\"\n                />\n                <!-- <el-image\n                  v-else-if=\"elm.type === 'image'\"\n                  :key=\"index\"\n                  style=\"margin: 8px 0; max-width: 20rem; border-radius: 1rem\"\n                  :src=\"elm.data.file\"\n                  :zoom-rate=\"1.2\"\n                  :preview-teleported=\"true\"\n                  :max-scale=\"7\"\n                  :min-scale=\"0.2\"\n                  :preview-src-list=\"[elm.data.file]\"\n                  :initial-index=\"4\"\n                  fit=\"cover\"\n                /> -->\n                <MdRenderer\n                  v-else-if=\"element.type === 'image'\"\n                  :md=\"`![image](${element.data.file})`\"\n                  :key=\"element.data.file\"\n                  :custom-plugins=\"mioPlugins\"\n                  :theme=\"'github'\"\n                />\n                <ForwardMsg\n                  v-else-if=\"elm.type === 'nodes'\"\n                  :contactor=\"activeContactor\"\n                  :messages=\"elm.data.messages\"\n                />\n                <MdRenderer\n                  v-else\n                  :md=\"`尚未支持的消息类型：${elm.type}`\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport MdRenderer from \"mio-previewer\";\nimport { client } from \"@/lib/runtime.js\";\nimport displayButtons from \"@/components/DisplayButtons.vue\";\nimport { imageViewerPlugin } from \"mio-previewer/plugins/custom\";\n\nexport default {\n  name: \"ForwardMsg\",\n  components: {\n    MdRenderer,\n    displayButtons,\n  },\n  props: {\n    messages: {\n      type: Array,\n      default: () => [], // 对于数组，使用函数返回一个新的空数组\n    },\n    contactor: {\n      type: Object,\n      default: () => {}, // 对于字符串，使用空字符串\n    },\n  },\n  data() {\n    const mioPlugins = [\n      {\n        plugin: imageViewerPlugin,\n      }\n    ]\n    return {\n      showBox: false,\n      onPhone: false,\n      mioPlugins: mioPlugins,\n    };\n  },\n  created() {\n    this.onPhone = window.innerWidth < 600;\n\n    client.on(\n      \"device-change\",\n      (type) => {\n        if (type == \"mobile\") {\n          this.onPhone = true;\n        } else {\n          this.onPhone = false;\n        }\n      },\n      false,\n    );\n  },\n};\n</script>\n\n<style scoped>\n#forward-msg-preview {\n  width: 15rem;\n  display: flex;\n  flex-direction: column;\n  padding: 0.2rem 0.5rem;\n}\n\n#forward-msg-preview.on-phone {\n  transform: translateX(-0.35rem);\n}\n\n#forward-msg-body {\n  margin: 0.5rem 0;\n  width: 100%;\n  text-overflow: ellipsis;\n}\n\n#forward-msg-summary {\n  width: 100%;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  overflow: hidden;\n  font-size: 0.8rem;\n  font-weight: 300;\n}\n\n#forward-msg-foot {\n  border-top: 1px solid #ccc;\n  padding-top: 0.2rem;\n  width: 100%;\n  font-size: 0.7rem;\n  color: rgb(150, 150, 150);\n}\n\n.cfg-btns {\n  transform: scale(0.8);\n  transform-origin: top right;\n}\n\n#forward-msg-box {\n  border: 1px solid rgb(199, 199, 199);\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 24rem;\n  height: 30rem;\n  z-index: 9999;\n  background-color: rgb(241, 241, 241);\n  border-radius: 0.25rem;\n  overflow: hidden;\n  box-shadow: 0 0 1rem rgba(0, 0, 0, 0.1);\n}\n\n.message-body > .avatar {\n  flex-basis: 2.65rem;\n  min-width: 2.65rem;\n  height: 2.65rem;\n}\n\n.avatar > img {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n}\n\n#forward-msg-box.on-phone {\n  border: null;\n  border-radius: null;\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  z-index: 9999;\n  background-color: rgb(241, 241, 241);\n  overflow: hidden;\n}\n\n.forward-msg-head {\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 1.5rem;\n  padding-left: 1rem;\n  border-bottom: 1px solid #ccc;\n  color: black;\n  font-size: .8rem;\n}\n\n.close {\n  width: 1.5rem;\n  font-size: 1.5rem;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.close:hover {\n  color: aliceblue;\n  background-color: rgb(196, 43, 28);\n}\n\n.body {\n  height: auto;\n  max-height: calc(100% - 2rem);\n  overflow: auto;\n}\n</style>\n","<template>\n  <div class=\"input-bar\">\n    <div class=\"options\">\n      <div class=\"bu-emoji\">\n        <emoji-picker v-show=\"showemoji\" ref=\"emojiPicker\" @emoji-click=\"getemoji\"></emoji-picker>\n        <p class=\"ho-emoji\">表情</p>\n        <i class=\"iconfont smile\" @click.prevent=\"ctrlEmojiPanel\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p class=\"ho-emoji\">{{ activeContactor.platform == \"openai\" ? \"模型选择\" : \"工具选择\" }}</p>\n        <el-tree-select id=\"wraper-selector\" v-model=\"selectedOption\" :data=\"extraOptions\" accordion\n          placement=\"top-start\" @node-click=\"currentChange\" />\n        <i class=\"iconfont robot\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p class=\"ho-emoji\">重置人格</p>\n        <i class=\"iconfont reset\" @click=\"$emit('cleanHistory')\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p class=\"ho-emoji\">上传</p>\n        <i class=\"iconfont upload\" @click=\"uploadFile\"></i>\n      </div>\n      <div class=\"bu-emoji\">\n        <p class=\"ho-emoji\">清除记录</p>\n        <el-popconfirm class=\"box-item\" title=\"此操作不可撤销\" confirm-button-text=\"确定\" cancel-button-text=\"取消\" placement=\"top\"\n          @confirm=\"$emit('cleanScreen')\">\n          <template #reference>\n            <i class=\"iconfont shanchu\"></i>\n          </template>\n        </el-popconfirm>\n      </div>\n      <div class=\"bu-emoji\">\n        <p class=\"ho-emoji\">更多</p>\n        <i class=\"iconfont more\" @click=\"unsupportedTip\"></i>\n      </div>\n    </div>\n\n    <div class=\"input-box\">\n      <div class=\"input-content\">\n        <div ref=\"textarea\" class=\"input-area\" contenteditable=\"true\"\n          @keydown=\"handleKeyDown\" @click=\"updateCursorPosition\"></div>\n      </div>\n      <button id=\"sendButton\" @click.prevent=\"send\">\n        发送{{ getWraperName() ? ` | ${getWraperName()}` : \"\" }}\n      </button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { client, config } from \"@/lib/runtime.js\";\nimport { debounce } from \"../utils/tools.js\";\n\nexport default {\n  props: {\n    activeContactor: {\n      type: Object,\n      required: true,\n    },\n  },\n  emits: [\"toButtom\", \"cleanHistory\", \"cleanScreen\", \"setModel\", \"stroge\"],\n  data() {\n    return {\n      selectedOption: null,\n      cursorPosition: [],\n      showemoji: false,\n      openaiModels: null,\n      onebotPresets: [],\n      host: \"\",\n      uploaded: { files: [], images: [] },\n      isPasting: false,\n    };\n  },\n  computed: {\n    extraOptions() {\n      if (this.activeContactor.platform == \"openai\") {\n        return this.openaiModels;\n      } else {\n        return this.onebotPresets;\n      }\n    },\n  },\n  watch: {\n    \"$route.params.id\"() {\n      this.loadSelected();\n    },\n  },\n  created() {\n    this.loadSelected();\n    this.debouncedAdjustHeight = debounce(this.adjustTextareaHeight, 100);\n  },\n  mounted() {\n    this.textareaRef = this.$refs.textarea;\n    this.textareaRef.addEventListener(\"input\", this.debouncedAdjustHeight);\n\n    // 拖拽文件\n    this.handleDragOver = (e) => {\n      e.preventDefault();\n      this.textareaRef.style.backgroundColor = \"#e0e0e0\";\n    };\n    this.handleDragLeave = (e) => {\n      e.preventDefault();\n      this.textareaRef.style.backgroundColor = \"#f1f1f1\";\n    };\n    this.handleDrop = (e) => {\n      e.preventDefault();\n      this.textareaRef.style.backgroundColor = \"#f1f1f1\";\n      const files = e.dataTransfer.files;\n      if (files.length > 0) {\n        this.handleDroppedFile(files[0]);\n      }\n    };\n    this.textareaRef.addEventListener(\"dragover\", this.handleDragOver);\n    this.textareaRef.addEventListener(\"dragleave\", this.handleDragLeave);\n    this.textareaRef.addEventListener(\"drop\", this.handleDrop);\n    // this.textareaRef.addEventListener(\"paste\", debounce(handlePaste.apply(this), 100));\n    this.textareaRef.addEventListener(\"paste\", this.handlePaste);\n\n    this.host = window.location.origin;\n    this.onebotPresets = config.onebotConfig?.textwraper?.options || [];\n  },\n  unmounted() {\n    this.textareaRef.removeEventListener(\"input\", this.adjustTextareaHeight);\n    this.textareaRef.removeEventListener(\"dragover\", this.handleDragOver);\n    this.textareaRef.removeEventListener(\"dragleave\", this.handleDragLeave);\n    this.textareaRef.removeEventListener(\"drop\", this.handleDrop);\n    this.textareaRef.removeEventListener(\"paste\", this.handlePaste);\n    this.textareaRef = null;\n  },\n  methods: {\n    unsupportedTip() {\n      this.$message.warning(\"功能暂未开放\");\n    },\n    hasInput() {\n      // const text = this.textareaRef?.innerText.trim();\n      const hasText = this.textareaRef?.innerText.trim();\n      const hasImage = this.textareaRef?.querySelector(\"img\");\n      return hasText || hasImage;\n    },\n    handleDroppedFile(file) {\n      if (file.type.startsWith(\"image/\")) {\n        this.handleUploadImage(file);\n      } else {\n        this.uploadFile(file);\n      }\n    },\n    // 把纯文本转换成可在contenteditable正确显示换行和空格的HTML\n    textToHtml(text) {\n      const escaped = text\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n        .replace(/\"/g, \"&quot;\")\n        .replace(/'/g, \"&#39;\");\n\n      // 换行符变成 <br>，空格用&nbsp;保留\n      return escaped\n        .replace(/  /g, \"&nbsp;&nbsp;\") // 连续空格至少保留两个才需要转换，单个空格是正常空格\n        .replace(/\\n/g, \"<br>\");\n    },\n\n    // 在光标处插入HTML片段（带换行和空格）\n    insertHtmlAtCursor(html) {\n      const selection = window.getSelection();\n      if (!selection || selection.rangeCount === 0) {\n        // 没有光标选区，追加到末尾\n        this.textareaRef.innerHTML += html;\n        this.setCursorToEnd(this.textareaRef);\n        return;\n      }\n      const range = selection.getRangeAt(0);\n      range.deleteContents();\n\n      // 使用临时容器把html转成节点\n      const tempEl = document.createElement(\"div\");\n      tempEl.innerHTML = html;\n\n      const frag = document.createDocumentFragment();\n      while (tempEl.firstChild) {\n        frag.appendChild(tempEl.firstChild);\n      }\n\n      range.insertNode(frag);\n\n      // 设置光标移动到插入节点后面\n      range.collapse(false);\n      selection.removeAllRanges();\n      selection.addRange(range);\n    },\n\n    // 粘贴事件处理：文本转html插入，图片异步队列上传\n    handlePaste(e) {\n      e.preventDefault();\n      const clipboardData = e.clipboardData || window.clipboardData;\n      const items = clipboardData.items;\n      let pastedText = \"\";\n      const imageFiles = [];\n\n      for (let i = 0; i < items.length; i++) {\n        const item = items[i];\n        if (item.type.indexOf(\"image\") !== -1) {\n          imageFiles.push(item.getAsFile());\n        } else if (item.type === \"text/plain\") {\n          pastedText += clipboardData.getData(\"text/plain\");\n        }\n      }\n\n      if (pastedText) {\n        const html = this.textToHtml(pastedText);\n        this.insertHtmlAtCursor(html);\n      }\n\n      if (imageFiles.length) {\n        this.$message.info(`检测到 ${imageFiles.length} 张图片，正在处理...`);\n        setTimeout(() => {\n          this.processImageQueue(imageFiles);\n        }, 0);\n      }\n    },\n\n    // 表情插入调用统一插入html方法，防止换行空格丢失\n    getemoji(e) {\n      const unicode = e.detail.unicode;\n      // 直接插unicode字符对应的html文本（一般没换行空格）\n      this.insertHtmlAtCursor(this.textToHtml(unicode));\n      this.ctrlEmojiPanel();\n    },\n\n    // 光标移动到内容最后函数\n    setCursorToEnd(element) {\n      element.focus();\n      const selection = window.getSelection();\n      const range = document.createRange();\n      range.selectNodeContents(element);\n      range.collapse(false);\n      selection.removeAllRanges();\n      selection.addRange(range);\n    },\n\n    // 顺序处理图片，防止堆积卡顿\n    async processImageQueue(files) {\n      for (const file of files) {\n        await this.handleUploadImage(file);\n        // 让主线程有时间渲染\n        await new Promise(r => setTimeout(r, 0));\n      }\n    },\n\n    handleUploadImage(file) {\n      return new Promise((resolve) => {\n        const maxSizeMB = 5;\n        const maxSizeByte = maxSizeMB * 1024 * 1024;\n\n        const img = new Image();\n        const blobUrl = URL.createObjectURL(file);\n        img.src = blobUrl;\n\n        img.onload = () => {\n          URL.revokeObjectURL(blobUrl); // 释放内存\n\n          const fileType = file.type.toLowerCase();\n\n          // GIF 直接上传\n          if (fileType === 'image/gif') {\n            if (file.size > maxSizeByte) {\n              this.$message.error(`GIF 图片不能超过 ${maxSizeMB}MB`);\n              resolve();\n              return;\n            }\n            const formData = new FormData();\n            formData.append('image', file, file.name);\n            client.uploadImage(formData)\n              .then((upload) => {\n                const imageUrl = upload.data.url;\n                this.uploaded.images.push(imageUrl);\n                this.insertImageToTextarea(imageUrl, file.name);\n                this.$message.success('上传 GIF 成功');\n              })\n              .catch(() => this.$message.error('上传 GIF 失败'))\n              .finally(resolve);\n            return;\n          }\n\n          // 其他类型进行压缩\n          const canvas = document.createElement('canvas');\n          const ctx = canvas.getContext('2d');\n          canvas.width = img.width;\n          canvas.height = img.height;\n          ctx.drawImage(img, 0, 0);\n          let mimeType, quality;\n          if (fileType === 'image/png') {\n            mimeType = 'image/png';\n          } else if (fileType === 'image/webp') {\n            mimeType = 'image/webp';\n            quality = 0.7;\n          } else {\n            mimeType = 'image/jpeg';\n            quality = 0.7;\n          }\n          canvas.toBlob(\n            (blob) => {\n              if (!blob) {\n                this.$message.error('图片压缩失败');\n                resolve();\n                return;\n              }\n              if (blob.size > maxSizeByte) {\n                this.$message.error(`压缩后仍超过 ${maxSizeMB}MB，请选小点的图片`);\n                resolve();\n                return;\n              }\n              const formData = new FormData();\n              formData.append('image', blob, file.name);\n              client.uploadImage(formData)\n                .then((upload) => {\n                  const imageUrl = upload.data.url;\n                  this.uploaded.images.push(imageUrl);\n                  this.insertImageToTextarea(imageUrl, file.name);\n                  this.$message.success('上传图片成功');\n                })\n                .catch(() => this.$message.error('上传失败'))\n                .finally(resolve);\n            },\n            mimeType,\n            quality\n          );\n        };\n      });\n    },\n    ctrlEmojiPanel() {\n      this.showemoji = !this.showemoji;\n      const editor = this.textareaRef;\n      editor.focus();\n    },\n    uploadFile(file) {\n      if (file instanceof File) {\n        this.handleFileUpload(file);\n        return;\n      }\n      const availableImageFormats = [\"png\", \"jpg\", \"jpeg\", \"webp\"];\n      const availableDocFormats = [\"docx\", \"txt\", \"pdf\", \"pptx\", \"xlsx\"];\n      const fileInput = document.createElement(\"input\");\n      fileInput.type = \"file\";\n      fileInput.accept = [...availableDocFormats, ...availableImageFormats]\n        .map((format) => `.${format}`)\n        .join(\",\");\n      const handleChange = async (e) => {\n        fileInput.removeEventListener(\"change\", handleChange);\n        const file = e.target.files[0];\n        if (!file) return;\n        this.handleFileUpload(file);\n      };\n      fileInput.addEventListener(\"change\", handleChange);\n      fileInput.click();\n    },\n    handleFileUpload(file) {\n      if (file.size > 50 * 1024 * 1024) {\n        this.$message.error(\"文件大小超过50MB，无法上传\");\n        return;\n      }\n      this.$message.info(\"文件上传中...\");\n      if (file.type.startsWith(\"image/\")) {\n        this.handleUploadImage(file);\n      } else {\n        this.uploadDocumentFile(file);\n      }\n    },\n    async uploadDocumentFile(file) {\n      try {\n        const upload = await client.uploadFile(file);\n        this.$message.success(\"文件上传成功\");\n        const fileUrl = `${upload.data.url}?size=${file.size}&name=${file.name}`;\n        const container = this.activeContactor.getBaseUserContainer();\n        container.content.push({\n          type: \"file\",\n          data: { file: this.host + fileUrl },\n        });\n        this.activeContactor.webSend(container, false);\n      } catch (error) {\n        console.error(\"文件上传失败:\", error);\n        this.$message.error(\"文件上传失败，请稍后再试\");\n      }\n      this.$emit(\"stroge\");\n      this.$emit(\"toButtom\");\n    },\n    insertImageToTextarea(imageUrl, imageName) {\n      const imageElement = document.createElement(\"img\");\n      imageElement.src = imageUrl;\n      imageElement.alt = imageName;\n      imageElement.style.maxWidth = \"10rem\";\n      imageElement.style.maxHeight = \"10rem\";\n      const range = document.createRange();\n      range.selectNodeContents(this.textareaRef);\n      range.collapse(false);\n      const selection = window.getSelection();\n      selection.removeAllRanges();\n      selection.addRange(range);\n      const fragment = range.createContextualFragment(\n        `<span>${imageElement.outerHTML}</span>`\n      );\n      range.insertNode(fragment);\n      setTimeout(() => {\n        const newRange = document.createRange();\n        newRange.selectNodeContents(this.textareaRef);\n        newRange.collapse(false);\n        const newSelection = window.getSelection();\n        newSelection.removeAllRanges();\n        newSelection.addRange(newRange);\n      }, 0);\n    },\n    initLLMExtraOptions() {\n      const allModels = client.config.getLlmModels();\n      this.openaiModels = Object.entries(allModels).map(([provider, models]) => {\n        return {\n          value: provider,\n          label: provider,\n          children: models.map((modelGroup) => {\n            return {\n              value: modelGroup.owner,\n              label: modelGroup.owner,\n              children: modelGroup.models.map((model) => {\n                return { value: model, label: model };\n              }),\n            };\n          }),\n        };\n      });\n    },\n    getOpenaiModelArray(model) {\n      const owner = client.config.getModelOwner(model);\n      return [owner, model];\n    },\n    wrapText(rawText) {\n      const preset = this.getOnebotPreset();\n      if (!this.selectedOption || !preset) return rawText;\n      const testText = \"{xxx}\";\n      return preset.replace(testText, rawText);\n    },\n    getOnebotPreset() {\n      const preset = this.onebotPresets\n        .reduce((acc = [], item) => {\n          const arr = item.children ?? [item];\n          return [...acc, ...arr];\n        }, [])\n        .find((child) => child.value == this.selectedOption)?.preset;\n      return preset;\n    },\n    loadSelected() {\n      if (this.activeContactor.platform === \"onebot\") {\n        if (this.activeContactor.preset) {\n          this.selectedOption = this.activeContactor.preset;\n        }\n      } else {\n        this.initLLMExtraOptions();\n        this.selectedOption = this.activeContactor.options.base.model;\n      }\n    },\n    adjustTextareaHeight() {\n      const textarea = this.textareaRef;\n      textarea.style.height = \"auto\";\n      textarea.style.height = textarea.scrollHeight + \"px\";\n    },\n    getWraperName() {\n      const preset = this.getOnebotPreset();\n      if (this.activeContactor.platform === \"onebot\" && preset) {\n        if (!this.selectedOption) return \"\";\n        return preset.replace(\"#\", \"\").replace(\"{xxx}\", \"\");\n      } else {\n        return \"\";\n      }\n    },\n    updateCursorPosition() {\n      const selection = window.getSelection();\n      if (!selection) return;\n      if (selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        this.cursorPosition[0] = range.startOffset;\n        this.cursorPosition[1] = range.endOffset;\n      }\n    },\n    presend() {\n      this.textareaRef.focus();\n      const images = this.textareaRef.querySelectorAll(\"img\");\n      const ImageSrcs = Array.from(images).map((img) => img.src);\n      let msg = this.getSafeText(this.textareaRef.innerText);\n      const wrappedMessage =\n        this.activeContactor.platform === \"onebot\" ? this.wrapText(msg) : msg;\n      this.textareaRef.innerHTML = \"\";\n      this.adjustTextareaHeight();\n      const container = this.activeContactor.getBaseUserContainer();\n      if (wrappedMessage.trim()) {\n        container.content.push({\n          type: \"text\",\n          data: { text: wrappedMessage },\n        });\n      }\n      ImageSrcs.forEach((imgUrl) => {\n        container.content.unshift({\n          type: \"image\",\n          data: { file: imgUrl },\n        });\n      });\n      if (this.repliedMessageId) {\n        container.content.push({\n          type: \"reply\",\n          data: { id: this.repliedMessageId },\n        });\n      }\n      return container;\n    },\n    async send() {\n      if (!this.hasInput()) return;\n      this.$emit(\"toButtom\");\n      const container = this.presend();\n      try {\n        const message_id = await this.activeContactor.webSend(container);\n        container.id = message_id;\n        this.$emit(\"stroge\");\n        this.uploaded.images = [];\n        this.uploaded.files = [];\n      } catch (error) {\n        this.$message.error(\"发送消息失败\");\n      }\n    },\n    getSafeText(text) {\n      return text;\n    },\n    cleanScreen() {\n      this.$emit(\"cleanScreen\");\n    },\n    currentChange(data, event) {\n      if (event.level === 3) {\n        if (!event.parent || !event.parent.parent) {\n          console.error(\"父节点不存在!\");\n          return;\n        }\n        const selectedValues = [\n          event.parent.parent.data.value,\n          event.parent.data.value,\n          data.value,\n        ];\n        this.$message({\n          message: \"已切换到 \" + selectedValues[2] + \" 模型\",\n          type: \"success\",\n        });\n        const seletedProvider = selectedValues[0];\n        if (seletedProvider !== this.activeContactor.options?.provider) {\n          this.$message({\n            message: \"已切换到 \" + seletedProvider + \" 协议\",\n            type: \"success\",\n          });\n        }\n        this.$emit(\"setModel\", selectedValues);\n      } else if (event.level === 2) {\n        if (this.activeContactor.platform === \"onebot\") {\n          if (this.getOnebotPreset() && !this.getOnebotPreset().includes(\"xxx\")) {\n            this.send();\n          }\n        }\n      }\n    },\n    handleKeyDown(event) {\n      if (event.key === \"Enter\") {\n        if (event.ctrlKey) {\n          if (this.hasInput()) {\n            this.send();\n          } else {\n            this.$message({ message: \"不能发送空消息\", type: \"warning\" });\n          }\n        } else {\n          document.execCommand(\"insertHTML\", false, \"\\n\");\n        }\n      }\n      setTimeout(() => {\n        this.updateCursorPosition();\n      }, 0);\n    },\n  },\n};\n</script>\n\n<style lang=\"sass\" scoped>\n$mobile: 600px\n$icon-hover: #09f\n\ni:hover\n  color: $icon-hover\n\n.input-bar\n  flex-shrink: 0\n  display: flex\n  flex-direction: column\n  border: 0 solid rgba(161, 154, 154, 0.626)\n  flex-basis: 11rem\n  @media (max-width: $mobile)\n    flex-basis: 7rem\n    width: 100%\n    flex-direction: column-reverse\n    position: fixed\n    bottom: 0\n    z-index: 1000\n    background-color: hsla(0, 0%, 100%, 0.8)\n    backdrop-filter: blur(0.5rem)\n\n  .options\n    display: flex\n    border-top: 0.0625rem solid rgba(128, 128, 128, 0.502)\n    padding: 0.25rem 0.5rem\n    @media (max-width: $mobile)\n      border: none\n      justify-content: space-around\n\n.bu-emoji\n  position: relative\n  white-space: nowrap\n  @media screen and (min-width: $mobile)\n    &:hover p.ho-emoji\n      display: block\n\nemoji-picker\n  position: absolute\n  top: -25.75rem\n  right: -20rem\n\np.ho-emoji\n    text-wrap: nowrap\n    display: none\n    font-size: .75rem\n    padding: .125rem .25rem\n    background-color: #fff\n    border: none\n    box-shadow: 0 .125rem .25rem #0003\n    position: absolute\n    top: 80%\n    left: 50%\n    transform: translate(-60%)\ni\n  display: block\n  padding: 0.25rem 0.5rem 0 0\n  font-size: 1.25rem\n  width: 1.5rem\n  height: 1.5rem\n\n.input-box\n    flex-grow: 1\n    padding: 0 .5rem\n    display: flex\n    flex-direction: column\n    align-items: end\n\n    @media screen and (max-width: $mobile)\n      flex-direction: row\n      align-items: flex-end\n      flex-wrap: nowrap\n\n    .input-content\n      flex-wrap: wrap\n      display: flex\n      background-color: #f1f1f1\n      border: 0\n      flex-grow: 1\n      width: 100%\n\n      @media screen and (max-width: $mobile)\n        margin: 0.5rem 0.5rem 0.8rem 0\n        min-height: 2rem\n        flex-basis: calc( 100% - 4rem )\n        max-width: calc( 100% - 4rem )\n        flex-grow: 0\n        background-color: #fff\n\n      .input-area\n        overflow-y: auto\n        max-height: 20rem\n        resize: none\n        font-size: 1rem\n        background-color: #f1f1f1\n        border: 0\n        flex-grow: 1\n        width: 100%\n        moz-user-select: -moz-none\n        -moz-user-select: none\n        -o-user-select: none\n        -khtml-user-select: none\n        -webkit-user-select: none\n        -ms-user-select: none\n        user-select: none\n        &:focus\n          border: 0\n          outline: none\n\n        @media screen and (max-width: $mobile)\n          background-color: transparent\n          margin: 0.2rem\n          caret-color: #14C1EB\n\n    button\n        white-space: nowrap\n        color: #f0f8ff\n        border-radius: .3125rem\n        border: 0\n        background-color: $icon-hover\n        padding: .25rem 1rem\n        margin-bottom: .8rem\n        margin-right: .5rem\n        cursor: pointer\n\n        @media screen and (max-width: $mobile)\n          height: 2rem\n          margin-right: 0rem\n</style>\n","<template>\n  <div class=\"file-block\">\n    <div class=\"file-block-icon\">\n      <div class=\"file-icon\" :class=\"iconClass\">\n        <!-- Dynamic class binding -->\n        <span v-if=\"file_type\"> {{ file_type.toUpperCase() }}</span>\n      </div>\n    </div>\n    <div class=\"file-block-text\">\n      <div class=\"file-name\" :title=\"file_name\">{{ file_name }}</div>\n      <div class=\"file-info\">\n        {{ file_type.toUpperCase() }}, {{ formated_file_size }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    fileUrl: {\n      // 修改为 camelCase\n      type: String,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      file_name: \"\",\n      file_type: \"\",\n      formated_file_size: \"\",\n    };\n  },\n  computed: {\n    iconClass() {\n      //Use lower case for comparison, easier to manage\n      const type = this.file_type.toLowerCase();\n\n      if (type === \"pdf\") {\n        return \"file-icon-pdf\";\n      } else if ([\"xls\", \"xlsx\", \"csv\"].includes(type)) {\n        // Spreadsheet (Excel, CSV)\n        return \"file-icon-spreadsheet\";\n      } else if ([\"doc\", \"docx\"].includes(type)) {\n        // Word\n        return \"file-icon-word\";\n      } else if ([\"ppt\", \"pptx\"].includes(type)) {\n        // PowerPoint\n        return \"file-icon-ppt\";\n      } else {\n        return \"file-icon-other\"; // Default (gray)\n      }\n    },\n  },\n  created() {\n    // 从查询参数中获取文件大小\n    const url = this.fileUrl.split(\"?\");\n    const params = new URLSearchParams(url[1]);\n    const bits = params.get(\"size\");\n    this.file_name = params.get(\"name\");\n    this.formated_file_size = this.formatFileSize(bits);\n    // 从url中获取文件类型\n    const file_type = url[0].split(\".\");\n    this.file_type = file_type[file_type.length - 1];\n  },\n  methods: {\n    formatFileSize(bits) {\n      const units = [\"B\", \"KB\", \"MB\"];\n      let unitIndex = 0;\n      while (bits >= 1024) {\n        bits /= 1024;\n        unitIndex++;\n      }\n      return bits.toFixed(2) + \" \" + units[unitIndex];\n    },\n  },\n};\n</script>\n\n<style scoped>\n.file-block {\n  display: flex;\n  align-items: center;\n  padding: 8px;\n  border-radius: 5px;\n  background-color: #f5f5f5;\n  margin: 0.5rem 0;\n  width: 12rem;\n  position: relative;\n}\n\n.file-block-icon {\n  width: 40px;\n  height: 40px;\n  margin-right: 8px;\n}\n\n.file-icon {\n  width: 40px;\n  height: 40px;\n  /*  Remove default background  */\n  /* background-color: #4285f4; */\n  color: #fff;\n  border-radius: 5px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 14px;\n}\n/* Add specific styles for each file type */\n.file-icon-pdf {\n  background-color: #e70012;\n}\n\n.file-icon-spreadsheet {\n  background-color: #138147;\n}\n\n.file-icon-word {\n  background-color: #144eb3;\n}\n.file-icon-ppt {\n  background-color: #ca4b27;\n}\n\n.file-icon-other {\n  background-color: gray;\n}\n\n.file-block-text {\n  flex: 1;\n  overflow: hidden;\n}\n\n.file-name {\n  font-weight: bold;\n  font-size: 12px;\n  color: #333;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.file-info {\n  font-size: 10px;\n  color: #777;\n}\n</style>\n","<template>\n  <div class=\"tool-call-bar\">\n    <div class=\"status-icon\">\n      <span v-if=\"toolCallSuccess\" class=\"call-success-icon\">\n        <div class=\"checkmark-container\">\n          <svg\n            class=\"checkmark\"\n            viewBox=\"0 0 52 36\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n          >\n            <polyline points=\"1 20 15 36 51 1\" />\n          </svg>\n        </div>\n      </span>\n      <span v-else-if=\"toolCallFail\" class=\"call-fail-icon\">❌</span>\n      <span v-else class=\"call-pend-icon\"></span>\n    </div>\n    <div class=\"tool-info\">\n      <div>\n        <span class=\"tool-name\">{{ toolCall.name.split(\"_mid_\")[0] }}</span>\n      </div>\n      <div class=\"tool-status\">\n        {{ call_status }}\n      </div>\n    </div>\n    <div class=\"extra-info\">\n      <button\n        ref=\"show-extra-info\"\n        :class=\"{ active: showExtraInfo, 'extra-info-button': true }\"\n        @click=\"toggleExtraInfo\"\n      >\n        <svg\n          t=\"1731677922196\"\n          class=\"icon\"\n          viewBox=\"0 0 1024 1024\"\n          version=\"1.1\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          p-id=\"5948\"\n          width=\"16\"\n          height=\"16\"\n        >\n          <path\n            d=\"M778.965749 128.759549l-383.064442 383.063419 388.097062 388.096039-0.070608 0.033769c12.709463 13.137205 20.529569 31.024597 20.529569 50.731428 0 40.376593-32.736589 73.112158-73.115228 73.112158-19.705807 0-37.591153-7.819083-50.730405-20.528546l-0.034792 0.035816L241.890654 564.622498l0.035816-0.035816c-13.779841-13.281491-22.3838-31.915897-22.3838-52.585659 0-0.071631 0-0.106424 0-0.178055 0-0.072655 0-0.10847 0-0.144286 0-20.669762 8.603959-39.341007 22.3838-52.622498l-0.035816-0.034792L680.573835 20.337187l0.180102 0.179079c13.139252-12.5662 30.950919-20.313651 50.587142-20.313651 40.378639 0 73.115228 32.736589 73.115228 73.114205C804.455283 95.485725 794.567076 115.334795 778.965749 128.759549z\"\n            p-id=\"5949\"\n          ></path>\n        </svg>\n      </button>\n    </div>\n    <teleport to=\"body\">\n      <div\n        v-if=\"showExtraInfo\"\n        ref=\"teleportContent\"\n        class=\"extra-info-bar\"\n        :class=\"{ active: showExtraInfo, upward: openUp }\"\n        :style=\"teleportStyle\"\n        @click.stop\n      >\n        <div class=\"extra-detail\">\n          <div class=\"detail-params\">\n            <div class=\"detail-title\">\n              <span>参数</span>\n              <button class=\"copy-btn\" @click=\"copyParameters\" title=\"复制参数\">\n                <i class=\"iconfont fuzhi\" title=\"复制参数\"></i>\n              </button>\n            </div>\n            <div class=\"detail-content\">\n              {{ toolCall.parameters }}\n            </div>\n          </div>\n\n          <div class=\"detail-result\">\n            <div class=\"detail-title\">\n              <span>返回值</span>\n              <button class=\"copy-btn\" @click=\"copyResult\" title=\"复制返回值\">\n                <i class=\"iconfont fuzhi\" title=\"复制返回值\"></i>\n              </button>\n            </div>\n            <div class=\"detail-content\">\n              {{ toolCall.result }}\n            </div>\n          </div>\n        </div>\n      </div>\n    </teleport>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    toolCall: {\n      type: Object,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      showExtraInfo: false,\n      teleportStyle: {},\n      openUp: false,\n    };\n  },\n  computed: {\n    toolCallSuccess() {\n      return (\n        this.toolCall.action === \"finished\" && !this.toolCall?.result?.error\n      );\n    },\n    toolCallFail() {\n      return (\n        this.toolCall.action === \"finished\" && this.toolCall?.result?.error\n      );\n    },\n    call_status() {\n      if (this.toolCall.action == \"started\") return \"开始运行\";\n      if (this.toolCall.action == \"pending\") return \"函数构建中\";\n      if (this.toolCall.action == \"running\") return \"函数运行中\";\n      if (this.toolCallSuccess) return \"函数运行成功\";\n      if (this.toolCallFail) return \"函数运行失败\";\n      else return \"未知状态\";\n    },\n  },\n  mounted() {},\n  methods: {\n    async copyToClipboard(text) {\n      try {\n        await navigator.clipboard.writeText(text);\n        // element-plus / global $message is used elsewhere in the project\n        if (this.$message) this.$message({ message: \"已复制到剪贴板\", type: \"success\" });\n      } catch (e) {\n        if (this.$message) this.$message({ message: \"复制失败\", type: \"error\" });\n      }\n    },\n    copyParameters() {\n      const p = this.toolCall.parameters;\n      const text = typeof p === \"string\" ? p : JSON.stringify(p, null, 2);\n      this.copyToClipboard(text);\n    },\n    copyResult() {\n      const r = this.toolCall.result;\n      const text = typeof r === \"string\" ? r : JSON.stringify(r, null, 2);\n      this.copyToClipboard(text);\n    },\n    toggleExtraInfo(event) {\n      this.showExtraInfo = !this.showExtraInfo;\n      if (this.showExtraInfo) {\n        this.positionTeleport();\n        // attach global listener to detect outside click\n        window.addEventListener(\"resize\", this.positionTeleport);\n        document.addEventListener(\"click\", this.onDocClick);\n      } else {\n        window.removeEventListener(\"resize\", this.positionTeleport);\n        document.removeEventListener(\"click\", this.onDocClick);\n      }\n    },\n    onDocClick(e) {\n      // if clicked outside component root and teleport content, close\n      const root = this.$el;\n      const t = this.$refs.teleportContent;\n      if (root && !root.contains(e.target) && t && !t.contains(e.target)) {\n        this.showExtraInfo = false;\n        window.removeEventListener(\"resize\", this.positionTeleport);\n        document.removeEventListener(\"click\", this.onDocClick);\n      }\n    },\n    positionTeleport() {\n      // Compute root position (tool-call-bar) and place teleport content below by default\n      const root = this.$el;\n      if (!root) return;\n      const rootRect = root.getBoundingClientRect();\n\n      // left align with the left edge of the component\n      const left = Math.max(8, rootRect.left);\n      const initialTop = rootRect.bottom + 8;\n\n      // set a temporary style so the element renders, then measure\n      this.teleportStyle = {\n        position: \"fixed\",\n        top: initialTop + \"px\",\n        left: left + \"px\",\n        minWidth: rootRect.width + \"px\",\n        zIndex: 10000,\n      };\n\n      this.$nextTick(() => {\n        const content = this.$refs.teleportContent;\n        if (!content) return;\n        const contentRect = content.getBoundingClientRect();\n        const contentHeight = contentRect.height;\n        const contentWidth = contentRect.width;\n\n        // recompute left to avoid overflow on the right\n        let finalLeft = left;\n        if (finalLeft + contentWidth + 8 > window.innerWidth) {\n          finalLeft = Math.max(8, window.innerWidth - contentWidth - 8);\n        }\n\n        // decide upward or downward based on available space below\n        if (rootRect.bottom + contentHeight + 12 > window.innerHeight) {\n          // open upwards\n          const topUp = rootRect.top - contentHeight - 8;\n          this.openUp = true;\n          this.teleportStyle = {\n            position: \"fixed\",\n            top: topUp + \"px\",\n            left: finalLeft + \"px\",\n            minWidth: rootRect.width + \"px\",\n            zIndex: 10000,\n          };\n        } else {\n          this.openUp = false;\n          this.teleportStyle = {\n            position: \"fixed\",\n            top: initialTop + \"px\",\n            left: finalLeft + \"px\",\n            minWidth: rootRect.width + \"px\",\n            zIndex: 10000,\n          };\n        }\n      });\n    },\n  },\n  beforeUnmount() {\n    window.removeEventListener(\"resize\", this.positionTeleport);\n    document.removeEventListener(\"click\", this.onDocClick);\n  },\n};\n</script>\n<style scoped>\n.extra-detail {\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  flex-grow: 1;\n  padding-bottom: 1rem;\n  width: 20rem;\n}\n\n.detail-params,\n.detail-result {\n  margin-top: 1rem;\n  width: 18rem;\n  background-color: #fff;\n  border-radius: 0.5rem;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  flex-grow: 1;\n}\n\n.detail-title {\n  padding-top: 0.5rem;\n  flex-basis: 2rem;\n  width: 90%;\n  border-bottom: 1px solid #5c5c5c;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n\n.detail-content {\n  user-select: text;\n  margin: 0.5rem 0rem;\n  font-size: 0.8rem;\n  color: #5c5c5c;\n  width: 90%;\n  /* allow wrapping and preserve newlines from formatted JSON/text */\n  white-space: pre-wrap;\n  overflow-wrap: anywhere;\n  word-break: break-word;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 8rem;\n  flex-grow: 1;\n}\n\n.extra-info-bar {\n  overflow: hidden;\n  z-index: 2;\n  max-height: 0px;\n  top: 4rem;\n  position: absolute;\n  background-color: #f5f5f5;\n  border-radius: 0.5rem;\n  box-shadow: 0px 0px 5px 0px rgba(0, 0, 0, 0.2);\n  display: flex;\n  flex-direction: column;\n}\n\n.extra-info-bar.active {\n  max-height: 50rem;\n}\n\n.tool-info {\n  flex-grow: 1;\n  flex-basis: 10rem;\n  flex-shrink: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-evenly;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  margin-right: 0.5rem;\n}\n\n.extra-info {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-basis: 3rem;\n  min-width: 3rem;\n}\n\nbutton.extra-info-button {\n  transition: transform 0.3s ease;\n  transform: rotate(90deg);\n}\n\nbutton.extra-info-button.active {\n  transform: rotate(-90deg);\n}\n\nbutton.extra-info-button:hover svg {\n  transition: transform 0.3s ease;\n  transform: scale(1.2);\n}\n\n.copy-btn {\n  border: none;\n  background: transparent;\n  cursor: pointer;\n  padding: 0.15rem 0.25rem;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  color: #5c5c5c;\n}\n\n.copy-btn:hover {\n  color: #09f;\n}\n\n.tool-name {\n  font-weight: bolder;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.tool-call-bar {\n  max-width: 100%;\n  margin-top: 0.5rem;\n  margin-bottom: 0.5rem;\n  height: 4rem;\n  flex-wrap: nowrap;\n  background-color: #f5f5f5;\n  border-radius: 5px;\n  display: flex;\n  position: relative;\n}\n\n.status-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  border-radius: 50%;\n  min-width: 4rem;\n}\n\n.call-pend-icon {\n  transform: rotateZ(45deg);\n  perspective: 1000px;\n  border-radius: 50%;\n  width: 48px;\n  height: 48px;\n  color: #fff;\n}\n\n.call-pend-icon:before,\n.call-pend-icon:after {\n  content: \"\";\n  display: block;\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: inherit;\n  height: inherit;\n  border-radius: 50%;\n  transform: rotateX(70deg);\n  animation: 1s spin linear infinite;\n}\n\n.call-pend-icon:after {\n  color: #ff3d00;\n  transform: rotateY(70deg);\n  animation-delay: 0.4s;\n}\n\n@keyframes rotate {\n  0% {\n    transform: translate(-50%, -50%) rotateZ(0deg);\n  }\n\n  100% {\n    transform: translate(-50%, -50%) rotateZ(360deg);\n  }\n}\n\n@keyframes rotateccw {\n  0% {\n    transform: translate(-50%, -50%) rotate(0deg);\n  }\n\n  100% {\n    transform: translate(-50%, -50%) rotate(-360deg);\n  }\n}\n\n@keyframes spin {\n  0%,\n  100% {\n    box-shadow: 0.2em 0px 0 0px currentcolor;\n  }\n\n  12% {\n    box-shadow: 0.2em 0.2em 0 0 currentcolor;\n  }\n\n  25% {\n    box-shadow: 0 0.2em 0 0px currentcolor;\n  }\n\n  37% {\n    box-shadow: -0.2em 0.2em 0 0 currentcolor;\n  }\n\n  50% {\n    box-shadow: -0.2em 0 0 0 currentcolor;\n  }\n\n  62% {\n    box-shadow: -0.2em -0.2em 0 0 currentcolor;\n  }\n\n  75% {\n    box-shadow: 0px -0.2em 0 0 currentcolor;\n  }\n\n  87% {\n    box-shadow: 0.2em -0.2em 0 0 currentcolor;\n  }\n}\n\n.checkmark-container {\n  width: 2.25rem;\n  height: 2rem;\n}\n\n.checkmark {\n  width: 100%;\n  height: 100%;\n}\n\n.checkmark polyline {\n  fill: none;\n  stroke: green;\n  /* 设置颜色为绿色 */\n  stroke-width: 10;\n  /* 设置线条的粗细 */\n  stroke-dasharray: 60;\n  /* 总长度 */\n  stroke-dashoffset: 60;\n  /* 起始偏移量 */\n  animation: draw 1s forwards;\n  /* 动画定义 */\n}\n\n@keyframes draw {\n  to {\n    stroke-dashoffset: 0;\n    /* 结束时偏移量为0，显示完整的对勾 */\n  }\n}\n</style>\n","<template>\n  <div class=\"reason-block\">\n    <div class=\"head-bar\">\n      <div class=\"reason-info\">{{ getReasonInfo }}</div>\n      <button\n        :class=\"{ active: show, 'extra-info-button': true }\"\n        @click=\"toggleShow\"\n      >\n        <i class=\"iconfont icon-return\" />\n      </button>\n    </div>\n    <div\n      ref=\"reasonContent\"\n      class=\"reason-content\"\n      :style=\"{ 'max-height': maxHeight }\"\n    >\n      {{ content }}\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    content: {\n      required: true,\n      type: String,\n      default: \"\",\n    },\n    startTime: {\n      required: true,\n      type: Number,\n    },\n    endTime: {\n      required: false,\n      type: Number,\n      default: 0,\n    },\n  },\n  data() {\n    return {\n      show: true,\n      maxHeight: \"auto\", // 初始值\n    };\n  },\n  computed: {\n    getReasonInfo() {\n      if (this.endTime) {\n        const timeDiff = this.endTime - this.startTime;\n        return `已深度思考（耗时 ${(timeDiff / 1000).toFixed(2)} 秒）`;\n      } else {\n        return `正在深度思考......`;\n      }\n    },\n  },\n  mounted() {\n    this.updateMaxHeight(); //初始展开\n  },\n  updated() {\n    this.updateMaxHeight(); //防止内容更新,导致高度计算错误\n  },\n  methods: {\n    toggleShow() {\n      this.show = !this.show;\n      this.updateMaxHeight();\n    },\n    updateMaxHeight() {\n      if (this.show) {\n        // 展开时，设置为内容实际高度 + 一些额外空间 (如 padding)\n        this.maxHeight = this.$refs.reasonContent.scrollHeight + 20 + \"px\";\n      } else {\n        // 收起时，设置为 0\n        this.maxHeight = \"0px\";\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.reason-block {\n  margin-bottom: 10px;\n  display: flex;\n  flex-direction: column;\n}\n\n.reason-info {\n  margin: 0.5rem 0;\n  font-size: 0.8rem;\n  min-width: 8rem;\n  flex-basis: 10rem;\n  text-wrap: nowrap;\n}\n\n.head-bar {\n  flex-basis: 1rem;\n  margin: 0.5rem 0;\n  display: flex;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: center;\n  width: fit-content;\n  background-color: #f5f5f5;\n  border-radius: 10px;\n  padding: 0px 0.5rem;\n}\n\n.head-bar:hover {\n  background-color: #ededed;\n}\n\n.head-bar button {\n  flex-basis: 1rem;\n  margin-left: 0.5rem;\n  background-color: transparent;\n  border: none;\n  cursor: pointer;\n  transition: transform 0.3s ease-in-out;\n  /* 使用 ease-in-out */\n  display: flex;\n  align-items: center;\n  gap: 2px;\n}\n\n.head-bar button i {\n  font-size: 0.8rem;\n}\n\n.head-bar button.active {\n  transform: rotate(-90deg);\n}\n\n.reason-content {\n  max-width: 100%;\n  /* max-height 在 JavaScript 中动态控制 */\n  overflow: hidden;\n  /* 隐藏超出部分 */\n  user-select: text;\n  font-size: 0.8rem;\n  color: #6f6f6f;\n  white-space: pre-line;\n  border-left: 2px solid #ccc;\n  transition: max-height 0.3s ease-in-out;\n  /* 对 max-height 应用过渡 */\n  padding-left: 1rem;\n}\n</style>\n","<template>\n  <div id=\"message-menu\" :class=\"{ 'expand-up': isUp, 'expand-down': !isUp }\">\n    <template v-if=\"type === 'friend'\">\n      <div @click.stop=\"enterChat\">\n        <i class=\"iconfont chat\"></i>\n        <span>进入对话</span>\n      </div>\n      <div @click.stop=\"togglePriority\">\n        <i class=\"iconfont star\"></i>\n        <span>{{ message.priority === 0 ? \"取消置顶\" : \"置顶\" }}</span>\n      </div>\n      <div @click.stop=\"shareBot\">\n        <i class=\"iconfont icon-share\"></i>\n        <span>分享</span>\n      </div>\n      <div @click.stop=\"deleteBot\">\n        <i class=\"iconfont shanchu\"></i>\n        <span>删除</span>\n      </div>\n    </template>\n    <template v-else>\n      <div v-if=\"seletedText\" @click.stop=\"copySeletedText\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>复制选中</span>\n      </div>\n      <div @click.stop=\"copyText\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>复制消息</span>\n      </div>\n      <div v-if=\"seletedImage\" @click.stop=\"copySeletedImage\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>复制图片</span>\n      </div>\n      <div v-if=\"seletedImage\" @click.stop=\"saveSeletedImage\">\n        <i class=\"iconfont fuzhi\"></i>\n        <span>保存图片</span>\n      </div>\n      <div @click.stop=\"retryMessage\">\n        <i class=\"iconfont reset\"></i>\n        <span>重试消息</span>\n      </div>\n      <div @click.stop=\"replyMessage\">\n        <i class=\"iconfont yinyong\"></i>\n        <span>引用消息</span>\n      </div>\n      <div @click.stop=\"deleteMessage\">\n        <i class=\"iconfont shanchu\"></i>\n        <span>删除消息</span>\n      </div>\n    </template>\n  </div>\n</template>\n<script>\nexport default {\n  name: \"MessageMenu\", // 建议添加组件 name，方便调试\n  props: {\n    type: {\n      type: String,\n      default: \"message\",\n    },\n    message: {\n      type: Object,\n      default: () => ({}),\n    },\n    seletedText: {\n      type: String,\n      default: \"\",\n    },\n    seletedImage: {\n      type: String,\n      default: \"\",\n    },\n  },\n  data() {\n    return {\n      isUp: false,\n    };\n  },\n  emits: [\"close\", \"message-option\"], //显式声明emit的事件\n  methods: {\n    updateArrow() {\n      // 判断根元素是否通过 inline style 使用 bottom 定位（表示向上展开）\n      const el = this.$el;\n      if (!el) return;\n      const hasBottom = el.style && el.style.bottom && el.style.bottom !== \"\";\n      this.isUp = !!hasBottom;\n    },\n    onWindowResize() {\n      // 重新计算三角位置（样式由 CSS 控制，这里主要保持 isUp 更新）\n      this.updateArrow();\n    },\n    async copySeletedImage() {\n      this.$emit(\"close\");\n      try {\n        await this.copyImageToClipboard(this.seletedImage);\n      } catch (error) {\n        console.error(\"复制选择图片失败：\", error);\n      }\n    },\n    async saveSeletedImage() {\n      this.$emit(\"close\");\n      try {\n        await this.downloadImage(this.seletedImage);\n      } catch (error) {\n        console.error(\"保存选择图片失败：\", error);\n      }\n    },\n    copyText() {\n      let text = \"\";\n      this.message.content.forEach((element) => {\n        if (element.type === \"text\") {\n          text += element.data.text;\n        } else if (element.type === \"image\") {\n          text += `\\n![图片](${element.data.file})`;\n        }\n      });\n      this.copyTextToClipboard(text);\n      this.$emit(\"close\");\n    },\n    copySeletedText() {\n      this.copyTextToClipboard(this.seletedText);\n      this.$emit(\"close\");\n    },\n    retryMessage() {\n      this.$emit(\"message-option\", \"retry\");\n      this.$emit(\"close\");\n    },\n    replyMessage() {\n      this.$emit(\"message-option\", \"reply\");\n      this.$emit(\"close\");\n    },\n    deleteMessage() {\n      this.$emit(\"message-option\", \"delete\");\n      this.$emit(\"close\");\n    },\n    enterChat() {\n      this.$emit(\"message-option\", \"enter\");\n      this.$emit(\"close\");\n    },\n    togglePriority() {\n      this.$emit(\"message-option\", \"priority\");\n      this.$emit(\"close\");\n    },\n    shareBot() {\n      this.$emit(\"message-option\", \"share\");\n      this.$emit(\"close\");\n    },\n    deleteBot() {\n      this.$emit(\"message-option\", \"delete\");\n      this.$emit(\"close\");\n    },\n    // 封装复制文本到剪贴板的函数\n    async copyTextToClipboard(text) {\n      let textarea;\n      try {\n        textarea = document.createElement(\"textarea\");\n        textarea.style.position = \"absolute\";\n        textarea.style.left = \"-9999px\";\n        textarea.value = text;\n        document.body.appendChild(textarea);\n        textarea.select();\n        textarea.setSelectionRange(0, 99999); // For mobile devices\n        await document.execCommand(\"copy\");\n        this.$message({ message: \"复制成功\", type: \"success\" });\n      } catch (err) {\n        console.error(\"复制失败:\", err);\n        this.$message({ message: \"复制失败\", type: \"error\" });\n      } finally {\n        document.body.removeChild(textarea);\n      }\n    },\n    // 封装复制图片到剪贴板的函数\n    async copyImageToClipboard(imgSrc) {\n      try {\n        const response = await fetch(imgSrc);\n        if (!response.ok) {\n          throw new Error(\"网络错误，无法获取图片\");\n        }\n        const blob = await response.blob();\n        const img = new Image();\n        const url = URL.createObjectURL(blob);\n        img.onload = async () => {\n          const canvas = document.createElement(\"canvas\");\n          canvas.width = img.width;\n          canvas.height = img.height;\n          const ctx = canvas.getContext(\"2d\");\n          ctx.drawImage(img, 0, 0);\n          // 使用 Promise 包装 toBlob\n          const pngBlob = await new Promise((resolve) => {\n            canvas.toBlob(resolve, \"image/png\");\n          });\n          if (pngBlob) {\n            const item = new ClipboardItem({ \"image/png\": pngBlob });\n            await navigator.clipboard.write([item]); // 使用 await\n            this.$message({\n              message: \"图片已复制到剪贴板\",\n              type: \"success\",\n            });\n          } else {\n            this.$message({\n              message: \"转换为 PNG 失败\",\n              type: \"error\",\n            });\n          }\n          URL.revokeObjectURL(url);\n        };\n        img.onerror = () => {\n          this.$message({ message: \"加载图片失败\", type: \"error\" });\n          URL.revokeObjectURL(url); // 确保在错误时也释放 URL\n        };\n        img.src = url;\n      } catch (err) {\n        console.error(\"复制图片失败:\", err);\n        this.$message({ message: \"复制图片失败\", type: \"error\" });\n      }\n    },\n    // 封装下载图片的函数\n    async downloadImage(imgSrc) {\n      try {\n        const link = document.createElement(\"a\");\n        link.href = imgSrc;\n        link.download = \"image.png\";\n        link.click();\n      } catch (err) {\n        console.error(\"保存图片失败：\", err);\n        this.$message({ message: \"保存图片失败\", type: \"error\" });\n      }\n    },\n  },\n  mounted() {\n    // 初次渲染后根据 inline style 判断展开方向\n    this.$nextTick(() => {\n      this.updateArrow();\n    });\n    window.addEventListener(\"resize\", this.onWindowResize);\n  },\n  updated() {\n    // 当父组件改变 inline style（top/bottom）时更新箭头方向\n    this.$nextTick(() => {\n      this.updateArrow();\n    });\n  },\n  beforeUnmount() {\n    window.removeEventListener(\"resize\", this.onWindowResize);\n  },\n};\n</script>\n<style lang=\"sass\" scoped>\n#message-menu\n    position: fixed\n    display: flex\n    flex-direction: column\n    justify-content: center\n    background-color: hsla(0, 0%, 100%, .78)\n    backdrop-filter: blur(0.5rem)\n    border-radius: 0.5rem\n    padding: .5rem\n    z-index: 9999\n    -webkit-user-select: none\n    -moz-user-select: none\n    -ms-user-select: none\n    user-select: none\n    \n    // 移动端样式 - 横向网格布局\n    @media (max-width: 768px)\n        display: grid\n        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr))\n        padding: 0.5rem\n        max-width: 16rem\n        background-color: rgba(40, 44, 52, 0.85)\n        border-radius: 1rem\n        left: 50%\n        transform: translateX(-50%)\n        \n    @keyframes pop-up\n        0%\n            transform: scale(1)\n        50%\n            transform: scale(1.2)\n        100%\n            transform: scale(1)\n            \n    & div\n        margin: 0.4rem 0\n        padding: .2rem .4rem\n        border-radius: .2rem\n        display: flex\n        justify-content: space-between\n        align-items: center\n        cursor: pointer\n        \n        // 移动端单个菜单项样式\n        @media (max-width: 768px)\n            margin: 0\n            flex-direction: column\n            justify-content: center\n            align-items: center\n            text-align: center\n            border-radius: 0.8rem\n            padding: 0rem 0rem\n            min-height: 3rem\n            background-color: transparent\n            transition: background-color 0.2s ease\n            \n    & div:hover\n        background-color: hsla(0, 0%, 90%, .88)\n        \n        // 移动端悬停效果\n        @media (max-width: 768px)\n            background-color: rgba(255, 255, 255, 0.1)\n            \n    & div:hover > i\n        animation: pop-up 0.5s ease-in-out 1 forwards\n        \n    & i\n        position: absolute\n        display: flex\n        justify-content: center\n        align-items: center\n        transform-origin: center\n        \n        // 移动端图标样式\n        @media (max-width: 768px)\n            position: static\n            font-size: 1rem\n            margin-bottom: 0.3rem\n            color: rgba(255, 255, 255, 0.9)\n            \n    & span\n        font-size: 0.8rem\n        color: rgb(120, 124, 127)\n        margin-left: 1.8rem\n        \n        // 移动端文字样式\n        @media (max-width: 768px)\n            margin-left: 0\n            font-size: 0.7rem\n            color: rgba(255, 255, 255, 0.8)\n            line-height: 1.2\n            word-break: break-all\n\n    &.expand-down\n      @media (max-width: 768px)\n        // 当向下展开，三角在顶部居中，指向触发点（仅移动端）\n        &::before\n          content: ''\n          position: absolute\n          top: -6px\n          left: 50%\n          transform: translateX(-50%)\n          width: 0\n          height: 0\n          border-left: 6px solid transparent\n          border-right: 6px solid transparent\n          // 与移动端菜单主体保持一致的背景色\n          border-bottom: 6px solid rgba(40, 44, 52, 0.85)\n  \n    &.expand-up\n      @media (max-width: 768px)\n        // 当向上展开，三角在底部居中，指向触发点（仅移动端）\n        &::after\n          content: ''\n          position: absolute\n          bottom: -6px\n          left: 50%\n          transform: translateX(-50%)\n          width: 0\n          height: 0\n          border-left: 6px solid transparent\n          border-right: 6px solid transparent\n          // 与移动端菜单主体保持一致的背景色\n          border-top: 6px solid rgba(40, 44, 52, 0.85)\n</style>\n","<template>\n  <!-- 移动端全屏模式 -->\n  <div v-if=\"isMobile\" class=\"mobile-fullscreen-overlay\" :class=\"{ show: show }\" @click=\"handleOverlayClick\">\n    <div class=\"mobile-container\" :class=\"{ show: show }\" @click.stop>\n      <div class=\"mobile-header\">\n        <div class=\"mobile-title\">添加机器人</div>\n        <button class=\"mobile-close-btn\" @click=\"close\">\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n            <path d=\"M18 6L6 18M6 6l12 12\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n          </svg>\n        </button>\n      </div>\n      <div class=\"add-contactor-body mobile\">\n        <!-- 标签页导航 -->\n        <div class=\"tabs mobile\">\n          <div\n            v-for=\"(tab, index) in tabs\"\n            :key=\"index\"\n            class=\"tab-item\"\n            :class=\"{ active: activeTab === index }\"\n            @click=\"activeTab = index\"\n          >\n            {{ tab }}\n          </div>\n        </div>\n\n        <!-- 标签页内容 -->\n        <div class=\"tab-content mobile\">\n          <!-- 适配器列表 -->\n          <div v-show=\"activeTab === 0\" class=\"adapters-view\">\n            <div class=\"search\">\n              <el-input\n                v-model=\"adapterKeyword\"\n                placeholder=\"搜索适配器...\"\n                :prefix-icon=\"Search\"\n                clearable\n              />\n            </div>\n            <el-scrollbar class=\"adapters-list\">\n              <div\n                v-for=\"(provider, index) in filteredProviders\"\n                :key=\"index\"\n                class=\"adapter-item mobile\"\n              >\n                <div class=\"adapter-icon\" :style=\"{ backgroundColor: getProviderColor(provider.adapterType) }\">\n                  <img :src=\"getAvatarByAdapterType(provider.adapterType)\" class=\"adapter-icon-img\" />\n                </div>\n                <div class=\"adapter-info\">\n                  <div class=\"adapter-header\">\n                    <el-tag size=\"small\" :type=\"getProviderTagType(provider.adapterType)\" effect=\"plain\" round>\n                      {{ provider.adapterType }}\n                    </el-tag>\n                    <div class=\"adapter-name\">{{ provider.label }}</div>\n                  </div>\n                  <div class=\"adapter-desc\">{{ getProviderDesc(provider.adapterType) }}</div>\n                </div>\n                <el-button type=\"primary\" size=\"small\" @click=\"handleAddByProvider(provider)\">添加</el-button>\n              </div>\n              <el-empty v-if=\"filteredProviders.length === 0\" description=\"未找到相关适配器\" />\n            </el-scrollbar>\n          </div>\n\n          <!-- 预设列表 -->\n          <div v-show=\"activeTab === 1\" class=\"presets-view\">\n            <div class=\"search\">\n              <el-input\n                v-model=\"keyWord\"\n                placeholder=\"输入搜索关键词\"\n                :prefix-icon=\"Search\"\n                clearable\n                @input=\"loadSerachPresets\"\n              />\n            </div>\n            <div class=\"info\">\n              <header class=\"presets-types mobile\">\n                <div :style=\"{ left: buttonTranslate }\" class=\"slide-button\"></div>\n                <nav\n                  v-for=\"(type, index) in avaliablePresetTypes\"\n                  :key=\"index\"\n                  :class=\"activeTypeIndex === index ? 'active' : ''\"\n                  @click=\"changeShownType(index)\"\n                >\n                  {{ type }}\n                </nav>\n              </header>\n              <el-scrollbar\n                v-if=\"shownPrestsList.length > 0 || [0, 3].includes(activeTypeIndex)\"\n                class=\"presets-list\"\n                @scroll=\"handleScroll\"\n              >\n                <div\n                  v-for=\"(preset, index) in shownPrestsList\"\n                  :key=\"index\"\n                  class=\"presets-item mobile\"\n                >\n                  <div v-if=\"preset.avatar\" class=\"preset-avatar custom\">\n                    <img :src=\"preset.avatar\" />\n                  </div>\n                  <div v-else-if=\"preset.model\" class=\"preset-avatar model\">\n                    <img :src=\"Contactor.getAvatarByModel(preset.model)\" />\n                  </div>\n                  <div v-else class=\"preset-avatar\">\n                    {{ preset.name.slice(0, 2) }}\n                  </div>\n                  <div class=\"preset-info\">\n                    <div class=\"preset-name\">{{ preset.name }}</div>\n                    <div :title=\"preset.opening\" class=\"preset-description\">\n                      {{ preset.opening }}\n                    </div>\n                  </div>\n                  <el-button @click=\"addBot(preset)\">添加</el-button>\n                </div>\n                <div v-if=\"showPresetsLoader\" class=\"loading\">\n                  <el-icon class=\"is-loading\">\n                    <Loading />\n                  </el-icon>\n                  <span style=\"margin-left: 8px;\">加载中...</span>\n                </div>\n              </el-scrollbar>\n              <div v-else class=\"empty-list\">\n                <el-empty :image-size=\"120\" />\n              </div>\n            </div>\n          </div>\n\n          <!-- 分享码 -->\n          <div v-show=\"activeTab === 2\" class=\"share-code-view\">\n            <div class=\"share-input-container\">\n              <div class=\"input-label\">输入分享码或分享链接</div>\n              <el-input\n                v-model=\"shareCode\"\n                placeholder=\"粘贴分享码或链接...\"\n                clearable\n                class=\"share-input\"\n              />\n              <el-button\n                type=\"primary\"\n                :disabled=\"!shareCode.trim()\"\n                @click=\"handleAddByShareCode\"\n                style=\"width: 100%; margin-top: 16px;\"\n              >\n                加载 Bot\n              </el-button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- 桌面端对话框模式 -->\n  <el-dialog\n    v-else\n    :model-value=\"show\"\n    title=\"添加机器人\"\n    width=\"500px\"\n    class=\"add-contactor-dialog\"\n    @update:model-value=\"$emit('update:show', $event)\"\n    @close=\"$emit('close')\"\n  >\n    <div class=\"add-contactor-body\">\n      <!-- 标签页导航 -->\n      <div class=\"tabs\">\n        <div\n          v-for=\"(tab, index) in tabs\"\n          :key=\"index\"\n          class=\"tab-item\"\n          :class=\"{ active: activeTab === index }\"\n          @click=\"activeTab = index\"\n        >\n          {{ tab }}\n        </div>\n      </div>\n\n      <!-- 标签页内容 -->\n      <div class=\"tab-content\">\n        <!-- 适配器列表 -->\n        <div v-show=\"activeTab === 0\" class=\"adapters-view\">\n          <div class=\"search\">\n            <el-input\n              v-model=\"adapterKeyword\"\n              placeholder=\"搜索适配器...\"\n              :prefix-icon=\"Search\"\n              clearable\n            />\n          </div>\n          <el-scrollbar class=\"adapters-list\">\n            <div\n              v-for=\"(provider, index) in filteredProviders\"\n              :key=\"index\"\n              class=\"adapter-item\"\n            >\n              <div class=\"adapter-icon\" :style=\"{ backgroundColor: getProviderColor(provider.adapterType) }\">\n                <img :src=\"getAvatarByAdapterType(provider.adapterType)\" class=\"adapter-icon-img\" />\n              </div>\n              <div class=\"adapter-info\">\n                <div class=\"adapter-header\">\n                  <el-tag size=\"small\" :type=\"getProviderTagType(provider.adapterType)\" effect=\"plain\" round>\n                    {{ provider.adapterType }}\n                  </el-tag>\n                  <div class=\"adapter-name\">{{ provider.label }}</div>\n                </div>\n                <div class=\"adapter-desc\">{{ getProviderDesc(provider.adapterType) }}</div>\n              </div>\n              <el-button type=\"primary\" size=\"small\" @click=\"handleAddByProvider(provider)\">添加</el-button>\n            </div>\n            <el-empty v-if=\"filteredProviders.length === 0\" description=\"未找到相关适配器\" />\n          </el-scrollbar>\n        </div>\n\n        <!-- 预设列表 -->\n        <div v-show=\"activeTab === 1\" class=\"presets-view\">\n          <div class=\"search\">\n            <el-input\n              v-model=\"keyWord\"\n              placeholder=\"输入搜索关键词\"\n              :prefix-icon=\"Search\"\n              clearable\n              @input=\"loadSerachPresets\"\n            />\n          </div>\n          <div class=\"info\">\n            <header class=\"presets-types\">\n              <div :style=\"{ left: buttonTranslate }\" class=\"slide-button\"></div>\n              <nav\n                v-for=\"(type, index) in avaliablePresetTypes\"\n                :key=\"index\"\n                :class=\"activeTypeIndex === index ? 'active' : ''\"\n                @click=\"changeShownType(index)\"\n              >\n                {{ type }}\n              </nav>\n            </header>\n            <el-scrollbar\n              v-if=\"shownPrestsList.length > 0 || [0, 3].includes(activeTypeIndex)\"\n              class=\"presets-list\"\n              @scroll=\"handleScroll\"\n            >\n              <div\n                v-for=\"(preset, index) in shownPrestsList\"\n                :key=\"index\"\n                class=\"presets-item\"\n              >\n                <div v-if=\"preset.avatar\" class=\"preset-avatar custom\">\n                  <img :src=\"preset.avatar\" />\n                </div>\n                <div v-else-if=\"preset.model\" class=\"preset-avatar model\">\n                  <img :src=\"Contactor.getAvatarByModel(preset.model)\" />\n                </div>\n                <div v-else class=\"preset-avatar\">\n                  {{ preset.name.slice(0, 2) }}\n                </div>\n                <div class=\"preset-info\">\n                  <div class=\"preset-name\">{{ preset.name }}</div>\n                  <div :title=\"preset.opening\" class=\"preset-description\">\n                    {{ preset.opening }}\n                  </div>\n                </div>\n                <el-button @click=\"addBot(preset)\">添加</el-button>\n              </div>\n              <div v-if=\"showPresetsLoader\" class=\"loading\">\n                <el-icon class=\"is-loading\">\n                  <Loading />\n                </el-icon>\n                <span style=\"margin-left: 8px;\">加载中...</span>\n              </div>\n            </el-scrollbar>\n            <div v-else class=\"empty-list\">\n              <el-empty :image-size=\"120\" />\n            </div>\n          </div>\n        </div>\n\n        <!-- 分享码 -->\n        <div v-show=\"activeTab === 2\" class=\"share-code-view\">\n          <div class=\"share-input-container\">\n            <div class=\"input-label\">输入分享码或分享链接</div>\n            <el-input\n              v-model=\"shareCode\"\n              placeholder=\"粘贴分享码或链接...\"\n              clearable\n              class=\"share-input\"\n            />\n            <el-button\n              type=\"primary\"\n              :disabled=\"!shareCode.trim()\"\n              @click=\"handleAddByShareCode\"\n              style=\"width: 100%; margin-top: 16px;\"\n            >\n              加载 Bot\n            </el-button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </el-dialog>\n</template>\n\n<script setup>\nimport { config } from \"@/lib/runtime.js\";\nimport { getAvatarByAdapterType } from \"@/utils/avatar.js\";\nimport { Loading, Search } from '@element-plus/icons-vue';\nimport { ElMessage } from 'element-plus';\nimport { computed, onMounted, onUnmounted, ref } from 'vue';\nimport { useRouter } from 'vue-router';\nimport Contactor from \"../lib/contactor\";\n\n// Props\nconst props = defineProps({\n  show: {\n    type: Boolean,\n    default: false,\n  },\n});\n\n// Emits\nconst emit = defineEmits([\"addBot\", \"close\", \"add-by-provider\", \"add-by-share-code\", \"update:show\"]);\n\n// Router\nconst router = useRouter();\n\n// Constants\nconst avaliablePresetTypes = [\"推荐\", \"最近\", \"本地\", \"系统\"];\nconst tabs = [\"适配器\", \"预设\", \"分享码\"];\n\n// Reactive state\nconst activeTab = ref(0);\nconst adapterKeyword = ref(\"\");\nconst shareCode = ref(\"\");\nconst recommendPresets = ref([]);\nconst recentPresets = ref([]);\nconst localPresets = ref([]);\nconst systemPresets = ref([]);\nconst searchPresets = ref([]);\nconst systemShownNum = ref(0);\nconst recommendShownNum = ref(0);\nconst keyWord = ref(\"\");\nconst activeTypeIndex = ref(0);\nconst buttonTranslate = ref(\"4px\");\nconst moreSystemPresets = ref(true);\nconst moreRecommendPresets = ref(true);\nconst isMobile = ref(false);\n\n// Computed\nconst showPresetsLoader = computed(() => {\n  return activeTypeIndex.value === 3\n    ? moreSystemPresets.value\n    : activeTypeIndex.value === 0\n      ? moreRecommendPresets.value\n      : false;\n});\n\nconst shownPrestsList = computed(() => {\n  if (keyWord.value) {\n    return searchPresets.value;\n  }\n  return activeTypeIndex.value === 2\n    ? localPresets.value\n    : activeTypeIndex.value === 1\n      ? recentPresets.value\n      : activeTypeIndex.value === 0\n        ? recommendPresets.value\n        : activeTypeIndex.value === 3\n          ? systemPresets.value\n          : [];\n});\n\nconst availableProviders = computed(() => {\n  return config.getLLMProviders();\n});\n\nconst filteredProviders = computed(() => {\n  if (!adapterKeyword.value.trim()) {\n    return availableProviders.value;\n  }\n  const keyword = adapterKeyword.value.toLowerCase();\n  return availableProviders.value.filter(provider => \n    provider.value.toLowerCase().includes(keyword) ||\n    provider.label.toLowerCase().includes(keyword) ||\n    provider.adapterType.toLowerCase().includes(keyword)\n  );\n});\n\n// Methods\nconst checkMobile = () => {\n  isMobile.value = window.innerWidth <= 768;\n};\n\nconst handleOverlayClick = () => {\n  close();\n};\n\nconst close = () => {\n  emit('close');\n};\n\nconst handleAddByProvider = (provider) => {\n  emit(\"add-by-provider\", provider.value);\n  ElMessage.success(`成功创建 ${provider.label} Bot`);\n  close();\n};\n\nconst getProviderDesc = (provider) => {\n  const descMap = {\n    'openai': 'OpenAI GPT 系列模型',\n    'gemini': 'Google Gemini 模型',\n    'vertex': 'Google Vertex AI 平台',\n    'onebot': 'OneBot 协议 (QQ, etc.)',\n  };\n  return descMap[provider] || '大语言模型适配器';\n};\n\nconst getProviderTagType = (provider) => {\n  const typeMap = {\n    'openai': 'primary',\n    'gemini': 'success',\n    'vertex': 'warning',\n    'onebot': 'info',\n  };\n  return typeMap[provider] || 'info';\n};\n\nconst getProviderColor = (provider) => {\n  const colorMap = {\n    'openai': '#f0f9ff',  // 浅蓝色背景\n    'gemini': '#f0f7ff',  // 浅蓝色背景\n    'vertex': '#fffbeb',  // 浅黄色背景\n    'onebot': '#f0f4ff',  // 浅紫蓝色背景\n  };\n  return colorMap[provider] || '#f5f5f5'; // 默认浅灰色\n};\n\nconst handleAddByShareCode = () => {\n  if (!shareCode.value.trim()) {\n    ElMessage.warning('请输入分享码');\n    return;\n  }\n  \n  const code = shareCode.value.trim();\n  \n  // 判断是否为纯数字\n  if (/^\\d+$/.test(code)) {\n    router.push(`/s/${code}`);\n    close();\n    return;\n  }\n  \n  // 判断是否为链接\n  try {\n    const url = new URL(code);\n    const currentHost = window.location.host;\n    \n    if (url.host === currentHost) {\n      const match = url.pathname.match(/^\\/s\\/(\\d+)$/);\n      if (match) {\n        router.push(url.pathname);\n        close();\n        return;\n      } else {\n        ElMessage.error('链接格式不正确，应为 /s/数字');\n        return;\n      }\n    } else {\n      ElMessage.error('链接域名与当前网站不一致');\n      return;\n    }\n  } catch (e) {\n    ElMessage.error('请输入有效的分享码或分享链接');\n    return;\n  }\n};\n\nconst addBot = (preset) => {\n  strogeAddHistory(preset);\n  emit(\"addBot\", preset);\n  ElMessage.success(\"添加成功\");\n};\n\nconst strogeAddHistory = (preset) => {\n  const existingItem = recentPresets.value.find(\n    (item) => item.name === preset.name,\n  );\n  if (existingItem) {\n    recentPresets.value.splice(recentPresets.value.indexOf(existingItem), 1);\n  }\n  recentPresets.value.unshift(preset);\n  if (recentPresets.value.length > 20) {\n    recentPresets.value.pop();\n  }\n  localStorage.setItem(\"recent-presets\", JSON.stringify(recentPresets.value));\n};\n\nconst getAddHistory = () => {\n  const recent = localStorage.getItem(\"recent-presets\");\n  if (recent) {\n    recentPresets.value = JSON.parse(recent);\n  }\n  const local = localStorage.getItem(\"local-presets\");\n  if (local) {\n    localPresets.value = JSON.parse(local);\n  }\n};\n\nconst loadSerachPresets = async () => {\n  if (keyWord.value) {\n    activeTypeIndex.value = -1;\n    const res = await fetch(\n      `/api/openai/presets?type=search&keyword=${keyWord.value}`,\n    ).then((res) => res.json());\n    searchPresets.value = res.data || [];\n  } else {\n    activeTypeIndex.value = 0;\n    changeShownType(0);\n  }\n};\n\nconst loadSpecificType = async () => {\n  if (activeTypeIndex.value === 3 && systemPresets.value.length === 0) {\n    const res = await fetch(\n      `/api/openai/presets?type=system&start=${systemShownNum.value}&limit=20`,\n    ).then((res) => res.json());\n    systemPresets.value = res.data || [];\n    systemShownNum.value += systemPresets.value.length;\n    if (!res.data || res.data.length < 20) {\n      moreSystemPresets.value = false;\n    }\n  } else if (\n    activeTypeIndex.value === 0 &&\n    recommendPresets.value.length === 0\n  ) {\n    const res = await fetch(\n      `/api/openai/presets?type=recommended&start=${recommendShownNum.value}&limit=20`,\n    ).then((res) => res.json());\n    recommendPresets.value = res.data || [];\n    recommendShownNum.value += recommendPresets.value.length;\n    if (!res.data || res.data.length < 20) {\n      moreRecommendPresets.value = false;\n    }\n  }\n};\n\nconst loadMoreData = async () => {\n  if (activeTypeIndex.value === 3 && moreSystemPresets.value) {\n    const res = await fetch(\n      `/api/openai/presets?type=system&start=${systemShownNum.value}&limit=20`,\n    ).then((res) => res.json());\n    const newPresets = res.data || [];\n    if (newPresets.length > 0) {\n      systemPresets.value = [...systemPresets.value, ...newPresets];\n      systemShownNum.value += newPresets.length;\n    }\n    if (newPresets.length < 20) {\n      moreSystemPresets.value = false;\n    }\n  } else if (activeTypeIndex.value === 0 && moreRecommendPresets.value) {\n    const res = await fetch(\n      `/api/openai/presets?type=recommended&start=${recommendShownNum.value}&limit=20`,\n    ).then((res) => res.json());\n    const newPresets = res.data || [];\n    if (newPresets.length > 0) {\n      recommendPresets.value = [...recommendPresets.value, ...newPresets];\n      recommendShownNum.value += newPresets.length;\n    }\n    if (newPresets.length < 20) {\n      moreRecommendPresets.value = false;\n    }\n  }\n};\n\nconst changeShownType = (index) => {\n  activeTypeIndex.value = index;\n  buttonTranslate.value = `calc(${index * 25}% + 4px)`;\n  loadSpecificType();\n};\n\n// 处理滚动事件，实现无限滚动\nconst handleScroll = ({ scrollTop }) => {\n  const scrollbar = document.querySelector('.presets-list .el-scrollbar__wrap');\n  if (!scrollbar || !showPresetsLoader.value) return;\n  \n  const scrollHeight = scrollbar.scrollHeight;\n  const clientHeight = scrollbar.clientHeight;\n  const distanceToBottom = scrollHeight - scrollTop - clientHeight;\n  \n  // 当距离底部小于 100px 时提前加载更多，提升用户体验\n  if (distanceToBottom < 100) {\n    loadMoreData();\n  }\n};\n\n// Lifecycle\nonMounted(async () => {\n  checkMobile();\n  window.addEventListener('resize', checkMobile);\n  getAddHistory();\n  await loadSpecificType();\n});\n\n// 清理事件监听器\nonUnmounted(() => {\n  window.removeEventListener('resize', checkMobile);\n});\n</script>\n\n<style lang=\"scss\" scoped>\n// 移动端全屏样式\n.mobile-fullscreen-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  background-color: rgba(0, 0, 0, 0.5);\n  z-index: 9999;\n  opacity: 0;\n  visibility: hidden;\n  transition: all 0.3s ease;\n\n  &.show {\n    opacity: 1;\n    visibility: visible;\n  }\n}\n\n.mobile-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: var(--el-bg-color);\n  transform: translateY(-100%);\n  transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n  display: flex;\n  flex-direction: column;\n\n  &.show {\n    transform: translateY(0);\n  }\n}\n\n.mobile-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 16px 20px;\n  border-bottom: 1px solid var(--el-border-color-light);\n  background-color: var(--el-bg-color);\n  position: sticky;\n  top: 0;\n  z-index: 10;\n}\n\n.mobile-title {\n  font-size: 18px;\n  font-weight: 600;\n  color: var(--el-text-color-primary);\n}\n\n.mobile-close-btn {\n  width: 32px;\n  height: 32px;\n  border: none;\n  background: none;\n  color: var(--el-text-color-regular);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n  transition: background-color 0.2s;\n\n  &:hover {\n    background-color: var(--el-fill-color-light);\n  }\n}\n\n.add-contactor-body {\n  height: 60vh;\n  display: flex;\n  flex-direction: column;\n\n  &.mobile {\n    height: calc(100vh - 65px);\n    flex: 1;\n  }\n}\n\n.tabs {\n  display: flex;\n  border-bottom: 1px solid var(--el-border-color-light);\n  flex-shrink: 0;\n  padding: 0 20px;\n\n  &.mobile {\n    padding: 0 16px;\n    background-color: var(--el-bg-color);\n  }\n}\n\n.tab-item {\n  padding: 10px 16px;\n  cursor: pointer;\n  position: relative;\n  color: var(--el-text-color-secondary);\n  transition: color 0.3s;\n\n  &.active {\n    color: var(--el-color-primary);\n  }\n\n  &.active::after {\n    content: '';\n    position: absolute;\n    bottom: -1px;\n    left: 0;\n    width: 100%;\n    height: 2px;\n    background-color: var(--el-color-primary);\n  }\n}\n\n.tab-content {\n  flex-grow: 1;\n  overflow: hidden;\n  padding: 0 20px;\n  display: flex;\n  flex-direction: column;\n\n  &.mobile {\n    padding: 0 16px;\n    flex: 1;\n  }\n}\n\n.search {\n  padding: 16px 0;\n  flex-shrink: 0;\n}\n\n.adapters-view, .presets-view, .share-code-view {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.adapters-list {\n  flex-grow: 1;\n  overflow-y: auto;\n}\n\n.adapter-item {\n  display: flex;\n  align-items: center;\n  padding: 12px;\n  border-radius: 8px;\n  transition: background-color 0.2s;\n  margin-bottom: 8px;\n\n  &:hover {\n    background-color: var(--el-fill-color-light);\n  }\n\n  &.mobile {\n    padding: 16px 12px;\n    margin-bottom: 12px;\n  }\n}\n\n.adapter-icon {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 12px;\n  color: white;\n  font-size: 20px;\n  overflow: hidden;\n  flex-shrink: 0;\n}\n\n.adapter-icon-img {\n  width: 24px;\n  height: 24px;\n  object-fit: contain;\n}\n\n.adapter-info {\n  flex-grow: 1;\n  min-width: 0;\n}\n\n.adapter-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 4px;\n}\n\n.adapter-item .el-button {\n  margin-left: 8px;\n  flex-shrink: 0;\n}\n\n.adapter-name {\n  font-weight: 500;\n  color: var(--el-text-color-primary);\n}\n\n.adapter-desc {\n  font-size: 12px;\n  color: var(--el-text-color-secondary);\n}\n\n.presets-view {\n  .info {\n    flex-grow: 1;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n  }\n  .presets-list {\n    flex-grow: 1;\n    overflow-y: auto;\n  }\n}\n\n.presets-types {\n  display: flex;\n  position: relative;\n  width: 100%;\n  background-color: var(--el-bg-color-page);\n  border-radius: 8px;\n  padding: 4px;\n  box-sizing: border-box;\n  margin-bottom: 16px;\n  height: 40px;\n\n  &.mobile {\n    height: 44px;\n    padding: 6px;\n  }\n\n  nav {\n    width: 25%;\n    text-align: center;\n    padding: 6px 0;\n    cursor: pointer;\n    position: relative;\n    z-index: 2;\n    transition: color 0.3s;\n    color: var(--el-text-color-regular);\n    font-size: 14px;\n\n    &.active {\n      color: var(--el-color-primary);\n    }\n\n    @media (max-width: 768px) {\n      font-size: 13px;\n      padding: 8px 0;\n    }\n  }\n}\n\n.slide-button {\n  position: absolute;\n  width: calc(25% - 8px);\n  height: calc(100% - 8px);\n  top: 4px;\n  left: 4px;\n  background-color: var(--el-color-white);\n  border-radius: 6px;\n  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);\n  transition: left 0.3s;\n  z-index: 1;\n}\n\n.presets-item {\n  display: flex;\n  align-items: center;\n  padding: 10px 0;\n  border-bottom: 1px solid var(--el-border-color-lighter);\n\n  &.mobile {\n    padding: 16px 0;\n  }\n\n  .preset-avatar {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    background-color: var(--el-color-primary-light-8);\n    color: var(--el-color-primary);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: bold;\n    margin-right: 12px;\n    overflow: hidden;\n    flex-shrink: 0;\n\n    img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n    }\n\n    @media (max-width: 768px) {\n      width: 44px;\n      height: 44px;\n      margin-right: 16px;\n    }\n  }\n\n  .preset-info {\n    flex-grow: 1;\n    overflow: hidden;\n  }\n\n  .preset-name {\n    font-weight: 500;\n\n    @media (max-width: 768px) {\n      font-size: 16px;\n    }\n  }\n\n  .preset-description {\n    font-size: 12px;\n    color: var(--el-text-color-secondary);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n\n    @media (max-width: 768px) {\n      font-size: 13px;\n      margin-top: 4px;\n    }\n  }\n}\n\n.loading {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 20px;\n  color: var(--el-text-color-secondary);\n  font-size: 14px;\n}\n\n.empty-list {\n  flex-grow: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.share-code-view {\n  padding-top: 16px;\n}\n\n.input-label {\n  font-size: 14px;\n  color: var(--el-text-color-regular);\n  margin-bottom: 8px;\n}\n</style>\n\n<style lang=\"scss\">\n.add-contactor-dialog {\n  .el-dialog__header {\n    border-bottom: 1px solid var(--el-border-color-light);\n    margin-right: 0;\n  }\n  .el-dialog__body {\n    padding: 0;\n  }\n}\n</style>\n\n// 移动端响应式样式\n@media (max-width: 768px) {\n  .add-contactor-dialog {\n    display: none !important;\n  }\n\n  .search {\n    padding: 12px 0 !important;\n  }\n\n  .adapter-icon {\n    width: 44px !important;\n    height: 44px !important;\n    margin-right: 16px !important;\n  }\n\n  .adapter-name {\n    font-size: 16px !important;\n  }\n\n  .adapter-desc {\n    font-size: 13px !important;\n  }\n\n  .el-button {\n    padding: 8px 16px !important;\n  }\n\n  .share-code-view {\n    padding-top: 20px !important;\n  }\n\n  .input-label {\n    font-size: 15px !important;\n    margin-bottom: 12px !important;\n  }\n\n  .el-input {\n    font-size: 16px !important;\n  }\n\n  .loading {\n    padding: 24px !important;\n    font-size: 15px !important;\n  }\n}\n\n// 平板适配\n@media (min-width: 769px) and (max-width: 1024px) {\n  .mobile-fullscreen-overlay {\n    display: none !important;\n  }\n}\n\n// 确保桌面端不显示移动端组件\n@media (min-width: 769px) {\n  .mobile-fullscreen-overlay {\n    display: none !important;\n  }\n}","<script>\nimport { client, config } from \"@/lib/runtime.js\";\nimport AddContactor from \"@/components/AddContactor.vue\"\nimport { shareOrCopy } from \"@/utils/tools.js\";\nimport ContextMenu from \"@/components/ContextMenu.vue\";\n\nexport default {\n  components: {\n    AddContactor,\n    ContextMenu,\n  },\n  data() {\n    return {\n      contactorList: [],\n      showAddWindow: false,\n      showMenu: false,\n      menuX: 0,\n      menuY: 0,\n      selectedFriend: null,\n    };\n  },\n  computed: {\n    sortedList() {\n      return [...this.contactorList].sort((a, b) =>\n        b.priority < a.priority ? 1 : b.lastUpdate - a.lastUpdate,\n      );\n    },\n    avaliableProvideres() {\n      return config.getLLMProviders().map((item) => item.value);\n    },\n  },\n  created() {\n    if (client.getContactors().length == 0) {\n      client.on(\n        \"loaded\",\n        () => {\n          this.contactorList = client.getContactors();\n          this.addReactiveListener();\n        },\n        false,\n      );\n    } else {\n      this.contactorList = client.getContactors();\n      this.addReactiveListener();\n    }\n  },\n  methods: {\n    genBotByShareCode() {\n      this.showAddWindow = false;\n      this.$emit(\"open-share-code-window\");\n    },\n    openAddWindow() {\n      this.showAddWindow = true;\n    },\n    showChat(id) {\n      // 如果当前路径 name 是 blank 或者 chat_view ，跳转到 /chat/:id\n      if (this.$route.name == \"blank\" || this.$route.name == \"chat_view\") {\n        this.$router.push({ name: \"chat_view\", params: { id: id } });\n      } else if (\n        this.$route.name == \"contactors\" ||\n        this.$route.name == \"profile_view\"\n      ) {\n        this.$router.push({ name: \"profile_view\", params: { id: id } });\n      } else {\n        // 否则，直接跳转到 /chat/:id\n        this.$router.replace({ name: \"chat_view\", params: { id: id } });\n      }\n    },\n    getId(item) {\n      // 获取当前页面的id\n      let currentId = this.$route.params.id;\n      // 获取当前页面的contactorId\n      let contactorId = item.id;\n      // 如果当前页面的id和contactorId相同，则返回active\n      if (currentId == contactorId) {\n        return \"active\";\n      } else {\n        return item.priority == 0 ? \"important\" : \"\";\n      }\n    },\n    async genBotByProvider(provider) {\n      const options = config.getLLMDefaultConfig(provider);\n      const blankConfig = {\n        id: this.genFakeId(),\n        title: options.base.model,\n        avatarPolicy: 0,\n        namePolicy: 2,\n        priority: 1,\n        options: options,\n      };\n\n      await client.addConcator(\"openai\", blankConfig);\n      this.addReactiveListener();\n    },\n    startResize(event) {\n      this.isResizing = true;\n      this.startX = event.clientX;\n      this.startWidth = this.$refs.friendlists.offsetWidth;\n      document.addEventListener(\"mousemove\", this.resize);\n      document.addEventListener(\"mouseup\", this.stopResize);\n    },\n    resize(event) {\n      if (this.isResizing) {\n        // debugger;\n        let newWidth = this.startWidth + (event.clientX - this.startX);\n        const remSize = document.documentElement.style.fontSize\n          ? parseFloat(document.documentElement.style.fontSize)\n          : 16;\n        const maxWidth = 20 * remSize;\n        const minWidth = 12 * remSize;\n        newWidth =\n          newWidth > maxWidth\n            ? maxWidth\n            : newWidth < minWidth\n              ? minWidth\n              : newWidth;\n        this.$refs.friendlists.style.minWidth = newWidth + \"px\";\n        this.$refs.friendlists.style.maxWidth = newWidth + \"px\";\n      }\n    },\n    stopResize() {\n      this.isResizing = false;\n      document.removeEventListener(\"mousemove\", this.resize);\n      document.removeEventListener(\"mouseup\", this.stopResize);\n    },\n    genFakeId() {\n      return client.genFakeId();\n    },\n    mergeOptions(options) {\n      const defaultOptions = config.getLLMDefaultConfig();\n      if (options.history)\n        defaultOptions.presetSettings.history = options.history;\n      if (options.tools?.length > 0)\n        defaultOptions.toolCallSettings.tools = config.getValidTools(\n          options.tools,\n        );\n      if (options.opening)\n        defaultOptions.presetSettings.opening = options.opening;\n\n      if (options.model) {\n        // 先获取可用的 provider 列表\n        const availableProviders = config\n          .getLLMProviders()\n          .map((item) => item.value);\n        // 看看哪个 provider 里面有这个 model\n        const provider = availableProviders.find((provider) =>\n          config.isModelAvailable(provider, options.model),\n        );\n        if (provider) {\n          // 如果找到了 provider，就使用这个 provider\n          defaultOptions.provider = provider;\n          defaultOptions.base.model = options.model;\n        } else {\n          // 如果没有找到 provider，就使用默认的 provider\n          defaultOptions.base.model = options.model;\n          this.$message({\n            message: \"预设模型不存在, 已使用默认模型\",\n            type: \"error\",\n          });\n        }\n      }\n      return defaultOptions;\n    },\n    async addPresetContactor(preset) {\n      const contactor = {\n        id: this.genFakeId(),\n        namePolicy: 1,\n        avatarPolicy: preset.avatar ? 1 : 0,\n        avatar: preset.avatar ? preset.avatar : undefined,\n        name: preset.name,\n        title: preset.title,\n        priority: 1,\n        options: this.mergeOptions(preset),\n      };\n      await client.addConcator(\"openai\", contactor);\n      this.addReactiveListener();\n    },\n    showFriendContextMenu(event, friend) {\n      this.selectedFriend = friend;\n      this.menuX = event.clientX;\n      this.menuY = event.clientY;\n      this.showMenu = true;\n\n      const closeMenu = () => {\n        this.showMenu = false;\n        document.removeEventListener(\"click\", closeMenu);\n      };\n      document.addEventListener(\"click\", closeMenu);\n    },\n\n    async handleFriendOption(option) {\n      switch (option) {\n        case \"enter\":\n          this.showChat(this.selectedFriend.id);\n          break;\n        case \"priority\":\n          this.selectedFriend.priority =\n            this.selectedFriend.priority === 0 ? 1 : 0;\n          client.setLocalStorage();\n          break;\n        case \"share\": {\n          const shareResult = await client.shareContactor(\n            this.selectedFriend.id,\n          );\n          if (shareResult && shareResult.shareUrl) {\n            const { shareUrl } = shareResult;\n            // 首先尝试调用分享api\n            const { success, message } = shareOrCopy(shareUrl);\n            if (success) {\n              this.$message({\n                message: message,\n                type: \"success\",\n              });\n            } else {\n              this.$message({\n                message: message,\n                type: \"error\",\n              });\n            }\n          }\n          break;\n        }\n        case \"delete\": {\n          let index;\n          index = this.contactorList.findIndex(\n            (c) => c.id === this.selectedFriend.id,\n          );\n          if (index !== -1) {\n            this.contactorList.splice(index, 1);\n            client.setLocalStorage();\n          }\n          break;\n        }\n      }\n      this.showMenu = false;\n    },\n\n    addReactiveListener() {\n      console.log(\"addReactiveListener\");\n      this.contactorList.map((contactor) => {\n        contactor.on(\"updateMessageSummary\", () => {\n          console.log(\"updateMessageSummary\");\n          contactor.lastMessageSummary = contactor.getLastMessageSummary();\n          this.$forceUpdate();\n        });\n      });\n    },\n  },\n};\n</script>\n\n<template>\n  <div id=\"friendlists\" ref=\"friendlists\">\n    <div id=\"friends\" class=\"upsidebar\">\n      <div class=\"search\">\n        <i class=\"iconfont sousuo listicon\"></i>\n        <input id=\"main-search\" type=\"text\" placeholder=\"搜索\" />\n      </div>\n      <div class=\"bu-add\">\n        <button id=\"addcont\" title=\"Add Bot\" @click=\"openAddWindow\">\n          <i class=\"iconfont add\"></i>\n        </button>\n      </div>\n    </div>\n    <div class=\"people\">\n      <div v-for=\"(item, index) of sortedList\" :id=\"getId(item)\" :key=\"index\" class=\"lists\" @click=\"showChat(item.id)\"\n        @contextmenu.prevent=\"showFriendContextMenu($event, item)\">\n        <div class=\"avatar\" :class=\"item.avatarPolicy == 1 ? 'custom' : 'model'\">\n          <img :src=\"item.avatar\" :alt=\"item.name\" />\n        </div>\n        <div class=\"info\">\n          <div class=\"name\">{{ item.name }}</div>\n          <div id=\"time\" class=\"msginfo\">{{ item.getLastTime() }}</div>\n          <div id=\"msgctt\" class=\"msginfo\">{{ item.lastMessageSummary }}</div>\n        </div>\n      </div>\n    </div>\n    <div class=\"resizer\" @mousedown=\"startResize\"></div>\n    <AddContactor \n      v-model:show=\"showAddWindow\"\n      @close=\"showAddWindow = false\" \n      @add-bot=\"addPresetContactor\"\n      @add-by-provider=\"genBotByProvider\"\n      @add-by-share-code=\"genBotByShareCode\"\n    />\n    <ContextMenu v-if=\"showMenu\" type=\"friend\" :message=\"selectedFriend\" :style=\"{\n      top: menuY + 'px',\n    }\" @message-option=\"handleFriendOption\" @close=\"showMenu = false\" />\n  </div>\n</template>\n\n<style scoped>\n#friendlists {\n  height: 100%;\n  display: flex;\n  min-width: 14rem;\n  max-width: 14rem;\n  flex-direction: column;\n  position: relative;\n  background-color: #fff;\n}\n\n.resizer {\n  width: 5px;\n  cursor: ew-resize;\n  background-color: transparent;\n  /* 可视化的样式，你可以根据需求进行调整 */\n  position: absolute;\n  right: 0;\n  top: 0;\n  height: 100%;\n}\n\n.upsidebar {\n  justify-content: space-between;\n  display: flex;\n  flex-direction: row;\n  background-color: rgb(255, 255, 255);\n  flex: 0 0 4rem;\n  align-items: flex-end;\n  -webkit-app-region: drag;\n  align-items: center;\n  padding: 0rem .5rem;\n}\n\n#main-search {\n  width: calc(100% - 1.125rem);\n  margin-top: 0.1875rem;\n  padding-left: 0.3125rem;\n  height: 1.125rem;\n  background-color: rgb(244, 244, 244);\n  border: 0rem;\n}\n\n#main-search:focus {\n  outline: none;\n  border: 0rem;\n}\n\nbutton#searchButton {\n  width: 1rem;\n  border: 0rem;\n  border-radius: 0.3125rem;\n  margin-left: 0.5rem;\n  text-wrap: nowrap;\n}\n\n.search {\n  flex-grow: 1;\n  flex-basis: 1rem;\n  border-radius: 0.3125rem;\n  background: rgb(244, 244, 244);\n  height: 2rem;\n  display: flex;\n  align-items: center;\n  padding-left: .5rem;\n}\n\n.bu-add {\n  flex-basis: 2rem;\n  font-size: 1rem;\n  margin-left: 0.5rem;\n  height: 2rem;\n  position: relative;\n}\n\n.listicon {\n  padding-top: 0.0625rem;\n  width: 1rem;\n  height: 1rem;\n}\n\nbutton#addcont {\n  border-radius: 0.3125rem;\n  width: 100%;\n  height: 100%;\n  border: none;\n  background-color: rgb(244, 244, 244);\n}\n\n.lists {\n  align-items: center;\n  min-width: 10rem;\n  display: flex;\n  padding: 0.25rem 0.5rem;\n  height: 3.75rem;\n  max-height: 3.75rem;\n  min-height: 3.75rem;\n  /* border: .0625rem solid pink; */\n}\n\n.lists#important {\n  background-color: rgb(240, 240, 240);\n}\n\n.lists:hover {\n  background-color: rgb(240, 240, 240);\n  /* border: .0625rem solid pink; */\n}\n\n.lists#important:hover {\n  background-color: rgb(231, 231, 231);\n  /* border: .0625rem solid pink; */\n}\n\n.lists#active {\n  background-color: rgb(0, 153, 255);\n}\n\n.lists>.avatar {\n  flex-basis: 2.65rem;\n  min-width: 2.65rem;\n  height: 2.65rem;\n  border-radius: 50%;\n  overflow: hidden;\n  background-color: white;\n}\n\n.avatar>img {\n  width: 100%;\n  height: 100%;\n}\n\n.avatar.model>img {\n  scale: 0.9;\n}\n\n.info {\n  height: 100%;\n  display: flex;\n  align-items: baseline;\n  justify-content: space-between;\n  flex: 0 0 calc(100% - 2.65rem);\n  max-width: calc(100% - 2.65rem);\n  flex-wrap: wrap;\n}\n\n.lists#active * {\n  color: #f0f8ff;\n}\n\n.lists .name {\n  flex-basis: 4rem;\n  flex-grow: 1;\n  margin-top: 0.75rem;\n  font-size: 0.875rem;\n  margin-left: 0.5rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.info #time {\n  font-size: 0.625rem;\n  flex-grow: 1;\n  text-align: right;\n}\n\n.info #msgctt {\n  flex-basis: 100%;\n  padding-right: 1rem;\n  font-size: 0.625rem;\n  margin-left: 0.5rem;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.people {\n  overflow-y: auto;\n}\n\n@media screen and (max-width: 600px) {\n  #friendlists {\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    max-width: none;\n  }\n}\n</style>\n","<template>\n  <div class=\"presets-list\">\n    <div\n      v-for=\"(message, index) of presetMessages\"\n      :key=\"index\"\n      class=\"preset-message\"\n    >\n      <div class=\"preset-message-block\">\n        <div\n          class=\"message-avatar\"\n          @mouseover=\"hoveredIndex = index\"\n          @mouseleave=\"hoveredIndex = null\"\n        >\n          <div v-if=\"hoveredIndex != index\" class=\"avatar-emoji\">\n            {{ getMessageAvatar(message.role) }}\n          </div>\n          <div\n            v-else\n            title=\"删除消息\"\n            class=\"avatar-emoji hovered\"\n            @click=\"delPresetMessage\"\n          >\n            🗑️\n          </div>\n        </div>\n        <div\n          :ref=\"`message-${index}`\"\n          class=\"message-content\"\n          contenteditable=\"true\"\n          @blur=\"handleMessageUpdate(index)\"\n        >\n          {{ presetMessages[index].content }}\n        </div>\n      </div>\n    </div>\n    <div class=\"messages-buttons\">\n      <el-button title=\"添加系统消息\" plain @click=\"addPresetMessage('system')\"\n        >➕ ⚙️</el-button\n      >\n      <el-button\n        title=\"添加助手消息\"\n        plain\n        @click=\"addPresetMessage('assistant')\"\n        >➕ 🤖</el-button\n      >\n      <el-button title=\"添加用户消息\" plain @click=\"addPresetMessage('user')\"\n        >➕ 👤</el-button\n      >\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    presetsHistory: {\n      type: Array,\n      default: () => [],\n    },\n  },\n  emits: [\"updatePresets\"],\n  data() {\n    const presetMessages = [...this.presetsHistory];\n    return {\n      presetMessages,\n      hoveredIndex: undefined,\n    };\n  },\n  watch: {\n    presetsHistory(newVal) {\n      this.presetMessages = [...newVal];\n    },\n  },\n  methods: {\n    delPresetMessage() {\n      this.presetMessages.splice(this.hoveredIndex, 1);\n      this.$emit(\"updatePresets\", this.presetMessages);\n    },\n    addPresetMessage(role) {\n      if (role == \"system\" && this.presetMessages.length > 0) {\n        this.$message.warning(\"系统消息必须是第一条消息\");\n        return;\n      }\n      this.presetMessages.push({\n        role,\n        content: \"\",\n      });\n      this.$emit(\"updatePresets\", this.presetMessages);\n    },\n    getMessageAvatar(role) {\n      return role == \"assistant\" ? \"🤖\" : role == \"system\" ? \"⚙️\" : \"👤\";\n    },\n    handleMessageUpdate(index) {\n      this.presetMessages[index].content =\n        this.$refs[`message-${index}`][0].innerText;\n      this.$emit(\"updatePresets\", this.presetMessages);\n    },\n  },\n};\n</script>\n<style scoped>\n.presets-list {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 100%;\n}\n\n.messages-buttons {\n  width: 100%;\n  display: flex;\n  justify-content: space-evenly;\n  align-items: center;\n  margin: 0.5rem;\n}\n\n.preset-message {\n  width: 100%;\n}\n\n.preset-message-block {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  margin: 0.5rem;\n  justify-content: space-between;\n  align-items: flex-start;\n}\n\n.preset-message-block .message-avatar {\n  flex-basis: 2rem;\n  font-size: 2rem;\n  border: 1px solid #ccc;\n  border-radius: 10%;\n}\n\n.message-avatar .hovered {\n  cursor: pointer;\n  box-shadow: inset 0px 0px 10px rgba(0, 0, 0, 0.493); /* 内阴影 */\n}\n\n.preset-message-block .message-content {\n  margin-left: 0.5rem;\n  font-size: 0.8rem;\n  border: 1px solid #5a9cf8;\n  border-radius: 0.5rem;\n  flex-grow: 1;\n  max-height: 10rem;\n  overflow-y: auto;\n  padding: 0.5rem;\n  min-height: 2rem;\n}\n\n.message-content input {\n  width: 100%;\n  border: none;\n  outline: none;\n}\n</style>\n","<template>\n  <div class=\"settings-container\">\n    <div v-if=\"activeContactorPlatform == 'openai'\" class=\"openai-settings\">\n      <div class=\"settings-block\">\n        <div class=\"block-title\">LLM 基本配置</div>\n        <div class=\"block-content\">\n          <div class=\"block-content-item\">\n            <div class=\"item-title\">来源渠道</div>\n            <div class=\"item-content\">\n              <el-select\n                v-model=\"localLlmProvider\"\n                style=\"width: 10rem\"\n                @change=\"handleProviderChange\"\n              >\n                <el-option\n                  v-for=\"item in llmProvidersList\"\n                  :key=\"item.value\"\n                  :label=\"item.label\"\n                  :value=\"item.value\"\n                />\n              </el-select>\n            </div>\n          </div>\n          <div\n            v-for=\"(_, key) in localLlmGeneralKeys\"\n            :key=\"key\"\n            class=\"block-content-item\"\n          >\n            <div class=\"item-title\">{{ getShownKey(key) }}</div>\n            <div class=\"item-content\">\n              <el-input\n                v-if=\"key === 'model'\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                @change=\"updateGeneralSettings\"\n              ></el-input>\n              <el-input-number\n                v-else-if=\"key === 'max_messages_num'\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                :min=\"1\"\n                :step=\"1\"\n                @change=\"updateGeneralSettings\"\n              />\n              <el-switch\n                v-else-if=\"['stream'].includes(key)\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                @change=\"updateGeneralSettings\"\n              ></el-switch>\n              <el-slider\n                v-else-if=\"['temperature'].includes(key)\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                :step=\"sliderTypes.a.step\"\n                :min=\"sliderTypes.a.min\"\n                :max=\"sliderTypes.a.max\"\n                @change=\"updateGeneralSettings\"\n              />\n              <el-slider\n                v-else-if=\"['top_p'].includes(key)\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                :step=\"sliderTypes.b.step\"\n                :min=\"sliderTypes.b.min\"\n                :max=\"sliderTypes.b.max\"\n                @change=\"updateGeneralSettings\"\n              />\n              <el-slider\n                v-else-if=\"\n                  ['frequency_penalty', 'presence_penalty'].includes(key)\n                \"\n                v-model=\"localLlmGeneralKeys[key]\"\n                :step=\"sliderTypes.c.step\"\n                :min=\"sliderTypes.c.min\"\n                :max=\"sliderTypes.c.max\"\n                @change=\"updateGeneralSettings\"\n              />\n              <el-slider\n                v-else-if=\"['reasoning_effort'].includes(key)\"\n                v-model=\"localLlmGeneralKeys[key]\"\n                :step=\"sliderTypes.d.step\"\n                :min=\"sliderTypes.d.min\"\n                :max=\"sliderTypes.d.max\"\n                :format-tooltip=\"sliderTypes.d.formatter\"\n                @change=\"updateGeneralSettings\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"settings-block\">\n        <div class=\"block-title\">LLM 预设配置</div>\n        <div class=\"block-content\">\n          <div class=\"block-content-item\">\n            <div class=\"item-title\">预设历史记录</div>\n            <div class=\"item-content\">\n              <button\n                :class=\"{\n                  active: showPresetsDetail,\n                  'extra-info-button': true,\n                }\"\n                @click=\"showPresetsDetail = !showPresetsDetail\"\n              >\n                <i class=\"iconfont icon-return\"></i>\n              </button>\n            </div>\n          </div>\n          <transition name=\"expand-slide\">\n            <div\n              v-show=\"showPresetsDetail\"\n              class=\"block-content-item\"\n              style=\"overflow: hidden\"\n            >\n              <PresetsList\n                :presets-history=\"presetsHistoryData\"\n                @update-presets=\"handleUpdatePresets\"\n              />\n            </div>\n          </transition>\n        </div>\n      </div>\n\n      <div class=\"settings-block\">\n        <div class=\"block-title\">LLM 工具调用配置</div>\n        <div class=\"block-content\">\n          <div class=\"block-content-item\">\n            <div class=\"item-title\">工具调用模式</div>\n            <div class=\"item-content\">\n              <el-select\n                v-model=\"localLlmToolCallMode\"\n                placeholder=\"AUTO\"\n                style=\"width: 10rem\"\n                @change=\"handleToolCallModeChange\"\n              >\n                <el-option\n                  v-for=\"item in toolCallModesList\"\n                  :key=\"item.value\"\n                  :label=\"item.label\"\n                  :value=\"item.value\"\n                />\n              </el-select>\n            </div>\n          </div>\n          <div\n            v-for=\"(plugin, index) in localAllLLMTools\"\n            :key=\"index\"\n            class=\"block-content-item parent-item\"\n          >\n            <div class=\"item-title\">{{ plugin.name }}</div>\n            <div class=\"item-content\">\n              <button\n                :class=\"{\n                  active: !plugin.collapsed,\n                  'extra-info-button': true,\n                }\"\n                @click=\"plugin.collapsed = !plugin.collapsed\"\n              >\n                <i class=\"iconfont icon-return\"></i>\n              </button>\n            </div>\n            <transition name=\"expand-slide\">\n              <div\n                v-show=\"!plugin.collapsed\"\n                class=\"item-hidden-content plugin-tools-container\"\n              >\n                <div\n                  v-for=\"(tool, toolIndex) in plugin.tools\"\n                  :key=\"toolIndex\"\n                  class=\"block-content-item child-item\"\n                  :title=\"tool.description\"\n                >\n                  <div class=\"item-title\">\n                    {{ tool.name.split(\"_mid_\")[0] }}\n                  </div>\n                  <div class=\"item-content\">\n                    <el-switch\n                      v-model=\"tool.enabled\"\n                      @change=\"handleToolEnableChange\"\n                    ></el-switch>\n                  </div>\n                </div>\n              </div>\n            </transition>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div\n      v-if=\"isGeminiAdapter\"\n      class=\"settings-block\"\n    >\n      <div class=\"block-title\">Gemini 额外设置</div>\n      <div class=\"block-content\">\n        <div class=\"block-content-item\">\n          <div class=\"item-title\">图像生成</div>\n          <div class=\"item-content\">\n            <el-switch\n              v-model=\"localGeminiExtraSettings.imageGeneration\"\n              @change=\"handleGeminiSettingsChange\"\n            ></el-switch>\n          </div>\n        </div>\n        <div class=\"block-content-item\">\n          <div class=\"item-title\">内置工具</div>\n          <div class=\"item-content\">\n            <button\n              :class=\"{\n                active: showInternalTools,\n                'extra-info-button': true,\n              }\"\n              @click=\"showInternalTools = !showInternalTools\"\n            >\n              <i class=\"iconfont icon-return\"></i>\n            </button>\n          </div>\n        </div>\n        <transition name=\"expand-slide\">\n          <div\n            v-show=\"showInternalTools\"\n            class=\"block-content-item\"\n            style=\"overflow: hidden\"\n          >\n            <ul id=\"internal-tools-settings\" class=\"sub-items\">\n              <li\n                v-for=\"(value, key) of localGeminiExtraSettings.internalTools\"\n                :key=\"key\"\n                class=\"block-content-item child-item\"\n              >\n                <div class=\"item-title\">{{ getShownKey(key) }}</div>\n                <div class=\"item-content\">\n                  <el-switch\n                    v-model=\"localGeminiExtraSettings.internalTools[key]\"\n                    @change=\"handleGeminiSettingsChange\"\n                  ></el-switch>\n                </div>\n              </li>\n            </ul>\n          </div>\n        </transition>\n        <div class=\"block-content-item\">\n          <div class=\"item-title\">过滤等级设置</div>\n          <div class=\"item-content\">\n            <button\n              :class=\"{\n                active: showSafetySettings,\n                'extra-info-button': true,\n              }\"\n              @click=\"showSafetySettings = !showSafetySettings\"\n            >\n              <i class=\"iconfont icon-return\"></i>\n            </button>\n          </div>\n        </div>\n        <transition name=\"expand-slide\">\n          <div\n            v-show=\"showSafetySettings\"\n            class=\"block-content-item\"\n            style=\"overflow: hidden\"\n          >\n            <ul id=\"safety-settings\" class=\"sub-items\">\n              <li\n                v-for=\"(value, key) of localGeminiSafetySettings\"\n                :key=\"key\"\n                class=\"block-content-item child-item\"\n              >\n                <div class=\"item-title\">{{ getShownKey(key) }}</div>\n                <div class=\"item-content\">\n                  <el-select\n                    v-model=\"localGeminiSafetySettings[key]\"\n                    style=\"width: 10rem\"\n                    @change=\"handleSafetySettingChange(key)\"\n                  >\n                    <el-option\n                      v-for=\"item in safetySimpleValueOptions\"\n                      :key=\"item.value\"\n                      :label=\"item.label\"\n                      :value=\"item.value\"\n                    />\n                  </el-select>\n                </div>\n              </li>\n            </ul>\n          </div>\n        </transition>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport PresetsList from \"@/components/PresetsList.vue\";\nimport { config } from \"@/lib/runtime.js\";\n\nexport default {\n  name: \"ContactorSettings\",\n  components: {\n    PresetsList,\n  },\n  props: {\n    modelValue: {\n      // for v-model:options\n      type: Object,\n      required: true,\n    },\n    activeContactorPlatform: {\n      type: String,\n      required: true,\n    },\n    llmProvidersList: {\n      type: Array,\n      required: true,\n    },\n    toolCallModesList: {\n      type: Array,\n      required: true,\n    },\n    allLlmToolsData: {\n      // Renamed from allLLMTools to avoid confusion\n      type: Array,\n      required: true,\n    },\n    safetySettingsParams: {\n      type: Object,\n      required: true,\n    },\n    safetySimpleValueOptions: {\n      type: Array,\n      required: true,\n    },\n    presetsHistoryData: {\n      type: Array,\n      default: () => [],\n    },\n  },\n  emits: [\"update:modelValue\", \"provider-changed\", \"update-presets\"],\n  data() {\n    return {\n      localLlmProvider: this.modelValue.provider,\n      localLlmGeneralKeys: {},\n      localLlmToolCallMode: this.modelValue.toolCallSettings?.mode,\n      localAllLLMTools: JSON.parse(JSON.stringify(this.allLlmToolsData)), // Deep copy\n      localGeminiExtraSettings: JSON.parse(\n        JSON.stringify(this.modelValue.extraSettings.gemini),\n      ), // Deep copy\n      localGeminiSafetySettings: {},\n\n      showPresetsDetail: false,\n      showInternalTools: false,\n      showSafetySettings: false,\n      // Moved from parent\n      sliderTypes: {\n        a: { min: 0, max: 2, step: 0.1 },\n        b: { min: 0, max: 1, step: 0.1 },\n        c: { min: -2, max: 2, step: 0.1 },\n        d: {\n          min: -1,\n          max: 3,\n          step: 1,\n          formatter: (value) => {\n            const map = {\n              \"-1\": \"默认\",\n              0: \"关闭思考\",\n              1: \"基础思考\",\n              2: \"均衡思考\",\n              3: \"深度思考\",\n            };\n            return map[value];\n          },\n        },\n      },\n    };\n  },\n  computed: {\n    isGeminiAdapter() {\n      const adapterType = config.getProviderAdapterType(this.localLlmProvider);\n      return ['gemini', 'vertex'].includes(adapterType);\n    }\n  },\n  watch: {\n    modelValue: {\n      handler(newVal) {\n        this.localLlmProvider = newVal.provider;\n        this.localLlmToolCallMode = newVal.toolCallSettings?.mode;\n        this.localGeminiExtraSettings = JSON.parse(\n          JSON.stringify(newVal.extraSettings.gemini),\n        );\n        this.initializeSettings();\n      },\n      deep: true,\n    },\n    allLlmToolsData: {\n      handler(newVal) {\n        this.localAllLLMTools = JSON.parse(JSON.stringify(newVal));\n        this.updateEnabledTools();\n      },\n      deep: true,\n    },\n  },\n  created() {\n    this.initializeSettings();\n  },\n  methods: {\n    initializeSettings() {\n      this.localLlmGeneralKeys = {\n        ...this.modelValue.base,\n        ...this.modelValue.chatParams,\n      };\n      const adapterType = config.getProviderAdapterType(this.localLlmProvider);\n      if (['gemini', 'vertex'].includes(adapterType)) {\n        this.localGeminiSafetySettings = this.safeSimplify(\n          this.localGeminiExtraSettings.safetySettings,\n        );\n      }\n      this.updateEnabledTools();\n    },\n    updateEnabledTools() {\n      const enabledTools = this.modelValue.toolCallSettings?.tools || [];\n      this.localAllLLMTools = this.localAllLLMTools.map((plugin) => ({\n        ...plugin,\n        tools: plugin.tools.map((tool) => ({\n          ...tool,\n          enabled: enabledTools.includes(tool.name),\n        })),\n      }));\n    },\n    getShownKey(key) {\n      const shownNameMap = {\n        mode: \"工具调用\",\n        model: \"模型\",\n        max_messages_num: \"最大历史消息数\",\n        stream: \"流式响应\",\n        reasoning_effort: \"思考强度\",\n        temperature: \"温度\",\n        top_p: \"核采样\",\n        frequency_penalty: \"重复惩罚度\",\n        presence_penalty: \"话题新鲜度\",\n        HARM_CATEGORY_HARASSMENT: \"骚扰\",\n        HARM_CATEGORY_HATE_SPEECH: \"仇恨言论\",\n        HARM_CATEGORY_SEXUALLY_EXPLICIT: \"色情\",\n        HARM_CATEGORY_DANGEROUS_CONTENT: \"危险内容\",\n        HARM_CATEGORY_CIVIC_INTEGRITY: \"公民诚信\",\n        imageGeneration: \"图像生成\",\n        google_search: \"联网搜索\",\n        code_execution: \"代码执行\",\n        url_context: \"网页解析\",\n      };\n      return shownNameMap[key] || key;\n    },\n    emitUpdate() {\n      const newOptions = JSON.parse(JSON.stringify(this.modelValue)); // Start with a copy of the prop\n\n      const {\n        model,\n        stream,\n        max_messages_num,\n        temperature,\n        top_p,\n        frequency_penalty,\n        presence_penalty,\n        reasoning_effort,\n      } = this.localLlmGeneralKeys;\n      newOptions.base = { model, max_messages_num, stream };\n      newOptions.chatParams = {\n        temperature,\n        top_p,\n        frequency_penalty,\n        presence_penalty,\n        reasoning_effort,\n      };\n\n      newOptions.provider = this.localLlmProvider;\n      if (!newOptions.toolCallSettings) newOptions.toolCallSettings = {};\n      newOptions.toolCallSettings.mode = this.localLlmToolCallMode;\n\n      const activeTools = this.localAllLLMTools.flatMap((plugin) =>\n        plugin.tools.filter((tool) => tool.enabled).map((tool) => tool.name),\n      );\n      console.log(\"Active tools:\", activeTools);\n      newOptions.toolCallSettings.tools = activeTools;\n\n      if (!newOptions.extraSettings) newOptions.extraSettings = {};\n      if (!newOptions.extraSettings.gemini)\n        newOptions.extraSettings.gemini = {\n          internalTools: {},\n          safetySettings: {},\n        };\n      newOptions.extraSettings.gemini = JSON.parse(\n        JSON.stringify(this.localGeminiExtraSettings),\n      );\n\n      this.$emit(\"update:modelValue\", newOptions);\n    },\n    updateGeneralSettings() {\n      this.emitUpdate();\n    },\n    handleProviderChange(newProvider) {\n      this.localLlmProvider = newProvider;\n      const defaultModel = config.getDefaultModel(newProvider);\n      if (defaultModel) {\n        this.localLlmGeneralKeys.model = defaultModel;\n      }\n      this.emitUpdate();\n      this.$emit(\"provider-changed\", newProvider); // Inform parent for avatar, etc.\n\n      // Re-initialize Gemini settings if switching to/from Gemini\n      const adapterType = config.getProviderAdapterType(newProvider);\n      if (['gemini', 'vertex'].includes(adapterType)) {\n        this.localGeminiSafetySettings = this.safeSimplify(\n          this.localGeminiExtraSettings.safetySettings,\n        );\n      }\n    },\n    handleUpdatePresets(presets) {\n      this.$emit(\"update-presets\", presets); // Pass through to parent\n    },\n    handleToolCallModeChange() {\n      this.emitUpdate();\n    },\n    handleToolEnableChange() {\n      this.emitUpdate();\n    },\n    handleGeminiSettingsChange() {\n      this.emitUpdate();\n    },\n    safeSimplify(rawSafetySettings) {\n      const result = {};\n      const simplifyMethod = new Map();\n      const table = this.safetySettingsParams;\n      Object.keys(table).forEach((key) => {\n        simplifyMethod.set(table[key], key);\n      });\n      Object.keys(rawSafetySettings || {}).forEach((key) => {\n        result[key] = simplifyMethod.get(rawSafetySettings[key]);\n      });\n      return result;\n    },\n    handleSafetySettingChange(key) {\n      const simplifiedValue = this.localGeminiSafetySettings[key];\n      const originalValue = this.safetySettingsParams[simplifiedValue];\n      if (!this.localGeminiExtraSettings.safetySettings) {\n        // Ensure safetySettings exists\n        this.localGeminiExtraSettings.safetySettings = {};\n      }\n      this.localGeminiExtraSettings.safetySettings[key] = originalValue;\n      this.emitUpdate();\n    },\n  },\n};\n</script>\n","<template>\n  <div class=\"error-boundary\">\n    <div v-if=\"hasError\" class=\"error-container\">\n      <el-result\n        icon=\"error\"\n        :title=\"errorTitle\"\n        :sub-title=\"errorMessage\"\n      >\n        <template #extra>\n          <el-space>\n            <el-button type=\"primary\" @click=\"handleReload\">\n              重新加载\n            </el-button>\n            <el-button @click=\"handleGoBack\">\n              返回\n            </el-button>\n            <el-button v-if=\"showDetails\" text @click=\"detailsVisible = !detailsVisible\">\n              {{ detailsVisible ? '隐藏' : '查看' }}详细信息\n            </el-button>\n          </el-space>\n        </template>\n      </el-result>\n\n      <el-collapse-transition>\n        <div v-show=\"detailsVisible && errorStack\" class=\"error-details\">\n          <el-card>\n            <template #header>\n              <span>错误详情</span>\n            </template>\n            <pre>{{ errorStack }}</pre>\n          </el-card>\n        </div>\n      </el-collapse-transition>\n    </div>\n\n    <slot v-else></slot>\n  </div>\n</template>\n\n<script setup>\nimport { onErrorCaptured, ref } from 'vue';\nimport { useRouter } from 'vue-router';\n\nconst props = defineProps({\n  fallbackTitle: {\n    type: String,\n    default: '出现错误'\n  },\n  fallbackMessage: {\n    type: String,\n    default: '加载此页面时发生错误，请稍后重试'\n  },\n  showDetails: {\n    type: Boolean,\n    default: true\n  },\n  onError: {\n    type: Function,\n    default: null\n  }\n});\n\nconst router = useRouter();\n\nconst hasError = ref(false);\nconst errorTitle = ref('');\nconst errorMessage = ref('');\nconst errorStack = ref('');\nconst detailsVisible = ref(false);\n\nonErrorCaptured((error, instance, info) => {\n  hasError.value = true;\n  \n  // 设置错误信息\n  errorTitle.value = props.fallbackTitle;\n  errorMessage.value = error.message || props.fallbackMessage;\n  errorStack.value = error.stack || '';\n\n  // 调用自定义错误处理\n  if (props.onError) {\n    props.onError(error, instance, info);\n  }\n\n  // 记录到控制台\n  console.error('ErrorBoundary caught error:', error);\n  console.error('Error info:', info);\n\n  // 阻止错误继续向上传播\n  return false;\n});\n\nconst handleReload = () => {\n  hasError.value = false;\n  errorTitle.value = '';\n  errorMessage.value = '';\n  errorStack.value = '';\n  detailsVisible.value = false;\n  \n  // 重新加载当前路由\n  router.go(0);\n};\n\nconst handleGoBack = () => {\n  if (window.history.length > 1) {\n    router.back();\n  } else {\n    router.push('/settings');\n  }\n};\n</script>\n\n<style scoped lang=\"scss\">\n.error-boundary {\n  width: 100%;\n  height: 100%;\n}\n\n.error-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 400px;\n  padding: 40px 20px;\n}\n\n.error-details {\n  width: 100%;\n  max-width: 800px;\n  margin-top: 24px;\n\n  pre {\n    margin: 0;\n    padding: 16px;\n    background-color: #f5f7fa;\n    border-radius: 4px;\n    font-size: 12px;\n    line-height: 1.5;\n    overflow-x: auto;\n    color: #606266;\n  }\n}\n</style>\n","/**\n * 配置管理 API 服务\n * 用于对接后端配置管理接口\n */\n\nclass ConfigAPI {\n  constructor() {\n    this.adminCode = '';\n    this._initialized = false;\n  }\n\n  /**\n   * 初始化 API 配置\n   * 从 localStorage 获取管理员访问码\n   */\n  init() {\n    if (this._initialized) return;\n    \n    // 从本地存储获取管理员访问码\n    this.adminCode = localStorage.getItem('admin_code') || '';\n    \n    this._initialized = true;\n  }\n\n  /**\n   * 设置管理员验证码\n   * @param {string} code - 管理员验证码\n   */\n  setAdminCode(code) {\n    this.adminCode = code;\n    localStorage.setItem('admin_code', code);\n  }\n\n  /**\n   * 通用请求方法\n   * @param {string} endpoint - API 端点\n   * @param {object} options - fetch 选项\n   * @returns {Promise<object>} 响应数据\n   */\n  async request(endpoint, options = {}) {\n    // 确保已初始化\n    if (!this._initialized) {\n      this.init();\n    }\n\n    const headers = {\n      'X-Admin-Code': this.adminCode,\n      'Content-Type': 'application/json',\n      ...options.headers\n    };\n\n    try {\n      const response = await fetch(endpoint, {\n        ...options,\n        headers\n      });\n\n      const data = await response.json();\n\n      // 检查响应状态\n      if (!response.ok) {\n        // 只有在认证失败时才清除本地存储的验证码\n        if (response.status === 401 || response.status === 403) {\n          // 进一步检查是否真的是认证问题\n          if (data.error === 'UNAUTHORIZED' || data.error === 'FORBIDDEN' || \n              data.message?.includes('认证') || data.message?.includes('权限') ||\n              data.message?.includes('访问码')) {\n            this.adminCode = '';\n            localStorage.removeItem('admin_code');\n          }\n        }\n        throw new Error(data.message || data.error || '请求失败');\n      }\n\n      // 检查业务错误码\n      if (data.code !== 0 && data.code !== undefined) {\n        throw new Error(data.message || '请求失败');\n      }\n\n      return data;\n    } catch (error) {\n      console.error(`API 请求失败 [${endpoint}]:`, error);\n      throw error;\n    }\n  }\n\n  // ========== 配置查询 ==========\n\n  /**\n   * 获取完整配置\n   * @returns {Promise<object>} 配置数据\n   */\n  async getConfig() {\n    return this.request('/api/config');\n  }\n\n  /**\n   * 获取指定配置节点\n   * @param {string} section - 配置节点名称 (server/web/onebot/llm_adapters)\n   * @returns {Promise<object>} 配置节点数据\n   */\n  async getConfigSection(section) {\n    return this.request(`/api/config/${section}`);\n  }\n\n  // ========== 配置修改 ==========\n\n  /**\n   * 更新完整配置\n   * @param {object} data - 配置数据\n   * @returns {Promise<object>} 响应数据\n   */\n  async updateConfig(data) {\n    return this.request('/api/config', {\n      method: 'PUT',\n      body: JSON.stringify(data)\n    });\n  }\n\n  /**\n   * 更新指定配置节点\n   * @param {string} section - 配置节点名称\n   * @param {object} data - 配置数据\n   * @returns {Promise<object>} 响应数据\n   */\n  async updateConfigSection(section, data) {\n    return this.request(`/api/config/${section}`, {\n      method: 'PUT',\n      body: JSON.stringify(data)\n    });\n  }\n\n  // ========== LLM 适配器管理 ==========\n\n  /**\n   * 获取适配器类型信息\n   * @returns {Promise<object>} 适配器类型数据\n   */\n  async getAdapterTypes() {\n    return this.request('/api/config/adapter-types');\n  }\n\n  /**\n   * 添加适配器实例\n   * @param {string} type - 适配器类型 (openai/gemini/vertex)\n   * @param {object} data - 适配器配置数据\n   * @returns {Promise<object>} 响应数据\n   */\n  async addAdapter(type, data) {\n    return this.request(`/api/config/llm/${type}`, {\n      method: 'POST',\n      body: JSON.stringify(data)\n    });\n  }\n\n  /**\n   * 更新适配器实例\n   * @param {string} type - 适配器类型\n   * @param {number} index - 实例索引\n   * @param {object} data - 适配器配置数据\n   * @returns {Promise<object>} 响应数据\n   */\n  async updateAdapter(type, index, data) {\n    return this.request(`/api/config/llm/${type}/${index}`, {\n      method: 'PUT',\n      body: JSON.stringify(data)\n    });\n  }\n\n  /**\n   * 删除适配器实例\n   * @param {string} type - 适配器类型\n   * @param {number} index - 实例索引\n   * @returns {Promise<object>} 响应数据\n   */\n  async deleteAdapter(type, index) {\n    return this.request(`/api/config/llm/${type}/${index}`, {\n      method: 'DELETE'\n    });\n  }\n\n  /**\n   * 批量删除适配器实例\n   * @param {Array<{type: string, index: number}>} adapters - 要删除的适配器列表\n   * @returns {Promise<Array>} 删除结果\n   */\n  async batchDeleteAdapters(adapters) {\n    // 按索引降序排序，避免删除后索引变化\n    const sorted = [...adapters].sort((a, b) => b.index - a.index);\n    const results = [];\n\n    for (const adapter of sorted) {\n      try {\n        const result = await this.deleteAdapter(adapter.type, adapter.index);\n        results.push({ success: true, adapter, result });\n      } catch (error) {\n        results.push({ success: false, adapter, error: error.message });\n      }\n    }\n\n    return results;\n  }\n\n  // ========== 模型列表刷新 ==========\n\n  /**\n   * 刷新所有适配器模型列表\n   * @returns {Promise<object>} 响应数据\n   */\n  async refreshAllModels() {\n    return this.request('/api/config/refresh-models', {\n      method: 'POST'\n    });\n  }\n\n  /**\n   * 刷新单个适配器实例模型列表\n   * @param {string} type - 适配器类型\n   * @param {number} index - 实例索引\n   * @returns {Promise<object>} 响应数据\n   */\n  async refreshAdapterModels(type, index) {\n    return this.request(`/api/config/llm/${type}/${index}/refresh-models`, {\n      method: 'POST'\n    });\n  }\n\n  // ========== 配置验证与重置 ==========\n\n  /**\n   * 验证配置\n   * @param {object} data - 配置数据\n   * @returns {Promise<object>} 验证结果\n   */\n  async validateConfig(data) {\n    return this.request('/api/config/validate', {\n      method: 'POST',\n      body: JSON.stringify(data)\n    });\n  }\n\n  /**\n   * 重置配置到示例配置\n   * @returns {Promise<object>} 响应数据\n   */\n  async resetConfig() {\n    return this.request('/api/config/reset', {\n      method: 'POST'\n    });\n  }\n\n  // ========== OneBot 配置管理 ==========\n\n  /**\n   * 获取 OneBot 插件选项\n   * @returns {Promise<object>} OneBot 插件选项数据\n   */\n  async getOneBotPlugins() {\n    return this.request('/api/onebot/plugins');\n  }\n\n  // ========== 配置导出/导入 ==========\n\n  /**\n   * 导出配置为 JSON 文件\n   * @param {string} filename - 文件名\n   */\n  async exportConfig(filename = 'mio-chat-config.json') {\n    const response = await this.getConfig();\n    const configData = response.data;\n    \n    const blob = new Blob([JSON.stringify(configData, null, 2)], {\n      type: 'application/json'\n    });\n    \n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    link.click();\n    URL.revokeObjectURL(url);\n  }\n\n  /**\n   * 导入配置从 JSON 文件\n   * @param {File} file - JSON 文件\n   * @returns {Promise<object>} 导入的配置数据\n   */\n  async importConfig(file) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      \n      reader.onload = (e) => {\n        try {\n          const config = JSON.parse(e.target.result);\n          resolve(config);\n        } catch {\n          reject(new Error('无效的 JSON 文件'));\n        }\n      };\n      \n      reader.onerror = () => {\n        reject(new Error('文件读取失败'));\n      };\n      \n      reader.readAsText(file);\n    });\n  }\n}\n\n/**\n * 插件管理 API\n */\nclass PluginAPI {\n  constructor(configAPI) {\n    this.configAPI = configAPI;\n  }\n\n  /**\n   * 获取所有插件列表\n   * @returns {Promise<object>} 插件列表数据\n   */\n  async listPlugins() {\n    return this.configAPI.request('/api/plugins');\n  }\n\n  /**\n   * 获取单个插件详情\n   * @param {string} pluginName - 插件名称\n   * @returns {Promise<object>} 插件详情数据\n   */\n  async getPluginDetail(pluginName) {\n    return this.configAPI.request(`/api/plugins/${pluginName}`);\n  }\n\n  /**\n   * 获取插件配置\n   * @param {string} pluginName - 插件名称\n   * @returns {Promise<object>} 插件配置数据\n   */\n  async getPluginConfig(pluginName) {\n    return this.configAPI.request(`/api/plugins/${pluginName}/config`);\n  }\n\n  /**\n   * 更新插件配置\n   * @param {string} pluginName - 插件名称\n   * @param {object} config - 新配置数据\n   * @returns {Promise<object>} 响应数据\n   */\n  async updatePluginConfig(pluginName, config) {\n    return this.configAPI.request(`/api/plugins/${pluginName}/config`, {\n      method: 'PUT',\n      body: JSON.stringify(config)\n    });\n  }\n\n  /**\n   * 获取插件工具列表\n   * @param {string} pluginName - 插件名称\n   * @returns {Promise<object>} 工具列表数据\n   */\n  async getPluginTools(pluginName) {\n    return this.configAPI.request(`/api/plugins/${pluginName}/tools`);\n  }\n\n  /**\n   * 调试工具执行\n   * @param {string} pluginName - 插件名称\n   * @param {string} toolName - 工具名称\n   * @param {object} parameters - 工具参数\n   * @param {object} user - 用户上下文（可选）\n   * @returns {Promise<object>} 执行结果\n   */\n  async debugTool(pluginName, toolName, parameters, user = null) {\n    return this.configAPI.request(`/api/plugins/${pluginName}/tools/${toolName}/debug`, {\n      method: 'POST',\n      body: JSON.stringify({ parameters, user })\n    });\n  }\n\n  /**\n   * 重载单个插件\n   * @param {string} pluginName - 插件名称\n   * @returns {Promise<object>} 响应数据\n   */\n  async reloadPlugin(pluginName) {\n    return this.configAPI.request(`/api/plugins/${pluginName}/reload`, {\n      method: 'POST'\n    });\n  }\n\n  /**\n   * 重载所有插件\n   * @returns {Promise<object>} 响应数据\n   */\n  async reloadAllPlugins() {\n    return this.configAPI.request('/api/plugins/reload-all', {\n      method: 'POST'\n    });\n  }\n\n  /**\n   * 启用/禁用插件\n   * @param {string} pluginName - 插件名称\n   * @param {boolean} enabled - 启用状态\n   * @returns {Promise<object>} 响应数据\n   */\n  async togglePlugin(pluginName, enabled) {\n    return this.configAPI.request(`/api/plugins/${pluginName}/toggle`, {\n      method: 'POST',\n      body: JSON.stringify({ enabled })\n    });\n  }\n}\n\n// 导出单例实例\nexport const configAPI = new ConfigAPI();\nexport const pluginAPI = new PluginAPI(configAPI);\n","/**\n * 配置管理 Store\n * 用于管理后端配置的状态\n * 使用 Composition API 风格\n */\n\nimport { configAPI } from '@/lib/configApi.js';\nimport { defineStore } from 'pinia';\nimport { computed, ref } from 'vue';\n\nexport const useConfigStore = defineStore('config', () => {\n  // ========== State ==========\n  \n  // 完整配置\n  const config = ref(null);\n  \n  // 适配器类型信息\n  const adapterTypes = ref({\n    types: [],\n    adapters: [],\n    count: 0\n  });\n  \n  // LLM 适配器\n  const adapters = ref({});\n  \n  // 模型列表 { provider: [{ owner, models }] }\n  const models = ref({}); \n  \n  // 加载状态\n  const loading = ref(false);\n  \n  // 是否需要重启服务\n  const needRestart = ref(false);\n  \n  // 管理员验证码\n  const adminCode = ref(localStorage.getItem('admin_code') || '');\n  \n  // 选中的适配器（用于批量操作）\n  const selectedAdapters = ref([]);\n\n  // ========== Getters ==========\n  \n  /**\n   * 获取所有启用的适配器\n   */\n  const enabledAdapters = computed(() => {\n    const result = [];\n    Object.entries(adapters.value).forEach(([type, instances]) => {\n      instances.forEach((adapter, index) => {\n        if (adapter.enable) {\n          result.push({ type, index, ...adapter });\n        }\n      });\n    });\n    return result;\n  });\n\n  /**\n   * 获取适配器总数\n   */\n  const totalAdapters = computed(() => {\n    return Object.values(adapters.value)\n      .reduce((sum, arr) => sum + arr.length, 0);\n  });\n\n  /**\n   * 获取启用的适配器数量\n   */\n  const enabledAdaptersCount = computed(() => {\n    let count = 0;\n    Object.values(adapters.value).forEach(instances => {\n      instances.forEach(adapter => {\n        if (adapter.enable) count++;\n      });\n    });\n    return count;\n  });\n\n  /**\n   * 获取总模型数量\n   */\n  const totalModelsCount = computed(() => {\n    let count = 0;\n    Object.values(models.value).forEach(providerModels => {\n      if (Array.isArray(providerModels)) {\n        providerModels.forEach(group => {\n          if (group.models && Array.isArray(group.models)) {\n            count += group.models.length;\n          }\n        });\n      }\n    });\n    return count;\n  });\n\n  // 插件数据\n  const plugins = ref([]);\n  \n  /**\n   * 获取可用插件总数\n   */\n  const totalPluginsCount = computed(() => {\n    return plugins.value.length;\n  });\n\n  /**\n   * 获取可用工具总数\n   */\n  const totalToolsCount = computed(() => {\n    return plugins.value.reduce((sum, plugin) => sum + (plugin.toolCount || 0), 0);\n  });\n\n  /**\n   * 检查是否已认证（有管理员验证码）\n   */\n  const isAuthenticated = computed(() => !!adminCode.value);\n\n  // ========== Actions ==========\n  \n  /**\n   * 设置管理员验证码\n   */\n  function setAdminCode(code) {\n    adminCode.value = code;\n    configAPI.setAdminCode(code);\n  }\n\n  /**\n   * 获取适配器类型信息\n   */\n  async function fetchAdapterTypes() {\n    try {\n      const response = await configAPI.getAdapterTypes();\n      adapterTypes.value = response.data;\n      return response.data;\n    } catch (error) {\n      console.error('获取适配器类型失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 清除管理员验证码\n   */\n  function clearAdminCode() {\n    adminCode.value = '';\n    localStorage.removeItem('admin_code');\n    configAPI.adminCode = '';\n  }\n\n  /**\n   * 获取完整配置\n   */\n  async function fetchConfig() {\n    loading.value = true;\n    try {\n      const response = await configAPI.getConfig();\n      config.value = response.data;\n      adapters.value = response.data.llm_adapters || {};\n      // 同时获取 models 数据\n      models.value = response.data.models || {};\n      return response.data;\n    } catch (error) {\n      console.error('获取配置失败:', error);\n      // 如果是认证失败，清除验证码\n      if (error.message.includes('验证码') || error.message.includes('访问被拒绝')) {\n        clearAdminCode();\n      }\n      throw error;\n    } finally {\n      loading.value = false;\n    }\n  }\n\n  /**\n   * 获取指定配置节点\n   */\n  async function fetchConfigSection(section) {\n    try {\n      const response = await configAPI.getConfigSection(section);\n      if (config.value) {\n        config.value[section] = response.data;\n      }\n      return response.data;\n    } catch (error) {\n      console.error(`获取配置节点 ${section} 失败:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * 获取插件列表\n   */\n  async function fetchPlugins() {\n    try {\n      const result = await configAPI.request('/api/plugins');\n      if (result.code === 0) {\n        plugins.value = result.data.plugins || [];\n        return result.data.plugins;\n      } else {\n        console.error('获取插件列表失败:', result.message);\n        plugins.value = [];\n        return [];\n      }\n    } catch (error) {\n      console.error('获取插件列表失败:', error);\n      plugins.value = [];\n      throw error;\n    }\n  }\n\n  /**\n   * 更新完整配置\n   */\n  async function updateConfig(data) {\n    try {\n      const response = await configAPI.updateConfig(data);\n      \n      // 标记需要重启（非 LLM 适配器配置）\n      needRestart.value = true;\n      \n      // 重新获取配置\n      await fetchConfig();\n      \n      return response.data;\n    } catch (error) {\n      console.error('更新配置失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 更新指定配置节点\n   */\n  async function updateConfigSection(section, data) {\n    try {\n      const response = await configAPI.updateConfigSection(section, data);\n      \n      // 更新本地状态\n      if (config.value) {\n        config.value[section] = data;\n      }\n      \n      // 非 LLM 适配器和 OneBot 配置需要重启\n      if (section !== 'llm_adapters' && section !== 'onebot') {\n        needRestart.value = true;\n      }\n      \n      return response.data;\n    } catch (error) {\n      console.error(`更新配置节点 ${section} 失败:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * 添加适配器实例\n   */\n  async function addAdapter(type, data) {\n    try {\n      const response = await configAPI.addAdapter(type, data);\n      \n      // 更新本地状态（热更新，无需重启）\n      await fetchConfig();\n      models.value = response.data.models || {};\n      \n      return response.data;\n    } catch (error) {\n      console.error('添加适配器失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 更新适配器实例\n   */\n  async function updateAdapter(type, index, data) {\n    try {\n      const response = await configAPI.updateAdapter(type, index, data);\n      // 用接口返回的完整适配器列表和模型列表直接更新本地状态\n      if (response.data.llm_adapters) {\n        adapters.value = response.data.llm_adapters;\n      }\n      if (response.data.models) {\n        models.value = response.data.models;\n      }\n      // 可选：同步 providers 等其他字段\n      return response.data;\n    } catch (error) {\n      console.error('更新适配器失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 删除适配器实例\n   */\n  async function deleteAdapter(type, index) {\n    try {\n      const response = await configAPI.deleteAdapter(type, index);\n      \n      // 更新本地状态\n      if (adapters.value[type]) {\n        adapters.value[type].splice(index, 1);\n      }\n      models.value = response.data.models || {};\n      \n      return response.data;\n    } catch (error) {\n      console.error('删除适配器失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 批量删除适配器实例\n   */\n  async function batchDeleteAdapters(adaptersList) {\n    try {\n      const results = await configAPI.batchDeleteAdapters(adaptersList);\n      \n      // 重新获取配置\n      await fetchConfig();\n      \n      return results;\n    } catch (error) {\n      console.error('批量删除适配器失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 批量启用/禁用适配器\n   */\n  async function batchToggleAdapters(adaptersList, enable) {\n    const results = [];\n    \n    for (const adapter of adaptersList) {\n      try {\n        const adapterData = adapters.value[adapter.type][adapter.index];\n        const updatedData = { ...adapterData, enable };\n        \n        await updateAdapter(adapter.type, adapter.index, updatedData);\n        results.push({ success: true, adapter });\n      } catch (error) {\n        results.push({ success: false, adapter, error: error.message });\n      }\n    }\n    \n    return results;\n  }\n\n  /**\n   * 刷新所有模型列表\n   */\n  async function refreshAllModels() {\n    try {\n      const response = await configAPI.refreshAllModels();\n      models.value = response.data.models || {};\n      return response.data;\n    } catch (error) {\n      console.error('刷新模型列表失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 刷新单个适配器实例模型列表\n   */\n  async function refreshAdapterModels(type, index) {\n    try {\n      const response = await configAPI.refreshAdapterModels(type, index);\n      models.value = response.data.models || {};\n      return response.data;\n    } catch (error) {\n      console.error('刷新适配器模型列表失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 验证配置\n   */\n  async function validateConfig(data) {\n    try {\n      const response = await configAPI.validateConfig(data);\n      return response.data;\n    } catch (error) {\n      console.error('验证配置失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 重置配置\n   */\n  async function resetConfig() {\n    try {\n      const response = await configAPI.resetConfig();\n      needRestart.value = true;\n      await fetchConfig();\n      return response.data;\n    } catch (error) {\n      console.error('重置配置失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 导出配置\n   */\n  async function exportConfig(filename) {\n    try {\n      await configAPI.exportConfig(filename);\n    } catch (error) {\n      console.error('导出配置失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 导入配置\n   */\n  async function importConfig(file) {\n    try {\n      const configData = await configAPI.importConfig(file);\n      return configData;\n    } catch (error) {\n      console.error('导入配置失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 获取 OneBot 插件选项\n   */\n  async function fetchOneBotPlugins() {\n    try {\n      const response = await configAPI.getOneBotPlugins();\n      return response.data;\n    } catch (error) {\n      console.error('获取 OneBot 插件选项失败:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 切换适配器选中状态\n   */\n  function toggleAdapterSelection(type, index) {\n    const key = `${type}-${index}`;\n    const idx = selectedAdapters.value.findIndex(a => `${a.type}-${a.index}` === key);\n    \n    if (idx > -1) {\n      selectedAdapters.value.splice(idx, 1);\n    } else {\n      selectedAdapters.value.push({ type, index });\n    }\n  }\n\n  /**\n   * 清空选中的适配器\n   */\n  function clearAdapterSelection() {\n    selectedAdapters.value = [];\n  }\n\n  /**\n   * 检查适配器是否被选中\n   */\n  function isAdapterSelected(type, index) {\n    const key = `${type}-${index}`;\n    return selectedAdapters.value.some(a => `${a.type}-${a.index}` === key);\n  }\n\n  // ========== 返回公开的 API ==========\n  \n  return {\n    // State\n    config,\n    adapterTypes,\n    adapters,\n    models,\n    plugins,\n    loading,\n    needRestart,\n    adminCode,\n    selectedAdapters,\n    \n    // Getters\n    enabledAdapters,\n    totalAdapters,\n    enabledAdaptersCount,\n    totalModelsCount,\n    totalPluginsCount,\n    totalToolsCount,\n    isAuthenticated,\n    \n    // Actions\n    setAdminCode,\n    clearAdminCode,\n    fetchAdapterTypes,\n    fetchConfig,\n    fetchConfigSection,\n    fetchPlugins,\n    updateConfig,\n    updateConfigSection,\n    addAdapter,\n    updateAdapter,\n    deleteAdapter,\n    batchDeleteAdapters,\n    batchToggleAdapters,\n    refreshAllModels,\n    refreshAdapterModels,\n    validateConfig,\n    resetConfig,\n    exportConfig,\n    importConfig,\n    fetchOneBotPlugins,\n    toggleAdapterSelection,\n    clearAdapterSelection,\n    isAdapterSelected\n  };\n});\n","<template>\n  <el-dialog\n    v-model=\"visible\"\n    title=\"配置对比\"\n    width=\"900px\"\n    :close-on-click-modal=\"false\"\n    @close=\"handleClose\"\n    class=\"config-dialog\"\n  >\n    <div class=\"dialog-content\">\n      <div class=\"config-compare-dialog\">\n      <!-- 上传对比配置 -->\n      <div v-if=\"!compareConfig\" class=\"upload-section\">\n        <el-upload\n          drag\n          :before-upload=\"handleUpload\"\n          :show-file-list=\"false\"\n          accept=\".json\"\n        >\n          <el-icon class=\"el-icon--upload\"><UploadFilled /></el-icon>\n          <div class=\"el-upload__text\">\n            拖拽配置文件到此处，或 <em>点击上传</em>\n          </div>\n          <template #tip>\n            <div class=\"el-upload__tip\">\n              上传 JSON 格式的配置文件以与当前配置进行对比\n            </div>\n          </template>\n        </el-upload>\n      </div>\n\n      <!-- 对比结果 -->\n      <div v-else class=\"compare-result\">\n        <div class=\"result-header\">\n          <el-tag :type=\"hasDifferences ? 'warning' : 'success'\" size=\"large\">\n            {{ hasDifferences ? '发现差异' : '配置相同' }}\n          </el-tag>\n          <el-button @click=\"handleReset\">重新选择</el-button>\n        </div>\n\n        <!-- 差异统计 -->\n        <div v-if=\"hasDifferences\" class=\"diff-stats\">\n          <el-descriptions :column=\"3\" border>\n            <el-descriptions-item label=\"新增项\">\n              <el-tag type=\"success\">{{ diffStats.added }}</el-tag>\n            </el-descriptions-item>\n            <el-descriptions-item label=\"修改项\">\n              <el-tag type=\"warning\">{{ diffStats.modified }}</el-tag>\n            </el-descriptions-item>\n            <el-descriptions-item label=\"删除项\">\n              <el-tag type=\"danger\">{{ diffStats.removed }}</el-tag>\n            </el-descriptions-item>\n          </el-descriptions>\n        </div>\n\n        <!-- 详细差异 -->\n        <div v-if=\"hasDifferences\" class=\"diff-details\">\n          <el-tabs v-model=\"activeTab\">\n            <el-tab-pane label=\"LLM 适配器\" name=\"adapters\">\n              <div class=\"diff-section\" v-for=\"(changes, type) in adapterDiffs\" :key=\"type\">\n                <h4>{{ adapterTypeName(type) }}</h4>\n                <div v-if=\"changes.length === 0\" class=\"no-changes\">\n                  无变化\n                </div>\n                <div v-else class=\"changes-list\">\n                  <div\n                    v-for=\"(change, index) in changes\"\n                    :key=\"index\"\n                    class=\"change-item\"\n                    :class=\"change.type\"\n                  >\n                    <el-tag :type=\"changeTypeTag(change.type)\" size=\"small\">\n                      {{ changeTypeText(change.type) }}\n                    </el-tag>\n                    <span class=\"change-path\">{{ change.path }}</span>\n                    <div class=\"change-values\">\n                      <div v-if=\"change.type !== 'added'\" class=\"old-value\">\n                        <span class=\"label\">当前:</span>\n                        <code>{{ formatValue(change.oldValue) }}</code>\n                      </div>\n                      <div v-if=\"change.type !== 'removed'\" class=\"new-value\">\n                        <span class=\"label\">{{ change.type === 'added' ? '新增' : '修改为' }}:</span>\n                        <code>{{ formatValue(change.newValue) }}</code>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </el-tab-pane>\n\n            <el-tab-pane label=\"服务器配置\" name=\"server\">\n              <div class=\"config-section-compare\">\n                <div v-if=\"!hasServerDiff\" class=\"no-changes\">无变化</div>\n                <div v-else class=\"diff-table\">\n                  <el-table :data=\"serverDifferences\" border>\n                    <el-table-column prop=\"key\" label=\"配置项\" width=\"200\" />\n                    <el-table-column label=\"当前值\">\n                      <template #default=\"{ row }\">\n                        <code>{{ row.currentValue }}</code>\n                      </template>\n                    </el-table-column>\n                    <el-table-column label=\"对比值\">\n                      <template #default=\"{ row }\">\n                        <code>{{ row.compareValue }}</code>\n                      </template>\n                    </el-table-column>\n                  </el-table>\n                </div>\n              </div>\n            </el-tab-pane>\n\n            <el-tab-pane label=\"Web 配置\" name=\"web\">\n              <div class=\"config-section-compare\">\n                <div v-if=\"!hasWebDiff\" class=\"no-changes\">无变化</div>\n                <div v-else class=\"diff-table\">\n                  <el-table :data=\"webDifferences\" border>\n                    <el-table-column prop=\"key\" label=\"配置项\" width=\"200\" />\n                    <el-table-column label=\"当前值\">\n                      <template #default=\"{ row }\">\n                        <code>{{ row.currentValue }}</code>\n                      </template>\n                    </el-table-column>\n                    <el-table-column label=\"对比值\">\n                      <template #default=\"{ row }\">\n                        <code>{{ row.compareValue }}</code>\n                      </template>\n                    </el-table-column>\n                  </el-table>\n                </div>\n              </div>\n            </el-tab-pane>\n\n            <el-tab-pane label=\"OneBot 配置\" name=\"onebot\">\n              <div class=\"config-section-compare\">\n                <div v-if=\"!hasOnebotDiff\" class=\"no-changes\">无变化</div>\n                <div v-else class=\"diff-table\">\n                  <el-table :data=\"onebotDifferences\" border>\n                    <el-table-column prop=\"key\" label=\"配置项\" width=\"200\" />\n                    <el-table-column label=\"当前值\">\n                      <template #default=\"{ row }\">\n                        <code>{{ row.currentValue }}</code>\n                      </template>\n                    </el-table-column>\n                    <el-table-column label=\"对比值\">\n                      <template #default=\"{ row }\">\n                        <code>{{ row.compareValue }}</code>\n                      </template>\n                    </el-table-column>\n                  </el-table>\n                </div>\n              </div>\n            </el-tab-pane>\n          </el-tabs>\n        </div>\n\n        <!-- 无差异提示 -->\n        <el-empty v-else description=\"配置完全相同\" />\n      </div>\n      </div>\n    </div>\n\n    <template #footer>\n      <div class=\"dialog-footer\">\n        <el-button @click=\"handleClose\">关闭</el-button>\n        <el-button\n          v-if=\"compareConfig && hasDifferences\"\n          type=\"primary\"\n          @click=\"handleApply\"\n        >\n          应用对比配置\n        </el-button>\n      </div>\n    </template>\n  </el-dialog>\n</template>\n\n<script setup>\nimport { useConfigStore } from '@/stores/configStore.js';\nimport { UploadFilled } from '@element-plus/icons-vue';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport { computed, ref, watch } from 'vue';\n\nconst props = defineProps({\n  modelValue: {\n    type: Boolean,\n    default: false\n  }\n});\n\nconst emit = defineEmits(['update:modelValue']);\n\nconst configStore = useConfigStore();\n\nconst visible = ref(props.modelValue);\nconst compareConfig = ref(null);\nconst activeTab = ref('adapters');\n\nwatch(() => props.modelValue, (val) => {\n  visible.value = val;\n  if (!val) {\n    compareConfig.value = null;\n  }\n});\n\nwatch(visible, (val) => {\n  emit('update:modelValue', val);\n});\n\nconst currentConfig = computed(() => configStore.config || {});\n\n// 计算差异\nconst adapterDiffs = computed(() => {\n  if (!compareConfig.value) return {};\n  \n  const diffs = {};\n  \n  // 动态获取适配器类型\n  const adapterTypes = configStore?.adapterTypes?.types || Object.keys(currentConfig.value.adapters || {});\n  \n  // 初始化差异对象\n  adapterTypes.forEach(type => {\n    diffs[type] = [];\n  });\n  \n  adapterTypes.forEach(type => {\n    const current = currentConfig.value.adapters?.[type] || [];\n    const compare = compareConfig.value.adapters?.[type] || [];\n    \n    // 检查每个实例\n    const maxLen = Math.max(current.length, compare.length);\n    for (let i = 0; i < maxLen; i++) {\n      const curr = current[i];\n      const comp = compare[i];\n      \n      if (!curr && comp) {\n        // 新增\n        diffs[type].push({\n          type: 'added',\n          path: `实例 ${i + 1}`,\n          newValue: comp\n        });\n      } else if (curr && !comp) {\n        // 删除\n        diffs[type].push({\n          type: 'removed',\n          path: `实例 ${i + 1}`,\n          oldValue: curr\n        });\n      } else if (curr && comp) {\n        // 检查属性差异\n        const props = new Set([...Object.keys(curr), ...Object.keys(comp)]);\n        props.forEach(prop => {\n          if (JSON.stringify(curr[prop]) !== JSON.stringify(comp[prop])) {\n            diffs[type].push({\n              type: 'modified',\n              path: `实例 ${i + 1} - ${prop}`,\n              oldValue: curr[prop],\n              newValue: comp[prop]\n            });\n          }\n        });\n      }\n    }\n  });\n  \n  return diffs;\n});\n\nconst diffStats = computed(() => {\n  let added = 0, modified = 0, removed = 0;\n  \n  Object.values(adapterDiffs.value).forEach(changes => {\n    changes.forEach(change => {\n      if (change.type === 'added') added++;\n      else if (change.type === 'modified') modified++;\n      else if (change.type === 'removed') removed++;\n    });\n  });\n  \n  // TODO: 添加其他配置项的差异统计\n  \n  return { added, modified, removed };\n});\n\nconst hasDifferences = computed(() => {\n  return diffStats.value.added > 0 ||\n         diffStats.value.modified > 0 ||\n         diffStats.value.removed > 0;\n});\n\n// 服务器配置差异\nconst serverDifferences = computed(() => {\n  return getConfigDifferences(currentConfig.value.server, compareConfig.value?.server);\n});\n\nconst hasServerDiff = computed(() => serverDifferences.value.length > 0);\n\n// Web 配置差异\nconst webDifferences = computed(() => {\n  return getConfigDifferences(currentConfig.value.web, compareConfig.value?.web);\n});\n\nconst hasWebDiff = computed(() => webDifferences.value.length > 0);\n\n// OneBot 配置差异\nconst onebotDifferences = computed(() => {\n  return getConfigDifferences(currentConfig.value.onebot, compareConfig.value?.onebot);\n});\n\nconst hasOnebotDiff = computed(() => onebotDifferences.value.length > 0);\n\n// 通用配置差异计算函数\nconst getConfigDifferences = (current, compare) => {\n  const diffs = [];\n  const keys = new Set([\n    ...Object.keys(current || {}),\n    ...Object.keys(compare || {})\n  ]);\n  \n  keys.forEach(key => {\n    const currVal = current?.[key];\n    const compVal = compare?.[key];\n    \n    if (JSON.stringify(currVal) !== JSON.stringify(compVal)) {\n      diffs.push({\n        key,\n        currentValue: formatConfigValue(currVal),\n        compareValue: formatConfigValue(compVal)\n      });\n    }\n  });\n  \n  return diffs;\n};\n\nconst formatConfigValue = (val) => {\n  if (val === undefined) return '-';\n  if (typeof val === 'object') return JSON.stringify(val);\n  return String(val);\n};\n\nconst adapterTypeName = (type) => {\n  const names = {\n    openai: 'OpenAI',\n    gemini: 'Gemini',\n    vertex: 'Vertex AI'\n  };\n  return names[type] || type;\n};\n\nconst changeTypeTag = (type) => {\n  const tags = {\n    added: 'success',\n    modified: 'warning',\n    removed: 'danger'\n  };\n  return tags[type] || '';\n};\n\nconst changeTypeText = (type) => {\n  const texts = {\n    added: '新增',\n    modified: '修改',\n    removed: '删除'\n  };\n  return texts[type] || type;\n};\n\nconst formatValue = (value) => {\n  if (typeof value === 'object') {\n    return JSON.stringify(value, null, 2);\n  }\n  return String(value);\n};\n\nconst handleUpload = async (file) => {\n  try {\n    const text = await file.text();\n    const config = JSON.parse(text);\n    \n    // 验证配置格式\n    const result = await configStore.validateConfig(config);\n    if (!result.valid) {\n      ElMessage.error('配置文件格式无效：' + result.errors.join(', '));\n      return false;\n    }\n    \n    compareConfig.value = config;\n    ElMessage.success('配置文件加载成功');\n  } catch (error) {\n    ElMessage.error('加载配置文件失败：' + error.message);\n  }\n  \n  return false;\n};\n\nconst handleReset = () => {\n  compareConfig.value = null;\n  activeTab.value = 'adapters';\n};\n\nconst handleClose = () => {\n  visible.value = false;\n};\n\nconst handleApply = async () => {\n  try {\n    await ElMessageBox.confirm(\n      '确定要应用对比配置吗？这将覆盖当前配置。',\n      '确认应用',\n      {\n        confirmButtonText: '应用',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }\n    );\n    \n    await configStore.updateConfig(compareConfig.value);\n    ElMessage.success('配置已应用，请重启服务使配置生效');\n    handleClose();\n    \n    // 重新加载配置\n    await configStore.fetchConfig();\n  } catch (error) {\n    if (error !== 'cancel') {\n      ElMessage.error('应用配置失败：' + error.message);\n    }\n  }\n};\n\n\n</script>\n\n<style scoped lang=\"scss\">\n.dialog-content {\n  max-height: 60vh;\n  overflow-y: auto;\n  padding: 0;\n}\n\n.config-compare-dialog {\n  min-height: 400px;\n}\n\n.upload-section {\n  padding: 40px 20px;\n}\n\n.compare-result {\n  .result-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 20px;\n    padding-bottom: 16px;\n    border-bottom: 1px solid #e4e7ed;\n  }\n\n  .diff-stats {\n    margin-bottom: 24px;\n  }\n\n  .diff-details {\n    margin-top: 24px;\n  }\n}\n\n.diff-section {\n  margin-bottom: 24px;\n\n  h4 {\n    margin: 0 0 12px;\n    font-size: 16px;\n    font-weight: 600;\n    color: #303133;\n  }\n\n  .no-changes {\n    padding: 20px;\n    text-align: center;\n    color: #909399;\n    background-color: #f5f7fa;\n    border-radius: 4px;\n  }\n\n  .changes-list {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n  }\n\n  .change-item {\n    padding: 12px;\n    border-radius: 4px;\n    border: 1px solid #e4e7ed;\n\n    &.added {\n      background-color: #f0f9ff;\n      border-color: #67c23a;\n    }\n\n    &.modified {\n      background-color: #fdf6ec;\n      border-color: #e6a23c;\n    }\n\n    &.removed {\n      background-color: #fef0f0;\n      border-color: #f56c6c;\n    }\n\n    .change-path {\n      margin-left: 8px;\n      font-weight: 500;\n      color: #303133;\n    }\n\n    .change-values {\n      margin-top: 8px;\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n\n      .old-value,\n      .new-value {\n        display: flex;\n        align-items: flex-start;\n        gap: 8px;\n\n        .label {\n          flex-shrink: 0;\n          color: #909399;\n          font-size: 13px;\n        }\n\n        code {\n          flex: 1;\n          padding: 4px 8px;\n          background-color: #f5f7fa;\n          border-radius: 3px;\n          font-size: 12px;\n          word-break: break-all;\n        }\n      }\n\n      .old-value code {\n        background-color: #fef0f0;\n      }\n\n      .new-value code {\n        background-color: #f0f9ff;\n      }\n    }\n  }\n}\n\n.config-section-compare {\n  .no-changes {\n    padding: 40px;\n    text-align: center;\n    color: #909399;\n  }\n}\n</style>\n","<template>\n  <div class=\"dynamic-adapter-form\">\n    <!-- 基本信息 -->\n    <el-divider content-position=\"left\">基本信息</el-divider>\n    \n    <!-- 动态生成的字段 -->\n    <template v-for=\"(fieldConfig, fieldName) in schema\" :key=\"fieldName\">\n      <el-form-item \n        :label=\"fieldConfig.label || fieldName\" \n        :prop=\"fieldName\"\n        :required=\"fieldConfig.required\"\n      >\n        <!-- 布尔类型 - 开关 -->\n        <el-switch \n          v-if=\"fieldConfig.type === 'boolean'\"\n          :model-value=\"modelValue[fieldName]\"\n          @update:model-value=\"updateField(fieldName, $event)\"\n          :active-text=\"fieldConfig.label || '启用'\"\n          :inactive-text=\"fieldConfig.inactiveText || '禁用'\"\n        />\n        \n        <!-- 密码类型 - 密码输入框 -->\n        <el-input \n          v-else-if=\"fieldConfig.type === 'password'\"\n          :model-value=\"modelValue[fieldName]\"\n          @update:model-value=\"updateField(fieldName, $event)\"\n          :type=\"showApiKey ? 'text' : 'password'\"\n          :placeholder=\"fieldConfig.placeholder || fieldConfig.description\"\n          clearable\n        >\n          <template #append>\n            <el-button \n              :icon=\"showApiKey ? View : Hide\" \n              @click=\"$emit('toggle-api-key')\"\n              class=\"input-append-button\" \n            />\n          </template>\n        </el-input>\n        \n        <!-- URL 类型 - URL 输入框 -->\n        <el-input \n          v-else-if=\"fieldConfig.type === 'url'\"\n          :model-value=\"modelValue[fieldName]\"\n          @update:model-value=\"updateField(fieldName, $event)\"\n          :placeholder=\"fieldConfig.placeholder || fieldConfig.description\"\n          clearable\n        />\n        \n        <!-- 选择框类型 -->\n        <el-select \n          v-else-if=\"fieldConfig.type === 'select'\"\n          :model-value=\"modelValue[fieldName]\"\n          @update:model-value=\"updateField(fieldName, $event)\"\n          :placeholder=\"fieldConfig.placeholder || `选择${fieldConfig.label}`\"\n          filterable\n          style=\"width: 100%\"\n        >\n          <el-option \n            v-for=\"option in fieldConfig.options\" \n            :key=\"option.value\" \n            :label=\"option.label\" \n            :value=\"option.value\" \n          />\n        </el-select>\n        \n        <!-- 文本区域类型 -->\n        <el-input \n          v-else-if=\"fieldConfig.type === 'textarea'\"\n          :model-value=\"modelValue[fieldName]\"\n          @update:model-value=\"updateField(fieldName, $event)\"\n          type=\"textarea\"\n          :rows=\"fieldConfig.rows || 4\"\n          :placeholder=\"fieldConfig.placeholder || fieldConfig.description\"\n        />\n        \n        <!-- 数组类型 - 多选标签 -->\n        <el-select \n          v-else-if=\"fieldConfig.type === 'array'\"\n          :model-value=\"modelValue[fieldName]\"\n          @update:model-value=\"updateField(fieldName, $event)\"\n          multiple\n          filterable\n          :allow-create=\"!fieldConfig.readonly\"\n          :disabled=\"fieldConfig.readonly\"\n          :placeholder=\"fieldConfig.placeholder || `添加${fieldConfig.label}`\"\n          style=\"width: 100%\"\n        >\n          <el-option \n            v-for=\"option in (fieldConfig.options || [])\" \n            :key=\"option.value || option\" \n            :label=\"option.label || option\" \n            :value=\"option.value || option\" \n          />\n        </el-select>\n        \n        <!-- 默认字符串类型 -->\n        <el-input \n          v-else\n          :model-value=\"modelValue[fieldName]\"\n          @update:model-value=\"updateField(fieldName, $event)\"\n          :placeholder=\"fieldConfig.placeholder || fieldConfig.description\"\n          :readonly=\"fieldConfig.readonly\"\n          clearable\n        />\n        \n        <!-- 字段描述 -->\n        <div v-if=\"fieldConfig.description && fieldConfig.type !== 'boolean'\" class=\"field-description\">\n          {{ fieldConfig.description }}\n        </div>\n      </el-form-item>\n    </template>\n    \n    <!-- 特殊处理：Vertex AI 的 JSON 文件上传 -->\n    <template v-if=\"type === 'vertex' && schema.service_account_json\">\n      <el-form-item label=\"认证方式\">\n        <el-radio-group v-model=\"vertexAuthType\">\n          <el-radio value=\"json\">粘贴 JSON</el-radio>\n          <el-radio value=\"file\">上传文件</el-radio>\n        </el-radio-group>\n      </el-form-item>\n      \n      <el-form-item v-if=\"vertexAuthType === 'file'\" label=\"JSON 文件\">\n        <el-upload \n          :before-upload=\"handleJsonUpload\" \n          :show-file-list=\"false\" \n          accept=\".json\" \n          drag\n        >\n          <el-icon class=\"el-icon--upload\">\n            <UploadFilled />\n          </el-icon>\n          <div class=\"el-upload__text\">\n            拖拽文件到此处或 <em>点击上传</em>\n          </div>\n          <template #tip>\n            <div class=\"el-upload__tip\">\n              仅支持 .json 格式的服务账号文件\n            </div>\n          </template>\n        </el-upload>\n        <el-input \n          v-if=\"modelValue.service_account_json\" \n          :model-value=\"jsonFilePreview\" \n          type=\"textarea\" \n          :rows=\"3\"\n          readonly \n          style=\"margin-top: 8px\" \n        />\n      </el-form-item>\n    </template>\n  </div>\n</template>\n\n<script setup>\nimport { Hide, UploadFilled, View } from '@element-plus/icons-vue';\nimport { ElMessage } from 'element-plus';\nimport { computed, ref } from 'vue';\n\nconst props = defineProps({\n  type: {\n    type: String,\n    required: true\n  },\n  schema: {\n    type: Object,\n    default: () => ({})\n  },\n  modelValue: {\n    type: Object,\n    required: true\n  },\n  showApiKey: {\n    type: Boolean,\n    default: false\n  }\n});\n\nconst emit = defineEmits(['update:modelValue', 'toggle-api-key', 'json-upload']);\n\nconst vertexAuthType = ref('json');\n\n// 更新字段值\nconst updateField = (fieldName, value) => {\n  const newValue = { ...props.modelValue };\n  newValue[fieldName] = value;\n  emit('update:modelValue', newValue);\n};\n\n// JSON 文件预览\nconst jsonFilePreview = computed(() => {\n  if (!props.modelValue.service_account_json) return '';\n  try {\n    const json = JSON.parse(props.modelValue.service_account_json);\n    return `项目: ${json.project_id}\\n客户端邮箱: ${json.client_email}`;\n  } catch {\n    return '已上传 JSON 文件';\n  }\n});\n\n// 处理 JSON 文件上传\nconst handleJsonUpload = (file) => {\n  const reader = new FileReader();\n  reader.onload = (e) => {\n    try {\n      const json = e.target.result;\n      JSON.parse(json); // 验证 JSON 格式\n      \n      // 更新模型值\n      const newValue = { ...props.modelValue };\n      newValue.service_account_json = json;\n      emit('update:modelValue', newValue);\n      \n      ElMessage.success('JSON 文件上传成功');\n    } catch (error) {\n      ElMessage.error('JSON 文件格式不正确');\n    }\n  };\n  reader.readAsText(file);\n  emit('json-upload', file);\n  return false; // 阻止自动上传\n};\n</script>\n\n<style scoped lang=\"scss\">\n.dynamic-adapter-form {\n  .field-description {\n    color: #909399;\n    font-size: 12px;\n    margin-top: 4px;\n    line-height: 1.4;\n  }\n  \n  :deep(.el-form-item__content) {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n  \n  :deep(.el-divider) {\n    margin: 24px 0 16px 0;\n  }\n  \n  :deep(.el-divider__text) {\n    font-weight: 600;\n    color: #606266;\n  }\n  \n  :deep(.el-upload-dragger) {\n    padding: 20px;\n  }\n  \n  // 统一输入框附加按钮宽度\n  :deep(.el-input-group__append) {\n    .input-append-button {\n      width: 100px;\n    }\n  }\n}\n</style>","<template>\n  <div class=\"model-selector\">\n    <!-- 默认模型选择 -->\n    <el-form-item label=\"默认模型\" v-if=\"showDefault\" required>\n      <div class=\"model-input-wrapper\">\n        <el-select\n          :model-value=\"modelValue.default\"\n          @update:model-value=\"updateDefault\"\n          filterable\n          allow-create\n          default-first-option\n          placeholder=\"请选择或输入默认模型\"\n          class=\"model-select\"\n        >\n          <el-option\n            v-for=\"model in availableModels\"\n            :key=\"model\"\n            :label=\"model\"\n            :value=\"model\"\n          />\n        </el-select>\n        <el-button\n          v-if=\"showFetchButton\"\n          type=\"primary\"\n          :icon=\"Refresh\"\n          :loading=\"fetchingModels\"\n          @click=\"handleFetchModels\"\n          class=\"fetch-button\"\n        >\n          获取模型\n        </el-button>\n      </div>\n      <template #extra>\n        <span class=\"form-item-tip\">\n          {{ availableModels.length > 0 ? '为所有用户设置的默认模型' : '暂无模型列表，请先获取或手动输入' }}\n        </span>\n      </template>\n    </el-form-item>\n\n    <!-- 访客模型配置 -->\n    <el-divider content-position=\"left\">访客模型配置</el-divider>\n\n    <!-- 关键词匹配 -->\n    <el-form-item label=\"关键词匹配\">\n      <div class=\"keyword-input-wrapper\">\n        <div class=\"keyword-tags\">\n          <el-tag\n            v-for=\"keyword in modelValue.guest?.keywords || []\"\n            :key=\"keyword\"\n            closable\n            @close=\"removeKeyword(keyword)\"\n            size=\"default\"\n          >\n            {{ keyword }}\n          </el-tag>\n        </div>\n        <el-input\n          v-model=\"newKeyword\"\n          @keyup.enter=\"addKeyword\"\n          placeholder=\"输入关键词后按回车添加\"\n          size=\"default\"\n          clearable\n          style=\"margin-top: 8px\"\n        >\n          <template #append>\n            <el-button :icon=\"Plus\" @click=\"addKeyword\" class=\"input-append-button\">添加</el-button>\n          </template>\n        </el-input>\n      </div>\n      <template #extra>\n        <span class=\"form-item-tip\">\n          访客可使用包含这些关键词的模型（如：gpt、4o、flash）\n        </span>\n      </template>\n    </el-form-item>\n\n    <!-- 完整名称匹配 -->\n    <el-form-item label=\"完整名称\">\n      <el-select\n        :model-value=\"modelValue.guest?.full_name || []\"\n        @update:model-value=\"updateFullNames\"\n        multiple\n        filterable\n        placeholder=\"选择访客可用的模型\"\n        style=\"width: 100%\"\n      >\n        <el-option\n          v-for=\"model in availableModels\"\n          :key=\"model\"\n          :label=\"model\"\n          :value=\"model\"\n        />\n      </el-select>\n      <template #extra>\n        <span class=\"form-item-tip\">访客可使用的具体模型列表</span>\n      </template>\n    </el-form-item>\n\n    <!-- 预览访客可用模型 -->\n    <el-alert\n      v-if=\"guestAvailableModels.length > 0\"\n      type=\"info\"\n      :closable=\"false\"\n      show-icon\n      style=\"margin-top: 16px\"\n    >\n      <template #title>\n        <div class=\"preview-title\">\n          访客可用模型预览\n          <el-tag size=\"small\">{{ guestAvailableModels.length }} 个</el-tag>\n        </div>\n      </template>\n      <div class=\"preview-models\">\n        <el-tag\n          v-for=\"model in guestAvailableModels.slice(0, 10)\"\n          :key=\"model\"\n          size=\"small\"\n          style=\"margin: 4px\"\n        >\n          {{ model }}\n        </el-tag>\n        <span v-if=\"guestAvailableModels.length > 10\" style=\"color: #909399; font-size: 12px;\">\n          等 {{ guestAvailableModels.length }} 个模型\n        </span>\n      </div>\n    </el-alert>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue';\nimport { Plus, Refresh } from '@element-plus/icons-vue';\n\nconst props = defineProps({\n  modelValue: {\n    type: Object,\n    default: () => ({\n      default: '',\n      guest: {\n        keywords: [],\n        full_name: []\n      }\n    })\n  },\n  availableModels: {\n    type: Array,\n    default: () => []\n  },\n  showDefault: {\n    type: Boolean,\n    default: true\n  },\n  showFetchButton: {\n    type: Boolean,\n    default: false\n  },\n  fetchingModels: {\n    type: Boolean,\n    default: false\n  }\n});\n\nconst emit = defineEmits(['update:modelValue', 'fetch-models']);\n\nconst newKeyword = ref('');\n\n// 获取模型列表\nconst handleFetchModels = () => {\n  emit('fetch-models');\n};\n\n// 访客可用模型预览\nconst guestAvailableModels = computed(() => {\n  const keywords = props.modelValue.guest?.keywords || [];\n  const fullNames = props.modelValue.guest?.full_name || [];\n  \n  // 合并关键词匹配和完整名称\n  const matched = new Set(fullNames);\n  \n  keywords.forEach(keyword => {\n    props.availableModels.forEach(model => {\n      if (model.toLowerCase().includes(keyword.toLowerCase())) {\n        matched.add(model);\n      }\n    });\n  });\n  \n  return Array.from(matched);\n});\n\n// 更新默认模型\nconst updateDefault = (value) => {\n  emit('update:modelValue', {\n    ...props.modelValue,\n    default: value\n  });\n};\n\n// 添加关键词\nconst addKeyword = () => {\n  const keyword = newKeyword.value.trim();\n  if (!keyword) return;\n  \n  const keywords = props.modelValue.guest?.keywords || [];\n  if (keywords.includes(keyword)) {\n    newKeyword.value = '';\n    return;\n  }\n  \n  emit('update:modelValue', {\n    ...props.modelValue,\n    guest: {\n      ...props.modelValue.guest,\n      keywords: [...keywords, keyword]\n    }\n  });\n  \n  newKeyword.value = '';\n};\n\n// 移除关键词\nconst removeKeyword = (keyword) => {\n  const keywords = props.modelValue.guest?.keywords || [];\n  emit('update:modelValue', {\n    ...props.modelValue,\n    guest: {\n      ...props.modelValue.guest,\n      keywords: keywords.filter(k => k !== keyword)\n    }\n  });\n};\n\n// 更新完整名称列表\nconst updateFullNames = (value) => {\n  emit('update:modelValue', {\n    ...props.modelValue,\n    guest: {\n      ...props.modelValue.guest,\n      full_name: value\n    }\n  });\n};\n</script>\n\n<style scoped lang=\"scss\">\n.model-selector {\n  :deep(.el-form-item) {\n    margin-bottom: 22px;\n  }\n  \n  :deep(.el-form-item__label) {\n    font-weight: 600;\n  }\n}\n\n.model-input-wrapper {\n  display: flex;\n  gap: 8px;\n  width: 100%;\n  \n  .model-select {\n    flex: 1;\n  }\n  \n  .fetch-button {\n    flex-shrink: 0;\n    width: 100px;\n  }\n}\n\n.form-item-tip {\n  color: #909399;\n  font-size: 12px;\n  line-height: 1.5;\n}\n\n.keyword-input-wrapper {\n  width: 100%;\n}\n\n.keyword-tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  min-height: 32px;\n  padding: 8px;\n  background-color: #f5f7fa;\n  border-radius: 4px;\n  border: 1px dashed #dcdfe6;\n}\n\n.preview-title {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 600;\n}\n\n.preview-models {\n  margin-top: 8px;\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n}\n\n:deep(.el-divider) {\n  margin: 24px 0 16px 0;\n}\n\n:deep(.el-divider__text) {\n  background-color: #fff;\n  font-weight: 600;\n  color: #606266;\n}\n\n// 统一输入框附加按钮宽度\n:deep(.el-input-group__append) {\n  .input-append-button {\n    width: 100px;\n  }\n}\n</style>\n","<template>\n  <el-dialog \n    :model-value=\"visible\" \n    :title=\"dialogTitle\" \n    @close=\"handleClose\" \n    width=\"700px\"\n    :close-on-click-modal=\"false\"\n    class=\"form-dialog adapter-editor-dialog\"\n  >\n    <div class=\"dialog-content\">\n      <el-form ref=\"formRef\" :model=\"formData\" :rules=\"rules\" label-width=\"120px\" label-position=\"left\">\n        <!-- 动态生成的配置表单 -->\n        <dynamic-adapter-form\n          :type=\"type\"\n          :schema=\"currentAdapterSchema\"\n          v-model=\"formData\"\n          :show-api-key=\"showApiKey\"\n          @toggle-api-key=\"showApiKey = !showApiKey\"\n          @json-upload=\"() => {}\"\n        />\n\n        <!-- 模型配置 -->\n        <el-divider content-position=\"left\">模型配置</el-divider>\n\n        <model-selector v-model=\"modelConfig\" :available-models=\"previewModels\" :show-default=\"true\"\n          :show-fetch-button=\"true\" :fetching-models=\"fetchingModels\" @fetch-models=\"handleFetchModels\" />\n      </el-form>\n    </div>\n\n    <template #footer>\n      <div class=\"dialog-footer\">\n        <el-button @click=\"handleClose\">取消</el-button>\n        <el-button type=\"primary\" :loading=\"submitting\" @click=\"handleSubmit\">\n          {{ mode === 'add' ? '保存并测试连接' : '保存' }}\n        </el-button>\n      </div>\n    </template>\n  </el-dialog>\n</template>\n\n<script setup>\nimport { configAPI } from '@/lib/configApi.js';\nimport { useConfigStore } from '@/stores/configStore.js';\nimport { ElMessage } from 'element-plus';\nimport { computed, ref, watch } from 'vue';\nimport DynamicAdapterForm from './DynamicAdapterForm.vue';\nimport ModelSelector from './ModelSelector.vue';\n\nconst props = defineProps({\n  visible: {\n    type: Boolean,\n    default: false\n  },\n  mode: {\n    type: String,\n    default: 'add',\n    validator: (value) => ['add', 'edit'].includes(value)\n  },\n  type: {\n    type: String,\n    required: true\n  },\n  adapter: {\n    type: Object,\n    default: null\n  },\n  index: {\n    type: Number,\n    default: -1\n  }\n});\n\nconst emit = defineEmits(['close', 'submit']);\n\nconst configStore = useConfigStore();\nconst formRef = ref(null);\nconst showApiKey = ref(false);\nconst submitting = ref(false);\nconst fetchingModels = ref(false);\nconst fetchedModels = ref([]);\n\n// 表单数据\nconst formData = ref({\n  name: '',\n  enable: true,\n  api_key: '',\n  base_url: '',\n  region: 'us-central1',\n  service_account_json: '',\n  models: [],\n  default_model: '',\n  guest_models: {\n    keywords: [],\n    full_name: []\n  }\n});\n\n// 保存原始数据用于对比变更\nconst originalData = ref(null);\n\n// 模型配置（用于 ModelSelector）\nconst modelConfig = ref({\n  default: '',\n  guest: {\n    keywords: [],\n    full_name: []\n  }\n});\n\n// 对话框标题\n// 将适配器类型格式化为友好显示名\nconst formatTypeLabel = (type) => {\n  // 确保 configStore 和 adapterTypes 都存在\n  if (configStore?.adapterTypes?.adapters) {\n    // 优先从适配器类型信息中获取显示名称\n    const adapterInfo = configStore.adapterTypes.adapters.find(a => a.type === type);\n    if (adapterInfo?.name) {\n      return adapterInfo.name;\n    }\n  }\n  \n  // 后备方案：使用硬编码映射\n  const map = {\n    openai: 'OpenAI',\n    gemini: 'Gemini',\n    vertex: 'Vertex AI',\n    deepseek: 'DeepSeek',\n    anthropic: 'Anthropic'\n  };\n  if (map[type]) return map[type];\n  return type ? type.charAt(0).toUpperCase() + type.slice(1) : '适配器';\n};\n\nconst dialogTitle = computed(() => {\n  const action = props.mode === 'add' ? '添加' : '编辑';\n  return `${action} ${formatTypeLabel(props.type)} 适配器实例`;\n});\n\n// 获取当前适配器类型的配置模式\nconst currentAdapterSchema = computed(() => {\n  if (!configStore?.adapterTypes?.adapters) {\n    return {};\n  }\n  const adapterInfo = configStore.adapterTypes.adapters.find(a => a.type === props.type);\n  return adapterInfo?.initialConfigSchema || {};\n});\n\n// 预览模型列表（用于模型选择器）\nconst previewModels = computed(() => {\n  // 优先使用手动获取的模型列表\n  if (fetchedModels.value.length > 0) {\n    return fetchedModels.value;\n  }\n\n  const typeModels = new Set();\n\n  // 1. 如果是编辑模式，优先使用当前适配器实例对应的模型列表\n  if (props.mode === 'edit' && props.adapter) {\n    const adapterName = props.adapter.name || `${props.type}-${props.index + 1}`;\n    const instanceModels = configStore.models[adapterName];\n    \n    if (Array.isArray(instanceModels)) {\n      instanceModels.forEach(group => {\n        if (group.models && Array.isArray(group.models)) {\n          group.models.forEach(model => typeModels.add(model));\n        }\n      });\n    }\n  }\n\n  // 2. 如果当前适配器实例有自定义模型配置，也包含进来\n  if (formData.value?.models && Array.isArray(formData.value.models) && formData.value.models.length > 0) {\n    formData.value.models.forEach(model => typeModels.add(model));\n  }\n\n  // 3. 如果还没有模型，尝试从该类型的其他实例获取\n  if (typeModels.size === 0) {\n    // 从该适配器类型的所有实例中获取模型\n    const typeInstances = configStore.adapters[props.type] || [];\n    typeInstances.forEach((instance, index) => {\n      const instanceName = instance.name || `${props.type}-${index + 1}`;\n      const instanceModels = configStore.models[instanceName];\n      \n      if (Array.isArray(instanceModels)) {\n        instanceModels.forEach(group => {\n          if (group.models && Array.isArray(group.models)) {\n            group.models.forEach(model => typeModels.add(model));\n          }\n        });\n      }\n    });\n  }\n\n  // 4. 如果有模型数据，返回排序后的列表\n  if (typeModels.size > 0) {\n    return Array.from(typeModels).sort();\n  }\n\n  // 5. 最后的后备方案：根据类型返回默认列表\n  if (props.type === 'openai') {\n    return ['gpt-4o', 'gpt-4o-mini', 'gpt-4-turbo', 'gpt-3.5-turbo'];\n  } else if (props.type === 'gemini') {\n    return ['gemini-2.0-flash', 'gemini-1.5-pro', 'gemini-1.5-flash'];\n  } else if (props.type === 'vertex') {\n    return ['gemini-2.0-flash-001', 'claude-3-5-sonnet-v2@20241022'];\n  } else if (props.type === 'deepseek') {\n    return ['deepseek-chat', 'deepseek-coder'];\n  } else if (props.type === 'anthropic') {\n    return ['claude-3-5-sonnet-20241022', 'claude-3-5-haiku-20241022', 'claude-3-opus-20240229'];\n  }\n  \n  return [];\n});\n\n// JSON 文件预览\nconst jsonFilePreview = computed(() => {\n  if (!formData.value.service_account_json) return '';\n  try {\n    const json = JSON.parse(formData.value.service_account_json);\n    return `项目: ${json.project_id}\\n客户端邮箱: ${json.client_email}`;\n  } catch {\n    return '已上传 JSON 文件';\n  }\n});\n\n// 表单验证规则\nconst rules = computed(() => {\n  const rules = {};\n  const schema = currentAdapterSchema.value;\n  \n  // 基于配置模式动态生成验证规则\n  Object.entries(schema).forEach(([fieldName, fieldConfig]) => {\n    const fieldRules = [];\n    \n    // 必填验证\n    if (fieldConfig.required) {\n      fieldRules.push({\n        required: true,\n        message: `请输入${fieldConfig.label || fieldName}`,\n        trigger: fieldConfig.type === 'select' ? 'change' : 'blur'\n      });\n    }\n    \n    // 自定义验证规则\n    if (fieldConfig.validation) {\n      if (fieldConfig.validation.pattern) {\n        fieldRules.push({\n          pattern: new RegExp(fieldConfig.validation.pattern),\n          message: fieldConfig.validation.message || '格式不正确',\n          trigger: 'blur'\n        });\n      }\n      \n      if (fieldConfig.validation.min) {\n        fieldRules.push({\n          min: fieldConfig.validation.min,\n          message: fieldConfig.validation.message || `最少${fieldConfig.validation.min}个字符`,\n          trigger: 'blur'\n        });\n      }\n      \n      if (fieldConfig.validation.isJson) {\n        fieldRules.push({\n          validator: (rule, value, callback) => {\n            if (!value) {\n              callback();\n              return;\n            }\n            try {\n              JSON.parse(value);\n              callback();\n            } catch {\n              callback(new Error(fieldConfig.validation.message || 'JSON 格式不正确'));\n            }\n          },\n          trigger: 'blur'\n        });\n      }\n    }\n    \n    // 特殊类型验证\n    if (fieldConfig.type === 'url') {\n      fieldRules.push({\n        type: 'url',\n        message: '请输入有效的 URL',\n        trigger: 'blur',\n        transform: (value) => {\n          return value && (value.startsWith('http://') || value.startsWith('https://'))\n            ? value\n            : `https://${value}`;\n        }\n      });\n    }\n    \n    if (fieldConfig.type === 'textarea' && fieldName === 'service_account_json') {\n      fieldRules.push({\n        validator: (rule, value, callback) => {\n          try {\n            JSON.parse(value);\n            callback();\n          } catch {\n            callback(new Error('JSON 格式不正确'));\n          }\n        },\n        trigger: 'blur'\n      });\n    }\n    \n    if (fieldRules.length > 0) {\n      rules[fieldName] = fieldRules;\n    }\n  });\n  \n  return rules;\n});\n\n\n\n// 获取模型列表\nconst handleFetchModels = async () => {\n  // 验证必要字段\n  if (props.type !== 'vertex') {\n    if (!formData.value.api_key) {\n      ElMessage.warning('请先填写 API Key');\n      return;\n    }\n    if (!formData.value.base_url) {\n      ElMessage.warning('请先填写 Base URL');\n      return;\n    }\n  } else if (props.type === 'vertex') {\n    if (!formData.value.region) {\n      ElMessage.warning('请先选择区域');\n      return;\n    }\n    if (!formData.value.service_account_json) {\n      ElMessage.warning('请先提供服务账号 JSON');\n      return;\n    }\n  }\n\n  fetchingModels.value = true;\n  try {\n    // 构建测试请求参数（包含所有相关字段）\n    const testConfig = {};\n\n    // 根据适配器类型添加必要的认证信息和配置\n    if (props.type === 'vertex') {\n      testConfig.region = formData.value.region;\n      testConfig.service_account_json = formData.value.service_account_json;\n      \n      // 包含手动模型配置\n      if (formData.value.models && formData.value.models.length > 0) {\n        testConfig.models = formData.value.models;\n      }\n      \n      // 包含手动模型字符串（如果有的话）\n      if (formData.value.manual_models && formData.value.manual_models.trim()) {\n        testConfig.manual_models = formData.value.manual_models.trim();\n      }\n      \n      // 包含其他可能的 Vertex 特定配置\n      if (formData.value.name) {\n        testConfig.name = formData.value.name;\n      }\n      if (formData.value.enable !== undefined) {\n        testConfig.enable = formData.value.enable;\n      }\n    } else {\n      testConfig.api_key = formData.value.api_key;\n      testConfig.base_url = formData.value.base_url;\n      \n      // 包含其他通用配置\n      if (formData.value.name) {\n        testConfig.name = formData.value.name;\n      }\n      if (formData.value.enable !== undefined) {\n        testConfig.enable = formData.value.enable;\n      }\n    }\n\n    console.log('发送测试配置:', testConfig); // 添加调试日志\n\n    // 调用后端 API 测试连接并获取模型\n    const response = await configAPI.request(`/api/config/llm/${props.type}/test-models`, {\n      method: 'POST',\n      body: JSON.stringify(testConfig)\n    });\n\n    if (response.data && response.data.models) {\n      // 将模型列表平铺\n      const models = [];\n      if (Array.isArray(response.data.models)) {\n        response.data.models.forEach(group => {\n          if (group.models && Array.isArray(group.models)) {\n            models.push(...group.models);\n          }\n        });\n      }\n\n      fetchedModels.value = [...new Set(models)].sort();\n\n      if (fetchedModels.value.length > 0) {\n        ElMessage.success(`成功获取 ${fetchedModels.value.length} 个模型`);\n      } else {\n        ElMessage.warning('获取模型列表为空');\n      }\n    } else {\n      ElMessage.warning('获取模型列表为空');\n    }\n  } catch (error) {\n    console.error('获取模型失败:', error);\n    ElMessage.error('获取模型失败：' + error.message);\n  } finally {\n    fetchingModels.value = false;\n  }\n};\n\n// 提交表单\nconst handleSubmit = async () => {\n  try {\n    await formRef.value.validate();\n\n    let submitData;\n\n    if (props.mode === 'add') {\n      // 添加模式：提交所有字段\n      submitData = {\n        ...formData.value,\n        default_model: modelConfig.value.default,\n        guest_models: modelConfig.value.guest\n      };\n\n      // 清理不需要的字段\n      if (props.type !== 'vertex') {\n        delete submitData.region;\n        delete submitData.service_account_json;\n        delete submitData.models;\n        delete submitData.manual_models;\n      } else {\n        delete submitData.api_key;\n        delete submitData.base_url;\n      }\n\n      console.log('提交数据 (添加模式):', submitData); // 添加调试日志\n    } else {\n      // 编辑模式：只提交变更的字段\n      submitData = {};\n\n      // 比对基本字段\n      const fieldsToCheck = ['name', 'enable', 'api_key', 'base_url', 'region', 'service_account_json', 'models', 'manual_models'];\n      for (const field of fieldsToCheck) {\n        // 跳过加密字段（以 *** 开头的值表示未修改）\n        if (field === 'api_key' && formData.value[field]?.startsWith('***')) {\n          continue;\n        }\n        if (field === 'service_account_json' && formData.value[field]?.startsWith('***')) {\n          continue;\n        }\n\n        // 只在字段值发生变化时添加\n        if (JSON.stringify(formData.value[field]) !== JSON.stringify(originalData.value?.[field])) {\n          // 根据适配器类型过滤字段\n          if (props.type !== 'vertex' && ['region', 'service_account_json', 'models', 'manual_models'].includes(field)) {\n            continue;\n          }\n          if (props.type === 'vertex' && ['api_key', 'base_url'].includes(field)) {\n            continue;\n          }\n          submitData[field] = formData.value[field];\n        }\n      }\n\n      // 检查模型配置变更\n      if (JSON.stringify(modelConfig.value.default) !== JSON.stringify(originalData.value?.default_model)) {\n        submitData.default_model = modelConfig.value.default;\n      }\n      if (JSON.stringify(modelConfig.value.guest) !== JSON.stringify(originalData.value?.guest_models)) {\n        submitData.guest_models = modelConfig.value.guest;\n      }\n\n      console.log('提交数据 (编辑模式):', submitData); // 添加调试日志\n    }\n\n    submitting.value = true;\n    await emit('submit', {\n      type: props.type,\n      index: props.index,\n      data: submitData,\n      mode: props.mode\n    });\n\n    handleClose();\n  } catch (error) {\n    if (error !== 'cancel') {\n      ElMessage.error('表单验证失败，请检查输入');\n    }\n  } finally {\n    submitting.value = false;\n  }\n};\n\n// 关闭对话框\nconst handleClose = () => {\n  emit('close');\n  // 重置表单\n  setTimeout(() => {\n    formRef.value?.resetFields();\n    showApiKey.value = false;\n    fetchedModels.value = [];\n  }, 300);\n};\n\n// 初始化表单数据\nconst initFormData = () => {\n  const schema = currentAdapterSchema.value;\n  \n  if (props.mode === 'edit' && props.adapter) {\n    formData.value = { ...props.adapter };\n    modelConfig.value = {\n      default: props.adapter.default_model || '',\n      guest: props.adapter.guest_models || { keywords: [], full_name: [] }\n    };\n    // 保存原始数据副本\n    originalData.value = JSON.parse(JSON.stringify(props.adapter));\n    \n    console.log('初始化表单数据 (编辑模式):', formData.value); // 添加调试日志\n  } else {\n    // 添加模式 - 基于配置模式设置默认值\n    const defaultData = {};\n    \n    // 从配置模式中获取默认值\n    Object.entries(schema).forEach(([fieldName, fieldConfig]) => {\n      defaultData[fieldName] = fieldConfig.default !== undefined ? fieldConfig.default : '';\n      \n      // 特殊处理数组类型\n      if (fieldConfig.type === 'array' && !Array.isArray(defaultData[fieldName])) {\n        defaultData[fieldName] = [];\n      }\n      \n      // 特殊处理布尔类型\n      if (fieldConfig.type === 'boolean' && typeof defaultData[fieldName] !== 'boolean') {\n        defaultData[fieldName] = fieldConfig.default === true;\n      }\n    });\n\n    formData.value = {\n      ...defaultData,\n      // 确保关键字段总是被初始化\n      models: defaultData.models || [],\n      manual_models: defaultData.manual_models || '',\n      default_model: '',\n      guest_models: {\n        keywords: [],\n        full_name: []\n      }\n    };\n\n    console.log('初始化表单数据 (添加模式):', formData.value); // 添加调试日志\n\n    modelConfig.value = {\n      default: '',\n      guest: {\n        keywords: [],\n        full_name: []\n      }\n    };\n  }\n};\n\n// 监听对话框打开\nwatch(\n  () => props.visible,\n  (visible) => {\n    if (visible) {\n      initFormData();\n    }\n  },\n  { immediate: true }\n);\n</script>\n\n<style scoped lang=\"scss\">\n.dialog-content {\n  max-height: 60vh;\n  overflow-y: auto;\n  padding: 0;\n}\n\n.dialog-footer {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n}\n\n.form-item-tip {\n  color: #909399;\n  font-size: 12px;\n}\n\n:deep(.el-form-item__content) {\n  flex-direction: column;\n  align-items: flex-start;\n}\n\n:deep(.el-form-item__extra) {\n  margin-top: 4px;\n}\n\n:deep(.el-divider) {\n  margin: 24px 0 16px 0;\n}\n\n:deep(.el-divider__text) {\n  font-weight: 600;\n  color: #606266;\n}\n\n:deep(.el-upload-dragger) {\n  padding: 20px;\n}\n\n// 统一输入框附加按钮宽度\n:deep(.el-input-group__append) {\n  .input-append-button {\n    width: 100px;\n  }\n}\n</style>\n\n","<template>\n  <div class=\"preset-card\" :class=\"{ selected: selected }\">\n    <!-- 选择框 -->\n    <div class=\"card-header\">\n      <el-checkbox\n        :model-value=\"selected\"\n        @change=\"handleSelect\"\n        class=\"select-checkbox\"\n      />\n      <div class=\"preset-tags\">\n        <el-tag\n          v-if=\"preset.source\"\n          :type=\"getSourceTagType(preset.source)\"\n          size=\"small\"\n          effect=\"light\"\n        >\n          {{ getSourceLabel(preset.source) }}\n        </el-tag>\n        <el-tag\n          v-if=\"preset.category\"\n          :type=\"getCategoryTagType(preset.category)\"\n          size=\"small\"\n          effect=\"light\"\n        >\n          {{ getCategoryLabel(preset.category) }}\n        </el-tag>\n      </div>\n    </div>\n\n    <!-- 预设信息 -->\n    <div class=\"card-content\">\n      <div class=\"preset-header\">\n        <el-avatar\n          v-if=\"preset.avatar\"\n          :src=\"preset.avatar\"\n          :size=\"48\"\n          class=\"preset-avatar\"\n        />\n        <el-avatar\n          v-else\n          :size=\"48\"\n          :icon=\"UserFilled\"\n          class=\"preset-avatar default-avatar\"\n        />\n        <div class=\"preset-name\">\n          <h4>{{ preset.name }}</h4>\n        </div>\n      </div>\n\n      <div class=\"preset-opening\" v-if=\"preset.opening\">\n        <p>{{ preset.opening }}</p>\n      </div>\n\n      <div class=\"preset-history\" v-if=\"preset.history && preset.history.length > 0\">\n        <div class=\"history-item\" v-for=\"(item, index) in preset.history.slice(0, 2)\" :key=\"index\">\n          <el-tag size=\"small\" :type=\"getRoleTagType(item.role)\">\n            {{ getRoleLabel(item.role) }}\n          </el-tag>\n          <span class=\"history-content\">{{ truncateText(item.content, 100) }}</span>\n        </div>\n        <div v-if=\"preset.history.length > 2\" class=\"more-history\">\n          <el-text type=\"info\" size=\"small\">\n            还有 {{ preset.history.length - 2 }} 条消息...\n          </el-text>\n        </div>\n      </div>\n\n      <div class=\"preset-tools\" v-if=\"preset.tools && preset.tools.length > 0\">\n        <div class=\"tools-label\">工具：</div>\n        <div class=\"tools-list\">\n          <el-tag\n            v-for=\"tool in preset.tools\"\n            :key=\"tool\"\n            size=\"small\"\n            type=\"info\"\n            effect=\"plain\"\n          >\n            {{ tool }}\n          </el-tag>\n        </div>\n      </div>\n    </div>\n\n    <!-- 操作按钮 -->\n    <div class=\"card-actions\">\n      <el-button\n        size=\"small\"\n        type=\"primary\"\n        text\n        @click=\"handleEdit\"\n      >\n        编辑\n      </el-button>\n      <el-button\n        size=\"small\"\n        type=\"success\"\n        text\n        @click=\"handleExport\"\n      >\n        导出\n      </el-button>\n      <el-button\n        v-if=\"preset.source !== 'built-in'\"\n        size=\"small\"\n        type=\"danger\"\n        text\n        @click=\"handleDelete\"\n      >\n        删除\n      </el-button>\n      <el-tooltip v-else content=\"内置预设无法删除\" placement=\"top\">\n        <el-button\n          size=\"small\"\n          type=\"info\"\n          text\n          disabled\n        >\n          删除\n        </el-button>\n      </el-tooltip>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { UserFilled } from '@element-plus/icons-vue';\n\nconst props = defineProps({\n  preset: {\n    type: Object,\n    required: true\n  },\n  selected: {\n    type: Boolean,\n    default: false\n  }\n});\n\nconst emit = defineEmits(['select', 'edit', 'delete', 'export']);\n\n// 获取来源标签颜色\nconst getSourceTagType = (source) => {\n  const map = {\n    'built-in': 'warning',\n    'custom': 'success'\n  };\n  return map[source] || 'primary';\n};\n\n// 获取来源标签文本\nconst getSourceLabel = (source) => {\n  const map = {\n    'built-in': '内置',\n    'custom': '自定义'\n  };\n  return map[source] || source;\n};\n\n// 获取分类标签颜色\nconst getCategoryTagType = (category) => {\n  const map = {\n    'common': 'primary',\n    'recommended': 'danger',\n    'hidden': 'info'\n  };\n  return map[category] || 'primary';\n};\n\n// 获取分类标签文本\nconst getCategoryLabel = (category) => {\n  const map = {\n    'common': '常用',\n    'recommended': '推荐',\n    'hidden': '隐藏'\n  };\n  return map[category] || category;\n};\n\n// 获取角色标签颜色\nconst getRoleTagType = (role) => {\n  const map = {\n    'system': 'warning',\n    'user': 'primary',\n    'assistant': 'success'\n  };\n  return map[role] || 'info';\n};\n\n// 获取角色标签文本\nconst getRoleLabel = (role) => {\n  const map = {\n    'system': '系统',\n    'user': '用户',\n    'assistant': '助手'\n  };\n  return map[role] || role;\n};\n\n// 截断文本\nconst truncateText = (text, maxLength) => {\n  if (!text) return '';\n  if (text.length <= maxLength) return text;\n  return text.substring(0, maxLength) + '...';\n};\n\n// 处理选择\nconst handleSelect = (selected) => {\n  emit('select', selected);\n};\n\n// 处理编辑\nconst handleEdit = () => {\n  emit('edit', props.preset);\n};\n\n// 处理删除\nconst handleDelete = () => {\n  emit('delete', props.preset);\n};\n\n// 处理导出\nconst handleExport = () => {\n  emit('export', props.preset);\n};\n</script>\n\n<style scoped lang=\"scss\">\n.preset-card {\n  background: white;\n  border: 1px solid #e4e7ed;\n  border-radius: 12px;\n  padding: 20px;\n  transition: all 0.3s ease;\n  display: flex;\n  flex-direction: column;\n  height: fit-content;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n\n  &:hover {\n    border-color: #409eff;\n    box-shadow: 0 4px 16px rgba(64, 158, 255, 0.12);\n    transform: translateY(-2px);\n  }\n\n  &.selected {\n    border-color: #409eff;\n    background: #f0f9ff;\n    box-shadow: 0 4px 16px rgba(64, 158, 255, 0.2);\n    \n    &::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 4px;\n      height: 100%;\n      background: #409eff;\n    }\n  }\n}\n\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n\n  .select-checkbox {\n    :deep(.el-checkbox__input) {\n      .el-checkbox__inner {\n        border-radius: 4px;\n      }\n    }\n  }\n\n  .preset-tags {\n    display: flex;\n    gap: 6px;\n    flex-shrink: 0;\n  }\n}\n\n.card-content {\n  margin-bottom: 16px;\n\n  .preset-header {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-bottom: 12px;\n\n    .preset-avatar {\n      flex-shrink: 0;\n      border: 2px solid #f0f0f0;\n      transition: border-color 0.3s ease;\n\n      &.default-avatar {\n        background-color: #f5f7fa;\n        color: #909399;\n      }\n    }\n\n    .preset-name {\n      flex: 1;\n      min-width: 0;\n\n      h4 {\n        margin: 0;\n        font-size: 16px;\n        font-weight: 600;\n        color: #303133;\n        line-height: 1.4;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n    }\n  }\n\n  .preset-opening {\n    margin-bottom: 12px;\n\n    p {\n      margin: 0;\n      font-size: 14px;\n      color: #606266;\n      line-height: 1.5;\n      display: -webkit-box;\n      -webkit-line-clamp: 2;\n      line-clamp: 2;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n  }\n\n  .preset-history {\n    margin-bottom: 12px;\n\n    .history-item {\n      display: flex;\n      align-items: flex-start;\n      gap: 8px;\n      margin-bottom: 6px;\n      font-size: 13px;\n\n      &:last-child {\n        margin-bottom: 0;\n      }\n\n      .history-content {\n        color: #606266;\n        line-height: 1.4;\n        flex: 1;\n        word-break: break-word;\n      }\n    }\n\n    .more-history {\n      margin-top: 8px;\n      text-align: center;\n    }\n  }\n\n  .preset-tools {\n    .tools-label {\n      font-size: 13px;\n      color: #909399;\n      margin-bottom: 6px;\n    }\n\n    .tools-list {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 4px;\n    }\n  }\n}\n\n.card-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n  padding-top: 12px;\n  border-top: 1px solid #f0f0f0;\n}\n</style>","<template>\n  <el-dialog\n    :model-value=\"visible\"\n    title=\"裁剪头像\"\n    width=\"600px\"\n    :before-close=\"handleClose\"\n    destroy-on-close\n    class=\"cropper-dialog\"\n  >\n    <div class=\"cropper-container\">\n      <div class=\"cropper-main\">\n        <!-- 裁剪区域 -->\n        <div class=\"crop-area\" ref=\"cropAreaRef\">\n          <img\n            ref=\"imageRef\"\n            :src=\"imageSrc\"\n            class=\"crop-image\"\n            @load=\"initCropper\"\n          />\n          <!-- 裁剪框 -->\n          <div\n            class=\"crop-box\"\n            :style=\"cropBoxStyle\"\n            @mousedown=\"startDrag\"\n          >\n            <div class=\"crop-overlay\"></div>\n            <!-- 调整手柄 -->\n            <div class=\"resize-handle nw\" @mousedown.stop=\"startResize('nw')\"></div>\n            <div class=\"resize-handle ne\" @mousedown.stop=\"startResize('ne')\"></div>\n            <div class=\"resize-handle sw\" @mousedown.stop=\"startResize('sw')\"></div>\n            <div class=\"resize-handle se\" @mousedown.stop=\"startResize('se')\"></div>\n          </div>\n        </div>\n\n        <!-- 预览区域 -->\n        <div class=\"preview-area\">\n          <div class=\"preview-title\">预览</div>\n          <div class=\"preview-container\">\n            <canvas\n              ref=\"previewCanvasRef\"\n              class=\"preview-canvas\"\n              width=\"120\"\n              height=\"120\"\n            ></canvas>\n          </div>\n          <div class=\"preview-size\">120 × 120</div>\n        </div>\n      </div>\n\n      <!-- 操作提示 -->\n      <div class=\"cropper-tips\">\n        <el-text type=\"info\" size=\"small\">\n          拖拽裁剪框调整位置，拖拽四角调整大小\n        </el-text>\n      </div>\n    </div>\n\n    <template #footer>\n      <div class=\"dialog-footer\">\n        <el-button @click=\"handleClose\">取消</el-button>\n        <el-button type=\"primary\" @click=\"handleConfirm\">确认裁剪</el-button>\n      </div>\n    </template>\n  </el-dialog>\n</template>\n\n<script setup>\nimport { nextTick, reactive, ref, watch } from 'vue';\n\nconst props = defineProps({\n  visible: {\n    type: Boolean,\n    default: false\n  },\n  imageSrc: {\n    type: String,\n    required: true\n  }\n});\n\nconst emit = defineEmits(['close', 'confirm']);\n\n// 引用\nconst cropAreaRef = ref(null);\nconst imageRef = ref(null);\nconst previewCanvasRef = ref(null);\n\n// 裁剪数据\nconst cropData = reactive({\n  x: 0,\n  y: 0,\n  width: 200,\n  height: 200,\n  imageWidth: 0,\n  imageHeight: 0,\n  containerWidth: 0,\n  containerHeight: 0\n});\n\n// 拖拽状态\nconst dragState = reactive({\n  isDragging: false,\n  isResizing: false,\n  resizeType: '',\n  startX: 0,\n  startY: 0,\n  startCropX: 0,\n  startCropY: 0,\n  startCropWidth: 0,\n  startCropHeight: 0\n});\n\n// 裁剪框样式\nconst cropBoxStyle = ref({\n  left: '0px',\n  top: '0px',\n  width: '200px',\n  height: '200px'\n});\n\n// 初始化裁剪器\nconst initCropper = () => {\n  nextTick(() => {\n    if (!imageRef.value || !cropAreaRef.value) return;\n\n    const image = imageRef.value;\n    const container = cropAreaRef.value;\n\n    // 获取图片和容器尺寸\n    cropData.imageWidth = image.naturalWidth;\n    cropData.imageHeight = image.naturalHeight;\n    cropData.containerWidth = container.clientWidth;\n    cropData.containerHeight = container.clientHeight;\n\n    // 计算初始裁剪框大小和位置\n    const minSize = Math.min(cropData.containerWidth, cropData.containerHeight);\n    const initialSize = Math.min(minSize * 0.6, 200);\n\n    cropData.width = initialSize;\n    cropData.height = initialSize;\n    cropData.x = (cropData.containerWidth - initialSize) / 2;\n    cropData.y = (cropData.containerHeight - initialSize) / 2;\n\n    updateCropBoxStyle();\n    updatePreview();\n  });\n};\n\n// 更新裁剪框样式\nconst updateCropBoxStyle = () => {\n  cropBoxStyle.value = {\n    left: cropData.x + 'px',\n    top: cropData.y + 'px',\n    width: cropData.width + 'px',\n    height: cropData.height + 'px'\n  };\n};\n\n// 更新预览\nconst updatePreview = () => {\n  if (!imageRef.value || !previewCanvasRef.value) return;\n\n  const canvas = previewCanvasRef.value;\n  const ctx = canvas.getContext('2d');\n  const image = imageRef.value;\n\n  // 计算裁剪区域在原图中的位置\n  const scaleX = cropData.imageWidth / cropData.containerWidth;\n  const scaleY = cropData.imageHeight / cropData.containerHeight;\n\n  const sourceX = cropData.x * scaleX;\n  const sourceY = cropData.y * scaleY;\n  const sourceWidth = cropData.width * scaleX;\n  const sourceHeight = cropData.height * scaleY;\n\n  // 清空画布\n  ctx.clearRect(0, 0, 120, 120);\n\n  // 绘制圆形裁剪路径\n  ctx.save();\n  ctx.beginPath();\n  ctx.arc(60, 60, 60, 0, Math.PI * 2);\n  ctx.clip();\n\n  // 绘制裁剪后的图片\n  ctx.drawImage(\n    image,\n    sourceX, sourceY, sourceWidth, sourceHeight,\n    0, 0, 120, 120\n  );\n\n  ctx.restore();\n};\n\n// 开始拖拽\nconst startDrag = (e) => {\n  if (dragState.isResizing) return;\n\n  dragState.isDragging = true;\n  dragState.startX = e.clientX;\n  dragState.startY = e.clientY;\n  dragState.startCropX = cropData.x;\n  dragState.startCropY = cropData.y;\n\n  document.addEventListener('mousemove', handleDrag);\n  document.addEventListener('mouseup', stopDrag);\n  e.preventDefault();\n};\n\n// 处理拖拽\nconst handleDrag = (e) => {\n  if (!dragState.isDragging) return;\n\n  const deltaX = e.clientX - dragState.startX;\n  const deltaY = e.clientY - dragState.startY;\n\n  let newX = dragState.startCropX + deltaX;\n  let newY = dragState.startCropY + deltaY;\n\n  // 边界限制\n  newX = Math.max(0, Math.min(newX, cropData.containerWidth - cropData.width));\n  newY = Math.max(0, Math.min(newY, cropData.containerHeight - cropData.height));\n\n  cropData.x = newX;\n  cropData.y = newY;\n\n  updateCropBoxStyle();\n  updatePreview();\n};\n\n// 停止拖拽\nconst stopDrag = () => {\n  dragState.isDragging = false;\n  document.removeEventListener('mousemove', handleDrag);\n  document.removeEventListener('mouseup', stopDrag);\n};\n\n// 开始调整大小\nconst startResize = (type) => {\n  dragState.isResizing = true;\n  dragState.resizeType = type;\n  dragState.startX = event.clientX;\n  dragState.startY = event.clientY;\n  dragState.startCropX = cropData.x;\n  dragState.startCropY = cropData.y;\n  dragState.startCropWidth = cropData.width;\n  dragState.startCropHeight = cropData.height;\n\n  document.addEventListener('mousemove', handleResize);\n  document.addEventListener('mouseup', stopResize);\n  event.preventDefault();\n};\n\n// 处理调整大小\nconst handleResize = (e) => {\n  if (!dragState.isResizing) return;\n\n  const deltaX = e.clientX - dragState.startX;\n  const deltaY = e.clientY - dragState.startY;\n\n  let newX = dragState.startCropX;\n  let newY = dragState.startCropY;\n  let newWidth = dragState.startCropWidth;\n  let newHeight = dragState.startCropHeight;\n\n  // 根据调整类型计算新的位置和大小\n  switch (dragState.resizeType) {\n    case 'nw': // 左上角\n      newX = dragState.startCropX + deltaX;\n      newY = dragState.startCropY + deltaY;\n      newWidth = dragState.startCropWidth - deltaX;\n      newHeight = dragState.startCropHeight - deltaY;\n      break;\n    case 'ne': // 右上角\n      newY = dragState.startCropY + deltaY;\n      newWidth = dragState.startCropWidth + deltaX;\n      newHeight = dragState.startCropHeight - deltaY;\n      break;\n    case 'sw': // 左下角\n      newX = dragState.startCropX + deltaX;\n      newWidth = dragState.startCropWidth - deltaX;\n      newHeight = dragState.startCropHeight + deltaY;\n      break;\n    case 'se': // 右下角\n      newWidth = dragState.startCropWidth + deltaX;\n      newHeight = dragState.startCropHeight + deltaY;\n      break;\n  }\n\n  // 保持正方形比例\n  const size = Math.min(newWidth, newHeight);\n  newWidth = size;\n  newHeight = size;\n\n  // 最小尺寸限制\n  const minSize = 50;\n  if (newWidth < minSize || newHeight < minSize) return;\n\n  // 边界限制\n  if (newX < 0) {\n    newWidth += newX;\n    newHeight = newWidth;\n    newX = 0;\n  }\n  if (newY < 0) {\n    newHeight += newY;\n    newWidth = newHeight;\n    newY = 0;\n  }\n  if (newX + newWidth > cropData.containerWidth) {\n    newWidth = cropData.containerWidth - newX;\n    newHeight = newWidth;\n  }\n  if (newY + newHeight > cropData.containerHeight) {\n    newHeight = cropData.containerHeight - newY;\n    newWidth = newHeight;\n  }\n\n  cropData.x = newX;\n  cropData.y = newY;\n  cropData.width = newWidth;\n  cropData.height = newHeight;\n\n  updateCropBoxStyle();\n  updatePreview();\n};\n\n// 停止调整大小\nconst stopResize = () => {\n  dragState.isResizing = false;\n  document.removeEventListener('mousemove', handleResize);\n  document.removeEventListener('mouseup', stopResize);\n};\n\n// 生成裁剪后的图片\nconst getCroppedImage = () => {\n  return new Promise((resolve) => {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    const image = imageRef.value;\n\n    // 设置输出尺寸\n    const outputSize = 200;\n    canvas.width = outputSize;\n    canvas.height = outputSize;\n\n    // 计算裁剪区域在原图中的位置\n    const scaleX = cropData.imageWidth / cropData.containerWidth;\n    const scaleY = cropData.imageHeight / cropData.containerHeight;\n\n    const sourceX = cropData.x * scaleX;\n    const sourceY = cropData.y * scaleY;\n    const sourceWidth = cropData.width * scaleX;\n    const sourceHeight = cropData.height * scaleY;\n\n    // 绘制裁剪后的图片\n    ctx.drawImage(\n      image,\n      sourceX, sourceY, sourceWidth, sourceHeight,\n      0, 0, outputSize, outputSize\n    );\n\n    // 转换为 Blob\n    canvas.toBlob((blob) => {\n      resolve(blob);\n    }, 'image/jpeg', 0.9);\n  });\n};\n\n// 监听图片源变化\nwatch(() => props.imageSrc, () => {\n  if (props.visible && props.imageSrc) {\n    nextTick(() => {\n      initCropper();\n    });\n  }\n});\n\n// 处理关闭\nconst handleClose = () => {\n  emit('close');\n};\n\n// 处理确认\nconst handleConfirm = async () => {\n  const croppedBlob = await getCroppedImage();\n  emit('confirm', croppedBlob);\n};\n</script>\n\n<style scoped lang=\"scss\">\n.cropper-container {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n.cropper-main {\n  display: flex;\n  gap: 20px;\n  align-items: flex-start;\n}\n\n.crop-area {\n  position: relative;\n  width: 400px;\n  height: 300px;\n  border: 1px solid #dcdfe6;\n  border-radius: 4px;\n  overflow: hidden;\n  background: #f5f7fa;\n\n  .crop-image {\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n    display: block;\n  }\n\n  .crop-box {\n    position: absolute;\n    border: 2px solid #409eff;\n    cursor: move;\n    user-select: none;\n\n    .crop-overlay {\n      position: absolute;\n      top: -2px;\n      left: -2px;\n      right: -2px;\n      bottom: -2px;\n      border: 2px dashed rgba(64, 158, 255, 0.5);\n      background: rgba(64, 158, 255, 0.1);\n    }\n\n    .resize-handle {\n      position: absolute;\n      width: 8px;\n      height: 8px;\n      background: #409eff;\n      border: 1px solid #fff;\n      border-radius: 50%;\n\n      &.nw {\n        top: -4px;\n        left: -4px;\n        cursor: nw-resize;\n      }\n\n      &.ne {\n        top: -4px;\n        right: -4px;\n        cursor: ne-resize;\n      }\n\n      &.sw {\n        bottom: -4px;\n        left: -4px;\n        cursor: sw-resize;\n      }\n\n      &.se {\n        bottom: -4px;\n        right: -4px;\n        cursor: se-resize;\n      }\n    }\n  }\n}\n\n.preview-area {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 12px;\n\n  .preview-title {\n    font-size: 14px;\n    font-weight: 500;\n    color: #303133;\n  }\n\n  .preview-container {\n    width: 120px;\n    height: 120px;\n    border: 2px solid #dcdfe6;\n    border-radius: 50%;\n    overflow: hidden;\n    background: #f5f7fa;\n\n    .preview-canvas {\n      display: block;\n      border-radius: 50%;\n    }\n  }\n\n  .preview-size {\n    font-size: 12px;\n    color: #909399;\n  }\n}\n\n.cropper-tips {\n  text-align: center;\n  padding: 12px;\n  background: #f5f7fa;\n  border-radius: 4px;\n}\n\n.dialog-footer {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n}\n\n// 防止图片拖拽\n.crop-image {\n  -webkit-user-drag: none;\n  -khtml-user-drag: none;\n  -moz-user-drag: none;\n  -o-user-drag: none;\n}\n</style>","<template>\n  <el-dialog\n    :model-value=\"visible\"\n    :title=\"mode === 'create' ? '创建预设' : '编辑预设'\"\n    width=\"800px\"\n    :before-close=\"handleClose\"\n    destroy-on-close\n    class=\"form-dialog preset-editor-dialog\"\n  >\n    <div class=\"dialog-content\">\n      <el-form\n        ref=\"formRef\"\n        :model=\"formData\"\n        :rules=\"formRules\"\n        label-width=\"100px\"\n        label-position=\"left\"\n      >\n      <!-- 预设名称 -->\n      <el-form-item label=\"预设名称\" prop=\"name\">\n        <el-input\n          v-model=\"formData.name\"\n          placeholder=\"请输入预设名称\"\n          maxlength=\"50\"\n          show-word-limit\n        />\n      </el-form-item>\n\n      <!-- 预设分类 -->\n      <el-form-item label=\"预设分类\" prop=\"category\">\n        <el-select\n          v-model=\"formData.category\"\n          placeholder=\"请选择预设分类\"\n          style=\"width: 100%\"\n        >\n          <el-option\n            label=\"常用预设\"\n            value=\"common\"\n          />\n          <el-option\n            label=\"推荐预设\"\n            value=\"recommended\"\n          />\n          <el-option\n            label=\"隐藏预设\"\n            value=\"hidden\"\n          />\n        </el-select>\n      </el-form-item>\n\n      <!-- 预设头像 -->\n      <el-form-item label=\"预设头像\" prop=\"avatar\">\n        <div class=\"avatar-editor\">\n          <div class=\"avatar-preview\">\n            <el-avatar\n              :size=\"80\"\n              :src=\"formData.avatar\"\n              :icon=\"UserFilled\"\n              class=\"preview-avatar\"\n            />\n          </div>\n          <div class=\"avatar-actions\">\n            <el-upload\n              ref=\"avatarUploadRef\"\n              :auto-upload=\"false\"\n              :show-file-list=\"false\"\n              :on-change=\"handleFileSelect\"\n              accept=\"image/*\"\n            >\n              <el-button type=\"primary\">\n                选择头像\n              </el-button>\n            </el-upload>\n            <el-button\n              v-if=\"formData.avatar\"\n              type=\"danger\"\n              text\n              @click=\"removeAvatar\"\n            >\n              移除头像\n            </el-button>\n          </div>\n          <div class=\"avatar-help\">\n            <el-text type=\"info\" size=\"small\">\n              支持 JPG、PNG 等图片格式，将自动裁剪为正方形\n            </el-text>\n          </div>\n        </div>\n      </el-form-item>\n\n      <!-- 图片裁剪组件 -->\n      <ImageCropper\n        :visible=\"cropperVisible\"\n        :image-src=\"selectedImageSrc\"\n        @close=\"handleCropperClose\"\n        @confirm=\"handleCropperConfirm\"\n      />\n\n      <!-- 开场白 -->\n      <el-form-item label=\"开场白\" prop=\"opening\">\n        <el-input\n          v-model=\"formData.opening\"\n          type=\"textarea\"\n          :rows=\"3\"\n          placeholder=\"请输入开场白（可选）\"\n          maxlength=\"500\"\n          show-word-limit\n        />\n      </el-form-item>\n\n      <!-- 对话历史 -->\n      <el-form-item label=\"对话历史\" prop=\"history\">\n        <div class=\"history-editor\">\n          <div class=\"history-header\">\n            <span>消息列表</span>\n            <el-button\n              type=\"primary\"\n              size=\"small\"\n              :icon=\"Plus\"\n              @click=\"addHistoryItem\"\n            >\n              添加消息\n            </el-button>\n          </div>\n\n          <div class=\"history-list\">\n            <div\n              v-for=\"(item, index) in formData.history\"\n              :key=\"index\"\n              class=\"history-item\"\n            >\n              <div class=\"item-header\">\n                <el-select\n                  v-model=\"item.role\"\n                  placeholder=\"选择角色\"\n                  style=\"width: 120px\"\n                >\n                  <el-option label=\"系统\" value=\"system\" />\n                  <el-option label=\"用户\" value=\"user\" />\n                  <el-option label=\"助手\" value=\"assistant\" />\n                </el-select>\n                <el-button\n                  type=\"danger\"\n                  size=\"small\"\n                  text\n                  :icon=\"Delete\"\n                  @click=\"removeHistoryItem(index)\"\n                >\n                  删除\n                </el-button>\n              </div>\n              <el-input\n                v-model=\"item.content\"\n                type=\"textarea\"\n                :rows=\"4\"\n                placeholder=\"请输入消息内容\"\n                maxlength=\"30000\"\n                show-word-limit\n              />\n            </div>\n\n            <div v-if=\"formData.history.length === 0\" class=\"empty-history\">\n              <el-empty description=\"暂无消息\" :image-size=\"80\">\n                <el-button type=\"primary\" :icon=\"Plus\" @click=\"addHistoryItem\">\n                  添加第一条消息\n                </el-button>\n              </el-empty>\n            </div>\n          </div>\n        </div>\n      </el-form-item>\n\n      <!-- 工具列表 -->\n      <el-form-item label=\"工具列表\" prop=\"tools\">\n        <div class=\"tools-editor\">\n          <el-cascader\n            v-model=\"formData.tools\"\n            :options=\"toolsOptions\"\n            :props=\"cascaderProps\"\n            placeholder=\"选择工具\"\n            style=\"width: 100%\"\n            clearable\n            filterable\n            :show-all-levels=\"false\"\n            collapse-tags\n            collapse-tags-tooltip\n            :max-collapse-tags=\"20\"\n            :loading=\"loadingTools\"\n            class=\"tools-cascader\"\n          />\n          <div class=\"tools-help\">\n            <el-text type=\"info\" size=\"small\">\n              从插件中选择可用的工具，支持多选和搜索\n              <span v-if=\"loadingTools\">（正在加载工具列表...）</span>\n              <span v-else-if=\"toolsOptions.length === 0\">（暂无可用工具）</span>\n            </el-text>\n          </div>\n        </div>\n      </el-form-item>\n      </el-form>\n    </div>\n\n    <template #footer>\n      <div class=\"dialog-footer\">\n        <el-button @click=\"handleClose\">取消</el-button>\n        <el-button\n          type=\"primary\"\n          :loading=\"submitting\"\n          @click=\"handleSubmit\"\n        >\n          {{ mode === 'create' ? '创建' : '保存' }}\n        </el-button>\n      </div>\n    </template>\n  </el-dialog>\n</template>\n\n<script setup>\nimport { pluginAPI } from '@/lib/configApi.js';\nimport { Delete, Plus, UserFilled } from '@element-plus/icons-vue';\nimport { ElMessage } from 'element-plus';\nimport { nextTick, onMounted, reactive, ref, watch } from 'vue';\nimport ImageCropper from './ImageCropper.vue';\n\nconst props = defineProps({\n  visible: {\n    type: Boolean,\n    default: false\n  },\n  mode: {\n    type: String,\n    default: 'create', // 'create' | 'edit'\n    validator: (value) => ['create', 'edit'].includes(value)\n  },\n  preset: {\n    type: Object,\n    default: null\n  }\n});\n\nconst emit = defineEmits(['close', 'submit']);\n\nconst formRef = ref(null);\nconst submitting = ref(false);\n\n// 表单数据\nconst formData = reactive({\n  name: '',\n  category: 'common', // 默认为常用预设\n  avatar: '', // 头像路径\n  opening: '',\n  history: [],\n  tools: []\n});\n\n// 表单验证规则\nconst formRules = {\n  name: [\n    { required: true, message: '请输入预设名称', trigger: 'blur' },\n    { min: 1, max: 50, message: '名称长度应在 1-50 个字符', trigger: 'blur' }\n  ],\n  category: [\n    { required: true, message: '请选择预设分类', trigger: 'change' }\n  ],\n  history: [\n    { required: true, message: '至少需要一条对话历史', trigger: 'change' },\n    {\n      validator: (_, value, callback) => {\n        if (!Array.isArray(value) || value.length === 0) {\n          callback(new Error('至少需要一条对话历史'));\n          return;\n        }\n        \n        for (let i = 0; i < value.length; i++) {\n          const item = value[i];\n          if (!item.role || !item.content) {\n            callback(new Error(`第 ${i + 1} 条消息的角色和内容不能为空`));\n            return;\n          }\n        }\n        \n        callback();\n      },\n      trigger: 'change'\n    }\n  ]\n};\n\n// 工具选项数据\nconst toolsOptions = ref([]);\nconst loadingTools = ref(false);\n\n// 头像上传相关\nconst avatarUploadRef = ref(null);\nconst uploadingAvatar = ref(false);\nconst cropperVisible = ref(false);\nconst selectedImageSrc = ref('');\nconst uploadHeaders = {\n  'X-Admin-Code': localStorage.getItem('admin_code') || ''\n};\n\n// 级联选择器配置\nconst cascaderProps = {\n  multiple: true,\n  checkStrictly: false,\n  value: 'value',\n  label: 'label',\n  children: 'children',\n  emitPath: false // 只返回选中的值，不返回完整路径\n};\n\n// 从插件获取工具列表\nconst loadToolsFromPlugins = async () => {\n  if (loadingTools.value) return;\n  \n  loadingTools.value = true;\n  try {\n    // 获取所有插件\n    const pluginsResult = await pluginAPI.listPlugins();\n    if (pluginsResult.code !== 0) {\n      console.error('获取插件列表失败:', pluginsResult.message);\n      return;\n    }\n\n    const plugins = pluginsResult.data.plugins || [];\n    const toolsMap = new Map(); // 用于去重和分组\n\n    // 遍历每个启用的插件获取工具\n    for (const plugin of plugins) {\n      if (!plugin.enabled) continue;\n\n      try {\n        const toolsResult = await pluginAPI.getPluginTools(plugin.name);\n        if (toolsResult.code === 0 && toolsResult.data.tools) {\n          // 处理工具数据\n          toolsResult.data.tools.forEach(group => {\n            group.tools.forEach(tool => {\n              // 提取工具名的有意义部分（使用 '_mid_' 分隔符）\n              const meaningfulName = tool.name.split('_mid_')[0];\n              \n              if (!toolsMap.has(meaningfulName)) {\n                toolsMap.set(meaningfulName, {\n                  value: meaningfulName,\n                  label: meaningfulName,\n                  fullName: tool.name,\n                  description: tool.description,\n                  plugin: plugin.displayName,\n                  group: group.group\n                });\n              }\n            });\n          });\n        }\n      } catch (error) {\n        console.error(`获取插件 ${plugin.name} 工具失败:`, error);\n      }\n    }\n\n    // 按插件 -> 工具组 -> 工具的三层结构构建级联选择器数据\n    const pluginGroups = new Map();\n    \n    toolsMap.forEach(tool => {\n      // 第一层：插件\n      if (!pluginGroups.has(tool.plugin)) {\n        pluginGroups.set(tool.plugin, {\n          value: tool.plugin,\n          label: tool.plugin,\n          children: new Map()\n        });\n      }\n      \n      const pluginGroup = pluginGroups.get(tool.plugin);\n      \n      // 第二层：工具组\n      if (!pluginGroup.children.has(tool.group)) {\n        pluginGroup.children.set(tool.group, {\n          value: `${tool.plugin}_${tool.group}`,\n          label: tool.group,\n          children: []\n        });\n      }\n      \n      // 第三层：工具\n      pluginGroup.children.get(tool.group).children.push({\n        value: tool.value,\n        label: tool.label\n      });\n    });\n\n    // 转换为数组格式\n    toolsOptions.value = Array.from(pluginGroups.values()).map(plugin => ({\n      ...plugin,\n      children: Array.from(plugin.children.values())\n    }));\n  } catch (error) {\n    console.error('加载工具列表失败:', error);\n    // 如果加载失败，提供一个空的选项结构\n    toolsOptions.value = [];\n  } finally {\n    loadingTools.value = false;\n  }\n};\n\n// 监听预设数据变化\nwatch(() => props.preset, (newPreset) => {\n  if (newPreset && props.mode === 'edit') {\n    formData.name = newPreset.name || '';\n    formData.category = newPreset.category || 'common';\n    formData.avatar = newPreset.avatar || '';\n    formData.opening = newPreset.opening || '';\n    formData.history = newPreset.history ? [...newPreset.history] : [];\n    formData.tools = newPreset.tools ? [...newPreset.tools] : [];\n  }\n}, { immediate: true });\n\n// 监听对话框显示状态\nwatch(() => props.visible, (visible) => {\n  if (visible) {\n    if (props.mode === 'create') {\n      // 创建模式，重置表单\n      resetForm();\n    }\n    // 等待 DOM 更新后清除验证状态\n    nextTick(() => {\n      formRef.value?.clearValidate();\n    });\n  }\n});\n\n// 重置表单\nconst resetForm = () => {\n  formData.name = '';\n  formData.category = 'common';\n  formData.avatar = '';\n  formData.opening = '';\n  formData.history = [];\n  formData.tools = [];\n};\n\n// 添加对话历史项\nconst addHistoryItem = () => {\n  formData.history.push({\n    role: 'system',\n    content: ''\n  });\n};\n\n// 删除对话历史项\nconst removeHistoryItem = (index) => {\n  formData.history.splice(index, 1);\n};\n\n// 处理关闭\nconst handleClose = () => {\n  if (submitting.value) return;\n  emit('close');\n};\n\n// 头像上传前验证\n// 处理文件选择\nconst handleFileSelect = (file) => {\n  const isImage = file.raw.type.startsWith('image/');\n  const isLt5M = file.raw.size / 1024 / 1024 < 5;\n\n  if (!isImage) {\n    ElMessage.error('只能上传图片文件!');\n    return;\n  }\n  if (!isLt5M) {\n    ElMessage.error('图片大小不能超过 5MB!');\n    return;\n  }\n\n  // 创建图片预览URL\n  const reader = new FileReader();\n  reader.onload = (e) => {\n    selectedImageSrc.value = e.target.result;\n    cropperVisible.value = true;\n  };\n  reader.readAsDataURL(file.raw);\n};\n\n// 关闭裁剪器\nconst handleCropperClose = () => {\n  cropperVisible.value = false;\n  selectedImageSrc.value = '';\n};\n\n// 确认裁剪\nconst handleCropperConfirm = async (croppedBlob) => {\n  cropperVisible.value = false;\n  uploadingAvatar.value = true;\n\n  try {\n    // 创建 FormData\n    const uploadFormData = new FormData();\n    uploadFormData.append('image', croppedBlob, 'avatar.jpg');\n\n    // 上传裁剪后的图片\n    const response = await fetch('/api/upload/image', {\n      method: 'POST',\n      headers: uploadHeaders,\n      body: uploadFormData\n    });\n\n    const result = await response.json();\n\n    if (result.code === 0 && result.data?.url) {\n      formData.avatar = result.data.url;\n      ElMessage.success('头像上传成功');\n    } else {\n      ElMessage.error('头像上传失败: ' + (result.message || '未知错误'));\n    }\n  } catch (error) {\n    ElMessage.error('头像上传失败: ' + error.message);\n  } finally {\n    uploadingAvatar.value = false;\n  }\n};\n\n// 移除头像\nconst removeAvatar = () => {\n  formData.avatar = '';\n  ElMessage.success('头像已移除');\n};\n\n// 处理提交\nconst handleSubmit = async () => {\n  if (submitting.value) return;\n\n  try {\n    // 验证表单\n    await formRef.value?.validate();\n    \n    submitting.value = true;\n\n    // 准备提交数据\n    const submitData = {\n      name: formData.name.trim(),\n      category: formData.category,\n      opening: formData.opening.trim(),\n      history: formData.history.map(item => ({\n        role: item.role,\n        content: item.content.trim()\n      })).filter(item => item.content), // 过滤空内容\n      tools: formData.tools.filter(tool => tool.trim()) // 过滤空工具名\n    };\n\n    // 添加头像字段（如果有的话）\n    if (formData.avatar) {\n      submitData.avatar = formData.avatar;\n    }\n\n    // 提交数据\n    emit('submit', {\n      data: submitData,\n      mode: props.mode\n    });\n\n    // 提交成功，关闭对话框\n    emit('close');\n  } catch (error) {\n    console.error('表单验证失败:', error);\n    // 验证失败或提交失败，不关闭对话框\n  } finally {\n    submitting.value = false;\n  }\n};\n\n// 组件挂载时加载工具列表\nonMounted(() => {\n  loadToolsFromPlugins();\n});\n</script>\n\n<style scoped lang=\"scss\">\n.history-editor {\n  width: 100%;\n\n  .history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 12px;\n    font-weight: 500;\n    color: #303133;\n  }\n\n  .history-list {\n    .history-item {\n      border: 1px solid #e4e7ed;\n      border-radius: 6px;\n      padding: 12px;\n      margin-bottom: 12px;\n      background: #fafafa;\n\n      &:last-child {\n        margin-bottom: 0;\n      }\n\n      .item-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 8px;\n      }\n    }\n\n    .empty-history {\n      padding: 20px;\n      text-align: center;\n      border: 1px dashed #d9d9d9;\n      border-radius: 6px;\n      background: #fafafa;\n    }\n  }\n}\n\n.avatar-editor {\n  width: 100%;\n\n  .avatar-preview {\n    margin-bottom: 12px;\n\n    .preview-avatar {\n      border: 2px dashed #d9d9d9;\n      transition: border-color 0.3s ease;\n\n      &:hover {\n        border-color: #409eff;\n      }\n    }\n  }\n\n  .avatar-actions {\n    display: flex;\n    gap: 12px;\n    align-items: center;\n    margin-bottom: 8px;\n  }\n\n  .avatar-help {\n    font-size: 12px;\n    color: #909399;\n  }\n}\n\n.tools-editor {\n  width: 100%;\n\n  .tools-help {\n    margin-top: 8px;\n  }\n\n  .tools-cascader {\n    :deep(.el-cascader-panel) {\n      .el-cascader-menu {\n        width: 180px; // 固定每一级的宽度\n        min-width: 180px;\n        \n        &:first-child {\n          width: 200px; // 插件名可能较长，给更多空间\n          min-width: 200px;\n        }\n        \n        &:nth-child(2) {\n          width: 160px; // 工具组名通常较短\n          min-width: 160px;\n        }\n        \n        &:nth-child(3) {\n          width: 140px; // 工具名最短\n          min-width: 140px;\n        }\n      }\n      \n      .el-cascader-node__label {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n    }\n  }\n}\n\n.dialog-footer {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n}\n\n.dialog-content {\n  max-height: 60vh;\n  overflow-y: auto;\n  padding: 0;\n}\n\n// Element Plus 样式覆盖\n:deep(.el-dialog__body) {\n  padding: 20px 24px;\n}\n\n:deep(.el-form-item__label) {\n  font-weight: 500;\n  color: #303133;\n}\n\n:deep(.el-textarea__inner) {\n  resize: vertical;\n}\n</style>"],"names":["debounce","fn","delay","timeoutId","args","clearTimeout","setTimeout","apply","this","AVATAR_BASE_PATH","AVATAR_MAP","OpenAI","Cohere","Anthropic","Google","DeepSeek","getAvatarByAdapterType","adapterType","iconFile","openai","gemini","vertex","onebot","getIconByAdapterType","numberString","length","result","characters","i","charAt","Math","floor","random","randomString","EventEmitter","constructor","events","on","eventName","listener","refresh","off","push","emit","data","forEach","Adapter","super","fetch","url","client","socket","Onebot","convertMessage","message","element","index","type","base64Data","file","replace","messages","node","rplMessage","filter","midMessage","unshift","role","time","Date","getTime","content","id","message_id","status","send","Openai","config","getMessagesSummary","messageChain","query","JSON","stringify","settings","getLLMDefaultConfig","base","stream","response","handleMessageEvent","chunk","messageId","metaData","emitEvent","detail","updateHandlers","reasoningContent","reasoning_content","toolCall","tool_call","handler","includes","complete","failed","error","getVerifiedLLMConfig","contactorId","Error","streamCompletions","avatarPolicy","namePolicy","Contactor","EventEmmiter","platform","title","name","avatar","priority","firstMessageIndex","active","lastUpdate","now","createTime","lastMessageSummary","getLastMessageSummary","options","loadOptions","kernel","enableOpenaiListener","toJSON","e","rawMessage","getMessageById","existingReasonIndex","findIndex","msgElm","text","startTime","endTime","lastMsgElm","isFirstElement","concat","previousCall","find","updatedCall","parse","action","parameters","indexOf","updateLastUpdate","errElem","some","elm","handleLLMMessageEvent","_getFilePrompt","fileElms","join","_getImagePrompt","imageElms","map","_getValidOpenaiMessage","start","end","max_messages_num","mergedMessages","slice","msg","fileList","imageList","subArray","formatedMsg","_content_type","tool_calls","function","arguments","tool_call_id","finalMessages","textElm","imageElm","fileElm","filePrompt","imagePrompt","image_url","presetHistory","presetSettings","history","updateMessageSummary","getBaseUserContainer","webSend","toServer","revMessage","insertMessage","splice","retryMessage","as","webMessage","delMessage","acting","makeSystemMessage","container","getLastTime","last","currentTime","lastTime","timeDiff","toinit","getHours","toString","padStart","getMinutes","getDay","getFullYear","getMonth","getDate","getShownTime","timestamp","weekdays","weekday","hours","minutes","getMessageText","updateFirstMessage","loadAvatar","model","getAvatarByModel","loadName","modelOwner","Object","keys","getAvatarByOwner","getModelOwner","Socket","code","available","getURL","requests","pendingRequests","Set","URL","window","location","href","host","initEventListeners","handleConnect","reason","handleDisconnect","handleConnectError","messageHandler","hasAttemptedPollingFallback","isAttemptingWebSocket","io","disconnect","_connectWithTransport","transports","path","auth","token","reconnection","reconnectionAttempts","Infinity","reconnectionDelay","reconnectionDelayMax","timeout","forceNew","connect","connected","protocol","request_id","delete","sendMessage","Promise","reject","has","add","resolve","pathArray","split","Boolean","request","timeOut","_","res","race","then","catch","finally","localforage","TOOL_CALL_MODEDS","AUTO","ANY","NONE","GEMINI_SAFETY_BLOCK_SETTINGS","LOW","MEDIUM","HIGH","DEFAULT","GEMINI_SAFETY_SETTINGS_TYPE","HARASSMENT","HATE_SPEECH","SEXUALLY_EXPLICIT","DANGEROUS_CONTENT","CONFIG_KEY","localPresets","toolsConfig","llmTools","onebotConfig","llmModels","safetyConfig","baseConfig","LLMDefaultConfig","baseConfigCallback","_loadStrogeConfig","initSafetyConfig","initLLMDefaultConfig","loadllmTools","loadonebotConfig","_getLocalStorage","_saveStrogeConfig","_setLocalStorage","key","localStorage","setItem","storedValue","getItem","removeItem","configToSave","loadedConfig","_mergeDefaultsRecursive","target","defaults","prototype","hasOwnProperty","call","defaultValue","targetValue","Array","isArray","requiredCategories","values","configChanged","category","firstProvider","llm_providers","defaultProvider","displayName","defaultConfigStructure","provider","getDefaultModel","chatParams","temperature","top_p","frequency_penalty","presence_penalty","reasoning_effort","toolCallSettings","mode","tools","opening","extraSettings","imageGeneration","internalTools","google_search","code_execution","url_context","safetySettings","getBaseConfig","setBaseConfig","default_model","newDefaultProvider","updateLLMDefaultConfig","defaultModelForProvider","setBaseConfigCallback","callback","updateBaseConfig","patch","newBaseConfig","getLLMProviders","value","label","getProviderAdapterType","providerName","found","p","targetProvider","getToolCallModes","entries","getLlmModels","setLlmModels","models","getDefaultLLMModel","providers","defaultModelMap","isModelAvailable","modelGroup","group","owner","getSafetySettingsParams","getSafetyConfig","setSafetyConfig","newSafetyConfig","originalSubConfigString","originalTopLevelConfig","copiedConfig","getValidTools","selectedToolNames","availableToolNames","pluginTools","toolName","validToolNames","verifiedConfig","ok","statusText","json","success","inited","isConnected","contactList","qq","bot_qq","onPhone","setLocalStorage","bind","preInit","localBaseInfo","loadOriginBaseInfo","loadBaseInfo","getLocalStorage","loadLocalStorage","genDefaultConctor","info","onebot_enabled","genFakeId","addConcator","allTools","bot","reactive","rmContactor","list","item","loadOriginalContactors","shareId","contactor","getContactor","shareContactor","uploadResult","setOriginalContactor","body","method","headers","reset","clear","resetCache","navigator","serviceWorker","controller","messageChannel","MessageChannel","port1","onmessage","event","onerror","postMessage","port2","registrations","getRegistrations","registration","unregister","everLogin","setEverLogin","init","login","getContactors","onebotId","async","addMsgListener","onebotContactors","onebotContactor","err","logout","admin_qq","uploadFile","fileOrImage","isImage","onProgress","startsWith","uploadImage","chunkSize","md5Hash","uploadChunk","totalChunks","formData","FormData","append","xhr","XMLHttpRequest","open","upload","onprogress","lengthComputable","chunkProgress","loaded","total","overallProgress","round","onload","uploadFileChunks","ceil","size","currentChunk","min","md5","filename","finalizeUpload","worker","UploadWorker","hash","terminate","_convertBlobToBase64","blob","reader","FileReader","onloadend","readAsDataURL","PageStatus","_hoisted_1","_hoisted_2","class","_hoisted_3","_hoisted_5","_hoisted_6","processedImage","activePage","computed","isChatActive","isProfileActive","watch","$route","newRoute","getPageStatusFromRoute","immediate","mounted","adminId","methods","imageUrl","canvas","document","createElement","ctx","getContext","img","Image","src","width","height","drawImage","centerX","centerY","radius","beginPath","arc","PI","clip","clearRect","toBlob","createObjectURL","toChat","$router","toProfile","toConfig","adminAvatar","processImage","route","_openBlock","_createElementBlock","_createElementVNode","$data","alt","_hoisted_4","_normalizeClass","$options","onClick","mainWindow","props","fullScreen","default","emits","preview","isTauri","__TAURI__","__TAURI_INTERNALS__","created","URLSearchParams","search","get","Window","waiting","$message","alert","getMainWindow","minimizeWindow","minimize","$emit","configFullScreen","maximize","unmaximize","closeWindow","close","$props","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","components","MdRenderer","displayButtons","showBox","mioPlugins","plugin","imageViewerPlugin","innerWidth","_Fragment","_cache","_renderList","_createVNode","_component_displayButtons","onClose","uin","_toDisplayString","_createBlock","_component_MdRenderer","md","theme","breaks","_ctx","_component_ForwardMsg","activeContactor","_createCommentVNode","required","selectedOption","cursorPosition","showemoji","openaiModels","onebotPresets","uploaded","files","images","isPasting","extraOptions","loadSelected","debouncedAdjustHeight","adjustTextareaHeight","textareaRef","$refs","textarea","addEventListener","handleDragOver","preventDefault","style","backgroundColor","handleDragLeave","handleDrop","dataTransfer","handleDroppedFile","handlePaste","origin","textwraper","unmounted","removeEventListener","unsupportedTip","warning","hasInput","hasText","innerText","trim","hasImage","querySelector","handleUploadImage","textToHtml","insertHtmlAtCursor","html","selection","getSelection","rangeCount","innerHTML","setCursorToEnd","range","getRangeAt","deleteContents","tempEl","frag","createDocumentFragment","firstChild","appendChild","insertNode","collapse","removeAllRanges","addRange","clipboardData","items","pastedText","imageFiles","getAsFile","getData","processImageQueue","getemoji","unicode","ctrlEmojiPanel","focus","createRange","selectNodeContents","r","maxSizeByte","maxSizeMB","blobUrl","revokeObjectURL","fileType","toLowerCase","insertImageToTextarea","mimeType","quality","File","handleFileUpload","fileInput","accept","format","handleChange","click","uploadDocumentFile","fileUrl","imageName","imageElement","maxWidth","maxHeight","fragment","createContextualFragment","outerHTML","newRange","newSelection","initLLMExtraOptions","allModels","children","getOpenaiModelArray","wrapText","rawText","preset","getOnebotPreset","reduce","acc","child","scrollHeight","getWraperName","updateCursorPosition","startOffset","endOffset","presend","querySelectorAll","ImageSrcs","from","getSafeText","wrappedMessage","imgUrl","repliedMessageId","cleanScreen","currentChange","level","parent","selectedValues","seletedProvider","handleKeyDown","ctrlKey","execCommand","ref","onEmojiClick","_withModifiers","_component_el_tree_select","modelValue","$event","accordion","placement","onNodeClick","_component_el_popconfirm","onConfirm","reference","contenteditable","onKeydown","String","file_name","file_type","formated_file_size","iconClass","params","bits","formatFileSize","unitIndex","toFixed","toUpperCase","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","showExtraInfo","teleportStyle","openUp","toolCallSuccess","toolCallFail","call_status","copyToClipboard","clipboard","writeText","copyParameters","copyResult","toggleExtraInfo","positionTeleport","onDocClick","root","$el","t","teleportContent","contains","rootRect","getBoundingClientRect","left","max","initialTop","bottom","position","top","minWidth","zIndex","$nextTick","contentRect","contentHeight","contentWidth","finalLeft","innerHeight","topUp","beforeUnmount","viewBox","xmlns","points","version","d","_Teleport","to","_normalizeStyle","Number","show","getReasonInfo","updateMaxHeight","updated","toggleShow","reasonContent","seletedText","seletedImage","isUp","updateArrow","el","hasBottom","onWindowResize","copySeletedImage","copyImageToClipboard","saveSeletedImage","downloadImage","copyText","copyTextToClipboard","copySeletedText","replyMessage","deleteMessage","enterChat","togglePriority","shareBot","deleteBot","select","setSelectionRange","removeChild","imgSrc","pngBlob","ClipboardItem","write","link","download","__emit","router","useRouter","avaliablePresetTypes","tabs","activeTab","adapterKeyword","shareCode","recommendPresets","recentPresets","systemPresets","searchPresets","systemShownNum","recommendShownNum","keyWord","activeTypeIndex","buttonTranslate","moreSystemPresets","moreRecommendPresets","isMobile","showPresetsLoader","shownPrestsList","availableProviders","filteredProviders","keyword","checkMobile","handleOverlayClick","handleAddByProvider","ElMessage","getProviderDesc","getProviderTagType","getProviderColor","handleAddByShareCode","test","currentHost","pathname","match","addBot","strogeAddHistory","existingItem","pop","loadSerachPresets","changeShownType","loadSpecificType","handleScroll","scrollTop","scrollbar","clientHeight","newPresets","loadMoreData","onMounted","recent","local","getAddHistory","onUnmounted","AddContactor","ContextMenu","contactorList","showAddWindow","showMenu","menuX","menuY","selectedFriend","sortedList","sort","a","b","avaliableProvideres","addReactiveListener","genBotByShareCode","openAddWindow","showChat","getId","genBotByProvider","blankConfig","startResize","isResizing","startX","clientX","startWidth","friendlists","offsetWidth","resize","stopResize","newWidth","remSize","documentElement","fontSize","parseFloat","mergeOptions","defaultOptions","addPresetContactor","showFriendContextMenu","friend","clientY","closeMenu","handleFriendOption","option","shareResult","shareUrl","share","shareOrCopy","c","$forceUpdate","placeholder","onContextmenu","onMousedown","_component_AddContactor","onAddBot","onAddByProvider","onAddByShareCode","_component_ContextMenu","onMessageOption","overflow","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_39","_hoisted_40","PresetsList","presetsHistory","presetMessages","hoveredIndex","newVal","delPresetMessage","addPresetMessage","getMessageAvatar","handleMessageUpdate","onMouseover","onMouseleave","ref_for","onBlur","_component_el_button","plain","_withCtx","_createTextVNode","activeContactorPlatform","llmProvidersList","toolCallModesList","allLlmToolsData","safetySettingsParams","safetySimpleValueOptions","presetsHistoryData","localLlmProvider","localLlmGeneralKeys","localLlmToolCallMode","localAllLLMTools","localGeminiExtraSettings","localGeminiSafetySettings","showPresetsDetail","showInternalTools","showSafetySettings","sliderTypes","step","formatter","isGeminiAdapter","initializeSettings","deep","updateEnabledTools","safeSimplify","enabledTools","tool","enabled","getShownKey","HARM_CATEGORY_HARASSMENT","HARM_CATEGORY_HATE_SPEECH","HARM_CATEGORY_SEXUALLY_EXPLICIT","HARM_CATEGORY_DANGEROUS_CONTENT","HARM_CATEGORY_CIVIC_INTEGRITY","emitUpdate","newOptions","activeTools","flatMap","updateGeneralSettings","handleProviderChange","newProvider","defaultModel","handleUpdatePresets","presets","handleToolCallModeChange","handleToolEnableChange","handleGeminiSettingsChange","rawSafetySettings","simplifyMethod","Map","table","set","handleSafetySettingChange","simplifiedValue","originalValue","_component_el_select","onChange","_component_el_option","_component_el_input","_component_el_input_number","_component_el_switch","_component_el_slider","_Transition","_withDirectives","_component_PresetsList","onUpdatePresets","collapsed","toolIndex","description","_vShow","_hoisted_25","_hoisted_31","_hoisted_32","_hoisted_37","_hoisted_38","__props","hasError","errorTitle","errorMessage","errorStack","detailsVisible","onErrorCaptured","instance","fallbackTitle","fallbackMessage","stack","onError","handleReload","go","handleGoBack","back","configAPI","adminCode","_initialized","setAdminCode","endpoint","getConfig","getConfigSection","section","updateConfig","updateConfigSection","getAdapterTypes","addAdapter","updateAdapter","deleteAdapter","batchDeleteAdapters","adapters","sorted","results","adapter","refreshAllModels","refreshAdapterModels","validateConfig","resetConfig","getOneBotPlugins","exportConfig","configData","Blob","importConfig","readAsText","pluginAPI","listPlugins","getPluginDetail","pluginName","getPluginConfig","updatePluginConfig","getPluginTools","debugTool","user","reloadPlugin","reloadAllPlugins","togglePlugin","useConfigStore","defineStore","adapterTypes","types","count","loading","needRestart","selectedAdapters","enabledAdapters","instances","enable","totalAdapters","sum","arr","enabledAdaptersCount","totalModelsCount","providerModels","plugins","totalPluginsCount","totalToolsCount","toolCount","isAuthenticated","clearAdminCode","fetchConfig","llm_adapters","fetchAdapterTypes","fetchConfigSection","fetchPlugins","adaptersList","batchToggleAdapters","updatedData","fetchOneBotPlugins","toggleAdapterSelection","idx","clearAdapterSelection","isAdapterSelected","configStore","visible","compareConfig","val","currentConfig","adapterDiffs","diffs","current","compare","maxLen","curr","comp","newValue","oldValue","prop","diffStats","added","modified","removed","changes","change","hasDifferences","serverDifferences","getConfigDifferences","server","hasServerDiff","webDifferences","web","hasWebDiff","onebotDifferences","hasOnebotDiff","currVal","compVal","currentValue","formatConfigValue","compareValue","adapterTypeName","changeTypeTag","changeTypeText","formatValue","handleUpload","valid","errors","handleReset","handleClose","handleApply","ElMessageBox","confirm","confirmButtonText","cancelButtonText","vertexAuthType","updateField","fieldName","jsonFilePreview","service_account_json","project_id","client_email","handleJsonUpload","newKeyword","handleFetchModels","guestAvailableModels","keywords","guest","fullNames","full_name","matched","availableModels","updateDefault","addKeyword","updateFullNames","k","formRef","showApiKey","submitting","fetchingModels","fetchedModels","api_key","base_url","region","guest_models","originalData","modelConfig","dialogTitle","adapterInfo","deepseek","anthropic","formatTypeLabel","currentAdapterSchema","initialConfigSchema","previewModels","typeModels","adapterName","instanceModels","instanceName","rules","schema","fieldConfig","fieldRules","trigger","validation","pattern","RegExp","isJson","validator","rule","transform","testConfig","manual_models","handleSubmit","submitData","validate","fieldsToCheck","field","resetFields","defaultData","initFormData","getSourceLabel","source","custom","getCategoryLabel","common","recommended","hidden","getRoleLabel","system","assistant","handleSelect","selected","handleEdit","handleDelete","handleExport","maxLength","substring","cropAreaRef","imageRef","previewCanvasRef","cropData","x","y","imageWidth","imageHeight","containerWidth","containerHeight","dragState","isDragging","resizeType","startY","startCropX","startCropY","startCropWidth","startCropHeight","cropBoxStyle","initCropper","nextTick","image","naturalWidth","naturalHeight","clientWidth","minSize","initialSize","updateCropBoxStyle","updatePreview","scaleX","scaleY","sourceX","sourceY","sourceWidth","sourceHeight","save","restore","startDrag","handleDrag","stopDrag","deltaX","deltaY","newX","newY","handleResize","newHeight","imageSrc","handleConfirm","croppedBlob","outputSize","formRules","toolsOptions","loadingTools","avatarUploadRef","uploadingAvatar","cropperVisible","selectedImageSrc","uploadHeaders","cascaderProps","multiple","checkStrictly","emitPath","newPreset","resetForm","clearValidate","addHistoryItem","handleFileSelect","raw","isLt5M","handleCropperClose","handleCropperConfirm","uploadFormData","removeAvatar","pluginsResult","toolsMap","toolsResult","meaningfulName","fullName","pluginGroups","pluginGroup","loadToolsFromPlugins"],"mappings":"giBAAO,SAASA,EAASC,EAAIC,GAC3B,IAAIC,EACJ,OAAO,YAAaC,GAClBC,aAAaF,GACbA,EAAYG,WAAW,KACrBL,EAAGM,MAAMC,KAAMJ,IACdF,EACL,CACF,kFCRA,MAAMO,EACJ,8EAEIC,EAAa,CACjBC,OAAQ,aACRC,OAAQ,mBACRC,UAAW,mBACXC,OAAQ,mBACR,OAAQ,WACRC,SAAU,qBACV,OAAM,kBACN,KAAI,mBACJ,cAAe,eACf,OAAM,kBACN,OAAM,iBACN,OAAM,qBAmCD,SAASC,EAAuBC,GACrC,MAAMC,EAhBD,SAA8BD,GAOnC,MANgB,CACdE,OAAQ,aACRC,OAAQ,mBACRC,OAAQ,mBACRC,OAAQ,cAEKL,IAAgB,YACjC,CAQmBM,CAAqBN,GACtC,MAAO,GAAGR,KAAoBS,GAChC,CC7CO,SAASM,GAAaC,GAC3B,IAAIC,EAAS,GACb,MAAMC,EAAa,aAEnB,IAAA,IAASC,EAAI,EAAGA,EAAIH,EAAQG,IAC1BF,GAAUC,EAAWE,OAAOC,KAAKC,MAFVJ,GAEgBG,KAAKE,WAE9C,OAAON,CACT,CAEO,SAASO,GAAaR,GAC3B,IAAIC,EAAS,GACb,MAAMC,EACJ,iEAEF,IAAA,IAASC,EAAI,EAAGA,EAAIH,EAAQG,IAC1BF,GAAUC,EAAWE,OAAOC,KAAKC,MAFVJ,GAEgBG,KAAKE,WAE9C,OAAON,CACT,CC3Be,MAAMQ,GACnB,WAAAC,GACE3B,KAAK4B,OAAS,CAAA,CAChB,CACA,EAAAC,CAAGC,EAAWC,EAAUC,GAAU,GAE5BA,GACFhC,KAAKiC,IAAIH,GAGN9B,KAAK4B,OAAOE,KACf9B,KAAK4B,OAAOE,GAAa,IAG3B9B,KAAK4B,OAAOE,GAAWI,KAAKH,EAC9B,CACA,IAAAI,CAAKL,EAAWM,GACVpC,KAAK4B,OAAOE,IACd9B,KAAK4B,OAAOE,GAAWO,QAASN,IAC9BA,EAASK,IAGf,CACA,GAAAH,CAAIH,GACE9B,KAAK4B,OAAOE,WACP9B,KAAK4B,OAAOE,EAEvB,EClBa,MAAMQ,WAAgBZ,GACnC,WAAAC,GACEY,OACF,CAEA,WAAMC,CAAMC,EAAKL,GACf,aAAaM,GAAOC,OAAOH,MAAMC,EAAKL,EACxC,ECda,MAAMQ,WAAeN,GAClC,WAAAX,GACEY,OACF,CAEA,cAAAM,CAAeT,GAEbA,EAAKU,QAAQT,QAAQ,CAACU,EAASC,KAC7B,GAAqB,UAAjBD,EAAQE,KAAkB,CAC5B,MAAMC,EAAaH,EAAQX,KAAKe,KAAKC,QACnC,eACA,2BAEFhB,EAAKU,QAAQE,GAAOZ,KAAKe,KAAOD,CAElC,KAA4B,UAAjBH,EAAQE,MACjBF,EAAQX,KAAKiB,SAAShB,QAASiB,IAC7B,GAAkB,UAAdA,EAAKL,KAAkB,CACzB,MAAMC,EAAaI,EAAKlB,KAAKe,KAAKC,QAChC,eACA,2BAEFE,EAAKlB,KAAKe,KAAOD,CACnB,MAKN,MAAMK,EAAanB,EAAKU,QAAQU,OAC7BT,GAA6B,UAAjBA,EAAQE,MAEjBQ,EAAarB,EAAKU,QAAQU,OAC7BT,GAA6B,UAAjBA,EAAQE,MAEnBM,EAAWtC,OAAS,GACtBwC,EAAWC,QAAQH,EAAW,IAUhC,MAPmB,CACjBI,KAAM,QACNC,MAAA,IAAUC,MAAOC,UACjBC,QAASN,EACTO,GAAI5B,EAAK6B,WACTC,OAAQ,YAGZ,CAQA,UAAMC,CAAKH,EAAIlB,GAKb,aAJuB9C,KAAKwC,MAC1B,uBAA4BwB,IAC5BlB,IAEcmB,UAClB,ECpDa,MAAMG,WAAe9B,GAClC,WAAAX,CAAY0C,GACV9B,QACAvC,KAAKgE,GAAKK,EAAOL,EACnB,CAEA,cAAAnB,CAAeC,GASb,MADsB,IAPH,CACjBa,KAAM,QACNC,MAAA,IAAUC,MAAOC,UACjBC,QAAS,CAAC,CAAEd,KAAM,QAASb,KAAM,CAAA,IACjC8B,OAAQ,UACRF,GAAIhD,GAAa,QAEuB8B,EAE5C,CAEA,wBAAMwB,CAAmBC,GACvB,MAAMC,EAAQ,gBAAgBC,KAAKC,UAAUH,mDACvCI,EAAWN,GAAOO,sBACxBD,EAASE,KAAKC,QAAS,EACvB,MAAMzB,EAAW,CACfsB,WACAtB,SAAU,CAAC,CAAEM,KAAM,OAAQI,QAASS,KAGhCO,QAAiB/E,KAAKwC,MAAM,uBAAwBa,IAEpDU,QAAEA,GAAYgB,EACpB,OAAOhB,GAAW,OACpB,CAEA,kBAAAiB,CAAmBC,GACjB,MAAM7C,EAAO6C,EAAM7C,KAEb8C,EAAY9C,EAAK+C,SAASD,iBAEzB9C,EAAK+C,SAEZ,MAAMC,EAAY,CAACtD,EAAWuD,KAC5BrF,KAAKmC,KAAKL,EAAW,IAAKuD,EAAQH,eAIpC,GAAsB,WAAlBD,EAAMnC,QAAsB,CAC9B,MAAMwC,EAAiB,CACrBC,iBAAmBxB,GACjBqB,EAAU,kBAAmB,CAAEI,kBAAmBzB,IACpDA,QAAUA,GAAYqB,EAAU,gBAAiB,CAAEH,MAAOlB,IAC1D0B,SAAWC,GAAcN,EAAU,iBAAkB,CAAEM,eAGnDtD,EAAO6C,EAAM7C,KACbuD,EAAUL,EAAelD,EAAKa,MAChC0C,GACFA,EAAQvD,EAAK2B,QAEjB,MAAA,GAAW,CAAC,WAAY,UAAU6B,SAASX,EAAMnC,SAAU,CACzD,MAKM6C,EALqB,CACzBE,SAAU,IAAMT,EAAU,kBAAmB,IAC7CU,OAAQ,IAAMV,EAAU,gBAAiB,CAAEW,MAAOd,EAAM7C,QAGvB6C,EAAMnC,SACrC6C,GACFA,GAEJ,CACF,CAEA,UAAMxB,CAAKd,EAAU6B,EAAWP,GAG9BA,EAAWN,GAAO2B,qBAAqBrB,GAEvC,MAAMQ,EAAW,CACfc,YAAajG,KAAKgE,GAClBkB,aAGI9C,EAAO,CACXuC,WACAtB,YAKF,IAAKX,GAAOC,OACV,MAAM,IAAIuD,MAAM,yCAGlBxD,GAAOC,OAAOwD,kBAAkB/D,EAAM+C,EACxC,EChGF,MAAMiB,GAAe,CAAC,QAAS,UAEzBC,GAAa,CAAC,QAAS,SAAU,WAExB,MAAMC,WAAkBC,GAkBrC,WAAA5E,CAAY6E,EAAUnC,GACpB9B,QACAvC,KAAKwG,SAAWA,EAChBxG,KAAKgE,GAAKK,EAAOL,GACjBhE,KAAKqG,WAAahC,EAAOgC,YAAc,EACvCrG,KAAKoG,aAAe/B,EAAO+B,cAAgB,EAC3CpG,KAAKyG,MAAQpC,EAAOoC,MACpBzG,KAAK0G,KAAOrC,EAAOqC,KACnB1G,KAAK2G,OAAStC,EAAOsC,OACrB3G,KAAK4G,SAAWvC,EAAOuC,SACvB5G,KAAK6G,kBAAoBxC,EAAOwC,mBAAqB,EACrD7G,KAAKuE,aAAeF,EAAOE,cAAgB,GAC3CvE,KAAK8G,QAAS,EACd9G,KAAK+G,WAAa1C,EAAO0C,YAAclD,KAAKmD,MAC5ChH,KAAKiH,WAAa5C,EAAO4C,YAAcpD,KAAKmD,MAC5ChH,KAAKkH,mBAAqBlH,KAAKmH,wBAC/BnH,KAAKoH,QAAUpH,KAAKqH,YAAYhD,EAAO+C,SACvCpH,KAAKsH,OACU,WAAbd,EAAwB,IAAI5D,GAAOyB,GAAU,IAAID,GAAOC,GAEzC,WAAbmC,GACFxG,KAAKuH,sBAET,CAMA,MAAAC,GACE,MAAO,CACLhB,SAAUxG,KAAKwG,SACfxC,GAAIhE,KAAKgE,GACToD,QAASpH,KAAKoH,QACdf,WAAYrG,KAAKqG,WACjBD,aAAcpG,KAAKoG,aACnBK,MAAOzG,KAAKyG,MACZC,KAAM1G,KAAK0G,KACXC,OAAQ3G,KAAK2G,OACbC,SAAU5G,KAAK4G,SACfrC,aAAcvE,KAAKuE,aACnBuC,OAAQ9G,KAAK8G,OACbC,WAAY/G,KAAK+G,WACjBE,WAAYjH,KAAKiH,WACjBC,mBAAoBlH,KAAKkH,mBACzBL,kBAAmB7G,KAAK6G,kBAE5B,CAEA,oBAAAU,GACEvH,KAAKsH,OAAOzF,GAAG,kBAAoB4F,IACjC,MAAMjC,kBAAEA,EAAAN,UAAmBA,GAAcuC,EACnCC,EAAa1H,KAAK2H,eAAezC,GACvC,IAAKwC,EAAY,OAGjB,MAAME,EAAsBF,EAAW3D,QAAQ8D,UAC5CC,GAA2B,WAAhBA,EAAO7E,MAGf6E,EAAS,CACb7E,KAAM,SACNb,KAAM,CACJ2F,KAAMvC,EACNwC,WAAA,IAAenE,MAAOC,UACtBmE,QAAS,KAIe,IAAxBL,GAEFE,EAAO1F,KAAK2F,KACVL,EAAW3D,QAAQ6D,GAAqBxF,KAAK2F,KAAOvC,EACtDsC,EAAO1F,KAAK4F,UACVN,EAAW3D,QAAQ6D,GAAqBxF,KAAK4F,UAC/CN,EAAW3D,QAAQ6D,GAAuBE,GACF,UAA/BJ,EAAW3D,QAAQ,GAAGd,KAE/ByE,EAAW3D,QAAQ,GAAK+D,EAGxBJ,EAAW3D,QAAQ7B,KAAK4F,GAG1B9H,KAAKmC,KAAK,iBACVnC,KAAKmC,KAAK,0BAGZnC,KAAKsH,OAAOzF,GAAG,gBAAkB4F,IAC/B,MAAMxC,MAAEA,EAAAC,UAAOA,GAAcuC,EACvBC,EAAa1H,KAAK2H,eAAezC,GACvC,IAAKwC,EAAY,OAEjBA,EAAW3D,QAAQ1B,QAASyF,IACP,UAAfA,EAAO7E,MAAqB6E,EAAO1F,KAAK6F,UAC1CH,EAAO1F,KAAK6F,SAAA,IAAcpE,MAAOC,aAGrC,MAAMoE,EAAaR,EAAW3D,QAAQ2D,EAAW3D,QAAQ9C,OAAS,GAC5DkH,EAAiB,CAAC,QAAS,QAAQvC,SAASsC,EAAWjF,MAEvD6E,EAAS,CACb7E,KAAM,OACNb,KAAM,CACJ2F,MAA0B,QAAnBG,EAAWjF,KAAiBiF,EAAW9F,KAAK2F,KAAO,IAAIK,OAC5DnD,KAKFkD,EACFT,EAAW3D,QAAQ2D,EAAW3D,QAAQ9C,OAAS,GAAK6G,EACjDJ,EAAW3D,QAAQ7B,KAAK4F,GAE7B9H,KAAKmC,KAAK,iBACVnC,KAAKmC,KAAK,0BAGZnC,KAAKsH,OAAOzF,GAAG,iBAAmB4F,IAChC,MAAM/B,UAAEA,EAAAR,UAAWA,GAAcuC,EAG3BC,EAAa1H,KAAK2H,eAAezC,GACvC,IAAKwC,EAAY,OAEjB,MAAMQ,EAAaR,EAAW3D,QAAQ2D,EAAW3D,QAAQ9C,OAAS,GAC5D6G,EAAS,CACb7E,KAAM,YACNb,KAAMsD,GAGR,GAAuB,SAAnBwC,EAAWjF,KAEbyE,EAAW3D,QAAQ,GAAK+D,MACnB,CACL,MAAMO,EAAeX,EAAW3D,QAAQuE,KACrCR,GAAWA,EAAO1F,KAAK4B,IAAM0B,EAAU1B,IAE1C,GAAIqE,EAAc,CAChB,MAAME,EAAc9D,KAAK+D,MAAM/D,KAAKC,UAAU2D,IAC9CE,EAAYnG,KAAKqG,OAAS/C,EAAU+C,OACpCF,EAAYnG,KAAKlB,OAASwE,EAAUxE,OACZ,WAApBwE,EAAU+C,SACZF,EAAYnG,KAAKsG,YAAchD,EAAUgD,YAE3C,MAAM1F,EAAQ0E,EAAW3D,QAAQ4E,QAAQN,GACzCX,EAAW3D,QAAQf,GAASuF,CAC9B,MAEEb,EAAW3D,QAAQ7B,KAAK4F,EAE5B,CAEA9H,KAAKmC,KAAK,iBACVnC,KAAKmC,KAAK,0BAGZnC,KAAKsH,OAAOzF,GAAG,kBAAoB4F,IACjCzH,KAAK4I,mBACL,MAAM1D,EAAYuC,EAAEvC,UACdwC,EAAa1H,KAAK2H,eAAezC,GACnCwC,IACFA,EAAWxD,OAAS,YAEpBlE,KAAKmC,KAAK,wBAEVnC,KAAKmC,KAAK,kBAAmB,CAC3B+C,iBAKNlF,KAAKsH,OAAOzF,GAAG,gBAAkB4F,IAG/B,GAAuB,iBAAZA,EAAE1B,MACX,IACE0B,EAAE1B,MAAMjD,QAAU2B,KAAK+D,MAAMf,EAAE1B,MAAMjD,QACvC,OAASiD,GAET,CAEF,MAAMA,EAAQtB,KAAKC,UAAU+C,EAAE1B,MAAO,KAAM,GAE5C/F,KAAK4I,mBACL,MAAM1D,EAAYuC,EAAEvC,UACdwC,EAAa1H,KAAK2H,eAAezC,GACvC,GAAIwC,EAAY,CACd,MAEMmB,EAAU,CACd5F,KAAM,OACNb,KAAM,CACJ2F,KAJF,gCAAkChC,EAAQ,UAQ1B2B,EAAW3D,QAAQ+E,KAClCC,GAAqB,UAAbA,EAAI9F,MAIbyE,EAAW3D,QAAQ,GAAK8E,EAExBnB,EAAW3D,QAAQ7B,KAAK2G,GAG1BnB,EAAWxD,OAAS,YAEpBlE,KAAKmC,KAAK,wBAEVnC,KAAKmC,KAAK,kBAAmB,CAC3B+C,aAEJ,GAEJ,CAEA,qBAAA8D,CAAsBvB,GACpBzH,KAAKsH,OAAOtC,mBAAmByC,EACjC,CAEA,WAAAJ,CAAYD,GACV,MAAsB,WAAlBpH,KAAKwG,SACAnC,GAAO2B,qBAAqBoB,GAE5BA,GAAW,CAAA,CAEtB,CAMA,UAAMjD,CAAKrB,SACH9C,KAAKsH,OAAOnD,KAAKrB,EACzB,CAEA,cAAAmG,CAAeC,GAEb,MADc,kBACCA,EAASC,KAAK,KAC/B,CAEA,eAAAC,CAAgBC,GAGd,MAFc,qBACUA,EAAUC,IAAKP,GAAMA,EAAIhF,SAASoF,KAAK,KAEjE,CAEA,sBAAAI,CACEC,EAAQxJ,KAAK6G,kBACb4C,EAAMzJ,KAAKuE,aAAatD,OACxBA,EAASjB,KAAKoH,QAAQvC,KAAK6E,kBAE3B,MAQMC,EARoB3J,KAAKuE,aAC5BqF,MAAMJ,EAAOC,GACbG,OAAO3I,GAEiCuC,OACxCqG,GAAoB,cAAZA,EAAIlG,MAGyB2F,IAAKxG,IAC3C,MAAMgH,EAAW,GACXC,EAAY,GACZC,EAAW,GAmDjB,GAlDAlH,EAAQiB,QAAQ1B,QAAS0G,IACvB,MAAMpF,EACQ,aAAZoF,EAAI9F,KACA,OACgB,QAAhBH,EAAQa,KACN,OACA,YACFsG,EAAc,CAClBtG,OACAI,QAAS,OACTmG,mBAAe,GAEL,QAARvG,GACFsG,EAAYtG,KAAO,YACnBsG,EAAYlG,QAAU,KACtBkG,EAAYE,WAAa,CACvB,CACEnG,GAAI+E,EAAI3G,KAAK4B,GACboG,SAAU,CACR1D,KAAMqC,EAAI3G,KAAKsE,KACf2D,UAAWtB,EAAI3G,KAAKsG,YAEtBzF,KAAM,aAGV+G,EAAS9H,KAAK,IAAK+H,WAEZA,EAAYE,WACnBF,EAAYtG,KAAO,OACnBsG,EAAYlG,QAAUU,KAAKC,UAAUqE,EAAI3G,KAAKlB,QAC9C+I,EAAYK,aAAevB,EAAI3G,KAAK4B,GACpCiG,EAAYvD,KAAOqC,EAAI3G,KAAKsE,KAC5BsD,EAAS9H,KAAK,IAAK+H,IAEnBA,EAAYtG,KAAOA,GACF,QAARA,GAA0B,aAARA,IACX,SAAZoF,EAAI9F,MACNgH,EAAYlG,QAAUgF,EAAI3G,KAAKe,KAC/B8G,EAAYC,cAAgB,QAC5BF,EAAS9H,KAAK+H,GACdF,EAAU7H,KAAK6G,EAAI3G,KAAKe,KAAKY,UACR,QAAZgF,EAAI9F,MACbgH,EAAYlG,QAAUgF,EAAI3G,KAAK2F,KAC/BkC,EAAYC,cAAgB,OAC5BF,EAAS9H,KAAK+H,IACO,QAAZlB,EAAI9F,MACb6G,EAAS5H,KAAK6G,EAAI3G,KAAKe,SAIzB2G,EAAS7I,OAAS,EAAG,CAGD,GAFN+I,EAASxG,OAAQuF,GAA6B,QAArBA,EAAImB,eAEjCjJ,QACV+I,EAAS9H,KAAK,CACZyB,KAAM,OACNI,QAAS/D,KAAKiJ,eAAea,GAC7BI,cAAe,QAGrB,CACA,OAAOF,IAET,IAAIO,EAAgB,GAEpBZ,EAAetH,QAAS2H,IACtB,MAAMQ,EAAUR,EAASxG,OAAQuF,GAA6B,QAArBA,EAAImB,eACvCO,EAAWT,EAASxG,OAAQuF,GAA6B,SAArBA,EAAImB,eACxCQ,EAAUV,EAASxG,OAAQuF,GAA6B,QAArBA,EAAImB,eACvCS,EAAaD,EAAQzJ,OAAS,EAAIjB,KAAKiJ,eAAeyB,GAAW,GACjEE,EAAcH,EAASxJ,OAAS,EAAIjB,KAAKoJ,gBAAgBqB,GAAY,GAE3E,IAAI3H,EAAU,KAEZ0H,EAAQvJ,OAAS,GACjBwJ,EAASxJ,OAAS,GACE,QAApBwJ,EAAS,GAAG9G,OAEZb,EAAU,CACRa,KAAM,OACNI,QAAS,IACJ0G,EAASnB,IAAKP,IACR,CACL9F,KAAM,YACN4H,UAAW,CACTpI,IAAKsG,EAAIhF,eAIZyG,EAAQlB,IAAKP,IACP,CACL9F,KAAM,OACN8E,KAAMgB,EAAIhF,QAAU4G,EAAaC,QAMvC9H,GAASiB,QAAQ9C,QAAU+I,EAAS/I,OACtCsJ,EAAcrI,KAAKY,IAEnBkH,EAAS3H,QAAS0G,WACTA,EAAImB,gBAEbK,EAAcrI,QAAQ8H,MAI1B,MAAMc,EAAgB9K,KAAKoH,QAAQ2D,eAAeC,QAMlD,OAJIF,IACFP,EAAgBO,EAAc1C,OAAOmC,IAGhCA,CACT,CACA,oBAAAU,GACEjL,KAAKkH,mBAAqBlH,KAAKmH,uBACjC,CAEA,oBAAA+D,GAQE,MAPsB,CACpBvH,KAAM,OACNC,MAAA,IAAUC,MAAOC,UACjBI,OAAQ,YACRF,GAAIhD,GAAa,IACjB+C,QAAS,GAGb,CAKA,aAAMoH,CAAQrI,EAASsI,GAAW,GAIhC,GAHApL,KAAK4I,mBACL5I,KAAKuE,aAAarC,KAAKY,GACvB9C,KAAKiL,uBACAG,EACL,IACE,GAAqB,UAAjBpL,KAAKwG,SAAsB,CAG7B,aAFwBxG,KAAKsH,OAAOnD,KAAKnE,KAAKgE,GAAIlB,EAAQiB,QAG5D,CAAO,CAEL,MAAMwG,EAAgBvK,KAAKuJ,yBACrBrE,EAAYlE,GAAa,IAO/B,aANMhB,KAAKsH,OAAOnD,KAAKoG,EAAerF,EAAWlF,KAAKoH,SAEtDpH,KAAKqL,WAAW,CACdrH,GAAIkB,IAGClE,GAAa,GACtB,CACF,OAAS+E,GAEP,MAAMA,CACR,CACF,CAEA,aAAAuF,CAAcxI,EAASE,GACrBhD,KAAKuE,aAAagH,OAAOvI,EAAO,EAAGF,GACnC9C,KAAKiL,sBACP,CAEA,kBAAMO,CAAaxH,GACjB,MAAMlB,EAAU9C,KAAK2H,eAAe3D,GACpC,GAAIlB,EAAS,CACXA,EAAQiB,QAAU,CAChB,CACEd,KAAM,UAGVjD,KAAK4I,mBACL,MAAM5F,EAAQhD,KAAKuE,aAAaoE,QAAQ7F,GAClCyH,EAAgBvK,KAAKuJ,uBAAuB,EAAGvG,GAErD,OADAhD,KAAKsH,OAAOnD,KAAKoG,EAAevG,EAAIhE,KAAKoH,UAClC,CACT,CACF,CAEAqE,GAOA,UAAAJ,CAAWvI,GACT9C,KAAK4I,mBAEL,MAAM8C,EAAa1L,KAAKsH,OAAOzE,eAAeC,GAM9C,OAJK9C,KAAK8G,OACL9G,KAAKmC,KAAK,aAAcuJ,GADX1L,KAAKuE,aAAarC,KAAKwJ,GAGzC1L,KAAKmC,KAAK,wBACHuJ,CACT,CAOA,UAAAC,CAAW1H,GACT,IAAA,IAAS7C,EAAI,EAAGA,EAAIpB,KAAKuE,aAAatD,OAAQG,IAE5C,GAAIpB,KAAKuE,aAAanD,GAAG4C,KAAOC,GAA4C,UAA9BjE,KAAKuE,aAAanD,GAAGuC,KAIjE,OAHI3D,KAAK8G,OAAQ9G,KAAKmC,KAAK,aAAcf,GACpCpB,KAAK4L,OAAOrH,aAAagH,OAAOnK,EAAG,GACxCpB,KAAK6L,kBAAkB,GAAG7L,KAAK0G,gBACxB,EAGX,OAAO,CACT,CAEA,iBAAAmF,CAAkB9D,GAChB,MAAM+D,EAAY,CAChBnI,KAAM,aACNC,MAAA,IAAUC,MAAOC,UACjBE,IAAA,IAAQH,MAAOC,UACfC,QAAS,CACP,CACEd,KAAM,OACNb,KAAM,CACJ2F,WAKJ/H,KAAK8G,OAAQ9G,KAAKmC,KAAK,aAAc2J,GACpC9L,KAAKuE,aAAarC,KAAK4J,EAC9B,CAEA,WAAAC,GACE,MAAMC,EAAOhM,KAAKuE,aAAavE,KAAKuE,aAAatD,OAAS,GAC1D,IAAK+K,EACH,MAAO,GAGT,MAAMC,GAAA,IAAkBpI,MAAOC,UACzBoI,EAAW,IAAIrI,KAAKmI,EAAKpI,MACzBuI,EAAWF,EAAcC,EAASpI,UAExC,GAAIqI,EAAW,MAAqB,CAClCnM,KAAKoM,QAAS,EAId,MAAO,GAFOF,EAASG,WAAWC,WAAWC,SAAS,EAAG,QACzCL,EAASM,aAAaF,WAAWC,SAAS,EAAG,MAE/D,CAAA,GAAWJ,EAAW,OAEpB,MAAO,QACEA,EAAW,OAAyB,CAI7C,MAAO,KAFU,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAChCD,EAASO,WAE3B,CAKE,MAAO,GAHMP,EAASQ,kBACPR,EAASS,WAAa,GAAGL,WAAWC,SAAS,EAAG,QACnDL,EAASU,UAAUN,WAAWC,SAAS,EAAG,MAG1D,CAEA,YAAAM,CAAaC,GACX,MAGMX,GAHA,IAAkBtI,MAAOC,UAGAgJ,EAC/B,GAAIX,EAAW,MAAqB,CAMlC,MAAO,GALO,IAAItI,KAAKiJ,GAAWT,WAAWC,WAAWC,SAAS,EAAG,QACpD,IAAI1I,KAAKiJ,GACtBN,aACAF,WACAC,SAAS,EAAG,MAEjB,CAAA,GAAWJ,EAAW,OAAqB,CAOzC,MAAO,KALO,IAAItI,KAAKiJ,GAAWT,WAAWC,WAAWC,SAAS,EAAG,QACpD,IAAI1I,KAAKiJ,GACtBN,aACAF,WACAC,SAAS,EAAG,MAEjB,IAAWJ,EAAW,OAAyB,CAE7C,MAAMY,EAAW,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC1CC,EAAU,IAAInJ,KAAKiJ,GAAWL,SAC9BQ,EAAQ,IAAIpJ,KAAKiJ,GAAWT,WAAWC,WAAWC,SAAS,EAAG,KAC9DW,EAAU,IAAIrJ,KAAKiJ,GACtBN,aACAF,WACAC,SAAS,EAAG,KACf,MAAO,KAAKQ,EAASC,KAAWC,KAASC,GAC3C,CAYE,MAAO,GAVM,IAAIrJ,KAAKiJ,GAAWJ,kBAClB,IAAI7I,KAAKiJ,GAAWH,WAAa,GAC7CL,WACAC,SAAS,EAAG,QACH,IAAI1I,KAAKiJ,GAAWF,UAAUN,WAAWC,SAAS,EAAG,QACnD,IAAI1I,KAAKiJ,GAAWT,WAAWC,WAAWC,SAAS,EAAG,QACpD,IAAI1I,KAAKiJ,GACtBN,aACAF,WACAC,SAAS,EAAG,MAGnB,CAEA,qBAAApF,CAAsBrE,GA4BpB,IAAI+G,EAAM/G,GAAW9C,KAAKuE,aAAavE,KAAKuE,aAAatD,OAAS,GAClE,OAAK4I,GACLA,EAAMpF,KAAK+D,MAAM/D,KAAKC,UAAUmF,IACf,SAAbA,EAAI5G,OACN4G,EAAMA,EAAIzH,MA/BW,CAACW,IACtB,OAAQA,EAAQE,MACd,IAAK,OAYL,IAAK,SACH,OAAOF,EAAQX,KAAK2F,KAXtB,IAAK,QACH,MAAO,OACT,IAAK,SACH,MAAO,OACT,IAAK,QACH,MAAO,OACT,IAAK,OACH,MAAO,OACT,IAAK,YACH,MAAO,UAAUhF,EAAQX,KAAKsE,OAGhC,IAAK,QACH,MAAO,WACT,IAAK,QACH,MAAO,GACT,IAAK,QACH,MAAO,SACT,QACE,MAAO,YAAc3D,EAAQE,OAW5BkK,CAAetD,EAAI9F,QAAU8F,EAAI9F,QAAQ,GAAK8F,IANpC,EAOnB,CAEA,kBAAAuD,GACEpN,KAAK6G,kBAAoB7G,KAAKuE,aAAatD,MAC7C,CAEA,gBAAA2H,GACE5I,KAAK+G,YAAA,IAAiBlD,MAAOC,SAC/B,CAEA,cAAA6D,CAAe3D,GACb,OAAOhE,KAAKuE,aAAa+D,KAAMuB,GAAQA,EAAI7F,KAAOA,EACpD,CAEA,UAAAqJ,GACE,IAAI1G,EAAS,4BACb,GAAuC,SAAnCP,GAAapG,KAAKoG,cAA0B,CAC9C,MAAMkH,EAAQtN,KAAKoH,QAAQvC,KAAKyI,MAChC3G,EAASL,GAAUiH,iBAAiBD,EACtC,KAA8C,UAAnClH,GAAapG,KAAKoG,gBAC3BO,EAAS3G,KAAK2G,QAQhB,MALqB,UAAjB3G,KAAKwG,WACPxG,KAAKyG,MAAQzG,KAAKoH,QAAQvC,KAAKyI,OAGjCtN,KAAK2G,OAASA,EACPA,CACT,CAEA,cAAM6G,GACJ,IAAI9G,EAAO1G,KAAK0G,MAAQ,UACxB,GAAmC,SAA/BL,GAAWrG,KAAKqG,YAAwB,CAE1CK,EADc1G,KAAKoH,QAAQkG,KAE7B,KAA0C,UAA/BjH,GAAWrG,KAAKqG,YACzBK,EAAO1G,KAAK0G,KAC4B,WAA/BL,GAAWrG,KAAKqG,cACrBrG,KAAKuE,aAAatD,OAAS,EAC7ByF,EAAO,UAEqB,GAA5B1G,KAAKuE,aAAatD,QAClBjB,KAAKuE,aAAatD,OAAS,GAAK,IAEhCyF,QAAa1G,KAAKsE,uBAItB,OADAtE,KAAK0G,KAAOA,EACLA,CACT,CAEA,kBAAApC,GACE,MAAqB,UAAjBtE,KAAKwG,SACAxG,KAAKsH,OAAOhD,mBACjBtE,KAAKuJ,yBAAyBK,OAAM,IAG/B,qBAEX,CAEA,uBAAO2D,CAAiBD,GAEtB,ONjrBG,SAA0BG,GAC/B,OAAIC,OAAOC,KAAKzN,GAAY0F,SAAS6H,GAC5B,GAAGxN,KAAoBC,EAAWuN,KAEpC,GAAGxN,cACZ,CM4qBW2N,CADYvJ,GAAOwJ,cAAcP,GAE1C,ECjsBa,MAAMQ,WAAepM,GAMlC,WAAAC,CAAYqC,EAAI+J,GACdxL,QACAvC,KAAKgO,UAAY,KACjBhO,KAAKyC,IAAMzC,KAAKiO,SAChBjO,KAAK2C,OAAS,KACd3C,KAAK+N,KAAOA,EACZ/N,KAAKgE,GAAKA,EACVhE,KAAKkO,SAAW,GAChBlO,KAAKmO,oBAAsBC,GAC7B,CAMA,MAAAH,GAGE,OAFY,IAAII,IAAIC,OAAOC,SAASC,MAEzBC,IACb,CAKA,kBAAAC,GACO1O,KAAK2C,SAKV3C,KAAK2C,OAAOV,IAAI,WAChBjC,KAAK2C,OAAOV,IAAI,cAChBjC,KAAK2C,OAAOV,IAAI,iBAChBjC,KAAK2C,OAAOV,IAAI,WAEhBjC,KAAK2C,OAAOd,GAAG,UAAW,IAAM7B,KAAK2O,iBACrC3O,KAAK2C,OAAOd,GAAG,aAAe+M,GAAW5O,KAAK6O,iBAAiBD,IAC/D5O,KAAK2C,OAAOd,GAAG,gBAAkBkE,GAAU/F,KAAK8O,mBAAmB/I,IACnE/F,KAAK2C,OAAOd,GAAG,UAAYiB,GAAY9C,KAAK+O,eAAejM,IAC7D,CAKA,aAAA6L,GACE3O,KAAKgO,WAAY,EACjBhO,KAAKgP,6BAA8B,EACnChP,KAAKiP,uBAAwB,EACXjP,KAAK2C,OAAOuM,EAEhC,CAMA,gBAAAL,CAAiBD,GACf5O,KAAKgO,WAAY,CAKnB,CAMA,kBAAAc,CAAmB/I,GACjB/F,KAAKmC,KAAK,gBAAiB4D,GASvB/F,KAAKiP,wBAA0BjP,KAAKgP,6BAItChP,KAAKgP,6BAA8B,EACnChP,KAAKiP,uBAAwB,EAGzBjP,KAAK2C,SACP3C,KAAK2C,OAAOwM,aACZnP,KAAK2C,OAAS,MAIhB7C,WAAW,KAETE,KAAKoP,sBAAsB,CAAC,aAC3B,OACOpP,KAAKiP,sBAUfjP,KAAKgO,WAAY,EAErB,CAMA,qBAAAoB,CAAsBC,GAKhBrP,KAAK2C,QACP3C,KAAK2C,OAAOwM,aAGdnP,KAAK2C,OAASuM,EAAGlP,KAAKyC,IAAK,CACzB6M,KAAM,aACND,aACAE,KAAM,CAAEvL,GAAIhE,KAAKgE,GAAIwL,MAAOxP,KAAK+N,MACjC0B,cAAc,EACdC,qBAAsBC,SACtBC,kBAAmB,IACnBC,qBAAsB,IACtBC,QAAS,KAGTC,UAAU,IAGZ/P,KAAK0O,oBACP,CAKA,aAAMsB,GACAhQ,KAAK2C,QAAU3C,KAAK2C,OAAOsN,YAI/BjQ,KAAKiP,uBAAwB,EAC7BjP,KAAKgP,6BAA8B,EACnChP,KAAKoP,sBAAsB,CAAC,cAC9B,CAKA,UAAAD,GACMnP,KAAK2C,SACP3C,KAAK2C,OAAOwM,aAIZnP,KAAKgO,WAAY,EAGrB,CAMA,cAAAe,CAAejM,GAEb,IACE,MAAM2E,EAAIhD,KAAK+D,MAAM1F,GACF,QAAf2E,EAAEyI,WACJlQ,KAAKmC,KAAKsF,EAAE0I,WAAY1I,GACxBzH,KAAKmC,KAAK,cAAesF,IAER,WAAfA,EAAEyI,SACJlQ,KAAKmC,KAAK,iBAAkBsF,GACJ,WAAfA,EAAEyI,WACI,UAAXzI,EAAExE,WAAuBd,KAAK,UAAWsF,EAAErF,MAC/CpC,KAAKmC,KAAK,iBAAkBsF,IAE9BzH,KAAKmC,KAAKsF,EAAE0I,WAAY1I,GACxBzH,KAAKmO,gBAAgBiC,OAAO3I,EAAE0I,WAChC,OAASpK,GAET,CACF,CAMA,WAAAsK,CAAYvN,GAIV,IAAK9C,KAAK2C,SAAW3C,KAAK2C,OAAOsN,UAK/B,OADAjQ,KAAKmO,gBAAgBiC,OAAOtN,EAAQqN,YAC7BG,QAAQC,OAAO,IAAIrK,MAAM,yBAIlC,GAAIlG,KAAKmO,gBAAgBqC,IAAI1N,EAAQqN,YAKnC,OAAOG,QAAQC,OACb,IAAIrK,MAAM,yBAAyBpD,EAAQqN,eAG/CnQ,KAAKmO,gBAAgBsC,IAAI3N,EAAQqN,YAEjC,IAKE,OAJAnQ,KAAK2C,OAAOR,KAAK,UAAWsC,KAAKC,UAAU5B,IAIpCwN,QAAQI,SACjB,OAAS3K,GAGP,OADA/F,KAAKmO,gBAAgBiC,OAAOtN,EAAQqN,YAC7BG,QAAQC,OAAOxK,EACxB,CACF,CAQA,KAAAvD,CAAMC,EAAKL,GACT,OAAO,IAAIkO,QAAQ,CAACI,EAASH,KAC3B,MAAMI,EAAYlO,EAAImO,MAAM,KAAKpN,OAAOqN,SAClCC,EAAU,CACdX,WAAY1O,GAAa,IACzByO,SAAUS,EAAU,GACpB1N,KAAM0N,EAAU,GAChB3M,GAAI2M,EAAU,GACdvO,OACA+C,SAAU,CACRc,YAAajG,KAAKgE,KAGhB+M,EAAU,IAAIT,QAAQ,CAACU,EAAGT,KAC9BzQ,WAAW,KACTE,KAAKmO,gBAAgBiC,OAAOU,EAAQX,YACpCI,EAAO,YACN,OAECxL,EAAW,IAAIuL,QAASI,IAC5B1Q,KAAK6B,GAAGiP,EAAQX,WAAac,IAC3BjR,KAAKmO,gBAAgBiC,OAAOU,EAAQX,YACpCO,EAAQO,EAAI7O,UAGhBkO,QAAQY,KAAK,CAACH,EAAShM,IACpBoM,KAAKT,GACLU,MAAMb,GACNc,QAAQ,KACPrR,KAAKiC,IAAI6O,EAAQX,cAErBnQ,KAAKqQ,YAAYS,IAGrB,CAOA,iBAAA3K,CAAkB/D,EAAM+C,GACtB,MACM2L,EAAU,CACdX,WAFiB1O,GAAa,IAG9ByO,SAAU,MACVjN,KAAM,cACNb,OACA+C,YAEFnF,KAAKqQ,YAAYS,EAEnB,ECxSFQ,EAAYjN,OAAO,CACjBqC,KAAM,aCLR,MAAM6K,GAAmB,CACvBC,KAAM,OACNC,IAAK,MACLC,KAAM,QAIFC,GAA+B,CACnCD,KAAM,aACNE,IAAK,kBACLC,OAAQ,yBACRC,KAAM,sBACNC,QAAS,cAILC,GAA8B,CAClCC,WAAY,2BACZC,YAAa,4BACbC,kBAAmB,kCACnBC,kBAAmB,mCAKfC,GAAa,gBCrBd,MAAChO,GAAS,ID2BA,MACb,WAAA1C,GAEE3B,KAAKsS,aAAe,GACpBtS,KAAKuS,YAAc,GACnBvS,KAAKwS,SAAW,GAChBxS,KAAKyS,aAAe,KACpBzS,KAAK0S,UAAY,GACjB1S,KAAK2S,aAAe,GACpB3S,KAAK4S,WAAa,GAClB5S,KAAK6S,iBAAmB,GACxB7S,KAAK8S,mBAAqB,KAI1B9S,KAAK+S,oBAGL/S,KAAKgT,mBAGLhT,KAAKiT,uBAILjT,KAAKkT,eAAe9B,MAAOrL,OAG3B/F,KAAKmT,mBAAmB/B,MAAOrL,OAK1B/F,KAAKoT,iBAAiBf,KAEzBrS,KAAKqT,mBAET,CASA,gBAAAC,CAAiBC,EAAKnR,GACpB,IACEoR,aAAaC,QAAQF,EAAK9O,KAAKC,UAAUtC,GAC3C,OAAS2D,GAGT,CACF,CAOA,gBAAAqN,CAAiBG,GACf,IACE,MAAMG,EAAcF,aAAaG,QAAQJ,GACzC,OAAIG,QACK,KAEFjP,KAAK+D,MAAMkL,EACpB,OAAS3N,GAIP,OADAyN,aAAaI,WAAWL,GACjB,IACT,CACF,CAOA,iBAAAF,GACE,MAAMQ,EAAe,CACnBvB,aAActS,KAAKsS,aACnBC,YAAavS,KAAKuS,YAClBC,SAAUxS,KAAKwS,SACfC,aAAczS,KAAKyS,aACnBC,UAAW1S,KAAK0S,UAChBE,WAAY5S,KAAK4S,WACjBD,aAAc3S,KAAK2S,aACnBE,iBAAkB7S,KAAK6S,kBAEzB7S,KAAKsT,iBAAiBjB,GAAYwB,EAEpC,CAKA,iBAAAd,GACE,MAAMe,EAAe9T,KAAKoT,iBAAiBf,IACvCyB,IAGF9T,KAAKsS,aAAewB,EAAaxB,cAAgB,GACjDtS,KAAKuS,YAAcuB,EAAavB,aAAe,CAAA,EAC/CvS,KAAKwS,SAAWsB,EAAatB,UAAY,GACzCxS,KAAKyS,aAAeqB,EAAarB,cAAgB,KACjDzS,KAAK0S,UAAYoB,EAAapB,WAAa,CAAA,EAC3C1S,KAAK4S,WAAakB,EAAalB,YAAc,CAAA,EAC7C5S,KAAK2S,aAAemB,EAAanB,cAAgB,CAAA,EACjD3S,KAAK6S,iBAAmBiB,EAAajB,kBAAoB,CAAA,EAK7D,CAaA,uBAAAkB,CAAwBC,EAAQC,GAC9B,IACGD,GACiB,iBAAXA,IACNC,GACmB,iBAAbA,EAGP,OAAOD,EAIT,IAAA,MAAWT,KAAOS,EACZtG,OAAOwG,UAAUC,eAAeC,KAAKJ,EAAQT,KAEzCA,KAAOU,UACJD,EAAOT,IAMpB,IAAA,MAAWA,KAAOU,EAEhB,GAAIvG,OAAOwG,UAAUC,eAAeC,KAAKH,EAAUV,GAAM,CACvD,MAAMc,EAAeJ,EAASV,GACxBe,EAAcN,EAAOT,GAGrBA,KAAOS,EAkBa,iBAAjBK,GACU,OAAjBA,GACCE,MAAMC,QAAQH,IACQ,iBAAhBC,GACS,OAAhBA,GACCC,MAAMC,QAAQF,IAGftU,KAAK+T,wBAAwBO,EAAaD,GAxBhB,iBAAjBA,GACU,OAAjBA,GACCE,MAAMC,QAAQH,GAINE,MAAMC,QAAQH,GAEvBL,EAAOT,GAAO,IAAIc,GAGlBL,EAAOT,GAAOc,EANdL,EAAOT,GAAOvT,KAAK+T,wBAAwB,CAAA,EAAIM,EAuBrD,CAGF,OAAOL,CACT,CAQA,gBAAAhB,GACE,MAAMyB,EAAqB/G,OAAOgH,OAAO1C,IACzC,IAAI2C,GAAgB,EAGf3U,KAAK2S,cAA6C,iBAAtB3S,KAAK2S,eAEpC3S,KAAK2S,aAAe,CAAA,EACpBgC,GAAgB,GAIlB,IAAA,MAAWC,KAAYH,EACfG,KAAY5U,KAAK2S,eAErB3S,KAAK2S,aAAaiC,GAAYjD,GAA6BI,QAC3D4C,GAAgB,EAyBtB,CAOA,oBAAA1B,GAEE,MAAM4B,EAAgB7U,KAAK4S,YAAYkC,gBAAgB,GACjDC,EAAkBF,GAAeG,aAAe,SAIhDC,EAAyB,CAC7BC,SAAUH,EACVlQ,KAAM,CACJyI,MANiBtN,KAAKmV,gBAAgBJ,IAAoB,cAO1DrL,iBAAkB,GAClB5E,QAAQ,GAEVsQ,WAAY,CACVC,YAAa,EACbC,MAAO,EACPC,kBAAmB,EACnBC,iBAAkB,EAClBC,kBAAkB,GAEpBC,iBAAkB,CAChBC,KAAMpE,GAAiBC,KACvBoE,MAAO,IAET7K,eAAgB,CACd8K,QAAS,GACT7K,QAAS,IAEX8K,cAAe,CACblV,OAAQ,CACNmV,iBAAiB,EAEjBC,cAAe,CACbC,eAAe,EACfC,gBAAgB,EAChBC,aAAa,GAEfC,eAAgB,CAEd,CAACpE,GAA4BC,YAC3BN,GAA6BI,QAC/B,CAACC,GAA4BE,aAC3BP,GAA6BI,QAC/B,CAACC,GAA4BG,mBAC3BR,GAA6BI,QAC/B,CAACC,GAA4BI,mBAC3BT,GAA6BI,YAQlC/R,KAAK6S,kBAAqD,iBAA1B7S,KAAK6S,mBAIxC7S,KAAK6S,iBAAmB,CAAA,GAS1B7S,KAAK6S,iBAAmB7S,KAAK+T,wBAC3B/T,KAAK6S,iBACLoC,EAQJ,CAKA,aAAAoB,GACE,OAAOrW,KAAK4S,UACd,CAMA,aAAA0D,CAAcjS,GACZrE,KAAK4S,WAAa,IAAKvO,GAIvB,MAAMyQ,cAAEA,EAAgB,GAAAyB,cAAIA,EAAgB,CAAA,GAAOvW,KAAK4S,WACxD,GAAIkC,EAAc7T,OAAS,EAAG,CAC5B,MAAMuV,EAAqB1B,EAAc,IAAIE,YAC7ChV,KAAKyW,uBAAuB,KAAM,CAAEvB,SAAUsB,IAG9C,IAAIE,EAA0B5B,EAAc,IAAIyB,eAG3CG,GAA2BH,EAAcC,KAC5CE,EAA0BH,EAAcC,IAGtCE,GACF1W,KAAKyW,uBAAuB,OAAQ,CAClCnJ,MAAOoJ,GAQb,CASA,GAHA1W,KAAKqT,oBAGDrT,KAAK8S,mBACP,IACE9S,KAAK8S,mBAAmB9S,KAAK4S,WAC/B,OAAS7M,GAET,CAEJ,CAMA,qBAAA4Q,CAAsBC,GACpB5W,KAAK8S,mBAAqB8D,CAC5B,CAMA,gBAAAC,CAAiBC,GAEf,MAAMC,EAAgB,IACjB/W,KAAK4S,cACLkE,GAGL9W,KAAKsW,cAAcS,EACrB,CAGA,eAAAC,GAEE,OADkBhX,KAAK4S,YAAYkC,eAAiB,IACnCxL,IAAK4L,IAAA,CACpB+B,MAAO/B,EAASF,YAChBkC,MAAOhC,EAASF,YAChBvU,YAAayU,EAASzU,cAE1B,CAGA,sBAAA0W,CAAuBC,GACrB,MACMC,GADYrX,KAAK4S,YAAYkC,eAAiB,IAC5BxM,KAAKgP,GAAKA,EAAEtC,cAAgBoC,GACpD,OAAKC,EACEA,EAAM5W,YADM,IAErB,CAGA,eAAA0U,CAAgBD,GAEd,MACMqC,GADYvX,KAAK4S,YAAYkC,eAAiB,IACnBxM,KAAKgP,GAAKA,EAAEtC,cAAgBE,GAC7D,OAAIqC,GAAgBhB,cACXgB,EAAehB,cAIjBvW,KAAK4S,YAAY2D,gBAAgBrB,EAC1C,CAGA,gBAAAsC,GACE,OAAO9J,OAAO+J,QAAQlG,IAAkBjI,IAAI,EAAEiK,EAAK0D,MAAK,CACtDA,QACAC,MAAO3D,IAEX,CAGA,YAAAmE,CAAaxC,GACX,OAAKA,EAGElV,KAAK0S,YAAYwC,IAAa,GAF5BlV,KAAK0S,WAAa,CAAA,CAG7B,CAGA,YAAAiF,CAAaC,GACX5X,KAAK0S,UAAYkF,EAEjB5X,KAAKqT,mBACP,CAGA,kBAAAwE,GAEE,MAAMC,EAAY9X,KAAK4S,YAAYkC,eAAiB,GAC9CiD,EAAkB,CAAA,EASxB,OAPAD,EAAUzV,QAAQ6S,IACZA,EAASF,aAAeE,EAASqB,gBACnCwB,EAAgB7C,EAASF,aAAeE,EAASqB,iBAKT,IAAxC7I,OAAOC,KAAKoK,GAAiB9W,QAAgBjB,KAAK4S,YAAY2D,cACzDvW,KAAK4S,WAAW2D,cAGlBwB,CACT,CAGA,gBAAAC,CAAiB9C,EAAU5H,GAEzB,OADuBtN,KAAK0S,YAAYwC,IAAa,IAC/BpM,KAAMmP,GAC1BA,EAAWL,OAAOhS,SAAS0H,GAE/B,CAGA,aAAAO,CAAcP,GACZ,IAAA,MAAW4H,KAAYlV,KAAK0S,UAAW,CACrC,MACMwF,GADiBlY,KAAK0S,UAAUwC,IAAa,IACtB5M,KAAM2P,GACjCA,EAAWL,OAAOhS,SAAS0H,IAE7B,GAAI4K,SAAcA,EAAMC,KAC1B,CAEF,CAGA,uBAAAC,GAEE,OAAOzG,EACT,CAGA,eAAA0G,GACE,OAAOrY,KAAK2S,YACd,CAMA,eAAA2F,CAAgBC,GAEdvY,KAAK2S,aAAe,IAAK4F,GAKzBvY,KAAKyW,uBAAuB,iBAAkB,IAAKzW,KAAK2S,cAC1D,CAOA,sBAAA8D,CAAuBxT,EAAM6T,GAC3B,IAAInC,GAAgB,EAEpB,GACE1R,GACAjD,KAAK6S,iBAAiB5P,IACiB,iBAAhCjD,KAAK6S,iBAAiB5P,GAC7B,CAEA,MAAMuV,EAA0B/T,KAAKC,UACnC1E,KAAK6S,iBAAiB5P,IAExBjD,KAAK6S,iBAAiB5P,GAAQ,IACzBjD,KAAK6S,iBAAiB5P,MACtB6T,GAIHrS,KAAKC,UAAU1E,KAAK6S,iBAAiB5P,MAAWuV,IAEhD7D,GAAgB,EAEpB,KAAA,IAAY1R,EAkBV,OAlBgB,CAEhB,MAAMwV,EAAyB,IAAKzY,KAAK6S,kBACzC7S,KAAK6S,iBAAmB,IACnB7S,KAAK6S,oBACLiE,GAIHrS,KAAKC,UAAU+T,KACfhU,KAAKC,UAAU1E,KAAK6S,oBAEpB8B,GAAgB,EAEpB,CAKA,CAEIA,GAMF3U,KAAKqT,mBAIT,CAOA,mBAAAzO,CAAoBsQ,GAElB,IAAKlV,KAAK6S,kBAAqD,iBAA1B7S,KAAK6S,iBAExC,MAAO,GAET,IAAI6F,EACJ,IACEA,EAAejU,KAAK+D,MAAM/D,KAAKC,UAAU1E,KAAK6S,kBAChD,OAASpL,GAEP,MAAO,EACT,CAGA,GAAIyN,GAAYA,IAAawD,EAAaxD,SAAU,CAClD,MAAMwB,EAA0B1W,KAAKmV,gBAAgBD,GACjDwB,IAIFgC,EAAaxD,SAAWA,EACxBwD,EAAa7T,KAAKyI,MAAQoJ,EAO9B,CACA,OAAOgC,CACT,CASA,aAAAC,CAAcC,GACZ,IAAKA,IAAsBrE,MAAMC,QAAQoE,GACvC,MAAO,GAGT,MAAMC,MAAyBzK,IAEF,iBAAlBpO,KAAKwS,UAA2C,OAAlBxS,KAAKwS,UAC5C9E,OAAOgH,OAAO1U,KAAKwS,UAAUnQ,QAASyW,IAEhCA,GAAsC,iBAAhBA,GACxBpL,OAAOC,KAAKmL,GAAazW,QACtB0W,GAAaF,EAAmBpI,IAAIsI,MAM7C,MAAMC,EAAiBJ,EAAkBpV,OAAOuV,GACvCF,EAAmBrI,IAAIuI,IAGhC,GAAIC,EAAe/X,OAAS2X,EAAkB3X,OAAQ,CAC/B2X,EAAkBpV,OACpCuV,IAAcF,EAAmBrI,IAAIuI,GAG1C,CAEA,OAAOC,CACT,CAQA,oBAAAhT,CAAqB3B,GACnB,IAAKA,GAA4B,iBAAXA,EAEpB,OAAOA,EAIT,IAAI4U,EAAiBxU,KAAK+D,MAAM/D,KAAKC,UAAUL,IAiB/C,OAfArE,KAAK+T,wBAAwBkF,EAAgBjZ,KAAK6S,kBAIhDoG,EAAevD,kBACfnB,MAAMC,QAAQyE,EAAevD,iBAAiBE,OAE7CqD,EAAevD,iBAAiBE,MAAQ5V,KAAK2Y,cAC3CM,EAAevD,iBAAiBE,OAE1BqD,EAAevD,mBAExBuD,EAAevD,iBAAiBE,MAAQ,IAGnCqD,CACT,CAOA,kBAAM/F,GACJ,IACE,MAAMnO,QAAiBvC,MAAM,qBAC7B,IAAKuC,EAASmU,GACZ,MAAM,IAAIhT,MACR,gBAAgBnB,EAASb,UAAUa,EAASoU,cAGhD,MAAM/W,QAAa2C,EAASqU,OAGxBhX,GAAQA,EAAKA,MAAQA,EAAKA,KAAKwT,MACjC5V,KAAKwS,SAAWpQ,EAAKA,KAAKwT,MAM1B5V,KAAKwS,SAAW,EAEpB,OAASzM,GAIT,CACF,CAKA,sBAAMoN,GACJ,IACE,MAAMpO,QAAiBvC,MAAM,uBAC7B,IAAKuC,EAASmU,GACZ,MAAM,IAAIhT,MACR,qBAAqBnB,EAASb,UAAUa,EAASoU,cAGrD,MAAM/W,QAAa2C,EAASqU,OAGxBhX,GAAQA,EAAKiX,SAAWjX,EAAKA,MAAQA,EAAKA,KAAKgF,SACjDpH,KAAKyS,aAAerQ,EAAKA,KAAKgF,QAG9BpH,KAAKqT,qBAGLrT,KAAKyS,aAAe,IAExB,OAAS1M,GAGT,CACF,GC5wBIrD,GAAS,IFGA,cAAqBhB,GAClC,WAAAC,CAAY0C,GACV9B,QACAvC,KAAKsZ,QAAS,EACdtZ,KAAKgE,GAAK,KACVhE,KAAK+N,KAAO,KACZ/N,KAAKuZ,aAAc,EACnBvZ,KAAKwZ,YAAc,GACnBxZ,KAAK2C,OAAS,KACd3C,KAAKyZ,GAAK,KACVzZ,KAAK0Z,OAAS,KACd1Z,KAAK2G,OAAS,KACd3G,KAAK2Z,QAAU,KACf3Z,KAAKyG,MAAQ,MACbzG,KAAK0G,KAAO,OACZ1G,KAAKqE,OAASA,EAEdrE,KAAK4Z,gBAAkBpa,EAASQ,KAAK4Z,gBAAgBC,KAAK7Z,MAAO,IACnE,CAMA,aAAM8Z,GACJ,MAAMC,EAAgB/Z,KAAKqE,OAAOgS,gBACQ,IAAtC3I,OAAOC,KAAKoM,GAAe9Y,aACvBjB,KAAKga,sBAEXha,KAAKga,qBACLha,KAAKia,aAAaF,IAGpB,MAAMvG,QAAqBxT,KAAKka,kBAC5B1G,GACFxT,KAAKma,iBAAiB3G,GAGxBxT,KAAKsZ,QAAS,EACdtZ,KAAKmC,KAAK,SACZ,CAEA,iBAAAiY,CAAkBC,GAChB,GAAIA,EAAKC,eAAgB,CAEvB,MAAM7H,EAAe,CACnBzO,GAAIhE,KAAKua,YACT7T,KAAM,SACNL,WAAY,EACZD,aAAc,EACdO,OAAQ,aAAa3G,KAAK0Z,QAAU,aACpCjT,MAAO,KACPG,SAAU,EACVQ,QAAS,CAAA,EACTL,YAAY4I,UAEd3P,KAAKwa,YAAY,SAAU/H,EAC7B,CAEA,MAAMrL,EAAUpH,KAAKqE,OAAOO,sBAItB6V,EAAW,GACjB,IAAA,MAAWlH,KAAOvT,KAAKqE,OAAOmO,SAC5BiI,EAASvY,QAAQwL,OAAOC,KAAK3N,KAAKqE,OAAOmO,SAASe,KAEpDnM,EAAQsO,iBAAiBE,MAAQ6E,EAEjC,MAAM5H,EAAmB,CACvB7O,GAAIhE,KAAKua,YACT7T,KAAM,SACNC,OAAQ,4BACRN,WAAY,EACZD,aAAc,EACdK,MAAO,OACPG,SAAU,EACVG,YAAY4I,SACZvI,WAGFpH,KAAKwa,YAAY,SAAU3H,EAC7B,CAEA,iBAAM2H,CAAYhU,EAAUnC,GAC1B,MAAMqW,EAAM,IAAIpU,GAAUE,EAAUnC,GACpCqW,EAAIlN,WACJkN,EAAIrN,aAKJ,OAHasN,EAAS3a,KAAKwZ,aACtBtX,KAAKwY,SACJ1a,KAAK4Z,kBACJc,CACT,CAEA,WAAAE,CAAY5W,GACV,MAAM6W,EAAOF,EAAS3a,KAAKwZ,aACrBxW,EAAQ6X,EAAKhT,UAAWiT,GAASA,EAAK9W,IAAMA,IAErC,GAAThB,IACF6X,EAAKtP,OAAOvI,EAAO,GACnBhD,KAAK4Z,kBAET,CAEA,4BAAMmB,CAAuBC,GAC3B,MAAM1L,EAAO,iBAAiB0L,IAC9B,IAAIC,EAAY,KAChB,IACE,MAAMhK,QAAYzO,MAAM8M,GAClBlN,QAAa6O,EAAImI,OACvB,OAAiB,GAAbhX,EAAK2L,OACPkN,EAAY7Y,EAAKA,KAAK6Y,UAEjBjb,KAAKkb,aAAaD,EAAUjX,KAC/BhE,KAAKwa,YAAYS,EAAUzU,SAAUyU,IAEhC,EAKX,OAASlV,GAEP,OAAO,CACT,CACF,CAEA,oBAAMoV,CAAenX,GACnB,MAAMoX,QAAqBpb,KAAKqb,qBAAqBrX,GACrD,OAAIoX,GAGK,IAEX,CAEA,0BAAMC,CAAqBrX,GACzB,MACMsX,EAAO,CACXL,UAAWjb,KAAKkb,aAAalX,IAE/B,IACE,MAAMiN,QAAYzO,MALP,iBAKmB,CAC5B+Y,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElBF,KAAM7W,KAAKC,UAAU4W,KAEjBlZ,QAAa6O,EAAImI,OACvB,GAAiB,GAAbhX,EAAK2L,KACP,OAAO3L,EAAKA,IAEhB,OAAS2D,GAEP,OAAO,IACT,CACF,CAEA,WAAM0V,GACJnK,EAAYoK,QACZlI,aAAakI,QACb,UACQ1b,KAAK2b,YACb,OAAS5V,GAET,CACA,OAAO,CACT,CAEA,gBAAM4V,GACJ,IAEMC,UAAUC,cAAcC,kBAIpB,IAAIxL,QAAQ,CAACI,EAASH,KAC1B,MAAMwL,EAAiB,IAAIC,eAC3BD,EAAeE,MAAMC,UAAaC,IACR,sBAApBA,EAAM/Z,KAAKa,KAEbyN,IAC6B,2BAApByL,EAAM/Z,KAAKa,KAKpBsN,EAAO4L,EAAM/Z,KAAK2D,OAElBwK,EAAO,IAAIrK,MAAM,yCAGrB6V,EAAeE,MAAMG,QAAWrW,IAE9BwK,EAAOxK,IAET6V,UAAUC,cAAcC,WAAWO,YACjC,CAAEpZ,KAAM,mBACR,CAAC8Y,EAAeO,UAUtB,MAAMC,QAAsBX,UAAUC,cAAcW,mBACpD,GAAID,GAAiBA,EAActb,OAAS,EAI1C,IAAA,MAAWwb,KAAgBF,EAEzB,UAC6BE,EAAaC,YAU1C,OAAS3W,GAMT,CASJ,OAAO,CACT,OAASA,GAEP,MAAMA,CACR,CACF,CAEA,SAAA4W,GAEE,QADenJ,aAAaG,QAAQ,YAMtC,CAEA,YAAAiJ,GACEpJ,aAAaC,QAAQ,aAAa,EACpC,CAEA,UAAMoJ,SACE7c,KAAK8Z,UACP9Z,KAAK2c,cAEP3c,KAAKuZ,aAAc,EACnBvZ,KAAK8c,MAAM9c,KAAK+N,MAIpB,CAEA,aAAAgP,GACE,OAAO/c,KAAKwZ,WACd,CAEA,YAAA0B,CAAalX,EAAIgZ,EAAW,MAC1B,OAAIA,EAEKhd,KAAKwZ,YAAYlR,KAAMwS,GAA0B,UAAjBA,EAAKtU,UAErCxG,KAAKwZ,YAAYlR,KAAMwS,GAASA,EAAK9W,IAAMA,EAEtD,CAOA,SAAAuW,GAEE,MAAMzN,EAAYjJ,KAAKmD,MAAMsF,WAAW1C,OAAM,GAI9C,OAFkBtI,KAAKC,MAAsB,IAAhBD,KAAKE,UAAgB8K,WAAWC,SAAS,EAAG,KAEtDO,CACrB,CAMA,qBAAMoN,GACJ,MAAMxX,QAAe4O,EAAYqC,QAAQ,UACzC,GAAIjR,EAAQ,CAEV,OADoB+B,KAAK+D,MAAM9F,EAEjC,CAIE,OAFA1C,KAAKgE,GAAKhE,KAAKua,YACfva,KAAK+N,KAAO,KACL,IAEX,CAMA,gBAAAoM,CAAiBzX,GACf1C,KAAKgE,GAAKtB,EAAOsB,GACjBhE,KAAK+N,KAAOrL,EAAOqL,KAGfrL,EAAO8W,aAA4C,GAA7B9W,EAAO8W,YAAYvY,OAC3CjB,KAAKwZ,YAAc9W,EAAO8W,YAAYlQ,IACnCwR,GAAS,IAAIxU,GAAUwU,EAAKtU,SAAUsU,IAGzC9a,KAAKwZ,YAAc,EAEvB,CAKA,qBAAMI,GAEJ,MAAMlX,EAAS,CACbsB,GAAIhE,KAAKgE,GACT+J,KAAM/N,KAAK+N,KACXyL,YAAaxZ,KAAKwZ,mBAEdlI,EAAYmC,QAAQ,SAAUhP,KAAKC,UAAUhC,GAErD,CAOA,WAAMoa,CAAM/O,GAGV,OAFA/N,KAAK+N,KAAOA,EAEL,IAAIuC,QAAQ,CAACI,EAASH,KAC3B,MAAM5N,EAAS,IAAImL,GAAO9N,KAAKgE,GAAIhE,KAAK+N,MAExCpL,EAAOd,GAAG,UAAWob,MAAO5C,IAE1Bra,KAAKuZ,aAAc,EACnBvZ,KAAK2C,OAASA,EACd3C,KAAKqE,OAAOsT,aAAa0C,EAAKzC,QAC9B5X,KAAKkd,iBAC0B,GAA3Bld,KAAKwZ,YAAYvY,QACnBjB,KAAKoa,kBAAkBC,GAEzBra,KAAK4c,eACL5c,KAAK4Z,kBACLlJ,EAAQ2J,KAGV1X,EAAOd,GAAG,gBAAkBkE,IAE1B/F,KAAKuZ,aAAc,EACnBhJ,EAAOxK,EAAMjD,WAGfH,EAAOqN,WAEX,CAEA,cAAAkN,GACEld,KAAK2C,OAAOd,GAAG,iBAAmB4F,IAEhC,MAAMrF,EAAOqF,EAAErF,KACT4B,EAAK5B,EAAK4B,GACVD,EAAU3B,EAAK2B,QACfd,EAAOb,EAAKa,KAElB,GAAY,WAARA,EAAmB,CACrB,MAAMgY,EAAYjb,KAAKkb,aAAalX,EAAI,KACpCiX,IACFA,EAAU5P,WAAWtH,GACrB/D,KAAK4Z,kBAIT,MAAA,GAAmB,WAAR3W,EAAmB,CAC5B,MAAMka,EAAmBnd,KAAKwZ,YAAYhW,OACvCsX,GAA0B,UAAjBA,EAAKtU,UAEjB,IAAA,MAAW4W,KAAmBD,EAAkB,CAE9C,GADgBC,EAAgBzR,WAAW5H,EAAQE,YACtC,CACXjE,KAAK4Z,kBAEL,KACF,CACF,CACF,IAGF5Z,KAAK2C,OAAOd,GAAG,cAAgB4F,IAC7B,MAAMrF,EAAOqF,EAAErF,MACT+C,SAAEA,GAAa/C,EACrB,GAAI+C,EAASc,YAAa,CACxB,MAAMgV,EAAYjb,KAAKkb,aAAa/V,EAASc,aACzCgV,GACFA,EAAUjS,sBAAsBvB,EAGpC,IAGFzH,KAAK2C,OAAOd,GAAG,iBAAmB4F,IAChC,IAEE,GAAIA,GAAgB,mBAAXA,EAAExE,MAA6BwE,EAAErF,KAAM,CAC9C,MAAM0V,UAAEA,EAAAF,OAAWA,EAAArB,cAAQA,GAAkB9O,EAAErF,KAS/C,GANIwV,GAAU5X,KAAKqE,QAA8C,mBAA7BrE,KAAKqE,OAAOsT,cAC9C3X,KAAKqE,OAAOsT,aAAaC,GAKvBE,GAAa9X,KAAKqE,QAAkD,mBAAjCrE,KAAKqE,OAAOwS,iBACjD,IAE0BiB,EAAUhP,KAAKwO,QAAyB,IAApBA,EAAEf,eAI5CvW,KAAKqE,OAAOwS,iBAAiB,CAAE/B,cAAegD,IAG9C9X,KAAKqE,OAAOwS,iBAAiB,CAAE/B,cAAegD,EAAWvB,iBAG7D,OAAS8G,GAET,CAKF,YADArd,KAAKmC,KAAK,iBAAkB,CAAE2V,YAAWF,UAE3C,CAGF,OAASyF,GAET,GAEJ,CAKA,YAAMC,GACJtd,KAAKuZ,aAAc,EACnBvZ,KAAK2C,OAAOwM,aACZnP,KAAK2C,OAAS,KACd3C,KAAK4Z,iBACP,CAMA,wBAAMI,GACJ,MAAM/I,QAAYzO,MAAM,mBAClBJ,KAAEA,SAAe6O,EAAImI,OAI3B,OAHApZ,KAAKqE,OAAOiS,cAAclU,GAC1BpC,KAAKia,aAAa7X,GAEXA,CACT,CAEA,YAAA6X,CAAa7X,GACXpC,KAAKud,SAAWnb,EAAKmb,SACrBvd,KAAK0Z,OAAStX,EAAKsX,OAEnB1Z,KAAK2G,OAAS,aAAa3G,KAAKud,WAEhC,MAAMH,EAAkBpd,KAAKkb,aAAa,KAAM,KAC5CkC,IACFA,EAAgBzW,OAAS,aAAa3G,KAAK0Z,SAE/C,CAUA,gBAAM8D,CAAWC,EAAarW,EAAU,IACtC,MAAMsW,QAAEA,GAAU,EAAAC,WAAOA,EAAa,MAASvW,EAG/C,GACEsW,GACwB,iBAAhBD,GAA4BA,EAAYG,WAAW,SAE3D,OAAO5d,KAAK6d,YAAYJ,GAG1B,MAAMta,EAAOsa,EACb,OAAO,IAAInN,QAAQ,CAACI,EAASH,KAC3B,MAAMuN,EAAY,QAClB,IAAIC,EAAU,KAEd,MAuBMC,EAAcf,MAAOhY,EAAOjC,EAAOib,IAChC,IAAI3N,QAAQ,CAACI,EAASH,KAC3B,MAAM2N,EAAW,IAAIC,SACrBD,EAASE,OAAO,OAAQnZ,GACxBiZ,EAASE,OAAO,MAAOL,GACvBG,EAASE,OAAO,aAAcpb,GAC9Bkb,EAASE,OAAO,cAAeH,GAC/BC,EAASE,OAAO,WAAYjb,EAAKuD,MAEjC,MAAM2X,EAAM,IAAIC,eAChBD,EAAIE,KAAK,OAAQ,qBAAqB,GAGlCZ,IACFU,EAAIG,OAAOC,WAActC,IACvB,GAAIA,EAAMuC,iBAAkB,CAE1B,MAAMC,EAAgBxC,EAAMyC,OAASzC,EAAM0C,MACrCC,EAEJ,KADC9b,EAAQib,EAAe,EAAIA,EAAeU,GAE7ChB,EAAWrc,KAAKyd,MAAMD,GACxB,IAIJT,EAAIW,OAAS,KACPX,EAAIna,QAAU,KAAOma,EAAIna,OAAS,IACpCwM,IAEAH,EAAO8N,EAAIlF,aAIfkF,EAAIjC,QAAU,KACZ7L,EAAO,kBAGT8N,EAAIla,KAAK+Z,KAIPe,EAAmBhC,UACvB,IAAK9Z,IAAS4a,EACZ,OAAOxN,EAAO,CAAExK,MAAO,iCAGzB,MAAMkY,EAAc3c,KAAK4d,KAAK/b,EAAKgc,KAAOrB,GAE1C,IACE,IAAA,IACMsB,EAAe,EACnBA,EAAenB,EACfmB,IACA,CACA,MAAM5V,EAAQ4V,EAAetB,EACvBrU,EAAMnI,KAAK+d,IAAI7V,EAAQsU,EAAW3a,EAAKgc,MACvCla,EAAQ9B,EAAKyG,MAAMJ,EAAOC,SAE1BuU,EAAY/Y,EAAOma,EAAcnB,EACzC,MAnFmBhB,OAAOgB,IAC5B,IACE,MAAMlZ,QAAiBvC,MAAM,uBAAwB,CACnD+Y,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3BF,KAAM7W,KAAKC,UAAU,CACnBuZ,cACAqB,IAAKvB,EACLwB,SAAUpc,EAAKuD,SAInB,IAAK3B,EAASmU,GACZ,MAAM,IAAIhT,MAAM,cAAcnB,EAASb,UAGzC,MAAM9B,QAAa2C,EAASqU,OAC5B1I,EAAQtO,EACV,OAAS2D,GACPwK,EAAO,CAAExK,MAAO,uBAAuBA,EAAMjD,WAC/C,GAkEQ0c,CAAevB,EACvB,OAASlY,GACPwK,EAAO,CAAExK,MAAO,iBAAiBA,KACnC,GAII0Z,EAAS,IAAIC,EACnBD,EAAOpD,YAAY,CAAElZ,OAAM2a,cAE3B2B,EAAOvD,UAAazU,IACdA,EAAErF,KAAKud,MACT5B,EAAUtW,EAAErF,KAAKud,KAEjBV,KACSxX,EAAErF,KAAK2D,QAChBwK,EAAO,CAAExK,MAAO0B,EAAErF,KAAK2D,QACvB0Z,EAAOG,cAIXH,EAAOrD,QAAWrW,IAEhBwK,EAAO,CAAExK,MAAO,iBAAiBA,EAAMjD,YACvC2c,EAAOG,cAGb,CAOA,iBAAM/B,CAAYK,GAChB,IACE,MAAMnZ,QAAiBvC,MAAM,oBAAqB,CAChD+Y,OAAQ,OACRD,KAAM4C,IAER,IAAKnZ,EAASmU,GACZ,MAAM,IAAIhT,MAAM,cAAcnB,EAASb,UAEzC,aAAaa,EAASqU,MACxB,OAASrT,GAEP,MAAMA,CACR,CACF,CAOA,0BAAM8Z,CAAqBC,GACzB,OAAO,IAAIxP,QAAQ,CAACI,EAASH,KAC3B,MAAMwP,EAAS,IAAIC,WACnBD,EAAOE,UAAY,IAAMvP,EAAQqP,EAAO7e,QACxC6e,EAAO3D,QAAU7L,EACjBwP,EAAOG,cAAcJ,IAEzB,GEzqBwBzb,IAE1B3B,GAAOma,mFCTDsD,GACE,OADFA,GAEK,UAFLA,GAGM,WAHNA,GAIE,OA6GDC,GAAA,CAAApc,GAAG,WACDqc,GAAA,CAAAC,MAAM,gBArHfC,GAAA,CAAA,WAyHSvc,GAAG,OAAOsc,MAAM,WACdE,GAAA,CAAAF,MAAM,WAYNG,GAAA,CAAAH,MAAM,yBA7HF,CACble,KAAA,KACS,CACLse,eAAgB,uBAChBC,WAAYR,KAGhBS,SAAU,CACR,YAAAC,GACE,OAAO7gB,KAAK2gB,aAAeR,EAC7B,EACA,eAAAW,GACE,OAAO9gB,KAAK2gB,aAAeR,EAC7B,GAEFY,MAAO,CACLC,OAAQ,CACN,OAAArb,CAAQsb,GACNjhB,KAAK2gB,WAAa3gB,KAAKkhB,uBAAuBD,EAChD,EACAE,WAAW,IAGf,OAAAC,GACEphB,KAAK2gB,WAAa3gB,KAAKkhB,yBACvB,MAAMG,EAAU3e,GAAO6a,SACnB8D,EACFrhB,KAAKqN,WAAWgU,GAEhB3e,GAAOb,GACL,SACA,KACE,MAAMwf,EAAU3e,GAAO6a,SACvBvd,KAAKqN,WAAWgU,KAElB,EAGN,EACAC,QAAS,CACPrE,mBAAmBsE,GACV,IAAIjR,QAAQ,CAACI,EAASH,KAC3B,MAAMiR,EAASC,SAASC,cAAc,UAChCC,EAAMH,EAAOI,WAAW,MACxBC,EAAM,IAAIC,MAChBD,EAAIE,IAAMR,EACVM,EAAI7C,OAAS,KACXwC,EAAOQ,MAAQH,EAAIG,MACnBR,EAAOS,OAASJ,EAAII,OAEpBN,EAAIO,UAAUL,EAAK,EAAG,GAEtB,IAAIM,EAAsB,GAAZN,EAAIG,MACdI,EAAuB,IAAbP,EAAII,OACdI,EAAU,EAAI,GAAMR,EAAIG,MAC5BL,EAAIW,YACJX,EAAIY,IAAIJ,EAASC,EAASC,EAAQ,EAAa,EAAV/gB,KAAKkhB,IAAQ,GAClDb,EAAIc,OACJd,EAAIe,UAAU,EAAG,EAAGb,EAAIG,MAAOH,EAAII,QAEnCT,EAAOmB,OAAQ7C,IACb,MAAMrd,EAAM4L,IAAIuU,gBAAgB9C,GAChCpP,EAAQjO,IACP,cAELof,EAAIzF,QAAWrW,IACbwK,EAAOxK,MAIb,YAAM8c,GACJ7iB,KAAK2gB,WAAaR,GAClBngB,KAAK8iB,QAAQ5gB,KAAK,CAAEwE,KAAM,SAC5B,EACA,eAAMqc,GACJ/iB,KAAK2gB,WAAaR,GAClBngB,KAAK8iB,QAAQ5gB,KAAK,CAAEwE,KAAM,cAC5B,EACA,cAAMsc,GACJhjB,KAAK2gB,WAAaR,GAClBngB,KAAK8iB,QAAQ5gB,KAAK,CAAEwE,KAAM,YAC5B,EACA,gBAAM2G,CAAWgU,GACf,MAAM4B,EAAc,aAAa5B,IACjC,IACErhB,KAAK0gB,qBAAuB1gB,KAAKkjB,aAAaD,EAChD,OAASld,GAET,CACF,EACA,sBAAAmb,CAAuBiC,EAAQnjB,KAAKghB,QAClC,MAAmB,MAAfmC,EAAM7T,MAAgB6T,EAAM7T,KAAK1J,SAAS,UACrCua,GAEQ,gBAAfgD,EAAM7T,MACN6T,EAAM7T,KAAK1J,SAAS,aAEbua,GACiB,cAAfgD,EAAM7T,KACR6Q,GAEFA,EACT,qCAKF,OAAAiD,IAAAC,EA+BM,MA/BNjD,GA+BM,CA9BJkD,EAGM,MAHNjD,GAGM,aAFJiD,EAA0B,MAAA,CAArBhD,MAAM,UAAQ,MAAA,IACnBgD,EAAgD,MAAA,CAA1CvB,IAAKwB,EAAA7C,eAAgB8C,IAAI,gBAvHrC,KAAA,EAAAjD,MAyHI+C,EAyBM,MAzBNG,GAyBM,CAxBJH,EAWM,MAXN9C,GAWM,CAVJ8C,EAIM,MAAA,CAJDhD,MA3HboD,EAAA,CA2HmB,YAAW,CAAA5c,OAAmB6c,EAAA9C,kBACvCyC,EAEM,MAAA,CAFDtf,GAAG,WAAY4f,4BAAOD,EAAAd,QAAAc,EAAAd,UAAAjjB,kBACzB0jB,EAA6B,IAAA,CAA1BhD,MAAM,iBAAe,MAAA,UAG5BgD,EAIM,MAAA,CAJDhD,MAhIboD,EAAA,CAgImB,YAAW,CAAA5c,OAAmB6c,EAAA7C,qBACvCwC,EAEM,MAAA,CAFDtf,GAAG,UAAW4f,4BAAOD,EAAAZ,WAAAY,EAAAZ,aAAAnjB,kBACxB0jB,EAA6B,IAAA,CAA1BhD,MAAM,iBAAe,MAAA,YAI9BgD,EAWM,MAXN7C,GAWM,aAVJ6C,EAMI,IAAA,CALF9U,KAAK,iDACLwF,OAAO,SACPsM,MAAM,cAENgD,EAA+B,IAAA,CAA5BhD,MAAM,0BAEXgD,EAEM,MAAA,CAFDhD,MAAM,YAAasD,4BAAOD,EAAAX,UAAAW,EAAAX,YAAApjB,kBAC7B0jB,EAA6B,IAAA,CAA1BhD,MAAM,iBAAe,MAAA,gDCxGlC,IAAIuD,GAAa,iBAEF,CACbC,MAAO,CACLC,WAAY,CACV9gB,KAAM4N,QACNmT,SAAS,IAGbC,MAAO,CAAC,aAAa,SACrB7hB,KAAA,KACS,CACL8hB,SAAS,EACTC,WAAY7V,OAAO8V,YAAa9V,OAAO+V,uBAG3C,OAAAC,GAGkB,SAFE,IAAIC,gBAAgBjW,OAAOC,SAASiW,QAC5BC,IAAI,aAE5BzkB,KAAKkkB,SAAU,GAEblkB,KAAKmkB,UACPN,GAAa,IAAIa,EAAO,QAE5B,EACApD,QAAS,CACP,OAAAqD,GACM3kB,KAAK4kB,SACP5kB,KAAK4kB,SAAS,CAAE9hB,QAAS,UAAWG,KAAM,YAG1C4hB,MAAM,UAEV,EAEA,mBAAMC,GACJ,IACE,OAAKjB,IAEI,IAGX,OAAS9d,GAEP,OAAO,IACT,CACF,EAEA,oBAAMgf,GACJ,GAAI/kB,KAAKmkB,QACP,GAAIN,GACF,UACQA,GAAWmB,UACnB,OAASvd,GAEPzH,KAAK2kB,SACP,MAEA3kB,KAAK2kB,eAIP3kB,KAAKilB,MAAM,QAEf,EAEA,gBAAAC,CAAiBnB,GACX/jB,KAAKmkB,QACP,WACE,GAAIN,GACF,IACME,QACIF,GAAWsB,iBAEXtB,GAAWuB,aAEnBplB,KAAKilB,MAAM,aAAclB,EAC3B,OAAStc,GAEPzH,KAAK2kB,SACP,MAEA3kB,KAAK2kB,SAET,EAhBA,GAkBA3kB,KAAKilB,MAAM,aAAclB,EAE7B,EAEA,iBAAMsB,GACJ,GAAIrlB,KAAKmkB,QACP,GAAIN,GACF,UACQA,GAAWyB,OACnB,OAAS7d,GAEPzH,KAAK2kB,SACP,MAEA3kB,KAAK2kB,eAIP3kB,KAAKilB,MAAM,QAEf,gDAjJF5B,EAgCK,KAAA,CA/BF/C,MAFLoD,EAAA,iCAE+D6B,EAAAxB,mBAA2BR,EAAAW,UAKtF,yBAAuB,SAEvBZ,EAEK,KAAA,CAFDhD,MAAM,SAAS,yBAAA,GAAwBsD,4BAAOD,EAAAoB,gBAAApB,EAAAoB,kBAAAnlB,kBAChD0jB,EAAiC,OAAA,CAA3BhD,MAAM,cAAa,KAAC,MAGpBiF,EAAAxB,gBADRV,EASK,KAAA,CArBT9P,IAAA,EAcM+M,MAAM,SACN,yBAAA,GACCsD,uBAAOD,EAAAuB,kBAAgB,kBAExB5B,EAEO,OAAA,CAFDhD,MAAM,gBAAc,CACxBgD,EAAqC,IAAA,CAAlChD,MAAM,wCAGb+C,EAOK,KAAA,CA7BT9P,IAAA,EAwBM+M,MAAM,SACN,yBAAA,GACCsD,uBAAOD,EAAAuB,kBAAgB,kBAExB5B,EAAiC,OAAA,CAA3BhD,MAAM,cAAa,KAAC,OAE5BgD,EAEK,KAAA,CAFDtf,GAAG,QAAQsc,MAAM,SAAS,yBAAA,GAAwBsD,4BAAOD,EAAA0B,aAAA1B,EAAA0B,eAAAzlB,kBAC3D0jB,EAAyC,OAAA,CAAnChD,MAAM,gBAAe,KAAO,8CCxB/BF,GAAA,CAAApc,GAAG,oBASHqc,GAAA,CAAArc,GAAG,oBAGHuc,GAAA,CAAAD,MAAM,oBAKNmD,GAAA,CAAAnD,MAAM,YAxBf/M,IAAA,EA8B4CvP,GAAG,QAAQsc,MAAM,gBAC9CG,GAAA,CAAAH,MAAM,UA/BrBkF,GAAA,CAAA,MAAA,OAkCeC,GAAA,CAAAnF,MAAM,OACJoF,GAAA,CAAApF,MAAM,aACJqF,GAAA,CAAArF,MAAM,SACNsF,GAAA,CAAAtF,MAAM,oBA0DV,CACb5Z,KAAM,aACNmf,WAAY,YACVC,EACAC,mBAEFjC,MAAO,CACLzgB,SAAU,CACRJ,KAAMsR,MACNyP,QAAS,IAAM,IAEjB/I,UAAW,CACThY,KAAMyK,OACNsW,QAAS,SAGb5hB,KAAA,KAMS,CACL4jB,SAAS,EACTrM,SAAS,EACTsM,WARiB,CACjB,CACEC,OAAQC,MASd,OAAA7B,GACEtkB,KAAK2Z,QAAUrL,OAAO8X,WAAa,IAEnC1jB,GAAOb,GACL,gBACCoB,IAEGjD,KAAK2Z,QADK,UAAR1W,IAMN,EAEJ,uGAzIF,OAAAmgB,IAAAC,EAAAgD,EAAA,KAAA,CACE/C,EAgBM,MAAA,CAfJtf,GAAG,sBACFsc,MAHLoD,EAGYH,EAAA5J,QAAO,WAAA,IACdiK,uBAAOL,EAAAyC,SAAO,KAEfM,EAAA,KAAAA,EAAA,GAAAhD,EAAwC,MAAA,CAAnCtf,GAAG,oBAAmB,WAAO,IAClCsf,EAQM,MARNlD,GAQM,QAPJiD,EAMMgD,EAAA,KAdZE,EASmChB,EAAAliB,SAASuG,MAAK,EAAA,GATjD,CASgB9G,EAASE,SADnBqgB,EAMM,MAAA,CAJJrf,GAAG,sBACFuP,IAAKvQ,KAEHuiB,EAAAtK,UAAUvU,MAAO,OAAK6e,EAAAtK,UAAU9T,sBAAsBrE,IAAO,aAGpEwgB,EAA6D,MAA7DjD,GAA2B,OAAKkF,EAAAliB,SAASpC,QAAS,QAAK,OAE9CsiB,EAAAyC,aAAX3C,EAoEM,MAAA,CAtFR9P,IAAA,EAkBsBvP,GAAG,kBAAmBsc,MAlB5CoD,EAkBmDH,EAAA5J,QAAO,WAAA,MACtD2J,EAIM,MAJN/C,GAIM,CAHJ+F,EAAA,KAAAA,EAAA,GAAAhD,EAA4C,MAAA,CAAvChD,MAAM,qBAAoB,WAAO,IACtCkG,EAA4DC,EAAA,CAA5CnG,MAAM,WAAYoG,uBAAOnD,EAAAyC,SAAO,OAGlD1C,EA6DM,MA7DNG,GA6DM,EA5DJL,GAAA,GAAAC,EA2DMgD,OApFZE,EA0BmChB,EAAAliB,SA1BnC,CA0BgBP,EAASE,SADnBqgB,EA2DM,MAAA,CAzDH9P,IAAKvQ,EACNsd,MAAM,sBAEiB,SAAZxd,EAAQG,MAAnBmgB,IAAAC,EAqDM,MArDN7C,GAqDM,CApDJ8C,EAEM,MAFN7C,GAEM,CADJ6C,EAAwE,MAAA,CAAlEvB,IAAG,cAAgBjf,EAAQV,KAAKukB,MAAQnD,IAAK1gB,EAAQV,KAAKsE,MAhC5E,KAAA,EAAA8e,MAkCUlC,EAgDM,MAhDNmC,GAgDM,CA/CJnC,EAGM,MAHNoC,GAGM,CAFJpC,EAA8C,MAA9CqC,GAA8CiB,EAAxBrB,EAAAtK,UAAUxU,OAAK,GACrC6c,EAA+C,MAA/CsC,GAA+CgB,EAA1B9jB,EAAQV,KAAKsE,MAAI,YAExC2c,EA0CMgD,EAAA,KAjFlBE,EAwCoCzjB,EAAQV,KAAK2B,QAxCjD,CAwCsBgF,EAAI/F,SADdqgB,EA0CM,MAAA,CAxCH9P,IAAKvQ,EACNsd,MAAM,YAENgD,EAoCM,MAAA,KAAA,CAlCY,SAARva,EAAI9F,UADZ4jB,EAKEC,EAAA,CAlDlBvT,IAAA,EA+CmBwT,GAAIhe,EAAI3G,KAAK2F,KACbif,MAAO,SACP,sBAAqB,CAAAC,QAAA,oBAgBC,UAAZC,EAAAnkB,QAAQE,UADrB4jB,EAMEC,EAAA,CAJCC,GAAE,YAAcG,EAAAnkB,QAAQX,KAAKe,QAC7BoQ,IAAK2T,EAAAnkB,QAAQX,KAAKe,KAClB,iBAAgBogB,EAAA0C,WAChBe,MAAO,2CAGW,UAARje,EAAI9F,UADjB4jB,EAIEM,EAAA,CA3ElB5T,IAAA,EAyEmB0H,UAAWiM,EAAAE,gBACX/jB,SAAU0F,EAAI3G,KAAKiB,iDAEtBwjB,EAGEC,EAAA,CA/ElBvT,IAAA,EA8EmBwT,GAAE,aAAehe,EAAI9F,yCA9ExCokB,EAAA,IAAA,oBAAAA,EAAA,IAAA,4CCCOjH,GAAA,CAAAE,MAAM,aACJD,GAAA,CAAAC,MAAM,WACJC,GAAA,CAAAD,MAAM,YAKNmD,GAAA,CAAAnD,MAAM,YACNE,GAAA,CAAAF,MAAM,YAKNG,GAAA,CAAAH,MAAM,YAINkF,GAAA,CAAAlF,MAAM,YAINmF,GAAA,CAAAnF,MAAM,YASNoF,GAAA,CAAApF,MAAM,YAMRqF,GAAA,CAAArF,MAAM,aACJsF,GAAA,CAAAtF,MAAM,6BAeF,CACbwD,MAAO,CACLsD,gBAAiB,CACfnkB,KAAMyK,OACN4Z,UAAU,IAGdrD,MAAO,CAAC,WAAY,eAAgB,cAAe,WAAY,UAC/D7hB,KAAA,KACS,CACLmlB,eAAgB,KAChBC,eAAgB,GAChBC,WAAW,EACXC,aAAc,KACdC,cAAe,GACflZ,KAAM,GACNmZ,SAAU,CAAEC,MAAO,GAAIC,OAAQ,IAC/BC,WAAW,IAGfnH,SAAU,CACR,YAAAoH,GACE,MAAqC,UAAjChoB,KAAKonB,gBAAgB5gB,SAChBxG,KAAK0nB,aAEL1nB,KAAK2nB,aAEhB,GAEF5G,MAAO,CACL,qBACE/gB,KAAKioB,cACP,GAEF,OAAA3D,GACEtkB,KAAKioB,eACLjoB,KAAKkoB,sBAAwB1oB,EAASQ,KAAKmoB,qBAAsB,IACnE,EACA,OAAA/G,GACEphB,KAAKooB,YAAcpoB,KAAKqoB,MAAMC,SAC9BtoB,KAAKooB,YAAYG,iBAAiB,QAASvoB,KAAKkoB,uBAGhDloB,KAAKwoB,eAAkB/gB,IACrBA,EAAEghB,iBACFzoB,KAAKooB,YAAYM,MAAMC,gBAAkB,WAE3C3oB,KAAK4oB,gBAAmBnhB,IACtBA,EAAEghB,iBACFzoB,KAAKooB,YAAYM,MAAMC,gBAAkB,WAE3C3oB,KAAK6oB,WAAcphB,IACjBA,EAAEghB,iBACFzoB,KAAKooB,YAAYM,MAAMC,gBAAkB,UACzC,MAAMd,EAAQpgB,EAAEqhB,aAAajB,MACzBA,EAAM5mB,OAAS,GACjBjB,KAAK+oB,kBAAkBlB,EAAM,KAGjC7nB,KAAKooB,YAAYG,iBAAiB,WAAYvoB,KAAKwoB,gBACnDxoB,KAAKooB,YAAYG,iBAAiB,YAAavoB,KAAK4oB,iBACpD5oB,KAAKooB,YAAYG,iBAAiB,OAAQvoB,KAAK6oB,YAE/C7oB,KAAKooB,YAAYG,iBAAiB,QAASvoB,KAAKgpB,aAEhDhpB,KAAKyO,KAAOH,OAAOC,SAAS0a,OAC5BjpB,KAAK2nB,cAAgBtjB,GAAOoO,cAAcyW,YAAY9hB,SAAW,EACnE,EACA,SAAA+hB,GACEnpB,KAAKooB,YAAYgB,oBAAoB,QAASppB,KAAKmoB,sBACnDnoB,KAAKooB,YAAYgB,oBAAoB,WAAYppB,KAAKwoB,gBACtDxoB,KAAKooB,YAAYgB,oBAAoB,YAAappB,KAAK4oB,iBACvD5oB,KAAKooB,YAAYgB,oBAAoB,OAAQppB,KAAK6oB,YAClD7oB,KAAKooB,YAAYgB,oBAAoB,QAASppB,KAAKgpB,aACnDhpB,KAAKooB,YAAc,IACrB,EACA9G,QAAS,CACP,cAAA+H,GACErpB,KAAK4kB,SAAS0E,QAAQ,SACxB,EACA,QAAAC,GAEE,MAAMC,EAAUxpB,KAAKooB,aAAaqB,UAAUC,OACtCC,EAAW3pB,KAAKooB,aAAawB,cAAc,OACjD,OAAOJ,GAAWG,CACpB,EACA,iBAAAZ,CAAkB5lB,GACZA,EAAKF,KAAK2a,WAAW,UACvB5d,KAAK6pB,kBAAkB1mB,GAEvBnD,KAAKwd,WAAWra,EAEpB,EAEA2mB,WAAW/hB,GACOA,EACb3E,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,SAIdA,QAAQ,MAAO,gBACfA,QAAQ,MAAO,QAIpB,kBAAA2mB,CAAmBC,GACjB,MAAMC,EAAY3b,OAAO4b,eACzB,IAAKD,GAAsC,IAAzBA,EAAUE,WAI1B,OAFAnqB,KAAKooB,YAAYgC,WAAaJ,OAC9BhqB,KAAKqqB,eAAerqB,KAAKooB,aAG3B,MAAMkC,EAAQL,EAAUM,WAAW,GACnCD,EAAME,iBAGN,MAAMC,EAAShJ,SAASC,cAAc,OACtC+I,EAAOL,UAAYJ,EAEnB,MAAMU,EAAOjJ,SAASkJ,yBACtB,KAAOF,EAAOG,YACZF,EAAKG,YAAYJ,EAAOG,YAG1BN,EAAMQ,WAAWJ,GAGjBJ,EAAMS,UAAS,GACfd,EAAUe,kBACVf,EAAUgB,SAASX,EACrB,EAGA,WAAAtB,CAAYvhB,GACVA,EAAEghB,iBACF,MAAMyC,EAAgBzjB,EAAEyjB,eAAiB5c,OAAO4c,cAC1CC,EAAQD,EAAcC,MAC5B,IAAIC,EAAa,GACjB,MAAMC,EAAa,GAEnB,IAAA,IAASjqB,EAAI,EAAGA,EAAI+pB,EAAMlqB,OAAQG,IAAK,CACrC,MAAM0Z,EAAOqQ,EAAM/pB,IACgB,IAA/B0Z,EAAK7X,KAAK0F,QAAQ,SACpB0iB,EAAWnpB,KAAK4Y,EAAKwQ,aACE,eAAdxQ,EAAK7X,OACdmoB,GAAcF,EAAcK,QAAQ,cAExC,CAEA,GAAIH,EAAY,CACd,MAAMpB,EAAOhqB,KAAK8pB,WAAWsB,GAC7BprB,KAAK+pB,mBAAmBC,EAC1B,CAEIqB,EAAWpqB,SACbjB,KAAK4kB,SAASvK,KAAK,OAAOgR,EAAWpqB,sBACrCnB,WAAW,KACTE,KAAKwrB,kBAAkBH,IACtB,GAEP,EAGA,QAAAI,CAAShkB,GACP,MAAMikB,EAAUjkB,EAAEpC,OAAOqmB,QAEzB1rB,KAAK+pB,mBAAmB/pB,KAAK8pB,WAAW4B,IACxC1rB,KAAK2rB,gBACP,EAGA,cAAAtB,CAAetnB,GACbA,EAAQ6oB,QACR,MAAM3B,EAAY3b,OAAO4b,eACnBI,EAAQ7I,SAASoK,cACvBvB,EAAMwB,mBAAmB/oB,GACzBunB,EAAMS,UAAS,GACfd,EAAUe,kBACVf,EAAUgB,SAASX,EACrB,EAGA,uBAAMkB,CAAkB3D,GACtB,IAAA,MAAW1kB,KAAQ0kB,QACX7nB,KAAK6pB,kBAAkB1mB,SAEvB,IAAImN,QAAQyb,GAAKjsB,WAAWisB,EAAG,GAEzC,EAEA,iBAAAlC,CAAkB1mB,GAChB,OAAO,IAAImN,QAASI,IAClB,MACMsb,EAAcC,QAEdpK,EAAM,IAAIC,MACVoK,EAAU7d,IAAIuU,gBAAgBzf,GACpC0e,EAAIE,IAAMmK,EAEVrK,EAAI7C,OAAS,KACX3Q,IAAI8d,gBAAgBD,GAEpB,MAAME,EAAWjpB,EAAKF,KAAKopB,cAG3B,GAAiB,cAAbD,EAA0B,CAC5B,GAAIjpB,EAAKgc,KAAO6M,EAGd,OAFAhsB,KAAK4kB,SAAS7e,MAAM,uBACpB2K,IAGF,MAAMwN,EAAW,IAAIC,SAWrB,OAVAD,EAASE,OAAO,QAASjb,EAAMA,EAAKuD,WACpChE,GAAOmb,YAAYK,GAChB/M,KAAMqN,IACL,MAAM+C,EAAW/C,EAAOpc,KAAKK,IAC7BzC,KAAK4nB,SAASE,OAAO5lB,KAAKqf,GAC1BvhB,KAAKssB,sBAAsB/K,EAAUpe,EAAKuD,MAC1C1G,KAAK4kB,SAASvL,QAAQ,eAEvBjI,MAAM,IAAMpR,KAAK4kB,SAAS7e,MAAM,cAChCsL,QAAQX,EAEb,CAGA,MAAM8Q,EAASC,SAASC,cAAc,UAChCC,EAAMH,EAAOI,WAAW,MAI9B,IAAI2K,EAAUC,EAHdhL,EAAOQ,MAAQH,EAAIG,MACnBR,EAAOS,OAASJ,EAAII,OACpBN,EAAIO,UAAUL,EAAK,EAAG,GAEL,cAAbuK,EACFG,EAAW,YACW,eAAbH,GACTG,EAAW,aACXC,EAAU,KAEVD,EAAW,aACXC,EAAU,IAEZhL,EAAOmB,OACJ7C,IACC,IAAKA,EAGH,OAFA9f,KAAK4kB,SAAS7e,MAAM,eACpB2K,IAGF,GAAIoP,EAAKX,KAAO6M,EAGd,OAFAhsB,KAAK4kB,SAAS7e,MAAM,2BACpB2K,IAGF,MAAMwN,EAAW,IAAIC,SACrBD,EAASE,OAAO,QAAS0B,EAAM3c,EAAKuD,MACpChE,GAAOmb,YAAYK,GAChB/M,KAAMqN,IACL,MAAM+C,EAAW/C,EAAOpc,KAAKK,IAC7BzC,KAAK4nB,SAASE,OAAO5lB,KAAKqf,GAC1BvhB,KAAKssB,sBAAsB/K,EAAUpe,EAAKuD,MAC1C1G,KAAK4kB,SAASvL,QAAQ,YAEvBjI,MAAM,IAAMpR,KAAK4kB,SAAS7e,MAAM,SAChCsL,QAAQX,IAEb6b,EACAC,KAIR,EACA,cAAAb,GACE3rB,KAAKynB,WAAaznB,KAAKynB,UACRznB,KAAKooB,YACbwD,OACT,EACA,UAAApO,CAAWra,GACT,GAAIA,aAAgBspB,KAElB,YADAzsB,KAAK0sB,iBAAiBvpB,GAGxB,MAEMwpB,EAAYlL,SAASC,cAAc,SACzCiL,EAAU1pB,KAAO,OACjB0pB,EAAUC,OAAS,CAHU,OAAQ,MAAO,MAAO,OAAQ,OAD5B,MAAO,MAAO,OAAQ,QAKlDtjB,IAAKujB,GAAW,IAAIA,KACpB1jB,KAAK,KACR,MAAM2jB,EAAe7P,MAAOxV,IAC1BklB,EAAUvD,oBAAoB,SAAU0D,GACxC,MAAM3pB,EAAOsE,EAAEuM,OAAO6T,MAAM,GACvB1kB,GACLnD,KAAK0sB,iBAAiBvpB,IAExBwpB,EAAUpE,iBAAiB,SAAUuE,GACrCH,EAAUI,OACZ,EACA,gBAAAL,CAAiBvpB,GACXA,EAAKgc,KAAO,SACdnf,KAAK4kB,SAAS7e,MAAM,oBAGtB/F,KAAK4kB,SAASvK,KAAK,YACflX,EAAKF,KAAK2a,WAAW,UACvB5d,KAAK6pB,kBAAkB1mB,GAEvBnD,KAAKgtB,mBAAmB7pB,GAE5B,EACA,wBAAM6pB,CAAmB7pB,GACvB,IACE,MAAMqb,QAAe9b,GAAO8a,WAAWra,GACvCnD,KAAK4kB,SAASvL,QAAQ,UACtB,MAAM4T,EAAU,GAAGzO,EAAOpc,KAAKK,YAAYU,EAAKgc,aAAahc,EAAKuD,OAC5DoF,EAAY9L,KAAKonB,gBAAgBlc,uBACvCY,EAAU/H,QAAQ7B,KAAK,CACrBe,KAAM,OACNb,KAAM,CAAEe,KAAMnD,KAAKyO,KAAOwe,KAE5BjtB,KAAKonB,gBAAgBjc,QAAQW,GAAW,EAC1C,OAAS/F,GAEP/F,KAAK4kB,SAAS7e,MAAM,eACtB,CACA/F,KAAKilB,MAAM,UACXjlB,KAAKilB,MAAM,WACb,EACA,qBAAAqH,CAAsB/K,EAAU2L,GAC9B,MAAMC,EAAe1L,SAASC,cAAc,OAC5CyL,EAAapL,IAAMR,EACnB4L,EAAa3J,IAAM0J,EACnBC,EAAazE,MAAM0E,SAAW,QAC9BD,EAAazE,MAAM2E,UAAY,QAC/B,MAAM/C,EAAQ7I,SAASoK,cACvBvB,EAAMwB,mBAAmB9rB,KAAKooB,aAC9BkC,EAAMS,UAAS,GACf,MAAMd,EAAY3b,OAAO4b,eACzBD,EAAUe,kBACVf,EAAUgB,SAASX,GACnB,MAAMgD,EAAWhD,EAAMiD,yBACrB,SAASJ,EAAaK,oBAExBlD,EAAMQ,WAAWwC,GACjBxtB,WAAW,KACT,MAAM2tB,EAAWhM,SAASoK,cAC1B4B,EAAS3B,mBAAmB9rB,KAAKooB,aACjCqF,EAAS1C,UAAS,GAClB,MAAM2C,EAAepf,OAAO4b,eAC5BwD,EAAa1C,kBACb0C,EAAazC,SAASwC,IACrB,EACL,EACA,mBAAAE,GACE,MAAMC,EAAYlrB,GAAO2B,OAAOqT,eAChC1X,KAAK0nB,aAAeha,OAAO+J,QAAQmW,GAAWtkB,IAAI,EAAE4L,EAAU0C,MACrD,CACLX,MAAO/B,EACPgC,MAAOhC,EACP2Y,SAAUjW,EAAOtO,IAAK2O,IACb,CACLhB,MAAOgB,EAAWE,MAClBjB,MAAOe,EAAWE,MAClB0V,SAAU5V,EAAWL,OAAOtO,IAAKgE,IACxB,CAAE2J,MAAO3J,EAAO4J,MAAO5J,UAM1C,EACAwgB,oBAAoBxgB,GAEX,CADO5K,GAAO2B,OAAOwJ,cAAcP,GAC3BA,GAEjB,QAAAygB,CAASC,GACP,MAAMC,EAASjuB,KAAKkuB,kBACpB,IAAKluB,KAAKunB,iBAAmB0G,EAAQ,OAAOD,EAE5C,OAAOC,EAAO7qB,QADG,QACe4qB,EAClC,EACA,eAAAE,GACE,MAAMD,EAASjuB,KAAK2nB,cACjBwG,OAAO,CAACC,EAAM,GAAItT,IAEV,IAAIsT,KADCtT,EAAK+S,UAAY,CAAC/S,IAE7B,IACFxS,KAAM+lB,GAAUA,EAAMpX,OAASjX,KAAKunB,iBAAiB0G,OACxD,OAAOA,CACT,EACA,YAAAhG,GACwC,WAAlCjoB,KAAKonB,gBAAgB5gB,SACnBxG,KAAKonB,gBAAgB6G,SACvBjuB,KAAKunB,eAAiBvnB,KAAKonB,gBAAgB6G,SAG7CjuB,KAAK2tB,sBACL3tB,KAAKunB,eAAiBvnB,KAAKonB,gBAAgBhgB,QAAQvC,KAAKyI,MAE5D,EACA,oBAAA6a,GACE,MAAMG,EAAWtoB,KAAKooB,YACtBE,EAASI,MAAMzG,OAAS,OACxBqG,EAASI,MAAMzG,OAASqG,EAASgG,aAAe,IAClD,EACA,aAAAC,GACE,MAAMN,EAASjuB,KAAKkuB,kBACpB,MAAsC,WAAlCluB,KAAKonB,gBAAgB5gB,UAAyBynB,GAC3CjuB,KAAKunB,eACH0G,EAAO7qB,QAAQ,IAAK,IAAIA,QAAQ,QAAS,IAEzC,EAEX,EACA,oBAAAorB,GACE,MAAMvE,EAAY3b,OAAO4b,eACzB,GAAKD,GACDA,EAAUE,WAAa,EAAG,CAC5B,MAAMG,EAAQL,EAAUM,WAAW,GACnCvqB,KAAKwnB,eAAe,GAAK8C,EAAMmE,YAC/BzuB,KAAKwnB,eAAe,GAAK8C,EAAMoE,SACjC,CACF,EACA,OAAAC,GACE3uB,KAAKooB,YAAYwD,QACjB,MAAM9D,EAAS9nB,KAAKooB,YAAYwG,iBAAiB,OAC3CC,EAAYta,MAAMua,KAAKhH,GAAQxe,IAAKuY,GAAQA,EAAIE,KACtD,IAAIlY,EAAM7J,KAAK+uB,YAAY/uB,KAAKooB,YAAYqB,WAC5C,MAAMuF,EAC8B,WAAlChvB,KAAKonB,gBAAgB5gB,SAAwBxG,KAAK+tB,SAASlkB,GAAOA,EACpE7J,KAAKooB,YAAYgC,UAAY,GAC7BpqB,KAAKmoB,uBACL,MAAMrc,EAAY9L,KAAKonB,gBAAgBlc,uBAmBvC,OAlBI8jB,EAAetF,QACjB5d,EAAU/H,QAAQ7B,KAAK,CACrBe,KAAM,OACNb,KAAM,CAAE2F,KAAMinB,KAGlBH,EAAUxsB,QAAS4sB,IACjBnjB,EAAU/H,QAAQL,QAAQ,CACxBT,KAAM,QACNb,KAAM,CAAEe,KAAM8rB,OAGdjvB,KAAKkvB,kBACPpjB,EAAU/H,QAAQ7B,KAAK,CACrBe,KAAM,QACNb,KAAM,CAAE4B,GAAIhE,KAAKkvB,oBAGdpjB,CACT,EACA,UAAM3H,GACJ,IAAKnE,KAAKupB,WAAY,OACtBvpB,KAAKilB,MAAM,YACX,MAAMnZ,EAAY9L,KAAK2uB,UACvB,IACE,MAAM1qB,QAAmBjE,KAAKonB,gBAAgBjc,QAAQW,GACtDA,EAAU9H,GAAKC,EACfjE,KAAKilB,MAAM,UACXjlB,KAAK4nB,SAASE,OAAS,GACvB9nB,KAAK4nB,SAASC,MAAQ,EACxB,OAAS9hB,GACP/F,KAAK4kB,SAAS7e,MAAM,SACtB,CACF,EACAgpB,YAAYhnB,GACHA,EAET,WAAAonB,GACEnvB,KAAKilB,MAAM,cACb,EACA,aAAAmK,CAAchtB,EAAM+Z,GAClB,GAAoB,IAAhBA,EAAMkT,MAAa,CACrB,IAAKlT,EAAMmT,SAAWnT,EAAMmT,OAAOA,OAEjC,OAEF,MAAMC,EAAiB,CACrBpT,EAAMmT,OAAOA,OAAOltB,KAAK6U,MACzBkF,EAAMmT,OAAOltB,KAAK6U,MAClB7U,EAAK6U,OAEPjX,KAAK4kB,SAAS,CACZ9hB,QAAS,QAAUysB,EAAe,GAAK,MACvCtsB,KAAM,YAER,MAAMusB,EAAkBD,EAAe,GACnCC,IAAoBxvB,KAAKonB,gBAAgBhgB,SAAS8N,UACpDlV,KAAK4kB,SAAS,CACZ9hB,QAAS,QAAU0sB,EAAkB,MACrCvsB,KAAM,YAGVjD,KAAKilB,MAAM,WAAYsK,EACzB,MAA2B,IAAhBpT,EAAMkT,OACuB,WAAlCrvB,KAAKonB,gBAAgB5gB,UACnBxG,KAAKkuB,oBAAsBluB,KAAKkuB,kBAAkBtoB,SAAS,QAC7D5F,KAAKmE,MAIb,EACA,aAAAsrB,CAActT,GACM,UAAdA,EAAM5I,MACJ4I,EAAMuT,QACJ1vB,KAAKupB,WACPvpB,KAAKmE,OAELnE,KAAK4kB,SAAS,CAAE9hB,QAAS,UAAWG,KAAM,YAG5Cwe,SAASkO,YAAY,cAAc,EAAO,OAG9C7vB,WAAW,KACTE,KAAKwuB,wBACJ,EACL,sFA/jBF,OAAApL,IAAAC,EA6CM,MA7CNjD,GA6CM,CA5CJkD,EAiCM,MAjCNjD,GAiCM,CAhCJiD,EAIM,MAJN/C,GAIM,GAHJ+C,EAA0F,eAAA,CAAzDsM,IAAI,cAAeC,iCAAalM,EAAA8H,UAAA9H,EAAA8H,YAAA7rB,mBAA3C2jB,EAAAkE,aACtBnB,EAAA,MAAAA,EAAA,IAAAhD,EAA0B,IAAA,CAAvBhD,MAAM,YAAW,MAAE,IACtBgD,EAA8D,IAAA,CAA3DhD,MAAM,iBAAkBsD,QAAK0C,EAAA,KAAAA,EAAA,GANxCwJ,UAMkDnM,EAAAgI,gBAAAhI,EAAAgI,kBAAA/rB,GAAc,CAAA,iBAE1D0jB,EAKM,MALNG,GAKM,CAJJH,EAAoF,IAApF9C,GAAoFoG,EAArC,UAAxBrB,EAAA6B,gBAAgB5gB,SAAQ,OAAA,QAAA,GAC/CggB,EACsDuJ,EAAA,CADtC/rB,GAAG,kBAV3BgsB,WAUsDzM,EAAAgE,eAVtD,sBAAAjB,EAAA,KAAAA,EAAA,GAAA2J,GAUsD1M,EAAAgE,eAAc0I,GAAG7tB,KAAMuhB,EAAAqE,aAAckI,UAAA,GACjFC,UAAU,YAAaC,YAAYzM,EAAAyL,yEACrC9L,EAA8B,IAAA,CAA3BhD,MAAM,kBAAgB,MAAA,MAE3BgD,EAGM,MAHN7C,GAGM,CAFJ6F,EAAA,MAAAA,EAAA,IAAAhD,EAA4B,IAAA,CAAzBhD,MAAM,YAAW,QAAI,IACxBgD,EAA6D,IAAA,CAA1DhD,MAAM,iBAAkBsD,uBAAOsD,EAAAjC,MAAK,qBAEzC3B,EAGM,MAHNkC,GAGM,CAFJc,EAAA,MAAAA,EAAA,IAAAhD,EAA0B,IAAA,CAAvBhD,MAAM,YAAW,MAAE,IACtBgD,EAAmD,IAAA,CAAhDhD,MAAM,kBAAmBsD,4BAAOD,EAAAnG,YAAAmG,EAAAnG,cAAA5d,QAErC0jB,EAQM,MARNmC,GAQM,CAPJa,EAAA,MAAAA,EAAA,IAAAhD,EAA4B,IAAA,CAAzBhD,MAAM,YAAW,QAAI,IACxBkG,EAKgB6J,EAAA,CALD/P,MAAM,WAAW7Z,MAAM,UAAU,sBAAoB,KAAK,qBAAmB,KAAK0pB,UAAU,MACxGG,yBAASpJ,EAAAjC,MAAK,kBACJsL,YACT,IAAgCjK,EAAA,MAAAA,EAAA,IAAA,CAAhChD,EAAgC,IAAA,CAA7BhD,MAAM,oBAAkB,MAAA,MA3BvCtP,EAAA,MA+BMsS,EAGM,MAHNoC,GAGM,CAFJY,EAAA,MAAAA,EAAA,IAAAhD,EAA0B,IAAA,CAAvBhD,MAAM,YAAW,MAAE,IACtBgD,EAAqD,IAAA,CAAlDhD,MAAM,gBAAiBsD,4BAAOD,EAAA0F,gBAAA1F,EAAA0F,kBAAAzpB,UAIrC0jB,EAQM,MARNqC,GAQM,CAPJrC,EAGM,MAHNsC,GAGM,CAFJtC,EAC+D,MAAA,CAD1DsM,IAAI,WAAWtP,MAAM,aAAakQ,gBAAgB,OACpDC,8BAAS9M,EAAA8L,eAAA9L,EAAA8L,iBAAA7vB,IAAgBgkB,4BAAOD,EAAA6K,sBAAA7K,EAAA6K,wBAAA5uB,iBAErC0jB,EAES,SAAA,CAFDtf,GAAG,aAAc4f,QAAK0C,EAAA,KAAAA,EAAA,GA1CpCwJ,UA0C8CnM,EAAAxf,MAAAwf,EAAAxf,QAAAvE,GAAI,CAAA,cAAE,MAC1CgnB,EAAGjD,EAAA4K,gBAAa,MAAW5K,EAAA4K,kBAAa,IAAA,2CC1C3CnO,GAAA,CAAAE,MAAM,cACJD,GAAA,CAAAC,MAAM,uBAFf/M,IAAA,GAQSkQ,GAAA,CAAAnD,MAAM,mBARfE,GAAA,CAAA,SAUWC,GAAA,CAAAH,MAAM,yBAQF,CACbwD,MAAO,CACLmJ,QAAS,CAEPhqB,KAAMytB,OACNpJ,UAAU,IAGdllB,KAAA,KACS,CACLuuB,UAAW,GACXC,UAAW,GACXC,mBAAoB,KAGxBjQ,SAAU,CACR,SAAAkQ,GAEE,MAAM7tB,EAAOjD,KAAK4wB,UAAUvE,cAE5B,MAAa,QAATppB,EACK,gBACE,CAAC,MAAO,OAAQ,OAAO2C,SAAS3C,GAElC,wBACE,CAAC,MAAO,QAAQ2C,SAAS3C,GAE3B,iBACE,CAAC,MAAO,QAAQ2C,SAAS3C,GAE3B,gBAEA,iBAEX,GAEF,OAAAqhB,GAEE,MAAM7hB,EAAMzC,KAAKitB,QAAQrc,MAAM,KACzBmgB,EAAS,IAAIxM,gBAAgB9hB,EAAI,IACjCuuB,EAAOD,EAAOtM,IAAI,QACxBzkB,KAAK2wB,UAAYI,EAAOtM,IAAI,QAC5BzkB,KAAK6wB,mBAAqB7wB,KAAKixB,eAAeD,GAE9C,MAAMJ,EAAYnuB,EAAI,GAAGmO,MAAM,KAC/B5Q,KAAK4wB,UAAYA,EAAUA,EAAU3vB,OAAS,EAChD,EACAqgB,QAAS,CACP,cAAA2P,CAAeD,GAEb,IAAIE,EAAY,EAChB,KAAOF,GAAQ,MACbA,GAAQ,KACRE,IAEF,OAAOF,EAAKG,QAAQ,GAAK,IANX,CAAC,IAAK,KAAM,MAMWD,EACvC,qCAzEF,OAAA9N,IAAAC,EAaM,MAbNjD,GAaM,CAZJkD,EAKM,MALNjD,GAKM,CAJJiD,EAGM,MAAA,CAHDhD,MAHXoD,EAAA,CAGiB,YAAoBC,EAAAmN,cAEjBvN,EAAAqN,WAAZxN,IAAAC,EAA4D,OALpE9C,GAAAqG,EAKmCrD,EAAAqN,UAAUQ,eAAW,IALxD/J,EAAA,IAAA,SAQI/D,EAKM,MALNG,GAKM,CAJJH,EAA+D,MAAA,CAA1DhD,MAAM,YAAa7Z,MAAO8c,EAAAoN,WAAc/J,EAAArD,EAAAoN,WAAS,EAT5DnQ,IAUM8C,EAEM,MAFN7C,GAEMmG,EADDrD,EAAAqN,UAAUQ,eAAgB,KAAExK,EAAGrD,EAAAsN,oBAAkB,2CCVrDzQ,GAAA,CAAAE,MAAM,iBACJD,GAAA,CAAAC,MAAM,mBAFf/M,IAAA,EAGmC+M,MAAM,yBAHzC/M,IAAA,EAcqC+M,MAAM,sBAd3C/M,IAAA,EAemB+M,MAAM,kBAEhBG,GAAA,CAAAH,MAAM,aAEDkF,GAAA,CAAAlF,MAAM,aAETmF,GAAA,CAAAnF,MAAM,eAIRoF,GAAA,CAAApF,MAAM,cAgCFqF,GAAA,CAAArF,MAAM,gBACJsF,GAAA,CAAAtF,MAAM,iBACJ+Q,GAAA,CAAA/Q,MAAM,gBAMNgR,GAAA,CAAAhR,MAAM,kBAKRiR,GAAA,CAAAjR,MAAM,iBACJkR,GAAA,CAAAlR,MAAM,gBAMNmR,GAAA,CAAAnR,MAAM,8BAWR,CACbwD,MAAO,CACLre,SAAU,CACRxC,KAAMyK,OACN4Z,UAAU,IAGdllB,KAAA,KACS,CACLsvB,eAAe,EACfC,cAAe,CAAA,EACfC,QAAQ,IAGZhR,SAAU,CACR,eAAAiR,GACE,MAC2B,aAAzB7xB,KAAKyF,SAASgD,SAA0BzI,KAAKyF,UAAUvE,QAAQ6E,KAEnE,EACA,YAAA+rB,GACE,MAC2B,aAAzB9xB,KAAKyF,SAASgD,QAAyBzI,KAAKyF,UAAUvE,QAAQ6E,KAElE,EACA,WAAAgsB,GACE,MAA4B,WAAxB/xB,KAAKyF,SAASgD,OAA4B,OAClB,WAAxBzI,KAAKyF,SAASgD,OAA4B,QAClB,WAAxBzI,KAAKyF,SAASgD,OAA4B,QAC1CzI,KAAK6xB,gBAAwB,SAC7B7xB,KAAK8xB,aAAqB,SAClB,MACd,GAEF,OAAA1Q,GAAW,EACXE,QAAS,CACP,qBAAM0Q,CAAgBjqB,GACpB,UACQ6T,UAAUqW,UAAUC,UAAUnqB,GAEhC/H,KAAK4kB,UAAU5kB,KAAK4kB,SAAS,CAAE9hB,QAAS,UAAWG,KAAM,WAC/D,OAASwE,GACHzH,KAAK4kB,UAAU5kB,KAAK4kB,SAAS,CAAE9hB,QAAS,OAAQG,KAAM,SAC5D,CACF,EACA,cAAAkvB,GACE,MAAM7a,EAAItX,KAAKyF,SAASiD,WAClBX,EAAoB,iBAANuP,EAAiBA,EAAI7S,KAAKC,UAAU4S,EAAG,KAAM,GACjEtX,KAAKgyB,gBAAgBjqB,EACvB,EACA,UAAAqqB,GACE,MAAMrG,EAAI/rB,KAAKyF,SAASvE,OAClB6G,EAAoB,iBAANgkB,EAAiBA,EAAItnB,KAAKC,UAAUqnB,EAAG,KAAM,GACjE/rB,KAAKgyB,gBAAgBjqB,EACvB,EACA,eAAAsqB,CAAgBlW,GACdnc,KAAK0xB,eAAiB1xB,KAAK0xB,cACvB1xB,KAAK0xB,eACP1xB,KAAKsyB,mBAELhkB,OAAOia,iBAAiB,SAAUvoB,KAAKsyB,kBACvC7Q,SAAS8G,iBAAiB,QAASvoB,KAAKuyB,cAExCjkB,OAAO8a,oBAAoB,SAAUppB,KAAKsyB,kBAC1C7Q,SAAS2H,oBAAoB,QAASppB,KAAKuyB,YAE/C,EACA,UAAAA,CAAW9qB,GAET,MAAM+qB,EAAOxyB,KAAKyyB,IACZC,EAAI1yB,KAAKqoB,MAAMsK,gBACjBH,IAASA,EAAKI,SAASnrB,EAAEuM,SAAW0e,IAAMA,EAAEE,SAASnrB,EAAEuM,UACzDhU,KAAK0xB,eAAgB,EACrBpjB,OAAO8a,oBAAoB,SAAUppB,KAAKsyB,kBAC1C7Q,SAAS2H,oBAAoB,QAASppB,KAAKuyB,YAE/C,EACA,gBAAAD,GAEE,MAAME,EAAOxyB,KAAKyyB,IAClB,IAAKD,EAAM,OACX,MAAMK,EAAWL,EAAKM,wBAGhBC,EAAOzxB,KAAK0xB,IAAI,EAAGH,EAASE,MAC5BE,EAAaJ,EAASK,OAAS,EAGrClzB,KAAK2xB,cAAgB,CACnBwB,SAAU,QACVC,IAAKH,EAAa,KAClBF,KAAMA,EAAO,KACbM,SAAUR,EAAS7Q,MAAQ,KAC3BsR,OAAQ,KAGVtzB,KAAKuzB,UAAU,KACb,MAAMxvB,EAAU/D,KAAKqoB,MAAMsK,gBAC3B,IAAK5uB,EAAS,OACd,MAAMyvB,EAAczvB,EAAQ+uB,wBACtBW,EAAgBD,EAAYvR,OAC5ByR,EAAeF,EAAYxR,MAGjC,IAAI2R,EAAYZ,EAMhB,GALIY,EAAYD,EAAe,EAAIplB,OAAO8X,aACxCuN,EAAYryB,KAAK0xB,IAAI,EAAG1kB,OAAO8X,WAAasN,EAAe,IAIzDb,EAASK,OAASO,EAAgB,GAAKnlB,OAAOslB,YAAa,CAE7D,MAAMC,EAAQhB,EAASO,IAAMK,EAAgB,EAC7CzzB,KAAK4xB,QAAS,EACd5xB,KAAK2xB,cAAgB,CACnBwB,SAAU,QACVC,IAAKS,EAAQ,KACbd,KAAMY,EAAY,KAClBN,SAAUR,EAAS7Q,MAAQ,KAC3BsR,OAAQ,IAEZ,MACEtzB,KAAK4xB,QAAS,EACd5xB,KAAK2xB,cAAgB,CACnBwB,SAAU,QACVC,IAAKH,EAAa,KAClBF,KAAMY,EAAY,KAClBN,SAAUR,EAAS7Q,MAAQ,KAC3BsR,OAAQ,MAIhB,GAEF,aAAAQ,GACExlB,OAAO8a,oBAAoB,SAAUppB,KAAKsyB,kBAC1C7Q,SAAS2H,oBAAoB,QAASppB,KAAKuyB,WAC7C,oCAhOA,OAAAnP,IAAAC,EAmFM,MAnFNjD,GAmFM,CAlFJkD,EAcM,MAdNjD,GAcM,CAbQsD,EAAAkO,iBAAZzO,IAAAC,EAUO,OAVP9C,GAUO+F,EAAA,KAAAA,EAAA,GAAA,CATLhD,EAQM,MAAA,CARDhD,MAAM,uBAAqB,CAC9BgD,EAMM,MAAA,CALJhD,MAAM,YACNyT,QAAQ,YACRC,MAAM,+BAEN1Q,EAAqC,WAAA,CAA3B2Q,OAAO,+BAINtQ,EAAAmO,kBAAjBzO,EAA8D,OAA9DI,GAAsD,OACtDL,IAAAC,EAA2C,OAA3C7C,OAEF8C,EAOM,MAPN7C,GAOM,CANJ6C,EAEM,MAAA,KAAA,CADJA,EAAoE,OAApEkC,GAAoEoB,EAAzCrB,WAAS7e,KAAKkK,MAAK,SAAA,IAAA,KAEhD0S,EAEM,MAFNmC,GAEMmB,EADDjD,EAAAoO,aAAW,KAGlBzO,EAsBM,MAtBNoC,GAsBM,CArBJpC,EAoBS,SAAA,CAnBPsM,IAAI,kBACHtP,MA5BToD,UA4B0BH,EAAAmO,cAAa,qBAAA,IAC9B9N,4BAAOD,EAAA0O,iBAAA1O,EAAA0O,mBAAAzyB,kBAER0jB,EAcM,MAAA,CAbJoP,EAAE,gBACFpS,MAAM,OACNyT,QAAQ,gBACRG,QAAQ,MACRF,MAAM,6BACN,OAAK,OACLhS,MAAM,KACNC,OAAO,OAEPqB,EAGQ,OAAA,CAFN6Q,EAAE,2sBACF,OAAK,0BAKbtN,EAmCWuN,EAAA,CAnCDC,GAAG,QAAM,CAET9Q,EAAAmO,mBADRrO,EAiCM,MAAA,CAlFZ9P,IAAA,EAmDQqc,IAAI,kBACJtP,MApDRoD,EAAA,CAoDc,iBAAgB,CAAA5c,OACJyc,EAAAmO,qBAAuBnO,EAAAqO,UACxClJ,MAtDT4L,EAsDgB/Q,EAAAoO,eACP/N,QAAK0C,EAAA,KAAAA,EAAA,GAvDdwJ,EAuDQ,OAAW,CAAA,YAEXxM,EAwBM,MAxBNqC,GAwBM,CAvBJrC,EAUM,MAVNsC,GAUM,CATJtC,EAKM,MALN+N,GAKM,CAJJ/K,EAAA,KAAAA,EAAA,GAAAhD,EAAe,YAAT,MAAE,IACRA,EAES,SAAA,CAFDhD,MAAM,WAAYsD,4BAAOD,EAAAwO,gBAAAxO,EAAAwO,kBAAAvyB,IAAgB6G,MAAM,qBACrD6c,EAA2C,IAAA,CAAxChD,MAAM,iBAAiB7Z,MAAM,sBAGpC6c,EAEM,MAFNgO,GAEM1K,EADDrB,EAAA9f,SAASiD,YAAU,KAI1B4a,EAUM,MAVNiO,GAUM,CATJjO,EAKM,MALNkO,GAKM,CAJJlL,EAAA,KAAAA,EAAA,GAAAhD,EAAgB,YAAV,OAAG,IACTA,EAES,SAAA,CAFDhD,MAAM,WAAYsD,4BAAOD,EAAAyO,YAAAzO,EAAAyO,cAAAxyB,IAAY6G,MAAM,sBACjD6c,EAA4C,IAAA,CAAzChD,MAAM,iBAAiB7Z,MAAM,uBAGpC6c,EAEM,MAFNmO,GAEM7K,EADDrB,EAAA9f,SAASvE,QAAM,YA9EhCmmB,EAAA,IAAA,4CCCOjH,GAAA,CAAAE,MAAM,gBACJD,GAAA,CAAAC,MAAM,YACJC,GAAA,CAAAD,MAAM,2BAmBF,CACbwD,MAAO,CACL/f,QAAS,CACPujB,UAAU,EACVrkB,KAAMytB,OACN1M,QAAS,IAEXhc,UAAW,CACTsf,UAAU,EACVrkB,KAAMsxB,QAERtsB,QAAS,CACPqf,UAAU,EACVrkB,KAAMsxB,OACNvQ,QAAS,IAGb5hB,KAAA,KACS,CACLoyB,MAAM,EACNnH,UAAW,SAGfzM,SAAU,CACR,aAAA6T,GACE,GAAIz0B,KAAKiI,QAAS,CAEhB,MAAO,cADUjI,KAAKiI,QAAUjI,KAAKgI,WACN,KAAMmpB,QAAQ,OAC/C,CACE,MAAO,cAEX,GAEF,OAAA/P,GACEphB,KAAK00B,iBACP,EACA,OAAAC,GACE30B,KAAK00B,iBACP,EACApT,QAAS,CACP,UAAAsT,GACE50B,KAAKw0B,MAAQx0B,KAAKw0B,KAClBx0B,KAAK00B,iBACP,EACA,eAAAA,GACM10B,KAAKw0B,KAEPx0B,KAAKqtB,UAAYrtB,KAAKqoB,MAAMwM,cAAcvG,aAAe,GAAK,KAG9DtuB,KAAKqtB,UAAY,KAErB,qCAzEF,OAAAjK,IAAAC,EAiBM,MAjBNjD,GAiBM,CAhBJkD,EAQM,MARNjD,GAQM,CAPJiD,EAAkD,MAAlD/C,GAAkDqG,EAAtBjD,EAAA8Q,eAAa,GACzCnR,EAKS,SAAA,CAJNhD,MALToD,UAK0BH,EAAAiR,KAAI,qBAAA,IACrB5Q,4BAAOD,EAAAiR,YAAAjR,EAAAiR,cAAAh1B,kBAER0jB,EAAkC,IAAA,CAA/BhD,MAAM,wBAAsB,MAAA,UAGnCgD,EAMM,MAAA,CALJsM,IAAI,gBACJtP,MAAM,iBACLoI,MAdP4L,gBAc8B/Q,EAAA8J,eAErB9H,EAAAxhB,SAAO,qDCqCD,CACb2C,KAAM,cACNod,MAAO,CACL7gB,KAAM,CACJA,KAAMytB,OACN1M,QAAS,WAEXlhB,QAAS,CACPG,KAAMyK,OACNsW,QAAS,MAAO,IAElB8Q,YAAa,CACX7xB,KAAMytB,OACN1M,QAAS,IAEX+Q,aAAc,CACZ9xB,KAAMytB,OACN1M,QAAS,KAGb5hB,KAAA,KACS,CACL4yB,MAAM,IAGV/Q,MAAO,CAAC,QAAS,kBACjB3C,QAAS,CACP,WAAA2T,GAEE,MAAMC,EAAKl1B,KAAKyyB,IAChB,IAAKyC,EAAI,OACT,MAAMC,EAAYD,EAAGxM,OAASwM,EAAGxM,MAAMwK,QAA8B,KAApBgC,EAAGxM,MAAMwK,OAC1DlzB,KAAKg1B,OAASG,CAChB,EACA,cAAAC,GAEEp1B,KAAKi1B,aACP,EACA,sBAAMI,GACJr1B,KAAKilB,MAAM,SACX,UACQjlB,KAAKs1B,qBAAqBt1B,KAAK+0B,aACvC,OAAShvB,GAET,CACF,EACA,sBAAMwvB,GACJv1B,KAAKilB,MAAM,SACX,UACQjlB,KAAKw1B,cAAcx1B,KAAK+0B,aAChC,OAAShvB,GAET,CACF,EACA,QAAA0vB,GACE,IAAI1tB,EAAO,GACX/H,KAAK8C,QAAQiB,QAAQ1B,QAASU,IACP,SAAjBA,EAAQE,KACV8E,GAAQhF,EAAQX,KAAK2F,KACK,UAAjBhF,EAAQE,OACjB8E,GAAQ,WAAWhF,EAAQX,KAAKe,WAGpCnD,KAAK01B,oBAAoB3tB,GACzB/H,KAAKilB,MAAM,QACb,EACA,eAAA0Q,GACE31B,KAAK01B,oBAAoB11B,KAAK80B,aAC9B90B,KAAKilB,MAAM,QACb,EACA,YAAAzZ,GACExL,KAAKilB,MAAM,iBAAkB,SAC7BjlB,KAAKilB,MAAM,QACb,EACA,YAAA2Q,GACE51B,KAAKilB,MAAM,iBAAkB,SAC7BjlB,KAAKilB,MAAM,QACb,EACA,aAAA4Q,GACE71B,KAAKilB,MAAM,iBAAkB,UAC7BjlB,KAAKilB,MAAM,QACb,EACA,SAAA6Q,GACE91B,KAAKilB,MAAM,iBAAkB,SAC7BjlB,KAAKilB,MAAM,QACb,EACA,cAAA8Q,GACE/1B,KAAKilB,MAAM,iBAAkB,YAC7BjlB,KAAKilB,MAAM,QACb,EACA,QAAA+Q,GACEh2B,KAAKilB,MAAM,iBAAkB,SAC7BjlB,KAAKilB,MAAM,QACb,EACA,SAAAgR,GACEj2B,KAAKilB,MAAM,iBAAkB,UAC7BjlB,KAAKilB,MAAM,QACb,EAEA,yBAAMyQ,CAAoB3tB,GACxB,IAAIugB,EACJ,IACEA,EAAW7G,SAASC,cAAc,YAClC4G,EAASI,MAAMyK,SAAW,WAC1B7K,EAASI,MAAMqK,KAAO,UACtBzK,EAASrR,MAAQlP,EACjB0Z,SAASnG,KAAKuP,YAAYvC,GAC1BA,EAAS4N,SACT5N,EAAS6N,kBAAkB,EAAG,aACxB1U,SAASkO,YAAY,QAC3B3vB,KAAK4kB,SAAS,CAAE9hB,QAAS,OAAQG,KAAM,WACzC,OAASoa,GAEPrd,KAAK4kB,SAAS,CAAE9hB,QAAS,OAAQG,KAAM,SACzC,CAAA,QACEwe,SAASnG,KAAK8a,YAAY9N,EAC5B,CACF,EAEA,0BAAMgN,CAAqBe,GACzB,IACE,MAAMtxB,QAAiBvC,MAAM6zB,GAC7B,IAAKtxB,EAASmU,GACZ,MAAM,IAAIhT,MAAM,eAElB,MAAM4Z,QAAa/a,EAAS+a,OACtB+B,EAAM,IAAIC,MACVrf,EAAM4L,IAAIuU,gBAAgB9C,GAChC+B,EAAI7C,OAAS/B,UACX,MAAMuE,EAASC,SAASC,cAAc,UACtCF,EAAOQ,MAAQH,EAAIG,MACnBR,EAAOS,OAASJ,EAAII,OACRT,EAAOI,WAAW,MAC1BM,UAAUL,EAAK,EAAG,GAEtB,MAAMyU,QAAgB,IAAIhmB,QAASI,IACjC8Q,EAAOmB,OAAOjS,EAAS,eAEzB,GAAI4lB,EAAS,CACX,MAAMxb,EAAO,IAAIyb,cAAc,CAAE,YAAaD,UACxC1a,UAAUqW,UAAUuE,MAAM,CAAC1b,IACjC9a,KAAK4kB,SAAS,CACZ9hB,QAAS,YACTG,KAAM,WAEV,MACEjD,KAAK4kB,SAAS,CACZ9hB,QAAS,aACTG,KAAM,UAGVoL,IAAI8d,gBAAgB1pB,IAEtBof,EAAIzF,QAAU,KACZpc,KAAK4kB,SAAS,CAAE9hB,QAAS,SAAUG,KAAM,UACzCoL,IAAI8d,gBAAgB1pB,IAEtBof,EAAIE,IAAMtf,CACZ,OAAS4a,GAEPrd,KAAK4kB,SAAS,CAAE9hB,QAAS,SAAUG,KAAM,SAC3C,CACF,EAEA,mBAAMuyB,CAAca,GAClB,IACE,MAAMI,EAAOhV,SAASC,cAAc,KACpC+U,EAAKjoB,KAAO6nB,EACZI,EAAKC,SAAW,YAChBD,EAAK1J,OACP,OAAS1P,GAEPrd,KAAK4kB,SAAS,CAAE9hB,QAAS,SAAUG,KAAM,SAC3C,CACF,GAEF,OAAAme,GAEEphB,KAAKuzB,UAAU,KACbvzB,KAAKi1B,gBAEP3mB,OAAOia,iBAAiB,SAAUvoB,KAAKo1B,eACzC,EACA,OAAAT,GAEE30B,KAAKuzB,UAAU,KACbvzB,KAAKi1B,eAET,EACA,aAAAnB,GACExlB,OAAO8a,oBAAoB,SAAUppB,KAAKo1B,eAC5C,+CAnPA/R,EAiDM,MAAA,CAjDDrf,GAAG,eAAgBsc,MAD1BoD,EAAA,CAAA,YACgDH,EAAAyR,KAAI,eAAkBzR,EAAAyR,SAC9C,WAAJzP,EAAAtiB,MAAhBmgB,IAAAC,EAiBWgD,GAnBf9S,IAAA,GAAA,CAGM+P,EAGM,MAAA,CAHAM,QAAK0C,EAAA,KAAAA,EAAA,GAHjBwJ,UAGwBnM,EAAAmS,WAAAnS,EAAAmS,aAAAl2B,GAAS,CAAA,0BACzB0jB,EAA6B,IAAA,CAA1BhD,MAAM,iBAAe,MAAA,GACxBgD,EAAiB,YAAX,QAAI,MAEZA,EAGM,MAAA,CAHAM,QAAK0C,EAAA,KAAAA,EAAA,GAPjBwJ,UAOwBnM,EAAAoS,gBAAApS,EAAAoS,kBAAAn2B,GAAc,CAAA,0BAC9B0jB,EAA6B,IAAA,CAA1BhD,MAAM,iBAAe,MAAA,IACxBgD,EAAyD,OAAA,KAAAsD,EAAhC,IAAhBrB,EAAAziB,QAAQ8D,SAAQ,OAAA,MAAA,KAE3B0c,EAGM,MAAA,CAHAM,QAAK0C,EAAA,KAAAA,EAAA,GAXjBwJ,UAWwBnM,EAAAqS,UAAArS,EAAAqS,YAAAp2B,GAAQ,CAAA,0BACxB0jB,EAAmC,IAAA,CAAhChD,MAAM,uBAAqB,MAAA,GAC9BgD,EAAe,YAAT,MAAE,MAEVA,EAGM,MAAA,CAHAM,QAAK0C,EAAA,KAAAA,EAAA,GAfjBwJ,UAewBnM,EAAAsS,WAAAtS,EAAAsS,aAAAr2B,GAAS,CAAA,0BACzB0jB,EAAgC,IAAA,CAA7BhD,MAAM,oBAAkB,MAAA,GAC3BgD,EAAe,YAAT,MAAE,aAGZF,IAAAC,EA6BWgD,GAjDf9S,IAAA,GAAA,CAqBiBgS,EAAAuP,iBAAXzR,EAGM,MAAA,CAxBZ9P,IAAA,EAqB+BqQ,QAAK0C,EAAA,KAAAA,EAAA,GArBpCwJ,UAqB2CnM,EAAAgS,iBAAAhS,EAAAgS,mBAAA/1B,GAAe,CAAA,0BAClD0jB,EAA8B,IAAA,CAA3BhD,MAAM,kBAAgB,MAAA,GACzBgD,EAAiB,YAAX,QAAI,OAvBlB+D,EAAA,IAAA,GAyBM/D,EAGM,MAAA,CAHAM,QAAK0C,EAAA,KAAAA,EAAA,GAzBjBwJ,UAyBwBnM,EAAA8R,UAAA9R,EAAA8R,YAAA71B,GAAQ,CAAA,0BACxB0jB,EAA8B,IAAA,CAA3BhD,MAAM,kBAAgB,MAAA,GACzBgD,EAAiB,YAAX,QAAI,MAEDiC,EAAAwP,kBAAX1R,EAGM,MAAA,CAhCZ9P,IAAA,EA6BgCqQ,QAAK0C,EAAA,KAAAA,EAAA,GA7BrCwJ,UA6B4CnM,EAAA0R,kBAAA1R,EAAA0R,oBAAAz1B,GAAgB,CAAA,0BACpD0jB,EAA8B,IAAA,CAA3BhD,MAAM,kBAAgB,MAAA,GACzBgD,EAAiB,YAAX,QAAI,OA/BlB+D,EAAA,IAAA,GAiCiB9B,EAAAwP,kBAAX1R,EAGM,MAAA,CApCZ9P,IAAA,EAiCgCqQ,QAAK0C,EAAA,KAAAA,EAAA,GAjCrCwJ,UAiC4CnM,EAAA4R,kBAAA5R,EAAA4R,oBAAA31B,GAAgB,CAAA,0BACpD0jB,EAA8B,IAAA,CAA3BhD,MAAM,kBAAgB,MAAA,GACzBgD,EAAiB,YAAX,QAAI,OAnClB+D,EAAA,IAAA,GAqCM/D,EAGM,MAAA,CAHAM,QAAK0C,EAAA,KAAAA,EAAA,GArCjBwJ,UAqCwBnM,EAAAnY,cAAAmY,EAAAnY,gBAAA5L,GAAY,CAAA,0BAC5B0jB,EAA8B,IAAA,CAA3BhD,MAAM,kBAAgB,MAAA,GACzBgD,EAAiB,YAAX,QAAI,MAEZA,EAGM,MAAA,CAHAM,QAAK0C,EAAA,KAAAA,EAAA,GAzCjBwJ,UAyCwBnM,EAAAiS,cAAAjS,EAAAiS,gBAAAh2B,GAAY,CAAA,0BAC5B0jB,EAAgC,IAAA,CAA7BhD,MAAM,oBAAkB,MAAA,GAC3BgD,EAAiB,YAAX,QAAI,MAEZA,EAGM,MAAA,CAHAM,QAAK0C,EAAA,MAAAA,EAAA,IA7CjBwJ,UA6CwBnM,EAAAkS,eAAAlS,EAAAkS,iBAAAj2B,GAAa,CAAA,0BAC7B0jB,EAAgC,IAAA,CAA7BhD,MAAM,oBAAkB,MAAA,GAC3BgD,EAAiB,YAAX,QAAI,4jDC6QlB,MAAMnhB,EAAOw0B,EAGPC,EAASC,IAGTC,EAAuB,CAAC,KAAM,KAAM,KAAM,MAC1CC,EAAO,CAAC,MAAO,KAAM,OAGrBC,EAAYpH,EAAI,GAChBqH,EAAiBrH,EAAI,IACrBsH,EAAYtH,EAAI,IAChBuH,EAAmBvH,EAAI,IACvBwH,EAAgBxH,EAAI,IACpBtd,EAAesd,EAAI,IACnByH,EAAgBzH,EAAI,IACpB0H,EAAgB1H,EAAI,IACpB2H,EAAiB3H,EAAI,GACrB4H,EAAoB5H,EAAI,GACxB6H,EAAU7H,EAAI,IACd8H,EAAkB9H,EAAI,GACtB+H,EAAkB/H,EAAI,OACtBgI,EAAoBhI,GAAI,GACxBiI,EAAuBjI,GAAI,GAC3BkI,EAAWlI,GAAI,GAGfmI,EAAoBnX,EAAS,IACA,IAA1B8W,EAAgBzgB,MACnB2gB,EAAkB3gB,MACQ,IAA1BygB,EAAgBzgB,OACd4gB,EAAqB5gB,OAIvB+gB,EAAkBpX,EAAS,IAC3B6W,EAAQxgB,MACHqgB,EAAcrgB,MAEU,IAA1BygB,EAAgBzgB,MACnB3E,EAAa2E,MACa,IAA1BygB,EAAgBzgB,MACdmgB,EAAcngB,MACY,IAA1BygB,EAAgBzgB,MACdkgB,EAAiBlgB,MACS,IAA1BygB,EAAgBzgB,MACdogB,EAAcpgB,MACd,IAGNghB,EAAqBrX,EAAS,IAC3Bvc,GAAO2S,mBAGVkhB,EAAoBtX,EAAS,KACjC,IAAKqW,EAAehgB,MAAMyS,OACxB,OAAOuO,EAAmBhhB,MAE5B,MAAMkhB,EAAUlB,EAAehgB,MAAMoV,cACrC,OAAO4L,EAAmBhhB,MAAMzT,OAAO0R,GACrCA,EAAS+B,MAAMoV,cAAczmB,SAASuyB,IACtCjjB,EAASgC,MAAMmV,cAAczmB,SAASuyB,IACtCjjB,EAASzU,YAAY4rB,cAAczmB,SAASuyB,MAK1CC,EAAc,KAClBN,EAAS7gB,MAAQ3I,OAAO8X,YAAc,KAGlCiS,GAAqB,KACzB/S,MAGIA,GAAQ,KACZnjB,EAAK,UAGDm2B,GAAuBpjB,IAC3B/S,EAAK,kBAAmB+S,EAAS+B,OACjCshB,EAAUlf,QAAQ,QAAQnE,EAASgC,aACnCoO,MAGIkT,GAAmBtjB,IACP,CACdvU,OAAU,kBACVC,OAAU,mBACVC,OAAU,sBACVC,OAAU,wBAEGoU,IAAa,YAGxBujB,GAAsBvjB,IACV,CACdvU,OAAU,UACVC,OAAU,UACVC,OAAU,UACVC,OAAU,QAEGoU,IAAa,QAGxBwjB,GAAoBxjB,IACP,CACfvU,OAAU,UACVC,OAAU,UACVC,OAAU,UACVC,OAAU,WAEIoU,IAAa,WAGzByjB,GAAuB,KAC3B,IAAKzB,EAAUjgB,MAAMyS,OAEnB,YADA6O,EAAUjP,QAAQ,UAIpB,MAAMvb,EAAOmpB,EAAUjgB,MAAMyS,OAG7B,GAAI,QAAQkP,KAAK7qB,GAGf,OAFA6oB,EAAO10B,KAAK,MAAM6L,UAClBuX,KAKF,IACE,MAAM7iB,EAAM,IAAI4L,IAAIN,GACd8qB,EAAcvqB,OAAOC,SAASE,KAEpC,GAAIhM,EAAIgM,OAASoqB,EAAa,CAE5B,OADcp2B,EAAIq2B,SAASC,MAAM,iBAE/BnC,EAAO10B,KAAKO,EAAIq2B,eAChBxT,WAGAiT,EAAUxyB,MAAM,mBAGpB,CAEE,YADAwyB,EAAUxyB,MAAM,eAGpB,OAAS0B,GAEP,YADA8wB,EAAUxyB,MAAM,iBAElB,GAGIizB,GAAU/K,IACdgL,GAAiBhL,GACjB9rB,EAAK,SAAU8rB,GACfsK,EAAUlf,QAAQ,SAGd4f,GAAoBhL,IACxB,MAAMiL,EAAe9B,EAAcngB,MAAM3O,KACtCwS,GAASA,EAAKpU,OAASunB,EAAOvnB,MAE7BwyB,GACF9B,EAAcngB,MAAM1L,OAAO6rB,EAAcngB,MAAMtO,QAAQuwB,GAAe,GAExE9B,EAAcngB,MAAMvT,QAAQuqB,GACxBmJ,EAAcngB,MAAMhW,OAAS,IAC/Bm2B,EAAcngB,MAAMkiB,MAEtB3lB,aAAaC,QAAQ,iBAAkBhP,KAAKC,UAAU0yB,EAAcngB,SAchEmiB,GAAoBnc,UACxB,GAAIwa,EAAQxgB,MAAO,CACjBygB,EAAgBzgB,OAAQ,EACxB,MAAMhG,QAAYzO,MAChB,2CAA2Ci1B,EAAQxgB,SACnD9F,KAAMF,GAAQA,EAAImI,QACpBke,EAAcrgB,MAAQhG,EAAI7O,MAAQ,EACpC,MACEs1B,EAAgBzgB,MAAQ,EACxBoiB,GAAgB,IAIdC,GAAmBrc,UACvB,GAA8B,IAA1Bya,EAAgBzgB,OAA8C,IAA/BogB,EAAcpgB,MAAMhW,OAAc,CACnE,MAAMgQ,QAAYzO,MAChB,yCAAyC+0B,EAAetgB,kBACxD9F,KAAMF,GAAQA,EAAImI,QACpBie,EAAcpgB,MAAQhG,EAAI7O,MAAQ,GAClCm1B,EAAetgB,OAASogB,EAAcpgB,MAAMhW,SACvCgQ,EAAI7O,MAAQ6O,EAAI7O,KAAKnB,OAAS,MACjC22B,EAAkB3gB,OAAQ,EAE9B,SAC4B,IAA1BygB,EAAgBzgB,OACkB,IAAlCkgB,EAAiBlgB,MAAMhW,OACvB,CACA,MAAMgQ,QAAYzO,MAChB,8CAA8Cg1B,EAAkBvgB,kBAChE9F,KAAMF,GAAQA,EAAImI,QACpB+d,EAAiBlgB,MAAQhG,EAAI7O,MAAQ,GACrCo1B,EAAkBvgB,OAASkgB,EAAiBlgB,MAAMhW,SAC7CgQ,EAAI7O,MAAQ6O,EAAI7O,KAAKnB,OAAS,MACjC42B,EAAqB5gB,OAAQ,EAEjC,GA+BIoiB,GAAmBr2B,IACvB00B,EAAgBzgB,MAAQjU,EACxB20B,EAAgB1gB,MAAQ,QAAgB,GAARjU,YAChCs2B,MAIIC,GAAe,EAAGC,gBACtB,MAAMC,EAAYhY,SAASmI,cAAc,qCACzC,IAAK6P,IAAc1B,EAAkB9gB,MAAO,OAEvBwiB,EAAUnL,aAESkL,EADnBC,EAAUC,aAIR,KA5CJzc,WACnB,GAA8B,IAA1Bya,EAAgBzgB,OAAe2gB,EAAkB3gB,MAAO,CAC1D,MAGM0iB,SAHYn3B,MAChB,yCAAyC+0B,EAAetgB,kBACxD9F,KAAMF,GAAQA,EAAImI,SACGhX,MAAQ,GAC3Bu3B,EAAW14B,OAAS,IACtBo2B,EAAcpgB,MAAQ,IAAIogB,EAAcpgB,SAAU0iB,GAClDpC,EAAetgB,OAAS0iB,EAAW14B,QAEjC04B,EAAW14B,OAAS,KACtB22B,EAAkB3gB,OAAQ,EAE9B,MAAA,GAAqC,IAA1BygB,EAAgBzgB,OAAe4gB,EAAqB5gB,MAAO,CACpE,MAGM0iB,SAHYn3B,MAChB,8CAA8Cg1B,EAAkBvgB,kBAChE9F,KAAMF,GAAQA,EAAImI,SACGhX,MAAQ,GAC3Bu3B,EAAW14B,OAAS,IACtBk2B,EAAiBlgB,MAAQ,IAAIkgB,EAAiBlgB,SAAU0iB,GACxDnC,EAAkBvgB,OAAS0iB,EAAW14B,QAEpC04B,EAAW14B,OAAS,KACtB42B,EAAqB5gB,OAAQ,EAEjC,GAoBE2iB,WAKJC,EAAU5c,UACRmb,IACA9pB,OAAOia,iBAAiB,SAAU6P,GArGd,MACpB,MAAM0B,EAAStmB,aAAaG,QAAQ,kBAChCmmB,IACF1C,EAAcngB,MAAQxS,KAAK+D,MAAMsxB,IAEnC,MAAMC,EAAQvmB,aAAaG,QAAQ,iBAC/BomB,IACFznB,EAAa2E,MAAQxS,KAAK+D,MAAMuxB,KA+FlCC,SACMV,OAIRW,EAAY,KACV3rB,OAAO8a,oBAAoB,SAAUgP,8vMC5VhCp0B,GAAG,cAAc4rB,IAAI,mBACnB5rB,GAAG,UAAUsc,MAAM,aAKjBC,GAAA,CAAAD,MAAM,UAMRmD,GAAA,CAAAnD,MAAM,UAxQfE,GAAA,CAAA,KAAA,UAAA,iBAAAC,GAAA,CAAA,MAAA,OA8Qa+E,GAAA,CAAAlF,MAAM,QACJmF,GAAA,CAAAnF,MAAM,YACNtc,GAAG,OAAOsc,MAAM,eAChBtc,GAAG,SAASsc,MAAM,uBA3QlB,CACbuF,WAAY,CACVqU,sDACAC,gBAEF/3B,KAAA,KACS,CACLg4B,cAAe,GACfC,eAAe,EACfC,UAAU,EACVC,MAAO,EACPC,MAAO,EACPC,eAAgB,OAGpB7Z,SAAU,CACR,UAAA8Z,GACE,MAAO,IAAI16B,KAAKo6B,eAAeO,KAAK,CAACC,EAAGC,IACtCA,EAAEj0B,SAAWg0B,EAAEh0B,SAAW,EAAIi0B,EAAE9zB,WAAa6zB,EAAE7zB,WAEnD,EACA+zB,oBAAA,IACSz2B,GAAO2S,kBAAkB1N,IAAKwR,GAASA,EAAK7D,QAGvD,OAAAqN,GACuC,GAAjC5hB,GAAOqa,gBAAgB9b,OACzByB,GAAOb,GACL,SACA,KACE7B,KAAKo6B,cAAgB13B,GAAOqa,gBAC5B/c,KAAK+6B,wBAEP,IAGF/6B,KAAKo6B,cAAgB13B,GAAOqa,gBAC5B/c,KAAK+6B,sBAET,EACAzZ,QAAS,CACP,iBAAA0Z,GACEh7B,KAAKq6B,eAAgB,EACrBr6B,KAAKilB,MAAM,yBACb,EACA,aAAAgW,GACEj7B,KAAKq6B,eAAgB,CACvB,EACA,QAAAa,CAASl3B,GAEiB,SAApBhE,KAAKghB,OAAOta,MAAuC,aAApB1G,KAAKghB,OAAOta,KAC7C1G,KAAK8iB,QAAQ5gB,KAAK,CAAEwE,KAAM,YAAaqqB,OAAQ,CAAE/sB,QAE7B,cAApBhE,KAAKghB,OAAOta,MACQ,gBAApB1G,KAAKghB,OAAOta,KAEZ1G,KAAK8iB,QAAQ5gB,KAAK,CAAEwE,KAAM,eAAgBqqB,OAAQ,CAAE/sB,QAGpDhE,KAAK8iB,QAAQ1f,QAAQ,CAAEsD,KAAM,YAAaqqB,OAAQ,CAAE/sB,OAExD,EACA,KAAAm3B,CAAMrgB,GAMJ,OAJgB9a,KAAKghB,OAAO+P,OAAO/sB,IAEjB8W,EAAK9W,GAGd,SAEiB,GAAjB8W,EAAKlU,SAAgB,YAAc,EAE9C,EACA,sBAAMw0B,CAAiBlmB,GACrB,MAAM9N,EAAU/C,GAAOO,oBAAoBsQ,GACrCmmB,EAAc,CAClBr3B,GAAIhE,KAAKua,YACT9T,MAAOW,EAAQvC,KAAKyI,MACpBlH,aAAc,EACdC,WAAY,EACZO,SAAU,EACVQ,iBAGI1E,GAAO8X,YAAY,SAAU6gB,GACnCr7B,KAAK+6B,qBACP,EACA,WAAAO,CAAYnf,GACVnc,KAAKu7B,YAAa,EAClBv7B,KAAKw7B,OAASrf,EAAMsf,QACpBz7B,KAAK07B,WAAa17B,KAAKqoB,MAAMsT,YAAYC,YACzCna,SAAS8G,iBAAiB,YAAavoB,KAAK67B,QAC5Cpa,SAAS8G,iBAAiB,UAAWvoB,KAAK87B,WAC5C,EACA,MAAAD,CAAO1f,GACL,GAAInc,KAAKu7B,WAAY,CAEnB,IAAIQ,EAAW/7B,KAAK07B,YAAcvf,EAAMsf,QAAUz7B,KAAKw7B,QACvD,MAAMQ,EAAUva,SAASwa,gBAAgBvT,MAAMwT,SAC3CC,WAAW1a,SAASwa,gBAAgBvT,MAAMwT,UAC1C,GACE9O,EAAW,GAAK4O,EAChB3I,EAAW,GAAK2I,EACtBD,EACEA,EAAW3O,EACPA,EACA2O,EAAW1I,EACTA,EACA0I,EACR/7B,KAAKqoB,MAAMsT,YAAYjT,MAAM2K,SAAW0I,EAAW,KACnD/7B,KAAKqoB,MAAMsT,YAAYjT,MAAM0E,SAAW2O,EAAW,IACrD,CACF,EACA,UAAAD,GACE97B,KAAKu7B,YAAa,EAClB9Z,SAAS2H,oBAAoB,YAAappB,KAAK67B,QAC/Cpa,SAAS2H,oBAAoB,UAAWppB,KAAK87B,WAC/C,EACAvhB,UAAA,IACS7X,GAAO6X,YAEhB,YAAA6hB,CAAah1B,GACX,MAAMi1B,EAAiBh4B,GAAOO,sBAU9B,GATIwC,EAAQ4D,UACVqxB,EAAetxB,eAAeC,QAAU5D,EAAQ4D,SAC9C5D,EAAQwO,OAAO3U,OAAS,IAC1Bo7B,EAAe3mB,iBAAiBE,MAAQvR,GAAOsU,cAC7CvR,EAAQwO,QAERxO,EAAQyO,UACVwmB,EAAetxB,eAAe8K,QAAUzO,EAAQyO,SAE9CzO,EAAQkG,MAAO,CAEjB,MAIM4H,EAJqB7Q,GACxB2S,kBACA1N,IAAKwR,GAASA,EAAK7D,OAEc3O,KAAM4M,GACxC7Q,GAAO2T,iBAAiB9C,EAAU9N,EAAQkG,QAExC4H,GAEFmnB,EAAennB,SAAWA,EAC1BmnB,EAAex3B,KAAKyI,MAAQlG,EAAQkG,QAGpC+uB,EAAex3B,KAAKyI,MAAQlG,EAAQkG,MACpCtN,KAAK4kB,SAAS,CACZ9hB,QAAS,mBACTG,KAAM,UAGZ,CACA,OAAOo5B,CACT,EACA,wBAAMC,CAAmBrO,GACvB,MAAMhT,EAAY,CAChBjX,GAAIhE,KAAKua,YACTlU,WAAY,EACZD,aAAc6nB,EAAOtnB,OAAS,EAAI,EAClCA,OAAQsnB,EAAOtnB,OAASsnB,EAAOtnB,YAAS,EACxCD,KAAMunB,EAAOvnB,KACbD,MAAOwnB,EAAOxnB,MACdG,SAAU,EACVQ,QAASpH,KAAKo8B,aAAanO,UAEvBvrB,GAAO8X,YAAY,SAAUS,GACnCjb,KAAK+6B,qBACP,EACA,qBAAAwB,CAAsBpgB,EAAOqgB,GAC3Bx8B,KAAKy6B,eAAiB+B,EACtBx8B,KAAKu6B,MAAQpe,EAAMsf,QACnBz7B,KAAKw6B,MAAQre,EAAMsgB,QACnBz8B,KAAKs6B,UAAW,EAEhB,MAAMoC,EAAY,KAChB18B,KAAKs6B,UAAW,EAChB7Y,SAAS2H,oBAAoB,QAASsT,IAExCjb,SAAS8G,iBAAiB,QAASmU,EACrC,EAEA,wBAAMC,CAAmBC,GACvB,OAAQA,GACN,IAAK,QACH58B,KAAKk7B,SAASl7B,KAAKy6B,eAAez2B,IAClC,MACF,IAAK,WACHhE,KAAKy6B,eAAe7zB,SACe,IAAjC5G,KAAKy6B,eAAe7zB,SAAiB,EAAI,EAC3ClE,GAAOkX,kBACP,MACF,IAAK,QAAS,CACZ,MAAMijB,QAAoBn6B,GAAOyY,eAC/Bnb,KAAKy6B,eAAez2B,IAEtB,GAAI64B,GAAeA,EAAYC,SAAU,CACvC,MAAMA,SAAEA,GAAaD,GAEfxjB,QAAEA,EAAAvW,QAASA,GrBrMtB,SAAqBL,GAC1B,IAAIvB,GAAS,EACT4B,EAAU,GAkCd,OAjCI8Y,UAAUmhB,OACZ77B,GAAS,EACT4B,EAAU,OAEV8Y,UACGmhB,MAAM,CACLt2B,MAAO,cACPhE,QAED0O,KAAK,QAGLC,MAAOrL,IAEN7E,GAAS,EACT4B,EAAU,UAEL8Y,UAAUqW,YACnB/wB,GAAS,EACT4B,EAAU,YACV8Y,UAAUqW,UACPC,UAAUzvB,GACV0O,KAAK,QAGLC,MAAOiM,IAENnc,GAAS,EACT4B,EAAU,UAKT,CACLuW,QAASnY,EACT4B,UAEJ,CqB6JyCk6B,CAAYF,GACrCzjB,EACFrZ,KAAK4kB,SAAS,CACZ9hB,UACAG,KAAM,YAGRjD,KAAK4kB,SAAS,CACZ9hB,UACAG,KAAM,SAGZ,CACA,KACF,CACA,IAAK,SAAU,CACb,IAAID,EACJA,EAAQhD,KAAKo6B,cAAcvyB,UACxBo1B,GAAMA,EAAEj5B,KAAOhE,KAAKy6B,eAAez2B,KAExB,IAAVhB,IACFhD,KAAKo6B,cAAc7uB,OAAOvI,EAAO,GACjCN,GAAOkX,mBAET,KACF,EAEF5Z,KAAKs6B,UAAW,CAClB,EAEA,mBAAAS,GAEE/6B,KAAKo6B,cAAc9wB,IAAK2R,IACtBA,EAAUpZ,GAAG,uBAAwB,KAEnCoZ,EAAU/T,mBAAqB+T,EAAU9T,wBACzCnH,KAAKk9B,kBAGX,kFAMF,OAAA9Z,IAAAC,EAoCM,MApCNjD,GAoCM,CAnCJkD,EAUM,MAVNjD,GAUM,aATJiD,EAGM,MAAA,CAHDhD,MAAM,UAAQ,CACjBgD,EAAwC,IAAA,CAArChD,MAAM,6BACTgD,EAAuD,QAAA,CAAhDtf,GAAG,cAAcf,KAAK,OAAOk6B,YAAY,aAElD7Z,EAIM,MAJN/C,GAIM,CAHJ+C,EAES,SAAA,CAFDtf,GAAG,UAAUyC,MAAM,UAAWmd,4BAAOD,EAAAsX,eAAAtX,EAAAsX,iBAAAr7B,kBAC3C0jB,EAA4B,IAAA,CAAzBhD,MAAM,gBAAc,MAAA,UAI7BgD,EAYM,MAZNG,GAYM,EAXJL,GAAA,GAAAC,EAUMgD,OAnRZE,EAyQmC5C,EAAA+W,WAzQnC,CAyQmB5f,EAAM9X,SAAnBqgB,EAUM,MAAA,CAVoCrf,GAAI2f,EAAAwX,MAAMrgB,GAAQvH,IAAKvQ,EAAOsd,MAAM,QAASsD,QAAKqM,GAAEtM,EAAAuX,SAASpgB,EAAK9W,IACzGo5B,cA1QTtN,EAAAG,GA0Q8BtM,EAAA4Y,sBAAsBtM,EAAQnV,GAAI,CAAA,cACxDwI,EAEM,MAAA,CAFDhD,MA3QboD,EAAA,CA2QmB,SAAkC,GAAjB5I,EAAK1U,aAAY,SAAA,YAC3Ckd,EAA2C,MAAA,CAArCvB,IAAKjH,EAAKnU,OAAS6c,IAAK1I,EAAKpU,MA5Q7C,KAAA,EAAA+Z,QA8QQ6C,EAIM,MAJNkC,GAIM,CAHJlC,EAAuC,MAAvCmC,GAAuCmB,EAAlB9L,EAAKpU,MAAI,GAC9B4c,EAA6D,MAA7DoC,GAA6DkB,EAA3B9L,EAAK/O,eAAW,GAClDuX,EAAoE,MAApEqC,GAAoEiB,EAAhC9L,EAAK5T,oBAAkB,MAjRrE,GAAAsZ,cAqRI8C,EAAoD,MAAA,CAA/ChD,MAAM,UAAW+c,gCAAW1Z,EAAA2X,aAAA3X,EAAA2X,eAAA17B,cACjC4mB,EAME8W,EAAA,CALQ9I,KAAMjR,EAAA8W,cAvRpB,gBAAA/T,EAAA,KAAAA,EAAA,GAAA2J,GAuRoB1M,EAAA8W,cAAapK,GAC1BvJ,uBAAOnD,EAAA8W,eAAa,GACpBkD,SAAS5Z,EAAA2Y,mBACTkB,gBAAiB7Z,EAAAyX,iBACjBqC,iBAAmB9Z,EAAAqX,oFAEHzX,EAAA+W,cAAnBzT,EAEoE6W,EAAA,CA/RxEnqB,IAAA,EA6RiCtQ,KAAK,SAAUH,QAASygB,EAAAkX,eAAiB/R,MA7R1E4L,EAAA,KA6R8F/Q,EAAAiX,MAAK,OAE3FmD,gBAAgBha,EAAAgZ,mBAAqBjW,uBAAOnD,EAAA+W,UAAQ,mDA/R5DjT,EAAA,IAAA,6CCCOjH,GAAA,CAAAE,MAAM,gBAMFD,GAAA,CAAAC,MAAM,wBAPjBC,GAAA,CAAA,mBAAAhN,IAAA,EAa4C+M,MAAM,gBAblDE,GAAA,CAAA,UAmCSC,GAAA,CAAAH,MAAM,0BClCRF,GAAA,CAAAE,MAAM,0BADb/M,IAAA,EAEoD+M,MAAM,mBAC/CC,GAAA,CAAAD,MAAM,kBAEJmD,GAAA,CAAAnD,MAAM,iBACJE,GAAA,CAAAF,MAAM,sBAEJG,GAAA,CAAAH,MAAM,gBAoBNkF,GAAA,CAAAlF,MAAM,cACNmF,GAAA,CAAAnF,MAAM,gBA0DZoF,GAAA,CAAApF,MAAM,kBAEJqF,GAAA,CAAArF,MAAM,iBACJsF,GAAA,CAAAtF,MAAM,sBAEJ+Q,GAAA,CAAA/Q,MAAM,oBAeTA,MAAM,qBACNoI,MAAA,CAAAkV,SAAA,WAWHrM,GAAA,CAAAjR,MAAM,kBAEJkR,GAAA,CAAAlR,MAAM,iBACJmR,GAAA,CAAAnR,MAAM,sBAEJud,GAAA,CAAAvd,MAAM,gBAqBNwd,GAAA,CAAAxd,MAAM,cACNyd,GAAA,CAAAzd,MAAM,gBAlJvB0d,GAAA,CAAA,WAgKgBC,GAAA,CAAA3d,MAAM,8CAhKtB4d,GAAA,CAAA,SAwKuBC,GAAA,CAAA7d,MAAM,cAGN8d,GAAA,CAAA9d,MAAM,oBA3K7B/M,IAAA,EA2LM+M,MAAM,kBAGD+d,GAAA,CAAA/d,MAAM,iBACJge,GAAA,CAAAhe,MAAM,sBAEJie,GAAA,CAAAje,MAAM,gBAORke,GAAA,CAAAle,MAAM,sBAEJme,GAAA,CAAAne,MAAM,oBAeTA,MAAM,qBACNoI,MAAA,CAAAkV,SAAA,eAEI55B,GAAG,0BAA0Bsc,MAAM,aAM9Boe,GAAA,CAAApe,MAAM,cACNqe,GAAA,CAAAre,MAAM,gBAUdse,GAAA,CAAAte,MAAM,sBAEJue,GAAA,CAAAve,MAAM,oBAeTA,MAAM,qBACNoI,MAAA,CAAAkV,SAAA,eAEI55B,GAAG,kBAAkBsc,MAAM,aAMtBwe,GAAA,CAAAxe,MAAM,cACNye,GAAA,CAAAze,MAAM,4BA2BZ,CACb5Z,KAAM,oBACNmf,WAAY,CACVmZ,eDjPW,CACblb,MAAO,CACLmb,eAAgB,CACdh8B,KAAMsR,MACNyP,QAAS,IAAM,KAGnBC,MAAO,CAAC,iBACR,IAAA7hB,GAEE,MAAO,CACL88B,eAFqB,IAAIl/B,KAAKi/B,gBAG9BE,kBAAc,EAElB,EACApe,MAAO,CACL,cAAAke,CAAeG,GACbp/B,KAAKk/B,eAAiB,IAAIE,EAC5B,GAEF9d,QAAS,CACP,gBAAA+d,GACEr/B,KAAKk/B,eAAe3zB,OAAOvL,KAAKm/B,aAAc,GAC9Cn/B,KAAKilB,MAAM,gBAAiBjlB,KAAKk/B,eACnC,EACA,gBAAAI,CAAiB37B,GACH,UAARA,GAAoB3D,KAAKk/B,eAAej+B,OAAS,EACnDjB,KAAK4kB,SAAS0E,QAAQ,iBAGxBtpB,KAAKk/B,eAAeh9B,KAAK,CACvByB,OACAI,QAAS,KAEX/D,KAAKilB,MAAM,gBAAiBjlB,KAAKk/B,gBACnC,EACAK,iBAAiB57B,GACA,aAARA,EAAsB,KAAe,UAARA,EAAmB,KAAO,KAEhE,mBAAA67B,CAAoBx8B,GAClBhD,KAAKk/B,eAAel8B,GAAOe,QACzB/D,KAAKqoB,MAAM,WAAWrlB,KAAS,GAAGymB,UACpCzpB,KAAKilB,MAAM,gBAAiBjlB,KAAKk/B,eACnC,4DA/FF,OAAA9b,IAAAC,EAgDM,MAhDNjD,GAgDM,EA/CJgD,GAAA,GAAAC,EAgCMgD,OAlCVE,EAGiChD,EAAA2b,eAHjC,CAGcp8B,EAASE,SADnBqgB,EAgCM,MAAA,CA9BH9P,IAAKvQ,EACNsd,MAAM,mBAENgD,EA0BM,MA1BNjD,GA0BM,CAzBJiD,EAgBM,MAAA,CAfJhD,MAAM,iBACLmf,YAASxP,GAAE1M,EAAA4b,aAAen8B,EAC1B08B,4BAAYnc,EAAA4b,aAAY,QAEd5b,EAAA4b,cAAgBn8B,GAA3BogB,IAAAC,EAEM,MAFNI,GAEMmD,EADDjD,mBAAiB7gB,EAAQa,OAAI,SAElC0f,EAOM,MAAA,CAvBhB9P,IAAA,EAkBY9M,MAAM,OACN6Z,MAAM,uBACLsD,4BAAOD,EAAA0b,kBAAA1b,EAAA0b,oBAAAz/B,KACT,WArBX,GAAA2gB,IAyBQ+C,EAOM,MAAA,CAhCdqc,SAAA,EA0BW/P,eAAgB5sB,IACjBsd,MAAM,kBACNkQ,gBAAgB,OACfoP,OAAI3P,GAAEtM,EAAA6b,oBAAoBx8B,IAExB4jB,EAAArD,EAAA2b,eAAel8B,GAAOe,SAAO,GA/B1Cyc,gBAmCI8C,EAaM,MAbN7C,GAaM,CAZJ+F,EAECqZ,EAAA,CAFUp5B,MAAM,SAASq5B,MAAA,GAAOlc,uBAAOD,EAAA2b,iBAAgB,aApC9Dtb,QAAA+b,EAqCS,IAAIzZ,EAAA,KAAAA,EAAA,GAAA,CArCb0Z,EAqCS,WArCThvB,EAAA,IAuCMwV,EAKCqZ,EAAA,CAJCp5B,MAAM,SACNq5B,MAAA,GACClc,uBAAOD,EAAA2b,iBAAgB,gBA1ChCtb,QAAA+b,EA2CS,IAAIzZ,EAAA,KAAAA,EAAA,GAAA,CA3Cb0Z,EA2CS,WA3CThvB,EAAA,IA6CMwV,EAECqZ,EAAA,CAFUp5B,MAAM,SAASq5B,MAAA,GAAOlc,uBAAOD,EAAA2b,iBAAgB,WA7C9Dtb,QAAA+b,EA8CS,IAAIzZ,EAAA,KAAAA,EAAA,GAAA,CA9Cb0Z,EA8CS,WA9CThvB,EAAA,6CCwSE8S,MAAO,CACLkM,WAAY,CAEV/sB,KAAMyK,OACN4Z,UAAU,GAEZ2Y,wBAAyB,CACvBh9B,KAAMytB,OACNpJ,UAAU,GAEZ4Y,iBAAkB,CAChBj9B,KAAMsR,MACN+S,UAAU,GAEZ6Y,kBAAmB,CACjBl9B,KAAMsR,MACN+S,UAAU,GAEZ8Y,gBAAiB,CAEfn9B,KAAMsR,MACN+S,UAAU,GAEZ+Y,qBAAsB,CACpBp9B,KAAMyK,OACN4Z,UAAU,GAEZgZ,yBAA0B,CACxBr9B,KAAMsR,MACN+S,UAAU,GAEZiZ,mBAAoB,CAClBt9B,KAAMsR,MACNyP,QAAS,IAAM,KAGnBC,MAAO,CAAC,oBAAqB,mBAAoB,kBACjD,IAAA7hB,GACE,MAAO,CACLo+B,iBAAkBxgC,KAAKgwB,WAAW9a,SAClCurB,oBAAqB,CAAA,EACrBC,qBAAsB1gC,KAAKgwB,WAAWta,kBAAkBC,KACxDgrB,iBAAkBl8B,KAAK+D,MAAM/D,KAAKC,UAAU1E,KAAKogC,kBACjDQ,yBAA0Bn8B,KAAK+D,MAC7B/D,KAAKC,UAAU1E,KAAKgwB,WAAWla,cAAclV,SAE/CigC,0BAA2B,CAAA,EAE3BC,mBAAmB,EACnBC,mBAAmB,EACnBC,oBAAoB,EAEpBC,YAAa,CACXrG,EAAG,CAAEvb,IAAK,EAAG2T,IAAK,EAAGkO,KAAM,IAC3BrG,EAAG,CAAExb,IAAK,EAAG2T,IAAK,EAAGkO,KAAM,IAC3BjE,EAAG,CAAE5d,OAAS2T,IAAK,EAAGkO,KAAM,IAC5B/M,EAAG,CACD9U,KAAK,EACL2T,IAAK,EACLkO,KAAM,EACNC,UAAYlqB,IACE,CACV,KAAM,KACN,EAAG,OACH,EAAG,OACH,EAAG,OACH,EAAG,QAEMA,MAKrB,EACA2J,SAAU,CACR,eAAAwgB,GACE,MAAM3gC,EAAc4D,GAAO8S,uBAAuBnX,KAAKwgC,kBACvD,MAAO,CAAC,SAAU,UAAU56B,SAASnF,EACvC,GAEFsgB,MAAO,CACLiP,WAAY,CACV,OAAArqB,CAAQy5B,GACNp/B,KAAKwgC,iBAAmBpB,EAAOlqB,SAC/BlV,KAAK0gC,qBAAuBtB,EAAO1pB,kBAAkBC,KACrD3V,KAAK4gC,yBAA2Bn8B,KAAK+D,MACnC/D,KAAKC,UAAU06B,EAAOtpB,cAAclV,SAEtCZ,KAAKqhC,oBACP,EACAC,MAAM,GAERlB,gBAAiB,CACf,OAAAz6B,CAAQy5B,GACNp/B,KAAK2gC,iBAAmBl8B,KAAK+D,MAAM/D,KAAKC,UAAU06B,IAClDp/B,KAAKuhC,oBACP,EACAD,MAAM,IAGV,OAAAhd,GACEtkB,KAAKqhC,oBACP,EACA/f,QAAS,CACP,kBAAA+f,GACErhC,KAAKygC,oBAAsB,IACtBzgC,KAAKgwB,WAAWnrB,QAChB7E,KAAKgwB,WAAW5a,YAErB,MAAM3U,EAAc4D,GAAO8S,uBAAuBnX,KAAKwgC,kBACnD,CAAC,SAAU,UAAU56B,SAASnF,KAChCT,KAAK6gC,0BAA4B7gC,KAAKwhC,aACpCxhC,KAAK4gC,yBAAyBxqB,iBAGlCpW,KAAKuhC,oBACP,EACA,kBAAAA,GACE,MAAME,EAAezhC,KAAKgwB,WAAWta,kBAAkBE,OAAS,GAChE5V,KAAK2gC,iBAAmB3gC,KAAK2gC,iBAAiBr3B,IAAK4c,IAAA,IAC9CA,EACHtQ,MAAOsQ,EAAOtQ,MAAMtM,IAAKo4B,IAAA,IACpBA,EACHC,QAASF,EAAa77B,SAAS87B,EAAKh7B,WAG1C,EACAk7B,YAAYruB,IACW,CACnBoC,KAAM,OACNrI,MAAO,KACP5D,iBAAkB,UAClB5E,OAAQ,OACR2Q,iBAAkB,OAClBJ,YAAa,KACbC,MAAO,MACPC,kBAAmB,QACnBC,iBAAkB,QAClBqsB,yBAA0B,KAC1BC,0BAA2B,OAC3BC,gCAAiC,KACjCC,gCAAiC,OACjCC,8BAA+B,OAC/BlsB,gBAAiB,OACjBE,cAAe,OACfC,eAAgB,OAChBC,YAAa,QAEK5C,IAAQA,GAE9B,UAAA2uB,GACE,MAAMC,EAAa19B,KAAK+D,MAAM/D,KAAKC,UAAU1E,KAAKgwB,cAE5C1iB,MACJA,EAAAxI,OACAA,EAAA4E,iBACAA,EAAA2L,YACAA,EAAAC,MACAA,EAAAC,kBACAA,EAAAC,iBACAA,EAAAC,iBACAA,GACEzV,KAAKygC,oBACT0B,EAAWt9B,KAAO,CAAEyI,QAAO5D,mBAAkB5E,UAC7Cq9B,EAAW/sB,WAAa,CACtBC,cACAC,QACAC,oBACAC,mBACAC,oBAGF0sB,EAAWjtB,SAAWlV,KAAKwgC,iBACtB2B,EAAWzsB,mBAAkBysB,EAAWzsB,iBAAmB,CAAA,GAChEysB,EAAWzsB,iBAAiBC,KAAO3V,KAAK0gC,qBAExC,MAAM0B,EAAcpiC,KAAK2gC,iBAAiB0B,QAASnc,GACjDA,EAAOtQ,MAAMpS,OAAQk+B,GAASA,EAAKC,SAASr4B,IAAKo4B,GAASA,EAAKh7B,OAGjEy7B,EAAWzsB,iBAAiBE,MAAQwsB,EAE/BD,EAAWrsB,gBAAeqsB,EAAWrsB,cAAgB,CAAA,GACrDqsB,EAAWrsB,cAAclV,SAC5BuhC,EAAWrsB,cAAclV,OAAS,CAChCoV,cAAe,CAAA,EACfI,eAAgB,CAAA,IAEpB+rB,EAAWrsB,cAAclV,OAAS6D,KAAK+D,MACrC/D,KAAKC,UAAU1E,KAAK4gC,2BAGtB5gC,KAAKilB,MAAM,oBAAqBkd,EAClC,EACA,qBAAAG,GACEtiC,KAAKkiC,YACP,EACA,oBAAAK,CAAqBC,GACnBxiC,KAAKwgC,iBAAmBgC,EACxB,MAAMC,EAAep+B,GAAO8Q,gBAAgBqtB,GACxCC,IACFziC,KAAKygC,oBAAoBnzB,MAAQm1B,GAEnCziC,KAAKkiC,aACLliC,KAAKilB,MAAM,mBAAoBud,GAG/B,MAAM/hC,EAAc4D,GAAO8S,uBAAuBqrB,GAC9C,CAAC,SAAU,UAAU58B,SAASnF,KAChCT,KAAK6gC,0BAA4B7gC,KAAKwhC,aACpCxhC,KAAK4gC,yBAAyBxqB,gBAGpC,EACA,mBAAAssB,CAAoBC,GAClB3iC,KAAKilB,MAAM,iBAAkB0d,EAC/B,EACA,wBAAAC,GACE5iC,KAAKkiC,YACP,EACA,sBAAAW,GACE7iC,KAAKkiC,YACP,EACA,0BAAAY,GACE9iC,KAAKkiC,YACP,EACA,YAAAV,CAAauB,GACX,MAAM7hC,EAAS,CAAA,EACT8hC,MAAqBC,IACrBC,EAAQljC,KAAKqgC,qBAOnB,OANA3yB,OAAOC,KAAKu1B,GAAO7gC,QAASkR,IAC1ByvB,EAAeG,IAAID,EAAM3vB,GAAMA,KAEjC7F,OAAOC,KAAKo1B,GAAqB,CAAA,GAAI1gC,QAASkR,IAC5CrS,EAAOqS,GAAOyvB,EAAeve,IAAIse,EAAkBxvB,MAE9CrS,CACT,EACA,yBAAAkiC,CAA0B7vB,GACxB,MAAM8vB,EAAkBrjC,KAAK6gC,0BAA0BttB,GACjD+vB,EAAgBtjC,KAAKqgC,qBAAqBgD,GAC3CrjC,KAAK4gC,yBAAyBxqB,iBAEjCpW,KAAK4gC,yBAAyBxqB,eAAiB,CAAA,GAEjDpW,KAAK4gC,yBAAyBxqB,eAAe7C,GAAO+vB,EACpDtjC,KAAKkiC,YACP,yKA9hBF,OAAA9e,IAAAC,EA2RM,MA3RNjD,GA2RM,CA1R8B,UAAvBmF,EAAA0a,yBAAX7c,IAAAC,EAqLM,MArLNhD,GAqLM,CApLJiD,EAkFM,MAlFN/C,GAkFM,CAjFJ+F,EAAA,KAAAA,EAAA,GAAAhD,EAAuC,MAAA,CAAlChD,MAAM,eAAc,YAAQ,IACjCgD,EA+EM,MA/ENG,GA+EM,CA9EJH,EAgBM,MAhBN9C,GAgBM,CAfJ8F,EAAA,KAAAA,EAAA,GAAAhD,EAAkC,MAAA,CAA7BhD,MAAM,cAAa,QAAI,IAC5BgD,EAaM,MAbN7C,GAaM,CAZJ+F,EAWY+c,EAAA,CApB1BvT,WAUyBzM,EAAAid,iBAVzB,sBAAAla,EAAA,KAAAA,EAAA,GAAA2J,GAUyB1M,EAAAid,iBAAgBvQ,GACzBvH,MAAA,CAAA1G,MAAA,SACCwhB,SAAQ7f,EAAA4e,uBAZzBve,QAAA+b,EAekB,IAAgC,EADlC3c,GAAA,GAAAC,EAKEgD,EAAA,KAnBlBE,EAeiChB,EAAA2a,iBAARplB,QADT+L,EAKE4c,EAAA,CAHClwB,IAAKuH,EAAK7D,MACVC,MAAO4D,EAAK5D,MACZD,MAAO6D,EAAK7D,2CAlB/BjG,EAAA,qCAuBUoS,GAAA,GAAAC,EA4DMgD,OAnFhBE,EAwB+BhD,EAAAkd,oBAxB/B,CAwBoBzvB,EAAGuC,SADb8P,EA4DM,MAAA,CA1DH9P,MACD+M,MAAM,uBAENgD,EAAoD,MAApDkC,GAAoDoB,EAAzBjD,EAAAie,YAAYruB,IAAG,GAC1C+P,EAqDM,MArDNmC,GAqDM,CAnDO,UAAHlS,OADRsT,EAIY6c,EAAA,CAlC1BnwB,IAAA,EAAAyc,WAgCyBzM,EAAAkd,oBAAoBltB,GAhC7C,sBAAA0c,GAgCyB1M,EAAAkd,oBAAoBltB,GAAG0c,EAC/BuT,SAAQ7f,EAAA2e,gFAGK,qBAAH/uB,OADbsT,EAME8c,EAAA,CAzChBpwB,IAAA,EAAAyc,WAqCyBzM,EAAAkd,oBAAoBltB,GArC7C,sBAAA0c,GAqCyB1M,EAAAkd,oBAAoBltB,GAAG0c,EAC/B5Q,IAAK,EACL6hB,KAAM,EACNsC,SAAQ7f,EAAA2e,gFAGa,CAAA,UAAA18B,SAAS2N,QADjCsT,EAIa+c,EAAA,CA9C3BrwB,IAAA,EAAAyc,WA4CyBzM,EAAAkd,oBAAoBltB,GA5C7C,sBAAA0c,GA4CyB1M,EAAAkd,oBAAoBltB,GAAG0c,EAC/BuT,SAAQ7f,EAAA2e,gFAGkB,CAAA,eAAA18B,SAAS2N,QADtCsT,EAOEgd,EAAA,CAtDhBtwB,IAAA,EAAAyc,WAiDyBzM,EAAAkd,oBAAoBltB,GAjD7C,sBAAA0c,GAiDyB1M,EAAAkd,oBAAoBltB,GAAG0c,EAC/BiR,KAAM3d,EAAA0d,YAAYrG,EAAEsG,KACpB7hB,IAAKkE,EAAA0d,YAAYrG,EAAEvb,IACnB2T,IAAKzP,EAAA0d,YAAYrG,EAAE5H,IACnBwQ,SAAQ7f,EAAA2e,mGAGY,CAAA,SAAA18B,SAAS2N,QADhCsT,EAOEgd,EAAA,CA9DhBtwB,IAAA,EAAAyc,WAyDyBzM,EAAAkd,oBAAoBltB,GAzD7C,sBAAA0c,GAyDyB1M,EAAAkd,oBAAoBltB,GAAG0c,EAC/BiR,KAAM3d,EAAA0d,YAAYpG,EAAEqG,KACpB7hB,IAAKkE,EAAA0d,YAAYpG,EAAExb,IACnB2T,IAAKzP,EAAA0d,YAAYpG,EAAE7H,IACnBwQ,SAAQ7f,EAAA2e,mGAG+D,CAAA,oBAAA,oBAAA18B,SAAS2N,QADnFsT,EASEgd,EAAA,CAxEhBtwB,IAAA,EAAAyc,WAmEyBzM,EAAAkd,oBAAoBltB,GAnE7C,sBAAA0c,GAmEyB1M,EAAAkd,oBAAoBltB,GAAG0c,EAC/BiR,KAAM3d,EAAA0d,YAAYhE,EAAEiE,KACpB7hB,IAAKkE,EAAA0d,YAAYhE,EAAE5d,IACnB2T,IAAKzP,EAAA0d,YAAYhE,EAAEjK,IACnBwQ,SAAQ7f,EAAA2e,mGAGuB,CAAA,oBAAA18B,SAAS2N,QAD3CsT,EAQEgd,EAAA,CAjFhBtwB,IAAA,EAAAyc,WA2EyBzM,EAAAkd,oBAAoBltB,GA3E7C,sBAAA0c,GA2EyB1M,EAAAkd,oBAAoBltB,GAAG0c,EAC/BiR,KAAM3d,EAAA0d,YAAY9M,EAAE+M,KACpB7hB,IAAKkE,EAAA0d,YAAY9M,EAAE9U,IACnB2T,IAAKzP,EAAA0d,YAAY9M,EAAEnB,IACnB,iBAAgBzP,EAAA0d,YAAY9M,EAAEgN,UAC9BqC,SAAQ7f,EAAA2e,oHAhFzBjb,EAAA,IAAA,mBAuFM/D,EA8BM,MA9BNoC,GA8BM,CA7BJY,EAAA,MAAAA,EAAA,IAAAhD,EAAuC,MAAA,CAAlChD,MAAM,eAAc,YAAQ,IACjCgD,EA2BM,MA3BNqC,GA2BM,CA1BJrC,EAaM,MAbNsC,GAaM,CAZJU,EAAA,KAAAA,EAAA,GAAAhD,EAAoC,MAAA,CAA/BhD,MAAM,cAAa,UAAM,IAC9BgD,EAUM,MAVN+N,GAUM,CATJ/N,EAQS,SAAA,CAPNhD,MA9FjBoD,EAAA,QA8FoDH,EAAAud,2CAInCld,QAAK0C,EAAA,KAAAA,EAAA,GAAA2J,GAAE1M,EAAAud,mBAAqBvd,EAAAud,iCAE7Bxd,EAAoC,IAAA,CAAjChD,MAAM,wBAAsB,MAAA,YAIrCkG,EAWasd,EAAA,CAXDp9B,KAAK,gBAAc,CAxGzCsd,QAAA+b,EAyGY,IASM,CATNgE,EAAAzgB,EASM,MATNgO,GASM,CAJJ9K,EAGEwd,EAAA,CAFC,kBAAiBze,EAAAgb,mBACjB0D,gBAAgBtgB,EAAA+e,6EANXnf,EAAAud,uBA1GtB9vB,EAAA,QAuHMsS,EA+DM,MA/DNiO,GA+DM,CA9DJjL,EAAA,MAAAA,EAAA,IAAAhD,EAAyC,MAAA,CAApChD,MAAM,eAAc,cAAU,IACnCgD,EA4DM,MA5DNkO,GA4DM,CA3DJlO,EAiBM,MAjBNmO,GAiBM,CAhBJnL,EAAA,MAAAA,EAAA,IAAAhD,EAAoC,MAAA,CAA/BhD,MAAM,cAAa,UAAM,IAC9BgD,EAcM,MAdNua,GAcM,CAbJrX,EAYY+c,EAAA,CAzI1BvT,WA8HyBzM,EAAAmd,qBA9HzB,sBAAApa,EAAA,KAAAA,EAAA,GAAA2J,GA8HyB1M,EAAAmd,qBAAoBzQ,GAC7BkN,YAAY,OACZzU,MAAA,CAAA1G,MAAA,SACCwhB,SAAQ7f,EAAAif,2BAjIzB5e,QAAA+b,EAoIkB,IAAiC,EADnC3c,GAAA,GAAAC,EAKEgD,EAAA,KAxIlBE,EAoIiChB,EAAA4a,kBAARrlB,QADT+L,EAKE4c,EAAA,CAHClwB,IAAKuH,EAAK7D,MACVC,MAAO4D,EAAK5D,MACZD,MAAO6D,EAAK7D,2CAvI/BjG,EAAA,qCA4IUoS,GAAA,GAAAC,EAwCMgD,OApLhBE,EA6IsChD,EAAAod,iBA7ItC,CA6IoBza,EAAQljB,SADlBqgB,EAwCM,MAAA,CAtCH9P,IAAKvQ,EACNsd,MAAM,mCAENgD,EAA+C,MAA/Cwa,GAA+ClX,EAApBV,EAAOxf,MAAI,GACtC4c,EAUM,MAVNya,GAUM,CATJza,EAQS,SAAA,CAPNhD,MApJjBoD,EAAA,CAoJqD5c,QAAAof,EAAOge,mCAI3CtgB,WAAOsC,EAAOge,WAAahe,EAAOge,0BAEnC5gB,EAAoC,IAAA,CAAjChD,MAAM,wBAAsB,MAAA,KA1J/C,GAAA0d,MA6JYxX,EAsBasd,EAAA,CAtBDp9B,KAAK,gBAAc,CA7J3Csd,QAAA+b,EA8Jc,IAoBM,CApBNgE,EAAAzgB,EAoBM,MApBN2a,GAoBM,QAhBJ5a,EAeMgD,EAAA,KAjLtBE,EAmK8CL,EAAOtQ,MAnKrD,CAmK0B8rB,EAAMyC,SADhB9gB,EAeM,MAAA,CAbH9P,IAAK4wB,EACN7jB,MAAM,gCACL7Z,MAAOi7B,EAAK0C,cAEb9gB,EAEM,MAFN6a,GAEMvX,EADD8a,EAAKh7B,KAAKkK,MAAK,SAAA,IAAA,GAEpB0S,EAKM,MALN8a,GAKM,CAJJ5X,EAGaod,EAAA,CA/KjC5T,WA6K+B0R,EAAKC,QA7KpC,sBAAA1R,GA6K+ByR,EAAKC,QAAO1R,EACpBuT,SAAQ7f,EAAAkf,mFA9K/B,EAAA3E,mBA+JyB,CAAAmG,GAAAne,EAAOge,eA/JhClzB,EAAA,0BAAAqW,EAAA,IAAA,GA0LY1D,EAAAyd,iBADRhe,IAAAC,EAkGM,MAlGNihB,GAkGM,CA9FJhe,EAAA,MAAAA,EAAA,IAAAhD,EAA0C,MAAA,CAArChD,MAAM,eAAc,eAAW,IACpCgD,EA4FM,MA5FN+a,GA4FM,CA3FJ/a,EAQM,MARNgb,GAQM,CAPJhY,EAAA,MAAAA,EAAA,IAAAhD,EAAkC,MAAA,CAA7BhD,MAAM,cAAa,QAAI,IAC5BgD,EAKM,MALNib,GAKM,CAJJ/X,EAGaod,EAAA,CArMzB5T,WAmMuBzM,EAAAqd,yBAAyB7qB,gBAnMhD,sBAAAuQ,EAAA,KAAAA,EAAA,GAAA2J,GAmMuB1M,EAAAqd,yBAAyB7qB,gBAAeka,GAChDuT,SAAQ7f,EAAAmf,kEAIfxf,EAaM,MAbNkb,GAaM,CAZJlY,EAAA,MAAAA,EAAA,IAAAhD,EAAkC,MAAA,CAA7BhD,MAAM,cAAa,QAAI,IAC5BgD,EAUM,MAVNmb,GAUM,CATJnb,EAQS,SAAA,CAPNhD,MA5MfoD,EAAA,QA4MgDH,EAAAwd,2CAIjCnd,QAAK0C,EAAA,KAAAA,EAAA,GAAA2J,GAAE1M,EAAAwd,mBAAqBxd,EAAAwd,mCAE7Bzd,EAAoC,IAAA,CAAjChD,MAAM,wBAAsB,MAAA,YAIrCkG,EAsBasd,EAAA,CAtBDp9B,KAAK,gBAAc,CAtNvCsd,QAAA+b,EAuNU,IAoBM,CApBNgE,EAAAzgB,EAoBM,MApBNihB,GAoBM,CAfJjhB,EAcK,KAdLkhB,GAcK,QAbHnhB,EAYKgD,EAAA,KAzOnBE,EA8NuChD,EAAAqd,yBAAyB5qB,cA9NhE,CA8NwBiB,EAAO1D,SADjB8P,EAYK,KAAA,CAVF9P,MACD+M,MAAM,kCAENgD,EAAoD,MAApDob,GAAoD9X,EAAzBjD,EAAAie,YAAYruB,IAAG,GAC1C+P,EAKM,MALNqb,GAKM,CAJJnY,EAGaod,EAAA,CAvO/B5T,WAqO6BzM,EAAAqd,yBAAyB5qB,cAAczC,GArOpE,sBAAA0c,GAqO6B1M,EAAAqd,yBAAyB5qB,cAAczC,GAAG0c,EAClDuT,SAAQ7f,EAAAmf,4GAdTvf,EAAAwd,uBAxNpB/vB,EAAA,IA6OQsS,EAaM,MAbNsb,GAaM,CAZJtY,EAAA,MAAAA,EAAA,IAAAhD,EAAoC,MAAA,CAA/BhD,MAAM,cAAa,UAAM,IAC9BgD,EAUM,MAVNub,GAUM,CATJvb,EAQS,SAAA,CAPNhD,MAjPfoD,EAAA,QAiPgDH,EAAAyd,4CAIjCpd,QAAK0C,EAAA,KAAAA,EAAA,GAAA2J,GAAE1M,EAAAyd,oBAAsBzd,EAAAyd,oCAE9B1d,EAAoC,IAAA,CAAjChD,MAAM,wBAAsB,MAAA,YAIrCkG,EA8Basd,EAAA,CA9BDp9B,KAAK,gBAAc,CA3PvCsd,QAAA+b,EA4PU,IA4BM,CA5BNgE,EAAAzgB,EA4BM,MA5BNmhB,GA4BM,CAvBJnhB,EAsBK,KAtBLohB,GAsBK,EArBHthB,GAAA,GAAAC,EAoBKgD,OAtRnBE,EAmQuChD,EAAAsd,0BAnQvC,CAmQwB5pB,EAAO1D,SADjB8P,EAoBK,KAAA,CAlBF9P,MACD+M,MAAM,kCAENgD,EAAoD,MAApDwb,GAAoDlY,EAAzBjD,EAAAie,YAAYruB,IAAG,GAC1C+P,EAaM,MAbNyb,GAaM,CAZJvY,EAWY+c,EAAA,CApR9BvT,WA0Q6BzM,EAAAsd,0BAA0BttB,GA1QvD,sBAAA0c,GA0Q6B1M,EAAAsd,0BAA0BttB,GAAG0c,EACtCvH,MAAA,CAAA1G,MAAA,SACCwhB,SAAMvT,GAAEtM,EAAAyf,0BAA0B7vB,KA5QvDyQ,QAAA+b,EA+QsB,IAAwC,EAD1C3c,GAAA,GAAAC,EAKEgD,EAAA,KAnRtBE,EA+QqChB,EAAA+a,yBAARxlB,QADT+L,EAKE4c,EAAA,CAHClwB,IAAKuH,EAAK7D,MACVC,MAAO4D,EAAK5D,MACZD,MAAO6D,EAAK7D,2CAlRnCjG,EAAA,iFA6PoBuS,EAAAyd,wBA7PpBhwB,EAAA,SAAAqW,EAAA,IAAA,iUC2CA,MAAMvD,EAAQ6gB,EAmBR/N,EAASC,IAET+N,EAAWhV,GAAI,GACfiV,EAAajV,EAAI,IACjBkV,EAAelV,EAAI,IACnBmV,EAAanV,EAAI,IACjBoV,EAAiBpV,GAAI,GAE3BqV,EAAgB,CAACl/B,EAAOm/B,EAAU7qB,KAChCuqB,EAAS3tB,OAAQ,EAGjB4tB,EAAW5tB,MAAQ6M,EAAMqhB,cACzBL,EAAa7tB,MAAQlR,EAAMjD,SAAWghB,EAAMshB,gBAC5CL,EAAW9tB,MAAQlR,EAAMs/B,OAAS,GAG9BvhB,EAAMwhB,SACRxhB,EAAMwhB,QAAQv/B,EAAOm/B,EAAU7qB,IAQ1B,IAGT,MAAMkrB,EAAe,KACnBX,EAAS3tB,OAAQ,EACjB4tB,EAAW5tB,MAAQ,GACnB6tB,EAAa7tB,MAAQ,GACrB8tB,EAAW9tB,MAAQ,GACnB+tB,EAAe/tB,OAAQ,EAGvB2f,EAAO4O,GAAG,IAGNC,EAAe,KACfn3B,OAAOtD,QAAQ/J,OAAS,EAC1B21B,EAAO8O,OAEP9O,EAAO10B,KAAK,02BCuTJ,MAACyjC,GAAY,IA5ZzB,MACE,WAAAhkC,GACE3B,KAAK4lC,UAAY,GACjB5lC,KAAK6lC,cAAe,CACtB,CAMA,IAAAhpB,GACM7c,KAAK6lC,eAGT7lC,KAAK4lC,UAAYpyB,aAAaG,QAAQ,eAAiB,GAEvD3T,KAAK6lC,cAAe,EACtB,CAMA,YAAAC,CAAa/3B,GACX/N,KAAK4lC,UAAY73B,EACjByF,aAAaC,QAAQ,aAAc1F,EACrC,CAQA,aAAM+C,CAAQi1B,EAAU3+B,EAAU,IAE3BpH,KAAK6lC,cACR7lC,KAAK6c,OAGP,MAAMrB,EAAU,CACd,eAAgBxb,KAAK4lC,UACrB,eAAgB,sBACbx+B,EAAQoU,SAGb,IACE,MAAMzW,QAAiBvC,MAAMujC,EAAU,IAClC3+B,EACHoU,YAGIpZ,QAAa2C,EAASqU,OAG5B,IAAKrU,EAASmU,GAWZ,MATwB,MAApBnU,EAASb,QAAsC,MAApBa,EAASb,SAEnB,iBAAf9B,EAAK2D,OAA2C,cAAf3D,EAAK2D,OACtC3D,EAAKU,SAAS8C,SAAS,OAASxD,EAAKU,SAAS8C,SAAS,OACvDxD,EAAKU,SAAS8C,SAAS,UACzB5F,KAAK4lC,UAAY,GACjBpyB,aAAaI,WAAW,eAGtB,IAAI1N,MAAM9D,EAAKU,SAAWV,EAAK2D,OAAS,QAIhD,GAAkB,IAAd3D,EAAK2L,WAA4B,IAAd3L,EAAK2L,KAC1B,MAAM,IAAI7H,MAAM9D,EAAKU,SAAW,QAGlC,OAAOV,CACT,OAAS2D,GAEP,MAAMA,CACR,CACF,CAQA,eAAMigC,GACJ,OAAOhmC,KAAK8Q,QAAQ,cACtB,CAOA,sBAAMm1B,CAAiBC,GACrB,OAAOlmC,KAAK8Q,QAAQ,eAAeo1B,IACrC,CASA,kBAAMC,CAAa/jC,GACjB,OAAOpC,KAAK8Q,QAAQ,cAAe,CACjCyK,OAAQ,MACRD,KAAM7W,KAAKC,UAAUtC,IAEzB,CAQA,yBAAMgkC,CAAoBF,EAAS9jC,GACjC,OAAOpC,KAAK8Q,QAAQ,eAAeo1B,IAAW,CAC5C3qB,OAAQ,MACRD,KAAM7W,KAAKC,UAAUtC,IAEzB,CAQA,qBAAMikC,GACJ,OAAOrmC,KAAK8Q,QAAQ,4BACtB,CAQA,gBAAMw1B,CAAWrjC,EAAMb,GACrB,OAAOpC,KAAK8Q,QAAQ,mBAAmB7N,IAAQ,CAC7CsY,OAAQ,OACRD,KAAM7W,KAAKC,UAAUtC,IAEzB,CASA,mBAAMmkC,CAActjC,EAAMD,EAAOZ,GAC/B,OAAOpC,KAAK8Q,QAAQ,mBAAmB7N,KAAQD,IAAS,CACtDuY,OAAQ,MACRD,KAAM7W,KAAKC,UAAUtC,IAEzB,CAQA,mBAAMokC,CAAcvjC,EAAMD,GACxB,OAAOhD,KAAK8Q,QAAQ,mBAAmB7N,KAAQD,IAAS,CACtDuY,OAAQ,UAEZ,CAOA,yBAAMkrB,CAAoBC,GAExB,MAAMC,EAAS,IAAID,GAAU/L,KAAK,CAACC,EAAGC,IAAMA,EAAE73B,MAAQ43B,EAAE53B,OAClD4jC,EAAU,GAEhB,IAAA,MAAWC,KAAWF,EACpB,IACE,MAAMzlC,QAAelB,KAAKwmC,cAAcK,EAAQ5jC,KAAM4jC,EAAQ7jC,OAC9D4jC,EAAQ1kC,KAAK,CAAEmX,SAAS,EAAMwtB,UAAS3lC,UACzC,OAAS6E,GACP6gC,EAAQ1kC,KAAK,CAAEmX,SAAS,EAAOwtB,UAAS9gC,MAAOA,EAAMjD,SACvD,CAGF,OAAO8jC,CACT,CAQA,sBAAME,GACJ,OAAO9mC,KAAK8Q,QAAQ,6BAA8B,CAChDyK,OAAQ,QAEZ,CAQA,0BAAMwrB,CAAqB9jC,EAAMD,GAC/B,OAAOhD,KAAK8Q,QAAQ,mBAAmB7N,KAAQD,mBAAwB,CACrEuY,OAAQ,QAEZ,CASA,oBAAMyrB,CAAe5kC,GACnB,OAAOpC,KAAK8Q,QAAQ,uBAAwB,CAC1CyK,OAAQ,OACRD,KAAM7W,KAAKC,UAAUtC,IAEzB,CAMA,iBAAM6kC,GACJ,OAAOjnC,KAAK8Q,QAAQ,oBAAqB,CACvCyK,OAAQ,QAEZ,CAQA,sBAAM2rB,GACJ,OAAOlnC,KAAK8Q,QAAQ,sBACtB,CAQA,kBAAMq2B,CAAa5nB,EAAW,wBAC5B,MACM6nB,SADiBpnC,KAAKgmC,aACA5jC,KAEtB0d,EAAO,IAAIunB,KAAK,CAAC5iC,KAAKC,UAAU0iC,EAAY,KAAM,IAAK,CAC3DnkC,KAAM,qBAGFR,EAAM4L,IAAIuU,gBAAgB9C,GAC1B2W,EAAOhV,SAASC,cAAc,KACpC+U,EAAKjoB,KAAO/L,EACZg0B,EAAKC,SAAWnX,EAChBkX,EAAK1J,QACL1e,IAAI8d,gBAAgB1pB,EACtB,CAOA,kBAAM6kC,CAAankC,GACjB,OAAO,IAAImN,QAAQ,CAACI,EAASH,KAC3B,MAAMwP,EAAS,IAAIC,WAEnBD,EAAOf,OAAUvX,IACf,IACE,MAAMpD,EAASI,KAAK+D,MAAMf,EAAEuM,OAAO9S,QACnCwP,EAAQrM,EACV,CAAA,MACEkM,EAAO,IAAIrK,MAAM,eACnB,GAGF6Z,EAAO3D,QAAU,KACf7L,EAAO,IAAIrK,MAAM,YAGnB6Z,EAAOwnB,WAAWpkC,IAEtB,GA+GWqkC,GAAY,IAzGzB,MACE,WAAA7lC,CAAYgkC,GACV3lC,KAAK2lC,UAAYA,CACnB,CAMA,iBAAM8B,GACJ,OAAOznC,KAAK2lC,UAAU70B,QAAQ,eAChC,CAOA,qBAAM42B,CAAgBC,GACpB,OAAO3nC,KAAK2lC,UAAU70B,QAAQ,gBAAgB62B,IAChD,CAOA,qBAAMC,CAAgBD,GACpB,OAAO3nC,KAAK2lC,UAAU70B,QAAQ,gBAAgB62B,WAChD,CAQA,wBAAME,CAAmBF,EAAYtjC,GACnC,OAAOrE,KAAK2lC,UAAU70B,QAAQ,gBAAgB62B,WAAqB,CACjEpsB,OAAQ,MACRD,KAAM7W,KAAKC,UAAUL,IAEzB,CAOA,oBAAMyjC,CAAeH,GACnB,OAAO3nC,KAAK2lC,UAAU70B,QAAQ,gBAAgB62B,UAChD,CAUA,eAAMI,CAAUJ,EAAY5uB,EAAUrQ,EAAYs/B,EAAO,MACvD,OAAOhoC,KAAK2lC,UAAU70B,QAAQ,gBAAgB62B,WAAoB5uB,UAAkB,CAClFwC,OAAQ,OACRD,KAAM7W,KAAKC,UAAU,CAAEgE,aAAYs/B,UAEvC,CAOA,kBAAMC,CAAaN,GACjB,OAAO3nC,KAAK2lC,UAAU70B,QAAQ,gBAAgB62B,WAAqB,CACjEpsB,OAAQ,QAEZ,CAMA,sBAAM2sB,GACJ,OAAOloC,KAAK2lC,UAAU70B,QAAQ,0BAA2B,CACvDyK,OAAQ,QAEZ,CAQA,kBAAM4sB,CAAaR,EAAYhG,GAC7B,OAAO3hC,KAAK2lC,UAAU70B,QAAQ,gBAAgB62B,WAAqB,CACjEpsB,OAAQ,OACRD,KAAM7W,KAAKC,UAAU,CAAEi9B,aAE3B,GAKqCgE,ICxZ1ByC,GAAiBC,EAAY,SAAU,KAIlD,MAAMhkC,EAASurB,EAAI,MAGb0Y,EAAe1Y,EAAI,CACvB2Y,MAAO,GACP7B,SAAU,GACV8B,MAAO,IAIH9B,EAAW9W,EAAI,IAGfhY,EAASgY,EAAI,CAAA,GAGb6Y,EAAU7Y,GAAI,GAGd8Y,EAAc9Y,GAAI,GAGlBgW,EAAYhW,EAAIpc,aAAaG,QAAQ,eAAiB,IAGtDg1B,EAAmB/Y,EAAI,IAOvBgZ,EAAkBhoB,EAAS,KAC/B,MAAM1f,EAAS,GAQf,OAPAwM,OAAO+J,QAAQivB,EAASzvB,OAAO5U,QAAQ,EAAEY,EAAM4lC,MAC7CA,EAAUxmC,QAAQ,CAACwkC,EAAS7jC,KACtB6jC,EAAQiC,QACV5nC,EAAOgB,KAAK,CAAEe,OAAMD,WAAU6jC,QAI7B3lC,IAMH6nC,EAAgBnoB,EAAS,IACtBlT,OAAOgH,OAAOgyB,EAASzvB,OAC3BkX,OAAO,CAAC6a,EAAKC,IAAQD,EAAMC,EAAIhoC,OAAQ,IAMtCioC,EAAuBtoB,EAAS,KACpC,IAAI4nB,EAAQ,EAMZ,OALA96B,OAAOgH,OAAOgyB,EAASzvB,OAAO5U,QAAQwmC,IACpCA,EAAUxmC,QAAQwkC,IACZA,EAAQiC,QAAQN,QAGjBA,IAMHW,EAAmBvoB,EAAS,KAChC,IAAI4nB,EAAQ,EAUZ,OATA96B,OAAOgH,OAAOkD,EAAOX,OAAO5U,QAAQ+mC,IAC9B70B,MAAMC,QAAQ40B,IAChBA,EAAe/mC,QAAQ6V,IACjBA,EAAMN,QAAUrD,MAAMC,QAAQ0D,EAAMN,UACtC4wB,GAAStwB,EAAMN,OAAO3W,YAKvBunC,IAIHa,EAAUzZ,EAAI,IAKd0Z,EAAoB1oB,EAAS,IAC1ByoB,EAAQpyB,MAAMhW,QAMjBsoC,EAAkB3oB,EAAS,IACxByoB,EAAQpyB,MAAMkX,OAAO,CAAC6a,EAAK9iB,IAAW8iB,GAAO9iB,EAAOsjB,WAAa,GAAI,IAMxEC,EAAkB7oB,EAAS,MAAQglB,EAAU3uB,OA6BnD,SAASyyB,IACP9D,EAAU3uB,MAAQ,GAClBzD,aAAaI,WAAW,cACxB+xB,GAAUC,UAAY,EACxB,CAKA3oB,eAAe0sB,IACblB,EAAQxxB,OAAQ,EAChB,IACE,MAAMlS,QAAiB4gC,GAAUK,YAKjC,OAJA3hC,EAAO4S,MAAQlS,EAAS3C,KACxBskC,EAASzvB,MAAQlS,EAAS3C,KAAKwnC,cAAgB,CAAA,EAE/ChyB,EAAOX,MAAQlS,EAAS3C,KAAKwV,QAAU,CAAA,EAChC7S,EAAS3C,IAClB,OAAS2D,GAMP,MAHIA,EAAMjD,QAAQ8C,SAAS,QAAUG,EAAMjD,QAAQ8C,SAAS,WAC1D8jC,IAEI3jC,CACR,CAAA,QACE0iC,EAAQxxB,OAAQ,CAClB,CACF,CAwGAgG,eAAespB,EAActjC,EAAMD,EAAOZ,GACxC,IACE,MAAM2C,QAAiB4gC,GAAUY,cAActjC,EAAMD,EAAOZ,GAS5D,OAPI2C,EAAS3C,KAAKwnC,eAChBlD,EAASzvB,MAAQlS,EAAS3C,KAAKwnC,cAE7B7kC,EAAS3C,KAAKwV,SAChBA,EAAOX,MAAQlS,EAAS3C,KAAKwV,QAGxB7S,EAAS3C,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,CAyLA,MAAO,CAEL1B,OAAAA,EACAikC,eACA5B,WACA9uB,SACAyxB,UACAZ,UACAC,cACA9C,YACA+C,mBAGAC,kBACAG,gBACAG,uBACAC,mBACAG,oBACAC,kBACAE,kBAGA3D,aAzXF,SAAsB/3B,GACpB63B,EAAU3uB,MAAQlJ,EAClB43B,GAAUG,aAAa/3B,EACzB,EAuXE27B,iBACAG,kBAnXF5sB,iBACE,IACE,MAAMlY,QAAiB4gC,GAAUU,kBAEjC,OADAiC,EAAarxB,MAAQlS,EAAS3C,KACvB2C,EAAS3C,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,EA2WE4jC,cACAG,mBAtUF7sB,eAAkCipB,GAChC,IACE,MAAMnhC,QAAiB4gC,GAAUM,iBAAiBC,GAIlD,OAHI7hC,EAAO4S,QACT5S,EAAO4S,MAAMivB,GAAWnhC,EAAS3C,MAE5B2C,EAAS3C,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,EA4TEgkC,aAvTF9sB,iBACE,IACE,MAAM/b,QAAeykC,GAAU70B,QAAQ,gBACvC,OAAoB,IAAhB5P,EAAO6M,MACTs7B,EAAQpyB,MAAQ/V,EAAOkB,KAAKinC,SAAW,GAChCnoC,EAAOkB,KAAKinC,UAGnBA,EAAQpyB,MAAQ,GACT,GAEX,OAASlR,GAGP,MADAsjC,EAAQpyB,MAAQ,GACVlR,CACR,CACF,EAwSEogC,aAnSFlpB,eAA4B7a,GAC1B,IACE,MAAM2C,QAAiB4gC,GAAUQ,aAAa/jC,GAQ9C,OALAsmC,EAAYzxB,OAAQ,QAGd0yB,IAEC5kC,EAAS3C,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,EAqREqgC,oBAhRFnpB,eAAmCipB,EAAS9jC,GAC1C,IACE,MAAM2C,QAAiB4gC,GAAUS,oBAAoBF,EAAS9jC,GAY9D,OATIiC,EAAO4S,QACT5S,EAAO4S,MAAMivB,GAAW9jC,GAIV,iBAAZ8jC,GAA0C,WAAZA,IAChCwC,EAAYzxB,OAAQ,GAGflS,EAAS3C,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,EA8PEugC,WAzPFrpB,eAA0Bha,EAAMb,GAC9B,IACE,MAAM2C,QAAiB4gC,GAAUW,WAAWrjC,EAAMb,GAMlD,aAHMunC,IACN/xB,EAAOX,MAAQlS,EAAS3C,KAAKwV,QAAU,CAAA,EAEhC7S,EAAS3C,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,EA6OEwgC,gBACAC,cApNFvpB,eAA6Bha,EAAMD,GACjC,IACE,MAAM+B,QAAiB4gC,GAAUa,cAAcvjC,EAAMD,GAQrD,OALI0jC,EAASzvB,MAAMhU,IACjByjC,EAASzvB,MAAMhU,GAAMsI,OAAOvI,EAAO,GAErC4U,EAAOX,MAAQlS,EAAS3C,KAAKwV,QAAU,CAAA,EAEhC7S,EAAS3C,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,EAsME0gC,oBAjMFxpB,eAAmC+sB,GACjC,IACE,MAAMpD,QAAgBjB,GAAUc,oBAAoBuD,GAKpD,aAFML,IAEC/C,CACT,OAAS7gC,GAEP,MAAMA,CACR,CACF,EAsLEkkC,oBAjLFhtB,eAAmC+sB,EAAclB,GAC/C,MAAMlC,EAAU,GAEhB,IAAA,MAAWC,KAAWmD,EACpB,IACE,MACME,EAAc,IADAxD,EAASzvB,MAAM4vB,EAAQ5jC,MAAM4jC,EAAQ7jC,OACnB8lC,gBAEhCvC,EAAcM,EAAQ5jC,KAAM4jC,EAAQ7jC,MAAOknC,GACjDtD,EAAQ1kC,KAAK,CAAEmX,SAAS,EAAMwtB,WAChC,OAAS9gC,GACP6gC,EAAQ1kC,KAAK,CAAEmX,SAAS,EAAOwtB,UAAS9gC,MAAOA,EAAMjD,SACvD,CAGF,OAAO8jC,CACT,EAkKEE,iBA7JF7pB,iBACE,IACE,MAAMlY,QAAiB4gC,GAAUmB,mBAEjC,OADAlvB,EAAOX,MAAQlS,EAAS3C,KAAKwV,QAAU,CAAA,EAChC7S,EAAS3C,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,EAqJEghC,qBAhJF9pB,eAAoCha,EAAMD,GACxC,IACE,MAAM+B,QAAiB4gC,GAAUoB,qBAAqB9jC,EAAMD,GAE5D,OADA4U,EAAOX,MAAQlS,EAAS3C,KAAKwV,QAAU,CAAA,EAChC7S,EAAS3C,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,EAwIEihC,eAnIF/pB,eAA8B7a,GAC5B,IAEE,aADuBujC,GAAUqB,eAAe5kC,IAChCA,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,EA4HEkhC,YAvHFhqB,iBACE,IACE,MAAMlY,QAAiB4gC,GAAUsB,cAGjC,OAFAyB,EAAYzxB,OAAQ,QACd0yB,IACC5kC,EAAS3C,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,EA8GEohC,aAzGFlqB,eAA4BsC,GAC1B,UACQomB,GAAUwB,aAAa5nB,EAC/B,OAASxZ,GAEP,MAAMA,CACR,CACF,EAmGEuhC,aA9FFrqB,eAA4B9Z,GAC1B,IAEE,aADyBwiC,GAAU2B,aAAankC,EAElD,OAAS4C,GAEP,MAAMA,CACR,CACF,EAuFEokC,mBAlFFltB,iBACE,IAEE,aADuB0oB,GAAUuB,oBACjB9kC,IAClB,OAAS2D,GAEP,MAAMA,CACR,CACF,EA2EEqkC,uBAtEF,SAAgCnnC,EAAMD,GACpC,MAAMuQ,EAAM,GAAGtQ,KAAQD,IACjBqnC,EAAM1B,EAAiB1xB,MAAMpP,UAAU+yB,GAAK,GAAGA,EAAE33B,QAAQ23B,EAAE53B,UAAYuQ,GAEzE82B,GAAM,EACR1B,EAAiB1xB,MAAM1L,OAAO8+B,EAAK,GAEnC1B,EAAiB1xB,MAAM/U,KAAK,CAAEe,OAAMD,SAExC,EA8DEsnC,sBAzDF,WACE3B,EAAiB1xB,MAAQ,EAC3B,EAwDEszB,kBAnDF,SAA2BtnC,EAAMD,GAC/B,MAAMuQ,EAAM,GAAGtQ,KAAQD,IACvB,OAAO2lC,EAAiB1xB,MAAMnO,KAAK8xB,GAAK,GAAGA,EAAE33B,QAAQ23B,EAAE53B,UAAYuQ,EACrE,o1BCpSF,MAAMuQ,EAAQ6gB,EAORxiC,EAAOw0B,EAEP6T,EAAcpC,KAEdqC,EAAU7a,EAAI9L,EAAMkM,YACpB0a,EAAgB9a,EAAI,MACpBoH,EAAYpH,EAAI,YAEtB7O,EAAM,IAAM+C,EAAMkM,WAAa2a,IAC7BF,EAAQxzB,MAAQ0zB,EACXA,IACHD,EAAczzB,MAAQ,QAI1B8J,EAAM0pB,EAAUE,IACdxoC,EAAK,oBAAqBwoC,KAG5B,MAAMC,EAAgBhqB,EAAS,IAAM4pB,EAAYnmC,QAAU,CAAA,GAGrDwmC,EAAejqB,EAAS,KAC5B,IAAK8pB,EAAczzB,MAAO,MAAO,CAAA,EAEjC,MAAM6zB,EAAQ,CAAA,EAGRxC,EAAekC,GAAalC,cAAcC,OAAS76B,OAAOC,KAAKi9B,EAAc3zB,MAAMyvB,UAAY,IAgDrG,OA7CA4B,EAAajmC,QAAQY,IACnB6nC,EAAM7nC,GAAQ,KAGhBqlC,EAAajmC,QAAQY,IACnB,MAAM8nC,EAAUH,EAAc3zB,MAAMyvB,WAAWzjC,IAAS,GAClD+nC,EAAUN,EAAczzB,MAAMyvB,WAAWzjC,IAAS,GAGlDgoC,EAAS3pC,KAAK0xB,IAAI+X,EAAQ9pC,OAAQ+pC,EAAQ/pC,QAChD,IAAA,IAASG,EAAI,EAAGA,EAAI6pC,EAAQ7pC,IAAK,CAC/B,MAAM8pC,EAAOH,EAAQ3pC,GACf+pC,EAAOH,EAAQ5pC,GAErB,IAAK8pC,GAAQC,EAEXL,EAAM7nC,GAAMf,KAAK,CACfe,KAAM,QACNqM,KAAM,MAAMlO,EAAI,IAChBgqC,SAAUD,SAEd,GAAWD,IAASC,EAElBL,EAAM7nC,GAAMf,KAAK,CACfe,KAAM,UACNqM,KAAM,MAAMlO,EAAI,IAChBiqC,SAAUH,SAEd,GAAWA,GAAQC,EAAM,CAET,IAAI/8B,IAAI,IAAIV,OAAOC,KAAKu9B,MAAUx9B,OAAOC,KAAKw9B,KACtD9oC,QAAQipC,IACR7mC,KAAKC,UAAUwmC,EAAKI,MAAW7mC,KAAKC,UAAUymC,EAAKG,KACrDR,EAAM7nC,GAAMf,KAAK,CACfe,KAAM,WACNqM,KAAM,MAAMlO,EAAI,OAAOkqC,IACvBD,SAAUH,EAAKI,GACfF,SAAUD,EAAKG,MAIvB,CACF,IAGKR,IAGHS,EAAY3qB,EAAS,KACzB,IAAI4qB,EAAQ,EAAGC,EAAW,EAAGC,EAAU,EAYvC,OAVAh+B,OAAOgH,OAAOm2B,EAAa5zB,OAAO5U,QAAQspC,IACxCA,EAAQtpC,QAAQupC,IACM,UAAhBA,EAAO3oC,KAAkBuoC,IACJ,aAAhBI,EAAO3oC,KAAqBwoC,IACZ,YAAhBG,EAAO3oC,MAAoByoC,QAMjC,CAAEF,QAAOC,WAAUC,aAGtBG,EAAiBjrB,EAAS,IACvB2qB,EAAUt0B,MAAMu0B,MAAQ,GACxBD,EAAUt0B,MAAMw0B,SAAW,GAC3BF,EAAUt0B,MAAMy0B,QAAU,GAI7BI,EAAoBlrB,EAAS,IAC1BmrB,EAAqBnB,EAAc3zB,MAAM+0B,OAAQtB,EAAczzB,OAAO+0B,SAGzEC,EAAgBrrB,EAAS,IAAMkrB,EAAkB70B,MAAMhW,OAAS,GAGhEirC,EAAiBtrB,EAAS,IACvBmrB,EAAqBnB,EAAc3zB,MAAMk1B,IAAKzB,EAAczzB,OAAOk1B,MAGtEC,EAAaxrB,EAAS,IAAMsrB,EAAej1B,MAAMhW,OAAS,GAG1DorC,EAAoBzrB,EAAS,IAC1BmrB,EAAqBnB,EAAc3zB,MAAMnW,OAAQ4pC,EAAczzB,OAAOnW,SAGzEwrC,EAAgB1rB,EAAS,IAAMyrB,EAAkBp1B,MAAMhW,OAAS,GAGhE8qC,EAAuB,CAAChB,EAASC,KACrC,MAAMF,EAAQ,GAmBd,WAlBiB18B,IAAI,IAChBV,OAAOC,KAAKo9B,GAAW,OACvBr9B,OAAOC,KAAKq9B,GAAW,CAAA,KAGvB3oC,QAAQkR,IACX,MAAMg5B,EAAUxB,IAAUx3B,GACpBi5B,EAAUxB,IAAUz3B,GAEtB9O,KAAKC,UAAU6nC,KAAa9nC,KAAKC,UAAU8nC,IAC7C1B,EAAM5oC,KAAK,CACTqR,MACAk5B,aAAcC,EAAkBH,GAChCI,aAAcD,EAAkBF,OAK/B1B,GAGH4B,EAAqB/B,QACb,IAARA,EAA0B,IACX,iBAARA,EAAyBlmC,KAAKC,UAAUimC,GAC5Cja,OAAOia,GAGViC,EAAmB3pC,IACT,CACZtC,OAAQ,SACRC,OAAQ,SACRC,OAAQ,aAEGoC,IAASA,GAGlB4pC,EAAiB5pC,IACR,CACXuoC,MAAO,UACPC,SAAU,UACVC,QAAS,UAECzoC,IAAS,IAGjB6pC,EAAkB7pC,IACR,CACZuoC,MAAO,KACPC,SAAU,KACVC,QAAS,MAEEzoC,IAASA,GAGlB8pC,EAAe91B,GACE,iBAAVA,EACFxS,KAAKC,UAAUuS,EAAO,KAAM,GAE9ByZ,OAAOzZ,GAGV+1B,EAAe/vB,MAAO9Z,IAC1B,IACE,MAAM4E,QAAa5E,EAAK4E,OAClB1D,EAASI,KAAK+D,MAAMT,GAGpB7G,QAAespC,EAAYxD,eAAe3iC,GAChD,IAAKnD,EAAO+rC,MAEV,OADA1U,EAAUxyB,MAAM,YAAc7E,EAAOgsC,OAAO/jC,KAAK,QAC1C,EAGTuhC,EAAczzB,MAAQ5S,EACtBk0B,EAAUlf,QAAQ,WACpB,OAAStT,GACPwyB,EAAUxyB,MAAM,YAAcA,EAAMjD,QACtC,CAEA,OAAO,GAGHqqC,EAAc,KAClBzC,EAAczzB,MAAQ,KACtB+f,EAAU/f,MAAQ,YAGdm2B,EAAc,KAClB3C,EAAQxzB,OAAQ,GAGZo2B,EAAcpwB,UAClB,UACQqwB,EAAaC,QACjB,uBACA,OACA,CACEC,kBAAmB,KACnBC,iBAAkB,KAClBxqC,KAAM,kBAIJunC,EAAYrE,aAAauE,EAAczzB,OAC7CshB,EAAUlf,QAAQ,oBAClB+zB,UAGM5C,EAAYb,aACpB,OAAS5jC,GACO,WAAVA,GACFwyB,EAAUxyB,MAAM,UAAYA,EAAMjD,QAEtC,2uLC7QF,MAAMghB,EAAQ6gB,EAmBRxiC,EAAOw0B,EAEP+W,EAAiB9d,EAAI,QAGrB+d,EAAc,CAACC,EAAW32B,KAC9B,MAAMm0B,EAAW,IAAKtnB,EAAMkM,YAC5Bob,EAASwC,GAAa32B,EACtB9U,EAAK,oBAAqBipC,IAItByC,EAAkBjtB,EAAS,KAC/B,IAAKkD,EAAMkM,WAAW8d,qBAAsB,MAAO,GACnD,IACE,MAAM10B,EAAO3U,KAAK+D,MAAMsb,EAAMkM,WAAW8d,sBACzC,MAAO,OAAO10B,EAAK20B,sBAAsB30B,EAAK40B,cAChD,CAAA,MACE,MAAO,aACT,IAIIC,EAAoB9qC,IACxB,MAAM4c,EAAS,IAAIC,WAkBnB,OAjBAD,EAAOf,OAAUvX,IACf,IACE,MAAM2R,EAAO3R,EAAEuM,OAAO9S,OACtBuD,KAAK+D,MAAM4Q,GAGX,MAAMgyB,EAAW,IAAKtnB,EAAMkM,YAC5Bob,EAAS0C,qBAAuB10B,EAChCjX,EAAK,oBAAqBipC,GAE1B7S,EAAUlf,QAAQ,cACpB,OAAStT,GACPwyB,EAAUxyB,MAAM,eAClB,GAEFga,EAAOwnB,WAAWpkC,GAClBhB,EAAK,cAAegB,IACb,guICtFT,MAAM2gB,EAAQ6gB,EA6BRxiC,EAAOw0B,EAEPuX,EAAate,EAAI,IAGjBue,EAAoB,KACxBhsC,EAAK,iBAIDisC,EAAuBxtB,EAAS,KACpC,MAAMytB,EAAWvqB,EAAMkM,WAAWse,OAAOD,UAAY,GAC/CE,EAAYzqB,EAAMkM,WAAWse,OAAOE,WAAa,GAGjDC,EAAU,IAAIrgC,IAAImgC,GAUxB,OARAF,EAAShsC,QAAQ81B,IACfrU,EAAM4qB,gBAAgBrsC,QAAQiL,IACxBA,EAAM+e,cAAczmB,SAASuyB,EAAQ9L,gBACvCoiB,EAAQh+B,IAAInD,OAKXiH,MAAMua,KAAK2f,KAIdE,EAAiB13B,IACrB9U,EAAK,oBAAqB,IACrB2hB,EAAMkM,WACThM,QAAS/M,KAKP23B,EAAa,KACjB,MAAMzW,EAAU+V,EAAWj3B,MAAMyS,OACjC,IAAKyO,EAAS,OAEd,MAAMkW,EAAWvqB,EAAMkM,WAAWse,OAAOD,UAAY,GACjDA,EAASzoC,SAASuyB,IAKtBh2B,EAAK,oBAAqB,IACrB2hB,EAAMkM,WACTse,MAAO,IACFxqB,EAAMkM,WAAWse,MACpBD,SAAU,IAAIA,EAAUlW,MAR1B+V,EAAWj3B,MAAQ,IA4BjB43B,EAAmB53B,IACvB9U,EAAK,oBAAqB,IACrB2hB,EAAMkM,WACTse,MAAO,IACFxqB,EAAMkM,WAAWse,MACpBE,UAAWv3B,8sCAjBK,CAACkhB,IACrB,MAAMkW,EAAWvqB,EAAMkM,WAAWse,OAAOD,UAAY,GACrDlsC,EAAK,oBAAqB,IACrB2hB,EAAMkM,WACTse,MAAO,IACFxqB,EAAMkM,WAAWse,MACpBD,SAAUA,EAAS7qC,OAAOsrC,GAAKA,IAAM3W,0rDCnL3C,MAAMrU,EAAQ6gB,EAwBRxiC,EAAOw0B,EAEP6T,EAAcpC,KACd2G,EAAUnf,EAAI,MACdof,EAAapf,GAAI,GACjBqf,EAAarf,GAAI,GACjBsf,EAAiBtf,GAAI,GACrBuf,EAAgBvf,EAAI,IAGpB1R,EAAW0R,EAAI,CACnBlpB,KAAM,GACNoiC,QAAQ,EACRsG,QAAS,GACTC,SAAU,GACVC,OAAQ,cACRxB,qBAAsB,GACtBl2B,OAAQ,GACRrB,cAAe,GACfg5B,aAAc,CACZlB,SAAU,GACVG,UAAW,MAKTgB,EAAe5f,EAAI,MAGnB6f,EAAc7f,EAAI,CACtB5L,QAAS,GACTsqB,MAAO,CACLD,SAAU,GACVG,UAAW,MA4BTkB,EAAc9uB,EAAS,IAEpB,GADuB,QAAfkD,EAAMnO,KAAiB,KAAO,QAvBvB,CAAC1S,IAEvB,GAAIunC,GAAalC,cAAc5B,SAAU,CAEvC,MAAMiJ,EAAcnF,EAAYlC,aAAa5B,SAASp+B,KAAKsyB,GAAKA,EAAE33B,OAASA,GAC3E,GAAI0sC,GAAajpC,KACf,OAAOipC,EAAYjpC,IAEvB,CAGA,MAAM4C,EAAM,CACV3I,OAAQ,SACRC,OAAQ,SACRC,OAAQ,YACR+uC,SAAU,WACVC,UAAW,aAEb,OAAIvmC,EAAIrG,GAAcqG,EAAIrG,GACnBA,EAAOA,EAAK5B,OAAO,GAAG+vB,cAAgBnuB,EAAK2G,MAAM,GAAK,OAKzCkmC,CAAgBhsB,EAAM7gB,eAItC8sC,EAAuBnvB,EAAS,KACpC,IAAK4pB,GAAalC,cAAc5B,SAC9B,MAAO,CAAA,EAET,MAAMiJ,EAAcnF,EAAYlC,aAAa5B,SAASp+B,KAAKsyB,GAAKA,EAAE33B,OAAS6gB,EAAM7gB,MACjF,OAAO0sC,GAAaK,qBAAuB,CAAA,IAIvCC,EAAgBrvB,EAAS,KAE7B,GAAIuuB,EAAcl4B,MAAMhW,OAAS,EAC/B,OAAOkuC,EAAcl4B,MAGvB,MAAMi5B,MAAiB9hC,IAGvB,GAAmB,SAAf0V,EAAMnO,MAAmBmO,EAAM+iB,QAAS,CAC1C,MAAMsJ,EAAcrsB,EAAM+iB,QAAQngC,MAAQ,GAAGod,EAAM7gB,QAAQ6gB,EAAM9gB,MAAQ,IACnEotC,EAAiB5F,EAAY5yB,OAAOu4B,GAEtC57B,MAAMC,QAAQ47B,IAChBA,EAAe/tC,QAAQ6V,IACjBA,EAAMN,QAAUrD,MAAMC,QAAQ0D,EAAMN,SACtCM,EAAMN,OAAOvV,QAAQiL,GAAS4iC,EAAWz/B,IAAInD,KAIrD,CAQA,GALI4Q,EAASjH,OAAOW,QAAUrD,MAAMC,QAAQ0J,EAASjH,MAAMW,SAAWsG,EAASjH,MAAMW,OAAO3W,OAAS,GACnGid,EAASjH,MAAMW,OAAOvV,WAAiB6tC,EAAWz/B,IAAInD,IAIhC,IAApB4iC,EAAW/wB,KAAY,EAEHqrB,EAAY9D,SAAS5iB,EAAM7gB,OAAS,IAC5CZ,QAAQ,CAAC6iC,EAAUliC,KAC/B,MAAMqtC,EAAenL,EAASx+B,MAAQ,GAAGod,EAAM7gB,QAAQD,EAAQ,IACzDotC,EAAiB5F,EAAY5yB,OAAOy4B,GAEtC97B,MAAMC,QAAQ47B,IAChBA,EAAe/tC,QAAQ6V,IACjBA,EAAMN,QAAUrD,MAAMC,QAAQ0D,EAAMN,SACtCM,EAAMN,OAAOvV,QAAQiL,GAAS4iC,EAAWz/B,IAAInD,OAKvD,CAGA,OAAI4iC,EAAW/wB,KAAO,EACb5K,MAAMua,KAAKohB,GAAYvV,OAIb,WAAf7W,EAAM7gB,KACD,CAAC,SAAU,cAAe,cAAe,iBACxB,WAAf6gB,EAAM7gB,KACR,CAAC,mBAAoB,iBAAkB,oBACtB,WAAf6gB,EAAM7gB,KACR,CAAC,uBAAwB,iCACR,aAAf6gB,EAAM7gB,KACR,CAAC,gBAAiB,kBACD,cAAf6gB,EAAM7gB,KACR,CAAC,6BAA8B,4BAA6B,0BAG9D,KAIe2d,EAAS,KAC/B,IAAK1C,EAASjH,MAAM62B,qBAAsB,MAAO,GACjD,IACE,MAAM10B,EAAO3U,KAAK+D,MAAM0V,EAASjH,MAAM62B,sBACvC,MAAO,OAAO10B,EAAK20B,sBAAsB30B,EAAK40B,cAChD,CAAA,MACE,MAAO,aACT,IAIF,MAAMsC,EAAQ1vB,EAAS,KACrB,MAAM0vB,EAAQ,CAAA,EACRC,EAASR,EAAqB94B,MAqFpC,OAlFAvJ,OAAO+J,QAAQ84B,GAAQluC,QAAQ,EAAEurC,EAAW4C,MAC1C,MAAMC,EAAa,GAGfD,EAAYlpB,UACdmpB,EAAWvuC,KAAK,CACdolB,UAAU,EACVxkB,QAAS,MAAM0tC,EAAYt5B,OAAS02B,IACpC8C,QAA8B,WAArBF,EAAYvtC,KAAoB,SAAW,SAKpDutC,EAAYG,aACVH,EAAYG,WAAWC,SACzBH,EAAWvuC,KAAK,CACd0uC,QAAS,IAAIC,OAAOL,EAAYG,WAAWC,SAC3C9tC,QAAS0tC,EAAYG,WAAW7tC,SAAW,QAC3C4tC,QAAS,SAITF,EAAYG,WAAWtxB,KACzBoxB,EAAWvuC,KAAK,CACdmd,IAAKmxB,EAAYG,WAAWtxB,IAC5Bvc,QAAS0tC,EAAYG,WAAW7tC,SAAW,KAAK0tC,EAAYG,WAAWtxB,SACvEqxB,QAAS,SAITF,EAAYG,WAAWG,QACzBL,EAAWvuC,KAAK,CACd6uC,UAAW,CAACC,EAAM/5B,EAAOL,KACvB,GAAKK,EAIL,IACExS,KAAK+D,MAAMyO,GACXL,GACF,CAAA,MACEA,EAAS,IAAI1Q,MAAMsqC,EAAYG,WAAW7tC,SAAW,cACvD,MARE8T,KAUJ85B,QAAS,UAMU,QAArBF,EAAYvtC,MACdwtC,EAAWvuC,KAAK,CACde,KAAM,MACNH,QAAS,aACT4tC,QAAS,OACTO,UAAYh6B,GACHA,IAAUA,EAAM2G,WAAW,YAAc3G,EAAM2G,WAAW,aAC7D3G,EACA,WAAWA,MAKI,aAArBu5B,EAAYvtC,MAAqC,yBAAd2qC,GACrC6C,EAAWvuC,KAAK,CACd6uC,UAAW,CAACC,EAAM/5B,EAAOL,KACvB,IACEnS,KAAK+D,MAAMyO,GACXL,GACF,CAAA,MACEA,EAAS,IAAI1Q,MAAM,cACrB,GAEFwqC,QAAS,SAITD,EAAWxvC,OAAS,IACtBqvC,EAAM1C,GAAa6C,KAIhBH,IAMHnC,EAAoBlxB,UAExB,GAAmB,WAAf6G,EAAM7gB,KAAmB,CAC3B,IAAKib,EAASjH,MAAMm4B,QAElB,YADA7W,EAAUjP,QAAQ,gBAGpB,IAAKpL,EAASjH,MAAMo4B,SAElB,YADA9W,EAAUjP,QAAQ,gBAGtB,MAAA,GAA0B,WAAfxF,EAAM7gB,KAAmB,CAClC,IAAKib,EAASjH,MAAMq4B,OAElB,YADA/W,EAAUjP,QAAQ,UAGpB,IAAKpL,EAASjH,MAAM62B,qBAElB,YADAvV,EAAUjP,QAAQ,gBAGtB,CAEA4lB,EAAej4B,OAAQ,EACvB,IAEE,MAAMi6B,EAAa,CAAA,EAGA,WAAfptB,EAAM7gB,MACRiuC,EAAW5B,OAASpxB,EAASjH,MAAMq4B,OACnC4B,EAAWpD,qBAAuB5vB,EAASjH,MAAM62B,qBAG7C5vB,EAASjH,MAAMW,QAAUsG,EAASjH,MAAMW,OAAO3W,OAAS,IAC1DiwC,EAAWt5B,OAASsG,EAASjH,MAAMW,QAIjCsG,EAASjH,MAAMk6B,eAAiBjzB,EAASjH,MAAMk6B,cAAcznB,SAC/DwnB,EAAWC,cAAgBjzB,EAASjH,MAAMk6B,cAAcznB,QAItDxL,EAASjH,MAAMvQ,OACjBwqC,EAAWxqC,KAAOwX,EAASjH,MAAMvQ,WAEL,IAA1BwX,EAASjH,MAAM6xB,SACjBoI,EAAWpI,OAAS5qB,EAASjH,MAAM6xB,UAGrCoI,EAAW9B,QAAUlxB,EAASjH,MAAMm4B,QACpC8B,EAAW7B,SAAWnxB,EAASjH,MAAMo4B,SAGjCnxB,EAASjH,MAAMvQ,OACjBwqC,EAAWxqC,KAAOwX,EAASjH,MAAMvQ,WAEL,IAA1BwX,EAASjH,MAAM6xB,SACjBoI,EAAWpI,OAAS5qB,EAASjH,MAAM6xB,SAOvC,MAAM/jC,QAAiB4gC,GAAU70B,QAAQ,mBAAmBgT,EAAM7gB,mBAAoB,CACpFsY,OAAQ,OACRD,KAAM7W,KAAKC,UAAUwsC,KAGvB,GAAInsC,EAAS3C,MAAQ2C,EAAS3C,KAAKwV,OAAQ,CAEzC,MAAMA,EAAS,GACXrD,MAAMC,QAAQzP,EAAS3C,KAAKwV,SAC9B7S,EAAS3C,KAAKwV,OAAOvV,QAAQ6V,IACvBA,EAAMN,QAAUrD,MAAMC,QAAQ0D,EAAMN,SACtCA,EAAO1V,QAAQgW,EAAMN,UAK3Bu3B,EAAcl4B,MAAQ,IAAI,IAAI7I,IAAIwJ,IAAS+iB,OAEvCwU,EAAcl4B,MAAMhW,OAAS,EAC/Bs3B,EAAUlf,QAAQ,QAAQ81B,EAAcl4B,MAAMhW,cAE9Cs3B,EAAUjP,QAAQ,WAEtB,MACEiP,EAAUjP,QAAQ,WAEtB,OAASvjB,GAEPwyB,EAAUxyB,MAAM,UAAYA,EAAMjD,QACpC,CAAA,QACEosC,EAAej4B,OAAQ,CACzB,GAIIm6B,EAAen0B,UACnB,IAGE,IAAIo0B,EAEJ,SAJMtC,EAAQ93B,MAAMq6B,WAID,QAAfxtB,EAAMnO,KAER07B,EAAa,IACRnzB,EAASjH,MACZV,cAAek5B,EAAYx4B,MAAM+M,QACjCurB,aAAcE,EAAYx4B,MAAMq3B,OAIf,WAAfxqB,EAAM7gB,aACDouC,EAAW/B,cACX+B,EAAWvD,4BACXuD,EAAWz5B,cACXy5B,EAAWF,uBAEXE,EAAWjC,eACXiC,EAAWhC,cAIf,CAELgC,EAAa,CAAA,EAGb,MAAME,EAAgB,CAAC,OAAQ,SAAU,UAAW,WAAY,SAAU,uBAAwB,SAAU,iBAC5G,IAAA,MAAWC,KAASD,EAElB,KAAc,YAAVC,GAAuBtzB,EAASjH,MAAMu6B,IAAQ5zB,WAAW,QAG/C,yBAAV4zB,GAAoCtzB,EAASjH,MAAMu6B,IAAQ5zB,WAAW,QAKtEnZ,KAAKC,UAAUwZ,EAASjH,MAAMu6B,MAAY/sC,KAAKC,UAAU8qC,EAAav4B,QAAQu6B,KAAS,CAEzF,GAAmB,WAAf1tB,EAAM7gB,MAAqB,CAAC,SAAU,uBAAwB,SAAU,iBAAiB2C,SAAS4rC,GACpG,SAEF,GAAmB,WAAf1tB,EAAM7gB,MAAqB,CAAC,UAAW,YAAY2C,SAAS4rC,GAC9D,SAEFH,EAAWG,GAAStzB,EAASjH,MAAMu6B,EACrC,CAIE/sC,KAAKC,UAAU+qC,EAAYx4B,MAAM+M,WAAavf,KAAKC,UAAU8qC,EAAav4B,OAAOV,iBACnF86B,EAAW96B,cAAgBk5B,EAAYx4B,MAAM+M,SAE3Cvf,KAAKC,UAAU+qC,EAAYx4B,MAAMq3B,SAAW7pC,KAAKC,UAAU8qC,EAAav4B,OAAOs4B,gBACjF8B,EAAW9B,aAAeE,EAAYx4B,MAAMq3B,MAIhD,CAEAW,EAAWh4B,OAAQ,QACb9U,EAAK,SAAU,CACnBc,KAAM6gB,EAAM7gB,KACZD,MAAO8gB,EAAM9gB,MACbZ,KAAMivC,EACN17B,KAAMmO,EAAMnO,OAGdy3B,GACF,OAASrnC,GACO,WAAVA,GACFwyB,EAAUxyB,MAAM,eAEpB,CAAA,QACEkpC,EAAWh4B,OAAQ,CACrB,GAIIm2B,EAAc,KAClBjrC,EAAK,SAELrC,WAAW,KACTivC,EAAQ93B,OAAOw6B,cACfzC,EAAW/3B,OAAQ,EACnBk4B,EAAcl4B,MAAQ,IACrB,aA6DL8J,EACE,IAAM+C,EAAM2mB,QACXA,IACKA,GA5Da,MACnB,MAAM8F,EAASR,EAAqB94B,MAEpC,GAAmB,SAAf6M,EAAMnO,MAAmBmO,EAAM+iB,QACjC3oB,EAASjH,MAAQ,IAAK6M,EAAM+iB,SAC5B4I,EAAYx4B,MAAQ,CAClB+M,QAASF,EAAM+iB,QAAQtwB,eAAiB,GACxC+3B,MAAOxqB,EAAM+iB,QAAQ0I,cAAgB,CAAElB,SAAU,GAAIG,UAAW,KAGlEgB,EAAav4B,MAAQxS,KAAK+D,MAAM/D,KAAKC,UAAUof,EAAM+iB,cAGhD,CAEL,MAAM6K,EAAc,CAAA,EAGpBhkC,OAAO+J,QAAQ84B,GAAQluC,QAAQ,EAAEurC,EAAW4C,MAC1CkB,EAAY9D,QAAqC,IAAxB4C,EAAYxsB,QAAwBwsB,EAAYxsB,QAAU,GAG1D,UAArBwsB,EAAYvtC,MAAqBsR,MAAMC,QAAQk9B,EAAY9D,MAC7D8D,EAAY9D,GAAa,IAIF,YAArB4C,EAAYvtC,MAAwD,kBAA3ByuC,EAAY9D,KACvD8D,EAAY9D,IAAqC,IAAxB4C,EAAYxsB,WAIzC9F,EAASjH,MAAQ,IACZy6B,EAEH95B,OAAQ85B,EAAY95B,QAAU,GAC9Bu5B,cAAeO,EAAYP,eAAiB,GAC5C56B,cAAe,GACfg5B,aAAc,CACZlB,SAAU,GACVG,UAAW,KAMfiB,EAAYx4B,MAAQ,CAClB+M,QAAS,GACTsqB,MAAO,CACLD,SAAU,GACVG,UAAW,IAGjB,GAQImD,IAGJ,CAAExwB,WAAW,uuDCncf,MAAM2C,EAAQ6gB,EAWRxiC,EAAOw0B,EAYPib,EAAkBC,IACV,CACV,WAAY,KACZC,OAAU,OAEDD,IAAWA,GAclBE,EAAoBn9B,IACZ,CACVo9B,OAAU,KACVC,YAAe,KACfC,OAAU,MAEDt9B,IAAaA,GAcpBu9B,EAAgBxuC,IACR,CACVyuC,OAAU,KACVpK,KAAQ,KACRqK,UAAa,MAEJ1uC,IAASA,GAWhB2uC,EAAgBC,IACpBpwC,EAAK,SAAUowC,IAIXC,EAAa,KACjBrwC,EAAK,OAAQ2hB,EAAMmK,SAIfwkB,EAAe,KACnBtwC,EAAK,SAAU2hB,EAAMmK,SAIjBykB,EAAe,KACnBvwC,EAAK,SAAU2hB,EAAMmK,8VAjFG4jB,kBACZ,CACV,WAAY,UACZC,OAAU,WAEDD,IAAW,wJAaIj9B,oBACd,CACVo9B,OAAU,UACVC,YAAe,SACfC,OAAU,QAEDt9B,IAAa,woBAcFjR,SACV,CACVyuC,OAAU,UACVpK,KAAQ,UACRqK,UAAa,WAEJ1uC,IAAS,gFAcAoE,YAAM4qC,MACrB5qC,EACDA,EAAK9G,QAAU0xC,EAAkB5qC,EAC9BA,EAAK6qC,UAAU,EAAGD,GAAa,MAFpB,UADC,IAAC5qC,EAAM4qC,EApBJhvC,g+BApBG,IAACiR,EAlBFi9B,gXCxE1B,MAAM/tB,EAAQ6gB,EAWRxiC,EAAOw0B,EAGPkc,EAAcjjB,EAAI,MAClBkjB,EAAWljB,EAAI,MACfmjB,EAAmBnjB,EAAI,MAGvBojB,EAAWr4B,EAAS,CACxBs4B,EAAG,EACHC,EAAG,EACHlxB,MAAO,IACPC,OAAQ,IACRkxB,WAAY,EACZC,YAAa,EACbC,eAAgB,EAChBC,gBAAiB,IAIbC,EAAY54B,EAAS,CACzB64B,YAAY,EACZjY,YAAY,EACZkY,WAAY,GACZjY,OAAQ,EACRkY,OAAQ,EACRC,WAAY,EACZC,WAAY,EACZC,eAAgB,EAChBC,gBAAiB,IAIbC,EAAenkB,EAAI,CACvBmD,KAAM,MACNK,IAAK,MACLpR,MAAO,QACPC,OAAQ,UAIJ+xB,EAAc,KAClBC,EAAS,KACP,IAAKnB,EAAS77B,QAAU47B,EAAY57B,MAAO,OAE3C,MAAMi9B,EAAQpB,EAAS77B,MACjBnL,EAAY+mC,EAAY57B,MAG9B+7B,EAASG,WAAae,EAAMC,aAC5BnB,EAASI,YAAcc,EAAME,cAC7BpB,EAASK,eAAiBvnC,EAAUuoC,YACpCrB,EAASM,gBAAkBxnC,EAAU4tB,aAGrC,MAAM4a,EAAUhzC,KAAK+d,IAAI2zB,EAASK,eAAgBL,EAASM,iBACrDiB,EAAcjzC,KAAK+d,IAAc,GAAVi1B,EAAe,KAE5CtB,EAAShxB,MAAQuyB,EACjBvB,EAAS/wB,OAASsyB,EAClBvB,EAASC,GAAKD,EAASK,eAAiBkB,GAAe,EACvDvB,EAASE,GAAKF,EAASM,gBAAkBiB,GAAe,EAExDC,IACAC,OAKED,EAAqB,KACzBT,EAAa98B,MAAQ,CACnB8b,KAAMigB,EAASC,EAAI,KACnB7f,IAAK4f,EAASE,EAAI,KAClBlxB,MAAOgxB,EAAShxB,MAAQ,KACxBC,OAAQ+wB,EAAS/wB,OAAS,OAKxBwyB,EAAgB,KACpB,IAAK3B,EAAS77B,QAAU87B,EAAiB97B,MAAO,OAEhD,MACM0K,EADSoxB,EAAiB97B,MACb2K,WAAW,MACxBsyB,EAAQpB,EAAS77B,MAGjBy9B,EAAS1B,EAASG,WAAaH,EAASK,eACxCsB,EAAS3B,EAASI,YAAcJ,EAASM,gBAEzCsB,EAAU5B,EAASC,EAAIyB,EACvBG,EAAU7B,EAASE,EAAIyB,EACvBG,EAAc9B,EAAShxB,MAAQ0yB,EAC/BK,EAAe/B,EAAS/wB,OAAS0yB,EAGvChzB,EAAIe,UAAU,EAAG,EAAG,IAAK,KAGzBf,EAAIqzB,OACJrzB,EAAIW,YACJX,EAAIY,IAAI,GAAI,GAAI,GAAI,EAAa,EAAVjhB,KAAKkhB,IAC5Bb,EAAIc,OAGJd,EAAIO,UACFgyB,EACAU,EAASC,EAASC,EAAaC,EAC/B,EAAG,EAAG,IAAK,KAGbpzB,EAAIszB,WAIAC,EAAaztC,IACb8rC,EAAUhY,aAEdgY,EAAUC,YAAa,EACvBD,EAAU/X,OAAS/zB,EAAEg0B,QACrB8X,EAAUG,OAASjsC,EAAEg1B,QACrB8W,EAAUI,WAAaX,EAASC,EAChCM,EAAUK,WAAaZ,EAASE,EAEhCzxB,SAAS8G,iBAAiB,YAAa4sB,GACvC1zB,SAAS8G,iBAAiB,UAAW6sB,GACrC3tC,EAAEghB,mBAIE0sB,EAAc1tC,IAClB,IAAK8rC,EAAUC,WAAY,OAE3B,MAAM6B,EAAS5tC,EAAEg0B,QAAU8X,EAAU/X,OAC/B8Z,EAAS7tC,EAAEg1B,QAAU8W,EAAUG,OAErC,IAAI6B,EAAOhC,EAAUI,WAAa0B,EAC9BG,EAAOjC,EAAUK,WAAa0B,EAGlCC,EAAOj0C,KAAK0xB,IAAI,EAAG1xB,KAAK+d,IAAIk2B,EAAMvC,EAASK,eAAiBL,EAAShxB,QACrEwzB,EAAOl0C,KAAK0xB,IAAI,EAAG1xB,KAAK+d,IAAIm2B,EAAMxC,EAASM,gBAAkBN,EAAS/wB,SAEtE+wB,EAASC,EAAIsC,EACbvC,EAASE,EAAIsC,EAEbhB,IACAC,KAIIW,EAAW,KACf7B,EAAUC,YAAa,EACvB/xB,SAAS2H,oBAAoB,YAAa+rB,GAC1C1zB,SAAS2H,oBAAoB,UAAWgsB,IAIpC9Z,EAAer4B,IACnBswC,EAAUhY,YAAa,EACvBgY,EAAUE,WAAaxwC,EACvBswC,EAAU/X,OAASrf,MAAMsf,QACzB8X,EAAUG,OAASv3B,MAAMsgB,QACzB8W,EAAUI,WAAaX,EAASC,EAChCM,EAAUK,WAAaZ,EAASE,EAChCK,EAAUM,eAAiBb,EAAShxB,MACpCuxB,EAAUO,gBAAkBd,EAAS/wB,OAErCR,SAAS8G,iBAAiB,YAAaktB,GACvCh0B,SAAS8G,iBAAiB,UAAWuT,GACrC3f,MAAMsM,kBAIFgtB,EAAgBhuC,IACpB,IAAK8rC,EAAUhY,WAAY,OAE3B,MAAM8Z,EAAS5tC,EAAEg0B,QAAU8X,EAAU/X,OAC/B8Z,EAAS7tC,EAAEg1B,QAAU8W,EAAUG,OAErC,IAAI6B,EAAOhC,EAAUI,WACjB6B,EAAOjC,EAAUK,WACjB7X,EAAWwX,EAAUM,eACrB6B,EAAYnC,EAAUO,gBAG1B,OAAQP,EAAUE,YAChB,IAAK,KACH8B,EAAOhC,EAAUI,WAAa0B,EAC9BG,EAAOjC,EAAUK,WAAa0B,EAC9BvZ,EAAWwX,EAAUM,eAAiBwB,EACtCK,EAAYnC,EAAUO,gBAAkBwB,EACxC,MACF,IAAK,KACHE,EAAOjC,EAAUK,WAAa0B,EAC9BvZ,EAAWwX,EAAUM,eAAiBwB,EACtCK,EAAYnC,EAAUO,gBAAkBwB,EACxC,MACF,IAAK,KACHC,EAAOhC,EAAUI,WAAa0B,EAC9BtZ,EAAWwX,EAAUM,eAAiBwB,EACtCK,EAAYnC,EAAUO,gBAAkBwB,EACxC,MACF,IAAK,KACHvZ,EAAWwX,EAAUM,eAAiBwB,EACtCK,EAAYnC,EAAUO,gBAAkBwB,EAK5C,MAAMn2B,EAAO7d,KAAK+d,IAAI0c,EAAU2Z,GAChC3Z,EAAW5c,EACXu2B,EAAYv2B,EAIR4c,EADY,IACU2Z,EADV,KAIZH,EAAO,IACTxZ,GAAYwZ,EACZG,EAAY3Z,EACZwZ,EAAO,GAELC,EAAO,IACTE,GAAaF,EACbzZ,EAAW2Z,EACXF,EAAO,GAELD,EAAOxZ,EAAWiX,EAASK,iBAC7BtX,EAAWiX,EAASK,eAAiBkC,EACrCG,EAAY3Z,GAEVyZ,EAAOE,EAAY1C,EAASM,kBAC9BoC,EAAY1C,EAASM,gBAAkBkC,EACvCzZ,EAAW2Z,GAGb1C,EAASC,EAAIsC,EACbvC,EAASE,EAAIsC,EACbxC,EAAShxB,MAAQ+Z,EACjBiX,EAAS/wB,OAASyzB,EAElBlB,IACAC,MAII3Y,EAAa,KACjByX,EAAUhY,YAAa,EACvB9Z,SAAS2H,oBAAoB,YAAaqsB,GAC1Ch0B,SAAS2H,oBAAoB,UAAW0S,IAuC1C/a,EAAM,IAAM+C,EAAM6xB,SAAU,KACtB7xB,EAAM2mB,SAAW3mB,EAAM6xB,UACzB1B,EAAS,KACPD,QAMN,MAAM5G,EAAc,KAClBjrC,EAAK,UAIDyzC,EAAgB34B,UACpB,MAAM44B,QAjDC,IAAIvlC,QAASI,IAClB,MAAM8Q,EAASC,SAASC,cAAc,UAChCC,EAAMH,EAAOI,WAAW,MACxBsyB,EAAQpB,EAAS77B,MAGjB6+B,EAAa,IACnBt0B,EAAOQ,MAAQ8zB,EACft0B,EAAOS,OAAS6zB,EAGhB,MAAMpB,EAAS1B,EAASG,WAAaH,EAASK,eACxCsB,EAAS3B,EAASI,YAAcJ,EAASM,gBAEzCsB,EAAU5B,EAASC,EAAIyB,EACvBG,EAAU7B,EAASE,EAAIyB,EACvBG,EAAc9B,EAAShxB,MAAQ0yB,EAC/BK,EAAe/B,EAAS/wB,OAAS0yB,EAGvChzB,EAAIO,UACFgyB,EACAU,EAASC,EAASC,EAAaC,EAC/B,EAAG,EAAGe,EAAYA,GAIpBt0B,EAAOmB,OAAQ7C,IACbpP,EAAQoP,IACP,aAAc,MAqBnB3d,EAAK,UAAW0zC,0hECnKlB,MAAM/xB,EAAQ6gB,EAgBRxiC,EAAOw0B,EAEPoY,EAAUnf,EAAI,MACdqf,EAAarf,GAAI,GAGjB1R,EAAWvD,EAAS,CACxBjU,KAAM,GACNkO,SAAU,SACVjO,OAAQ,GACRkP,QAAS,GACT7K,QAAS,GACT4K,MAAO,KAIHmgC,EAAY,CAChBrvC,KAAM,CACJ,CAAE4gB,UAAU,EAAMxkB,QAAS,UAAW4tC,QAAS,QAC/C,CAAErxB,IAAK,EAAG2T,IAAK,GAAIlwB,QAAS,kBAAmB4tC,QAAS,SAE1D97B,SAAU,CACR,CAAE0S,UAAU,EAAMxkB,QAAS,UAAW4tC,QAAS,WAEjD1lC,QAAS,CACP,CAAEsc,UAAU,EAAMxkB,QAAS,aAAc4tC,QAAS,UAClD,CACEK,UAAW,CAAC//B,EAAGiG,EAAOL,KACpB,GAAKrC,MAAMC,QAAQyC,IAA2B,IAAjBA,EAAMhW,OAAnC,CAKA,IAAA,IAASG,EAAI,EAAGA,EAAI6V,EAAMhW,OAAQG,IAAK,CACrC,MAAM0Z,EAAO7D,EAAM7V,GACnB,IAAK0Z,EAAKnX,OAASmX,EAAK/W,QAEtB,YADA6S,EAAS,IAAI1Q,MAAM,KAAK9E,EAAI,mBAGhC,CAEAwV,GAVA,MAFEA,EAAS,IAAI1Q,MAAM,gBAcvBwqC,QAAS,YAMTsF,EAAepmB,EAAI,IACnBqmB,EAAermB,GAAI,GAGnBsmB,EAAkBtmB,EAAI,MACtBumB,EAAkBvmB,GAAI,GACtBwmB,EAAiBxmB,GAAI,GACrBymB,EAAmBzmB,EAAI,IACvB0mB,EAAgB,CACpB,eAAgB9iC,aAAaG,QAAQ,eAAiB,IAIlD4iC,EAAgB,CACpBC,UAAU,EACVC,eAAe,EACfx/B,MAAO,QACPC,MAAO,QACP2W,SAAU,WACV6oB,UAAU,GAgGZ31B,EAAM,IAAM+C,EAAMmK,OAAS0oB,IACrBA,GAA4B,SAAf7yB,EAAMnO,OACrBuI,EAASxX,KAAOiwC,EAAUjwC,MAAQ,GAClCwX,EAAStJ,SAAW+hC,EAAU/hC,UAAY,SAC1CsJ,EAASvX,OAASgwC,EAAUhwC,QAAU,GACtCuX,EAASrI,QAAU8gC,EAAU9gC,SAAW,GACxCqI,EAASlT,QAAU2rC,EAAU3rC,QAAU,IAAI2rC,EAAU3rC,SAAW,GAChEkT,EAAStI,MAAQ+gC,EAAU/gC,MAAQ,IAAI+gC,EAAU/gC,OAAS,KAE3D,CAAEuL,WAAW,IAGhBJ,EAAM,IAAM+C,EAAM2mB,QAAUA,IACtBA,IACiB,WAAf3mB,EAAMnO,MAERihC,IAGF3C,EAAS,KACPlF,EAAQ93B,OAAO4/B,qBAMrB,MAAMD,EAAY,KAChB14B,EAASxX,KAAO,GAChBwX,EAAStJ,SAAW,SACpBsJ,EAASvX,OAAS,GAClBuX,EAASrI,QAAU,GACnBqI,EAASlT,QAAU,GACnBkT,EAAStI,MAAQ,IAIbkhC,EAAiB,KACrB54B,EAASlT,QAAQ9I,KAAK,CACpByB,KAAM,SACNI,QAAS,MAUPqpC,EAAc,KACd6B,EAAWh4B,OACf9U,EAAK,UAKD40C,EAAoB5zC,IACxB,MAAMua,EAAUva,EAAK6zC,IAAI/zC,KAAK2a,WAAW,UACnCq5B,EAAS9zC,EAAK6zC,IAAI73B,KAAO,KAAO,KAAO,EAE7C,IAAKzB,EAEH,YADA6a,EAAUxyB,MAAM,aAGlB,IAAKkxC,EAEH,YADA1e,EAAUxyB,MAAM,iBAKlB,MAAMga,EAAS,IAAIC,WACnBD,EAAOf,OAAUvX,IACf4uC,EAAiBp/B,MAAQxP,EAAEuM,OAAO9S,OAClCk1C,EAAen/B,OAAQ,GAEzB8I,EAAOG,cAAc/c,EAAK6zC,MAItBE,EAAqB,KACzBd,EAAen/B,OAAQ,EACvBo/B,EAAiBp/B,MAAQ,IAIrBkgC,EAAuBl6B,MAAO44B,IAClCO,EAAen/B,OAAQ,EACvBk/B,EAAgBl/B,OAAQ,EAExB,IAEE,MAAMmgC,EAAiB,IAAIj5B,SAC3Bi5B,EAAeh5B,OAAO,QAASy3B,EAAa,cAG5C,MAAM9wC,QAAiBvC,MAAM,oBAAqB,CAChD+Y,OAAQ,OACRC,QAAS86B,EACTh7B,KAAM87B,IAGFl2C,QAAe6D,EAASqU,OAEV,IAAhBlY,EAAO6M,MAAc7M,EAAOkB,MAAMK,KACpCyb,EAASvX,OAASzF,EAAOkB,KAAKK,IAC9B81B,EAAUlf,QAAQ,WAElBkf,EAAUxyB,MAAM,YAAc7E,EAAO4B,SAAW,QAEpD,OAASiD,GACPwyB,EAAUxyB,MAAM,WAAaA,EAAMjD,QACrC,CAAA,QACEqzC,EAAgBl/B,OAAQ,CAC1B,GAIIogC,EAAe,KACnBn5B,EAASvX,OAAS,GAClB4xB,EAAUlf,QAAQ,UAId+3B,EAAen0B,UACnB,IAAIgyB,EAAWh4B,MAEf,UAEQ83B,EAAQ93B,OAAOq6B,YAErBrC,EAAWh4B,OAAQ,EAGnB,MAAMo6B,EAAa,CACjB3qC,KAAMwX,EAASxX,KAAKgjB,OACpB9U,SAAUsJ,EAAStJ,SACnBiB,QAASqI,EAASrI,QAAQ6T,OAC1B1e,QAASkT,EAASlT,QAAQ1B,IAAIwR,IAAA,CAC5BnX,KAAMmX,EAAKnX,KACXI,QAAS+W,EAAK/W,QAAQ2lB,UACpBlmB,OAAOsX,GAAQA,EAAK/W,SACxB6R,MAAOsI,EAAStI,MAAMpS,OAAOk+B,GAAQA,EAAKhY,SAIxCxL,EAASvX,SACX0qC,EAAW1qC,OAASuX,EAASvX,QAI/BxE,EAAK,SAAU,CACbC,KAAMivC,EACN17B,KAAMmO,EAAMnO,OAIdxT,EAAK,QACP,OAAS4D,GAGT,CAAA,QACEkpC,EAAWh4B,OAAQ,CACrB,UAIF4iB,EAAU,KAlQmB5c,WAC3B,IAAIg5B,EAAah/B,MAAjB,CAEAg/B,EAAah/B,OAAQ,EACrB,IAEE,MAAMqgC,QAAsB9P,GAAUC,cACtC,GAA2B,IAAvB6P,EAAcvpC,KAEhB,OAGF,MAAMs7B,EAAUiO,EAAcl1C,KAAKinC,SAAW,GACxCkO,MAAetU,IAGrB,IAAA,MAAW/c,KAAUmjB,EACnB,GAAKnjB,EAAOyb,QAEZ,IACE,MAAM6V,QAAoBhQ,GAAUM,eAAe5hB,EAAOxf,MACjC,IAArB8wC,EAAYzpC,MAAcypC,EAAYp1C,KAAKwT,OAE7C4hC,EAAYp1C,KAAKwT,MAAMvT,QAAQ6V,IAC7BA,EAAMtC,MAAMvT,QAAQq/B,IAElB,MAAM+V,EAAiB/V,EAAKh7B,KAAKkK,MAAM,SAAS,GAE3C2mC,EAAS/mC,IAAIinC,IAChBF,EAASpU,IAAIsU,EAAgB,CAC3BxgC,MAAOwgC,EACPvgC,MAAOugC,EACPC,SAAUhW,EAAKh7B,KACf09B,YAAa1C,EAAK0C,YAClBle,OAAQA,EAAOlR,YACfkD,MAAOA,EAAMA,WAMzB,OAASnS,GAET,CAIF,MAAM4xC,MAAmB1U,IAEzBsU,EAASl1C,QAAQq/B,IAEViW,EAAannC,IAAIkxB,EAAKxb,SACzByxB,EAAaxU,IAAIzB,EAAKxb,OAAQ,CAC5BjP,MAAOyqB,EAAKxb,OACZhP,MAAOwqB,EAAKxb,OACZ2H,aAAcoV,MAIlB,MAAM2U,EAAcD,EAAalzB,IAAIid,EAAKxb,QAGrC0xB,EAAY/pB,SAASrd,IAAIkxB,EAAKxpB,QACjC0/B,EAAY/pB,SAASsV,IAAIzB,EAAKxpB,MAAO,CACnCjB,MAAO,GAAGyqB,EAAKxb,UAAUwb,EAAKxpB,QAC9BhB,MAAOwqB,EAAKxpB,MACZ2V,SAAU,KAKd+pB,EAAY/pB,SAASpJ,IAAIid,EAAKxpB,OAAO2V,SAAS3rB,KAAK,CACjD+U,MAAOyqB,EAAKzqB,MACZC,MAAOwqB,EAAKxqB,UAKhB8+B,EAAa/+B,MAAQ1C,MAAMua,KAAK6oB,EAAajjC,UAAUpL,IAAI4c,IAAA,IACtDA,EACH2H,SAAUtZ,MAAMua,KAAK5I,EAAO2H,SAASnZ,YAEzC,OAAS3O,GAGPiwC,EAAa/+B,MAAQ,EACvB,CAAA,QACEg/B,EAAah/B,OAAQ,CACvB,CAvFwB,GAkQxB4gC,k1FA3HwB,CAAC70C,IACzBkb,EAASlT,QAAQO,OAAOvI,EAAO"}