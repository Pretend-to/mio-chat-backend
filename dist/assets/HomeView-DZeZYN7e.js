import{_ as P,r as v,o as a,c as d,a as s,w as f,v as S,F as y,b as _,n as w,t as m,d as b,e as p,f as I,g as L,h as k,i as l,j as x,k as $,l as T}from"./index-BlN-F8uX.js";const C={data(){return{show:!1,presetsList:[],recommendPresets:[],recentPresets:[],localPresets:[],systemPresets:[],searchPresets:[],systemShownNum:0,recommendShownNum:0,keyWord:"",activeTypeIndex:0,buttonTranslate:0,avaliablePresetTypes:["推荐","最近","本地","系统"],moreSystemPresets:!0,moreRecommendPresets:!0}},computed:{showPresetsLoader(){return this.activeTypeIndex==3?this.moreSystemPresets:this.activeTypeIndex==0?this.moreRecommendPresets:!1},shownPrestsList(){return this.activeTypeIndex===2?this.localPresets:this.activeTypeIndex===1?this.recentPresets:this.activeTypeIndex===0?this.recommendPresets:this.activeTypeIndex===3?this.systemPresets:null}},methods:{async addBot(e){this.strogeAddHistory(e),this.$emit("addBot",e),console.log(e)},strogeAddHistory(e){const t=this.recentPresets.find(r=>r.name===e.name);t&&this.recentPresets.splice(this.recentPresets.indexOf(t),1),this.recentPresets.unshift(e),this.recentPresets.length>6&&this.recentPresets.pop(),localStorage.setItem("addHistory",JSON.stringify(this.recentPresets))},getAddHistory(){const e=localStorage.getItem("addHistory");e&&(this.recentPresets=JSON.parse(e))},async changeShownType(e){this.activeTypeIndex=e,this.buttonTranslate=`${49.6*e}px`,await this.loadSpecificType()},close(){this.$emit("close")},async loadSpecificType(){const e=this.avaliablePresetTypes[this.activeTypeIndex];this.presetsList=await this.getPresetList(e)},async getPresetList(e){if(e==="系统")return await this.loadSystemPresets();if(e==="推荐")return await this.loadRecommendedPresets();if(e==="最近")return this.recentPresets;if(e==="本地")return this.localPresets},async loadRecommendedPresets(){const e=await fetch(`/api/openai/presets?type=recommended&start=${this.recommendShownNum}`).then(t=>t.json());for(let t=0;t<e.data.length;t++)this.recommendPresets.push(e.data[t]);return this.recommendShownNum+=e.data.length,e.data.length<9&&(this.moreRecommendPresets=!1),this.recommendPresets},async loadSystemPresets(){const e=await fetch(`/api/openai/presets?type=system&start=${this.systemShownNum}`).then(t=>t.json());for(let t=0;t<e.data.length;t++)this.systemPresets.push(e.data[t]);return this.systemShownNum+=e.data.length,e.data.length<9&&(this.moreSystemPresets=!1),this.systemPresets}},mounted(){const e=c=>{c.forEach(n=>{n.isIntersecting&&(this.showPresetsLoader&&this.activeTypeIndex===3?this.loadSystemPresets():this.showPresetsLoader&&this.activeTypeIndex===0&&this.loadRecommendedPresets())})},t=new IntersectionObserver(e),r=this.$refs.loader;t.observe(r),this.getAddHistory()}},B={class:"add-contactor"},R={class:"head"},A={class:"body"},N={class:"search"},z={class:"info"},W={class:"presets-types"},M=["onClick"],O={class:"presets-list"},H={class:"preset-avatar"},E={class:"preset-info"},V={class:"preset-name"},F=["title"],X={ref:"loader",class:"loading"};function j(e,t,r,c,n,i){const u=v("el-button");return a(),d("div",B,[s("div",R,[t[2]||(t[2]=s("div",{class:"title"},"添加机器人",-1)),s("div",{class:"close-icon",onClick:t[0]||(t[0]=(...o)=>i.close&&i.close(...o))},"✕")]),s("div",A,[s("div",N,[t[3]||(t[3]=s("i",{class:"iconfont sousuo listicon"},null,-1)),f(s("input",{type:"text",placeholder:"输入搜索关键词","onUpdate:modelValue":t[1]||(t[1]=o=>n.keyWord=o)},null,512),[[S,n.keyWord]])]),s("div",z,[s("header",W,[(a(!0),d(y,null,_(n.avaliablePresetTypes,(o,h)=>(a(),d("nav",{key:h,onClick:g=>i.changeShownType(h),class:w(n.activeTypeIndex===h?"active":"")},m(o),11,M))),128))]),s("div",{style:b({left:n.buttonTranslate}),class:"slide-button"},null,4),s("div",O,[(a(!0),d(y,null,_(i.shownPrestsList,(o,h)=>(a(),d("div",{class:"presets-item",key:h},[s("div",H,m(o.name.slice(0,2)),1),s("div",E,[s("div",V,m(o.name),1),s("div",{title:o.opening,class:"preset-description"},m(o.opening),9,F)]),p(u,{onClick:g=>i.addBot(o)},{default:I(()=>t[4]||(t[4]=[L("添加")])),_:2},1032,["onClick"])]))),128)),f(s("div",X,t[5]||(t[5]=[s("div",null,null,-1),s("div",null,null,-1),s("div",null,null,-1),s("div",null,null,-1),s("div",null,null,-1)]),512),[[k,i.showPresetsLoader]])])]),t[6]||(t[6]=s("div",{class:"options"},null,-1))])])}const D=P(C,[["render",j],["__scopeId","data-v-186b971a"]]),U={data(){const e=l.contactList.map(r=>x(r));return{onPhone:l.onPhone,contactorList:e,showAddOptions:!1,showAddWindow:!1}},methods:{genBotByPreset(){this.showAddOptions=!1,this.showAddWindow=!0},showChat(e){this.$route.name=="blank"||this.$route.name=="chat_view"?this.$router.push({name:"chat_view",params:{id:e}}):this.$route.name=="contactors"||this.$route.name=="profile_view"?this.$router.push({name:"profile_view",params:{id:e}}):this.$router.replace({name:"chat_view",params:{id:e}})},getId(e){let t=this.$route.params.id,r=e.id;return t==r?"active":e.priority==0?"important":""},genBlankBot(){const e={id:this.genFakeId(),name:l.default_model,activeModel:l.default_model,avatar:"/static/avatar/openai.png",title:"gpt",priority:1,options:{}};this.showAddOptions=!1,this.addReactiveListener(),l.addConcator("openai",e)},startResize(e){this.isResizing=!0,this.startX=e.clientX,this.startWidth=this.$refs.friendlists.offsetWidth,document.addEventListener("mousemove",this.resize),document.addEventListener("mouseup",this.stopResize)},resize(e){if(this.isResizing){let t=this.startWidth+(e.clientX-this.startX);const r=500,c=176;t=t>r?r:t<c?c:t,this.$refs.friendlists.style.flexBasis=t+"px"}},stopResize(){this.isResizing=!1,document.removeEventListener("mousemove",this.resize),document.removeEventListener("mouseup",this.stopResize)},genFakeId(){const t=`1${Math.floor(1e3+Math.random()*9e3)}`;if(this.id){const r=Math.floor(1e3+Math.random()*9e3),c=`${this.id}${r}`;return parseInt(c)}else return parseInt(t)},addPresetContactor(e){console.log(e);const t={id:this.genFakeId(),name:e.name,title:e.title,activeModel:e.recommendedModel??l.default_model,priority:1,options:{opening:e.opening,history:e.history,textWrapper:e.textWrapper,tools:e.tools}};this.addReactiveListener(),l.addConcator("openai",t)},addReactiveListener(){this.contactorList.map(e=>{e.on("updateMessageSummary",()=>{e.lastMessageSummary=e.getMessageSummary()})})}},components:{AddContactor:D},computed:{sortedList(){return[...this.contactorList].sort((e,t)=>t.priority-e.priority==-1?1:t.lastUpdate-e.lastUpdate)}},mounted(){this.addReactiveListener()}},J={class:"upsidebar",id:"friends"},q={class:"bu-add"},G={id:"add-options"},K={class:"people"},Q=["onClick","id"],Y={class:"avatar"},Z=["src","alt"],ee={class:"info"},te={class:"name"},se={class:"msginfo",id:"time"},oe={class:"msginfo",id:"msgctt"};function ie(e,t,r,c,n,i){const u=v("AddContactor");return a(),d("div",{id:"friendlists",ref:"friendlists",class:w(n.onPhone?"mobile":"")},[s("div",J,[t[5]||(t[5]=s("div",{class:"search"},[s("i",{class:"iconfont sousuo listicon"}),s("input",{type:"text",id:"tosearch",placeholder:"搜索"})],-1)),s("div",q,[s("button",{id:"addcont",onClick:t[0]||(t[0]=o=>n.showAddOptions=!n.showAddOptions)},"+"),f(s("div",G,[s("ul",null,[s("li",null,[s("button",{onClick:t[1]||(t[1]=(...o)=>i.genBlankBot&&i.genBlankBot(...o))},"新建空白Bot")]),s("li",null,[s("button",{onClick:t[2]||(t[2]=(...o)=>i.genBotByPreset&&i.genBotByPreset(...o))},"从预设新建Bot")])])],512),[[k,n.showAddOptions]])])]),s("div",K,[(a(!0),d(y,null,_(i.sortedList,(o,h)=>(a(),d("div",{onClick:g=>i.showChat(o.id),key:h,class:"lists",id:i.getId(o)},[s("div",Y,[s("img",{src:o.avatar,alt:o.name},null,8,Z)]),s("div",ee,[s("div",te,m(o.name),1),s("div",se,m(o.getLastTime()),1),s("div",oe,m(o.lastMessageSummary),1)])],8,Q))),128))]),s("div",{class:"resizer",onMousedown:t[3]||(t[3]=(...o)=>i.startResize&&i.startResize(...o))},null,32),n.showAddWindow?(a(),$(u,{key:0,onClose:t[4]||(t[4]=o=>n.showAddWindow=!1),onAddBot:i.addPresetContactor},null,8,["onAddBot"])):T("",!0)],2)}const ne=P(U,[["render",ie],["__scopeId","data-v-92f8cbff"]]),re={data(){return console.log(l.onPhone),{onPhone:l.onPhone,client:l,pagePath:this.$route.path}},components:{friendlist:ne},methods:{},mounted(){},computed:{},watch:{$route:function(e){this.pagePath=e.path}}},ae={key:0,id:"main"},de={key:1,id:"main-mobile"},le={key:2,id:"main-mobile",class:"mobile-chat"};function ce(e,t,r,c,n,i){const u=v("friendlist"),o=v("router-view");return n.onPhone?n.pagePath==="/"?(a(),d("div",de,[p(u)])):(a(),d("div",le,[p(o)])):(a(),d("div",ae,[p(u),p(o)]))}const me=P(re,[["render",ce]]);export{me as default};
