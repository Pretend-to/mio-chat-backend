import{_ as g,r as v,o as a,c as r,a as t,w as f,v as I,F as y,b as w,n as k,t as h,d as B,e as _,f as S,g as L,h as b,p as $,i as C,j as T,k as c,l as x,m as A}from"./index-Ck2D_opc.js";const W={data(){return{show:!1,presetsList:[],recommendPresets:[],recentPresets:[],localPresets:[],systemPresets:[],searchPresets:[],systemShownNum:0,recommendShownNum:0,keyWord:"",activeTypeIndex:0,buttonTranslate:0,avaliablePresetTypes:["推荐","最近","本地","系统"],moreSystemPresets:!0,moreRecommendPresets:!0}},computed:{showPresetsLoader(){return this.activeTypeIndex==3?this.moreSystemPresets:this.activeTypeIndex==0?this.moreRecommendPresets:!1}},methods:{async addBot(e){this.$emit("addBot",e),this.close(),console.log(e)},async changeShownType(e){this.activeTypeIndex=e,this.buttonTranslate=`${49.6*e}px`,await this.loadSpecificType()},close(){this.$emit("close")},async loadSpecificType(){const e=this.avaliablePresetTypes[this.activeTypeIndex];this.presetsList=await this.getPresetList(e)},async getPresetList(e){if(e==="系统")return await this.loadSystemPresets();if(e==="推荐")return this.recommendPresets;if(e==="最近")return this.recentPresets;if(e==="本地")return this.localPresets},async loadSystemPresets(){const e=await fetch(`/api/openai/presets?type=system&start=${this.systemShownNum}`).then(s=>s.json());for(let s=0;s<e.data.length;s++)this.systemPresets.push(e.data[s]);return this.systemShownNum+=e.data.length,e.data.length<9&&(this.moreSystemPresets=!1),this.systemPresets}},mounted(){const e=l=>{l.forEach(i=>{i.isIntersecting&&(this.showPresetsLoader&&this.activeTypeIndex===3?this.loadSystemPresets():this.showPresetsLoader&&this.activeTypeIndex===0&&this.loadRecommendPresets())})},s=new IntersectionObserver(e),d=this.$refs.loader;s.observe(d)}},u=e=>($("data-v-0c4669a9"),e=e(),C(),e),z={class:"add-contactor"},N={class:"head"},R=u(()=>t("div",{class:"title"},"添加机器人",-1)),M={class:"body"},O={class:"search"},E=u(()=>t("i",{class:"iconfont sousuo listicon"},null,-1)),V={class:"info"},F={class:"presets-types"},U=["onClick"],X={class:"presets-list"},D={class:"preset-avatar"},j={class:"preset-info"},H={class:"preset-name"},q={class:"preset-description"},G={class:"preset-detail"},J={ref:"loader",class:"loading"},K=u(()=>t("div",null,null,-1)),Q=u(()=>t("div",null,null,-1)),Y=u(()=>t("div",null,null,-1)),Z=u(()=>t("div",null,null,-1)),ee=u(()=>t("div",null,null,-1)),te=[K,Q,Y,Z,ee],se=u(()=>t("div",{class:"options"},null,-1));function oe(e,s,d,l,i,n){const p=v("el-button");return a(),r("div",z,[t("div",N,[R,t("div",{class:"close-icon",onClick:s[0]||(s[0]=(...o)=>n.close&&n.close(...o))},"✕")]),t("div",M,[t("div",O,[E,f(t("input",{type:"text",placeholder:"输入搜索关键词","onUpdate:modelValue":s[1]||(s[1]=o=>i.keyWord=o)},null,512),[[I,i.keyWord]])]),t("div",V,[t("header",F,[(a(!0),r(y,null,w(i.avaliablePresetTypes,(o,m)=>(a(),r("nav",{key:m,onClick:P=>n.changeShownType(m),class:k(i.activeTypeIndex===m?"active":"")},h(o),11,U))),128))]),t("div",{style:B({left:i.buttonTranslate}),class:"slide-button"},null,4),t("div",X,[(a(!0),r(y,null,w(i.presetsList,(o,m)=>(a(),r("div",{class:"presets-item",key:m},[t("div",D,h(o.name.slice(0,2)),1),t("div",j,[t("div",H,h(o.name),1),t("div",q,h(o.opening),1),t("div",G,h(o.opening),1)]),_(p,{onClick:P=>n.addBot(o)},{default:S(()=>[L("添加")]),_:2},1032,["onClick"])]))),128)),f(t("div",J,te,512),[[b,n.showPresetsLoader]])])]),se])])}const ie=g(W,[["render",oe],["__scopeId","data-v-0c4669a9"]]),ne={data(){const e=T(c.contactList);return{onPhone:c.onPhone,contactorList:e,showAddOptions:!1,showAddWindow:!1}},methods:{genBotByPreset(){this.showAddOptions=!1,this.showAddWindow=!0},showChat(e){this.$route.name=="blank"||this.$route.name=="chat_view"?this.$router.push({name:"chat_view",params:{id:e}}):this.$route.name=="contactors"||this.$route.name=="profile_view"?this.$router.push({name:"profile_view",params:{id:e}}):this.$router.replace({name:"chat_view",params:{id:e}})},getId(e){let s=this.$route.params.id,d=e.id;return s==d?"active":e.priority==0?"important":""},genBlankBot(){const e={id:this.genFakeId(),name:c.default_model,activeModel:c.default_model,avatar:"/static/avatar/openai.png",title:"gpt",priority:1,options:{}};this.showAddOptions=!1,c.addConcator("openai",e)},startResize(e){this.isResizing=!0,this.startX=e.clientX,this.startWidth=this.$refs.friendlists.offsetWidth,document.addEventListener("mousemove",this.resize),document.addEventListener("mouseup",this.stopResize)},resize(e){if(this.isResizing){let s=this.startWidth+(e.clientX-this.startX);const d=500,l=176;s=s>d?d:s<l?l:s,this.$refs.friendlists.style.flexBasis=s+"px"}},stopResize(){this.isResizing=!1,document.removeEventListener("mousemove",this.resize),document.removeEventListener("mouseup",this.stopResize)},genFakeId(){const s=`1${Math.floor(1e3+Math.random()*9e3)}`;if(this.id){const d=Math.floor(1e3+Math.random()*9e3),l=`${this.id}${d}`;return parseInt(l)}else return parseInt(s)},addPresetContactor(e){console.log(e),this.showAddWindow=!1;const s={id:this.genFakeId(),name:e.name,title:e.title,activeModel:c.default_model,priority:1,options:{opening:e.opening,history:e.history,textWrapper:e.textWrapper,tools:e.tools}};c.addConcator("openai",s)}},components:{AddContactor:ie},computed:{sortedList(){return[...this.contactorList].sort((e,s)=>s.priority-e.priority==-1?1:s.lastUpdate-e.lastUpdate)}},mounted(){this.contactorList.map(e=>{e.on("updateMessage",()=>{this.$forceUpdate()})})}},ae=e=>($("data-v-20abb2ca"),e=e(),C(),e),de={class:"upsidebar",id:"friends"},re=ae(()=>t("div",{class:"search"},[t("i",{class:"iconfont sousuo listicon"}),t("input",{type:"text",id:"tosearch",placeholder:"搜索"})],-1)),ce={class:"bu-add"},le={id:"add-options"},he={class:"people"},ue=["onClick","id"],me={class:"avatar"},pe=["src","alt"],_e={class:"info"},ve={class:"name"},fe={class:"msginfo",id:"time"},ye={class:"msginfo",id:"msgctt"};function we(e,s,d,l,i,n){const p=v("AddContactor");return a(),r("div",{id:"friendlists",ref:"friendlists",class:k(i.onPhone?"mobile":"")},[t("div",de,[re,t("div",ce,[t("button",{id:"addcont",onClick:s[0]||(s[0]=o=>i.showAddOptions=!i.showAddOptions)},"+"),f(t("div",le,[t("ul",null,[t("li",null,[t("button",{onClick:s[1]||(s[1]=(...o)=>n.genBlankBot&&n.genBlankBot(...o))},"新建空白Bot")]),t("li",null,[t("button",{onClick:s[2]||(s[2]=(...o)=>n.genBotByPreset&&n.genBotByPreset(...o))},"从预设新建Bot")])])],512),[[b,i.showAddOptions]])])]),t("div",he,[(a(!0),r(y,null,w(n.sortedList,(o,m)=>(a(),r("div",{onClick:P=>n.showChat(o.id),key:m,class:"lists",id:n.getId(o)},[t("div",me,[t("img",{src:o.avatar,alt:o.name},null,8,pe)]),t("div",_e,[t("div",ve,h(o.name),1),t("div",fe,h(o.getLastTime()),1),t("div",ye,h(o.getMessageSummary()),1)])],8,ue))),128))]),t("div",{class:"resizer",onMousedown:s[3]||(s[3]=(...o)=>n.startResize&&n.startResize(...o))},null,32),i.showAddWindow?(a(),x(p,{key:0,onClose:s[4]||(s[4]=o=>i.showAddWindow=!1),onAddBot:n.addPresetContactor},null,8,["onAddBot"])):A("",!0)],2)}const ge=g(ne,[["render",we],["__scopeId","data-v-20abb2ca"]]),Pe={data(){return console.log(c.onPhone),{onPhone:c.onPhone,client:c,pagePath:this.$route.path}},components:{friendlist:ge},methods:{},mounted(){},computed:{},watch:{$route:function(e){this.pagePath=e.path}}},ke={key:0,id:"main"},be={key:1,id:"main-mobile"},$e={key:2,id:"main-mobile",class:"mobile-chat"};function Ce(e,s,d,l,i,n){const p=v("friendlist"),o=v("router-view");return i.onPhone?i.pagePath==="/"?(a(),r("div",be,[_(p)])):(a(),r("div",$e,[_(o)])):(a(),r("div",ke,[_(p),_(o)]))}const Be=g(Pe,[["render",Ce]]);export{Be as default};
